Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    1


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A        1 	INCLUDE "IODEFS.H"
                             B        1 ;	CPU  Z80
                             B        2 
                             B        3 	.IFNDEF RAMSTARTLOC
                             B        4 
                             B        5 	
                             B        6 	DEFINE BOOT;,ALIGN=1; Define a section
                             B        7 	DEFINE IM1INTSEG ;Define a section
                             B        8 	DEFINE NMIIM1INTSEG
                             B        9 	DEFINE CODE;,ALIGN=1
                             B       10 
                             B       11 	DEFINE RST08SEG
                             B       12 	DEFINE RST10SEG
                             B       13 	DEFINE RST18SEG
                             B       14 	DEFINE RST20SEG
                             B       15 	DEFINE RST28SEG
                             B       16 	DEFINE RST30SEG
                             B       17 	DEFINE RST38SEG
                             B       18 
                             B       19 	DEFINE RST66SEG
                             B       20 
                             B       21 	DEFINE INTTABLE, 	ALIGN=256 ; Define a section
                             B       22 	
                   00004000  B       23 RAMSTARTLOC equ 04000h
                   00002400  B       24 VIDSTARTLOC equ 2400h
                   00002C00  B       25 FONTSTARTLOC equ	2C00H
                             B       26 
                   00000018  B       27 SCRLINES	equ		18h
                   00000020  B       28 SCRWIDTH	equ		20h
                             B       29 
                             B       30 
                             B       31 ;Z84C15 equ 1 ;Uncomment when building for Z84C15
                             B       32 
                             B       33 
                             B       34 
                             B       35 	.ifdef Z84C15
                             B       36 
                             B       37 KIOBASE	equ	10h
                             B       38 
                             B       39 CTCIOBASE	equ	00h
                             B       40 SIOIOBASE	equ	18h
                             B       41 PIOIOBASE	equ	1Ch
                             B       42 PIAIOBASE	equ	11B
                             B       43 KIOIOBASE	equ	11B
                             B       44 
                             B       45 PIOPORTADATA	equ	00b
                             B       46 PIOPORTACMD		equ	01b
                             B       47 PIOPORTBDATA	equ	10b
                             B       48 PIOPORTBCMD		equ	11b
                             B       49 
                             B       50 CTCCHANNEL0		equ	00b
                             B       51 CTCCHANNEL1		equ	01b
                             B       52 CTCCHANNEL2		equ	10b
                             B       53 CTCCHANNEL3		equ	11b
                             B       54 
                             B       55 SIOPORTADATA	equ	00b
                             B       56 SIOPORTACMD		equ	01b
                             B       57 SIOPORTBDATA	equ	10b
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    2


IODEFS.H

Location Object              Type  Line Source
                             B       58 SIOPORTBCMD		equ	11b
                             B       59 
                             B       60 MAKEPORT	MACRO	Name,Base,Device,Register
                             B       61 Name equ Base|(Device<<2)|(Register)
                             B       62 	ENDMAC 
                             B       63 
                             B       64 	.else
                   000000FC  B       65 KIOBASE	equ	0FCh
                             B       66 
                   00000000  B       67 PIOIOBASE	equ	00B
                   00000001  B       68 CTCIOBASE	equ	01B
                   00000002  B       69 SIOIOBASE	equ	10B
                   00000003  B       70 PIAIOBASE	equ	11B
                   00000003  B       71 KIOIOBASE	equ	11B
                             B       72 
                   00000000  B       73 PIOPORTADATA	equ	00b
                   00000001  B       74 PIOPORTACMD		equ	01b
                   00000002  B       75 PIOPORTBDATA	equ	10b
                   00000003  B       76 PIOPORTBCMD		equ	11b
                             B       77 
                   00000000  B       78 CTCCHANNEL0		equ	00b
                   00000001  B       79 CTCCHANNEL1		equ	01b
                   00000002  B       80 CTCCHANNEL2		equ	10b
                   00000003  B       81 CTCCHANNEL3		equ	11b
                             B       82 
                   00000000  B       83 SIOPORTADATA	equ	00b
                   00000001  B       84 SIOPORTACMD		equ	01b
                   00000002  B       85 SIOPORTBDATA	equ	10b
                   00000003  B       86 SIOPORTBCMD		equ	11b
                             B       87 
                   00000000  B       88 PIAPORTCDATA	equ	00b
                   00000001  B       89 PIAPORTCCMD		equ	01b
                             B       90 
                   00000002  B       91 KIOCOMMANDA		equ	10b
                   00000003  B       92 KIOCOMMANDB		equ	11b
                             B       93 
                             B       94 MAKEPORT	MACRO	Name,Base,Device,Register
                             B       95 Name equ Base|(Device<<10)|(Register<<8)
                             B       96 	ENDMAC 
                             B       97 
                             B       98 	.endif
                             B       99 
                             B      100 
                             B      101 	MAKEPORT PIOADATA,KIOBASE,PIOIOBASE,PIOPORTADATA
                   000000FC  B+     101 Name equ Base|(Device<<10)|(Register<<8)
                             B      102 	MAKEPORT PIOACMD,KIOBASE,PIOIOBASE,PIOPORTACMD
                   000001FC  B+     102 Name equ Base|(Device<<10)|(Register<<8)
                             B      103 	MAKEPORT PIOBDATA,KIOBASE,PIOIOBASE,PIOPORTBDATA
                   000002FC  B+     103 Name equ Base|(Device<<10)|(Register<<8)
                             B      104 	MAKEPORT PIOBCMD,KIOBASE,PIOIOBASE,PIOPORTBCMD
                   000003FC  B+     104 Name equ Base|(Device<<10)|(Register<<8)
                             B      105 
                             B      106 	MAKEPORT CTCCH0,KIOBASE,CTCIOBASE,CTCCHANNEL0
                   000004FC  B+     106 Name equ Base|(Device<<10)|(Register<<8)
                             B      107 	MAKEPORT CTCCH1,KIOBASE,CTCIOBASE,CTCCHANNEL1
                   000005FC  B+     107 Name equ Base|(Device<<10)|(Register<<8)
                             B      108 	MAKEPORT CTCCH2,KIOBASE,CTCIOBASE,CTCCHANNEL2
                   000006FC  B+     108 Name equ Base|(Device<<10)|(Register<<8)
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    3


IODEFS.H

Location Object              Type  Line Source
                             B      109 	MAKEPORT CTCCH3,KIOBASE,CTCIOBASE,CTCCHANNEL3
                   000007FC  B+     109 Name equ Base|(Device<<10)|(Register<<8)
                             B      110 
                             B      111 	MAKEPORT SIOADATA,KIOBASE,SIOIOBASE,SIOPORTADATA
                   000008FC  B+     111 Name equ Base|(Device<<10)|(Register<<8)
                             B      112 	MAKEPORT SIOACMD,KIOBASE,SIOIOBASE,SIOPORTACMD
                   000009FC  B+     112 Name equ Base|(Device<<10)|(Register<<8)
                             B      113 	MAKEPORT SIOBDATA,KIOBASE,SIOIOBASE,SIOPORTBDATA
                   00000AFC  B+     113 Name equ Base|(Device<<10)|(Register<<8)
                             B      114 	MAKEPORT SIOBCMD,KIOBASE,SIOIOBASE,SIOPORTBCMD
                   00000BFC  B+     114 Name equ Base|(Device<<10)|(Register<<8)
                             B      115 
                             B      116 	.ifdef Z84C15
                             B      117 	.else
                             B      118 	MAKEPORT PIACDATA,KIOBASE,PIAIOBASE,PIAPORTCDATA
                   00000CFC  B+     118 Name equ Base|(Device<<10)|(Register<<8)
                             B      119 	MAKEPORT PIACCMD,KIOBASE,PIAIOBASE,PIAPORTCCMD
                   00000DFC  B+     119 Name equ Base|(Device<<10)|(Register<<8)
                             B      120 
                             B      121 	MAKEPORT KIOCMDA,KIOBASE,KIOIOBASE,KIOCOMMANDA
                   00000EFC  B+     121 Name equ Base|(Device<<10)|(Register<<8)
                             B      122 	MAKEPORT KIOCMDB,KIOBASE,KIOIOBASE,KIOCOMMANDB
                   00000FFC  B+     122 Name equ Base|(Device<<10)|(Register<<8)
                             B      123 	.endif
                             B      124 	
                   000000F0  B      125 WDTMT	equ	0F0h
                   000000F1  B      126 WDTCR	equ	0F1h
                             B      127 
                   000000F4  B      128 IPR		equ	0F4h
                             B      129 
                   000000EE  B      130 SCRP	equ	0EEh
                   000000EF  B      131 SCDP	equ	0EFh
                             B      132 
                   00000020  B      133 SERIALTXBUFFLEN	equ	020h	;must be power of 2
                             B      134 
                             B      135 DEFB MACRO P1
                             B      136 	DB P1
                             B      137 	ENDMAC
                             B      138 
                             B      139 DEFW MACRO P1
                             B      140 	DW P1
                             B      141 	ENDMAC
                             B      142 
                             B      143 DEFM MACRO P1
                             B      144 	DB P1
                             B      145 	ENDMAC
                             B      146 
                             B      147 DOOUT	MACRO	ADDR,VALUE
                             B      148 	push 	AF
                             B      149 	push 	BC
                             B      150 
                             B      151 	ld a,VALUE	; write into WR0: error reset, select WR0
                             B      152 	.ifdef Z84C15
                             B      153 	out (ADDR),A
                             B      154 	.else
                             B      155 	ld BC,ADDR
                             B      156 	out (BC),A
                             B      157 	.endif
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    4


IODEFS.H

Location Object              Type  Line Source
                             B      158 
                             B      159 	pop 	BC
                             B      160 	pop 	AF
                             B      161 	
                             B      162 	ENDMAC 
                             B      163 
                             B      164 DOIN	MACRO	ADDR,DEST
                             B      165 	push 	AF
                             B      166 	push 	BC
                             B      167 
                             B      168 	.ifdef Z84C15
                             B      169 	in a,(ADDR)
                             B      170 	.else
                             B      171 	ld BC,ADDR
                             B      172 	in 	a,(BC)
                             B      173 	.endif
                             B      174 
                             B      175 	ld	DEST,a
                             B      176 	pop BC
                             B      177 	POP	AF
                             B      178 	
                             B      179 	ENDMAC 
                             B      180 
                             B      181 	.endif
                             B      182 
                             A        2 	INCLUDE "SYSVARS.H"
                             B        1 ;	CPU  Z80
                             B        2 
                   00000010  B        3 BufferSize equ 16
                             B        4 
                             B        5 	EXTERN SIOINTTBL
                   00004000  B        6 RAMTOP equ RAMSTARTLOC
                             B        7 
                   00004000  B        8 TxQA equ RAMSTARTLOC	;Needs to be 16 bytle aligned
                   00004010  B        9 RxQA equ TxQA + BufferSize		;Needs to be 16 bytle aligned
                   00004020  B       10 TxQB equ RxQA + BufferSize		;Needs to be 16 bytle aligned
                   00004030  B       11 RxQB equ TxQB + BufferSize		;Needs to be 16 bytle aligned
                   00004040  B       12 KeyB equ RxQB + BufferSize		;Needs to be 16 bytle aligned
                             B       13 
                   00004060  B       14 TxQAWritePos equ KeyB + BufferSize*2
                   00004061  B       15 TxQAReadPos equ TxQAWritePos + 1
                             B       16 
                   00004062  B       17 RxQAWritePos equ TxQAReadPos + 1
                   00004063  B       18 RxQAReadPos equ RxQAWritePos + 1
                             B       19 
                   00004064  B       20 TxQBWritePos equ RxQAReadPos + 1
                   00004065  B       21 TxQBReadPos equ TxQBWritePos + 1
                   00004066  B       22 TxBIdle equ TxQBReadPos + 1
                             B       23 
                   00004067  B       24 RxQBWritePos equ TxBIdle + 1
                   00004068  B       25 RxQBReadPos equ RxQBWritePos + 1
                             B       26 
                   00004069  B       27 KeyBWritePos equ RxQBReadPos + 1
                   0000406A  B       28 KeyBReadPos equ KeyBWritePos + 1
                             B       29 
                   0000406B  B       30 SYSCLOCK equ KeyBReadPos + 1
                             B       31 
                   0000406F  B       32 FLASHCOUNT equ SYSCLOCK+4
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    5


SYSVARS.H

Location Object              Type  Line Source
                   00004071  B       33 LOOPCOUNT equ FLASHCOUNT+2
                             B       34 
                   00004075  B       35 LOOPCOUNT2 equ LOOPCOUNT+4
                             B       36 
                   00004076  B       37 KeyBWPos	equ	LOOPCOUNT2+1 
                             B       38 
                   00004077  B       39 NEXTMEM equ KeyBWPos+1
                             B       40 
                             B       41 
                             B       42 
                             A        3 	INCLUDE "DEBUGMACROS.H"
                             B        1 ;	PUBLIC 	UNDEFINT0,UNDEFINT1,UNDEFINT2,UNDEFINT3,UNDEFINT4,UNDEFINT5,UNDEFINT6,UNDEFINT7
                             B        2 
                             B        3 	EXTERN 	FAOUT,FQUADOUT,FXY2SCR,FHOUTA
                             B        4 
                             B        5 
                   00000000  B        6 DONTUSEFUNCS equ 0
                             B        7 
                             B        8 
                             B        9 COUT MACRO MADDR , CHR
                             B       10 	PUSH HL
                             B       11 
                             B       12 	LD	HL,MADDR
                             B       13 	LD 	(HL),CHR
                             B       14 
                             B       15 	POP HL
                             B       16 	ENDMAC
                             B       17 
                             B       18 COUTXY MACRO XPOS, YPOS , CHR
                             B       19 	PUSH IX
                             B       20 
                             B       21 	XY2SCR	XPOS, YPOS
                             B       22 
                             B       23 	LD 	(IX),CHR
                             B       24 
                             B       25 	POP	IX
                             B       26 
                             B       27 	ENDMAC
                             B       28 
                             B       29 
                             B       30 SP2SCR	MACRO XPOS, YPOS
                             B       31 	PUSH	HL
                             B       32 
                             B       33 	XY2SCR	XPOS, YPOS
                             B       34 
                             B       35 	LD HL,0
                             B       36 	ADD HL,SP
                             B       37 	LD A,H
                             B       38 
                             B       39 	SRL A
                             B       40 	SRL A
                             B       41 	SRL A
                             B       42 	SRL A
                             B       43 
                             B       44 	CALL FAOUT
                             B       45 
                             B       46 	LD HL,0
                             B       47 	ADD HL,SP
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    6


DEBUGMACROS.H

Location Object              Type  Line Source
                             B       48 	LD A,H
                             B       49 
                             B       50 	AND 0FH
                             B       51 
                             B       52 	INC		IX
                             B       53 	CALL FAOUT
                             B       54 
                             B       55 	LD HL,0
                             B       56 	ADD HL,SP
                             B       57 	LD A,L
                             B       58 
                             B       59 	SRL A
                             B       60 	SRL A
                             B       61 	SRL A
                             B       62 	SRL A
                             B       63 
                             B       64 	INC		IX
                             B       65 	CALL FAOUT
                             B       66 
                             B       67 	LD HL,0
                             B       68 	ADD HL,SP
                             B       69 	LD A,L
                             B       70 
                             B       71 	AND 0FH
                             B       72 
                             B       73 	INC		IX
                             B       74 	CALL FAOUT
                             B       75 
                             B       76 	POP		HL
                             B       77 	
                             B       78 	ENDMAC
                             B       79  
                             B       80 XY2SCR	MACRO XPOS, YPOS
                             B       81 	PUSH BC
                             B       82 
                             B       83 	LD 	B,XPOS
                             B       84 	LD 	C,YPOS
                             B       85 
                             B       86 	CALL	FXY2SCR
                             B       87 
                             B       88 	POP BC
                             B       89 
                             B       90 	ENDMAC
                             B       91  
                             B       92 
                             B       93 HOUT	MACRO POS, DIN
                             B       94 	PUSH BC
                             B       95 	PUSH IX
                             B       96 
                             B       97 	LD	IX,POS
                             B       98 	LD	B,DIN
                             B       99 	call FHOUTA
                             B      100 
                             B      101 	POP	IX
                             B      102 	POP BC
                             B      103 
                             B      104 	ENDMAC
                             B      105 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    7


DEBUGMACROS.H

Location Object              Type  Line Source
                             B      106 HOUTXY	MACRO XPOS,YPOS, DIN
                             B      107 	PUSH BC
                             B      108 	PUSH IX
                             B      109 
                             B      110 	XY2SCR	XPOS, YPOS
                             B      111 
                             B      112 	LD	B,DIN
                             B      113 	call FHOUTA
                             B      114 
                             B      115 	POP	IX
                             B      116 	POP BC
                             B      117 
                             B      118 	ENDMAC
                             B      119 	
                             B      120 QUADOUT	MACRO XPOS, YPOS, PTR
                             B      121 	PUSH BC
                             B      122 	PUSH HL
                             B      123 
                             B      124 	LD B,XPOS 
                             B      125 	LD C,YPOS
                             B      126  	LD HL,PTR
                             B      127 
                             B      128 	call FQUADOUT
                             B      129 
                             B      130 	POP HL
                             B      131 	POP BC
                             B      132 
                             B      133 	ENDMAC
                             B      134 	   
                             B      135 STROUTXY	MACRO XPOS,YPOS,STR,STRLEN
                             B      136 	PUSH BC
                             B      137 	PUSH DE
                             B      138 	PUSH HL
                             B      139 	PUSH IX
                             B      140 
                             B      141 	XY2SCR	XPOS, YPOS
                             B      142 
                             B      143 	LD	HL,$STRSTR
                             B      144 	PUSH	IX
                             B      145 	POP		DE
                             B      146 	LD	BC,STRLEN
                             B      147 
                             B      148 	LDIR
                             B      149 	JR $LEAVE
                             B      150 
                             B      151 $STRSTR
                             B      152 	DB STR
                             B      153 $LEAVE
                             B      154 	POP	IX
                             B      155 	POP HL
                             B      156 	POP DE
                             B      157 	POP BC
                             B      158 
                             B      159 	ENDMAC
                             B      160 
                             A        4 	INCLUDE "QUEUEMACRO.H"
                             B        1 
                             B        2 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    8


QUEUEMACRO.H

Location Object              Type  Line Source
                             B        3 
                             B        4 AddtoQueue MACRO InChar,Queue,RPosPtr,WPosPtr
                             B        5 	push	bc
                             B        6 	push	de
                             B        7 	push	hl
                             B        8 
                             B        9 	ld b,InChar
                             B       10 	ld hl,Queue
                             B       11 	ld a,(RPosPtr)
                             B       12 	ld c,a
                             B       13 	ld de,WPosPtr
                             B       14 
                             B       15 	call FAddtoQueue
                             B       16 
                             B       17 	pop		hl
                             B       18 	pop		de
                             B       19 	pop		bc
                             B       20 
                             B       21 	ENDMAC
                             B       22 
                             B       23 ReadfromQueue MACRO Queue,RPosPtr,WPosPtr	;Return in bc If b!=0 then C contains value.
                             B       24 
                             B       25 	push	af
                             B       26 	push	de
                             B       27 	push	hl
                             B       28 
                             B       29 	ld hl,Queue
                             B       30 	ld bc,RPosPtr
                             B       31 	ld a,(WPosPtr)
                             B       32 	ld	e,a
                             B       33 
                             B       34 	call FReadfromQueue
                             B       35 
                             B       36 	pop		hl
                             B       37 	pop		de
                             B       38 	pop		af
                             B       39 
                             B       40 	ENDMAC
                             B       41 
                             B       42 QueueEmpty MACRO RPosPtr,WPos	;Return in bc If b!=0 then C contains value.
                             B       43 
                             B       44 	ld bc,RPosPtr
                             B       45 	ld a,(WPos)
                             B       46 	ld	e,a
                             B       47 
                             B       48 	ld	a,(BC)
                             B       49 	cp	e
                             B       50 	jr	nz,QNotEmpty
                             B       51 	ld	a,1
                             B       52 	jp Exit
                             B       53 QNotEmpty:
                             B       54 	ld	a,0
                             B       55 Exit:
                             B       56 
                             B       57 	ENDMAC
                             B       58 
                             B       59 
                             A        5 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:    9


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A        6 
                             A        7 	public FAddtoQueue,FReadfromQueue, QUEUETEST, InitQueue,TxQB2Scr
                             A        8 
00000000                     A        9 InitQueue:
00000000 3E 00               A       10 	LD	A,0
                             A       11 
00000002 32 60 40            A       12 	LD (TxQAWritePos),A
00000005 32 61 40            A       13 	LD (TxQAReadPos),A
                             A       14 
00000008 32 62 40            A       15 	LD (RxQAWritePos),A
0000000B 32 63 40            A       16 	LD (RxQAReadPos),A
                             A       17 
0000000E 32 64 40            A       18 	LD (TxQBWritePos),A
00000011 32 65 40            A       19 	LD (TxQBReadPos),A
                             A       20 
00000014 32 67 40            A       21 	LD (RxQBWritePos),A
00000017 32 68 40            A       22 	LD (RxQBReadPos),A
                             A       23 		
0000001A 32 69 40            A       24 	LD	(KeyBWritePos),A
                             A       25 
                             A       26 
0000001D 21 40 40            A       27 	LD HL, KeyB             ; point to the source
00000020 11 41 40            A       28 	LD DE, KeyB + 1         ; point to the destination
00000023 01 1F 00            A       29 	LD BC, BufferSize*2 - 1    ; copying this many bytes
00000026 36 20               A       30 	LD (HL), 20h                  ; put a seed space in the first position
00000028 ED B0               A       31 	LDIR                           ; move 1 to 2, 2 to 3
                             A       32 
                             A       33 
0000002A 21 20 40            A       34 	LD HL, TxQB             ; point to the source
0000002D 11 21 40            A       35 	LD DE, TxQB + 1         ; point to the destination
00000030 01 0F 00            A       36 	LD BC, BufferSize - 1    ; copying this many bytes
00000033 36 20               A       37 	LD (HL), 20h                  ; put a seed space in the first position
00000035 ED B0               A       38 	LDIR   
                             A       39 
00000037 3E 01               A       40 	ld		a,1
00000039 32 66 40            A       41 	ld		(TxBIdle),a
0000003C C9                  A       42 	ret
                             A       43 
0000003D                     A       44 TxQB2Scr:		;;Y in e
0000003D C5                  A       45 	push	bc
0000003E D5                  A       46 	push	de
0000003F E5                  A       47 	push	hl
00000040 F5                  A       48 	push	af
                             A       49 
00000041 3A 65 40            A       50 	ld	a,	 (TxQBReadPos)
                             A       51 	HOUTXY 0,e, a
00000044 C5                  A+      51 	PUSH BC
00000045 DD E5               A+      51 	PUSH IX
                             A+      51 
                             A+      51 	XY2SCR	XPOS, YPOS
00000047 C5                  A+      51 	PUSH BC
                             A+      51 
00000048 06 00               A+      51 	LD 	B,XPOS
0000004A 4B                  A+      51 	LD 	C,YPOS
                             A+      51 
0000004B CD 00 00            A+      51 	CALL	FXY2SCR
                             A+      51 
0000004E C1                  A+      51 	POP BC
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   10


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A+      51 
                             A+      51 
0000004F 47                  A+      51 	LD	B,DIN
00000050 CD 00 00            A+      51 	call FHOUTA
                             A+      51 
00000053 DD E1               A+      51 	POP	IX
00000055 C1                  A+      51 	POP BC
                             A+      51 
00000056 3A 64 40            A       52 	ld	a,	 (TxQBWritePos)
                             A       53 	HOUTXY 3,e, a
00000059 C5                  A+      53 	PUSH BC
0000005A DD E5               A+      53 	PUSH IX
                             A+      53 
                             A+      53 	XY2SCR	XPOS, YPOS
0000005C C5                  A+      53 	PUSH BC
                             A+      53 
0000005D 06 03               A+      53 	LD 	B,XPOS
0000005F 4B                  A+      53 	LD 	C,YPOS
                             A+      53 
00000060 CD 00 00            A+      53 	CALL	FXY2SCR
                             A+      53 
00000063 C1                  A+      53 	POP BC
                             A+      53 
                             A+      53 
00000064 47                  A+      53 	LD	B,DIN
00000065 CD 00 00            A+      53 	call FHOUTA
                             A+      53 
00000068 DD E1               A+      53 	POP	IX
0000006A C1                  A+      53 	POP BC
                             A+      53 
                             A       54 
0000006B 0E 10               A       55 	ld	c,10h
0000006D 06 10               A       56 	ld	b,10h
0000006F 21 20 40            A       57 	ld	hl,TxQB
00000072 3A 65 40            A       58 	ld	a,(TxQBReadPos)
00000075 57                  A       59 	ld	d,a
00000076 85                  A       60 	add	a,l
00000077 6F                  A       61 	ld	l,a
00000078                     A       62 NextChr:
00000078 7E                  A       63 	ld	a,(hl)
                             A       64 	COUTXY	b,e,a
00000079 DD E5               A+      64 	PUSH IX
                             A+      64 
                             A+      64 	XY2SCR	XPOS, YPOS
0000007B C5                  A+      64 	PUSH BC
                             A+      64 
0000007C 40                  A+      64 	LD 	B,XPOS
0000007D 4B                  A+      64 	LD 	C,YPOS
                             A+      64 
0000007E CD 00 00            A+      64 	CALL	FXY2SCR
                             A+      64 
00000081 C1                  A+      64 	POP BC
                             A+      64 
                             A+      64 
00000082 DD 77 00            A+      64 	LD 	(IX),CHR
                             A+      64 
00000085 DD E1               A+      64 	POP	IX
                             A+      64 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   11


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
00000087 21 20 40            A       65 	ld	hl,TxQB
0000008A 14                  A       66 	inc	d
0000008B 7A                  A       67 	ld	a,d
0000008C E6 0F               A       68 	and 0Fh
0000008E 57                  A       69 	ld	d,a
0000008F 85                  A       70 	add	a,l
00000090 6F                  A       71 	ld	l,a
00000091 04                  A       72 	inc b
00000092 0D                  A       73 	dec c
00000093 20 E3               A       74 	jr nz,NextChr
                             A       75 
00000095 F1                  A       76 	pop		af
00000096 E1                  A       77 	pop		hl
00000097 D1                  A       78 	pop		de
00000098 C1                  A       79 	pop		bc
                             A       80 
00000099 C9                  A       81 	ret 
                             A       82 
0000009A                     A       83 FQueueFullTest:
0000009A 1A                  A       84 	ld	a,(DE)
0000009B 3C                  A       85 	inc	a
0000009C E6 0F               A       86 	and	0Fh
0000009E B9                  A       87 	cp	c
0000009F 20 04               A       88 	jr	nz,QNotFull$
000000A1 3E 00               A       89 	ld	a,0
000000A3 18 02               A       90 	jr 	ToExit$
000000A5                     A       91 QNotFull$:
000000A5 3E 01               A       92 	ld	a,1
000000A7                     A       93 ToExit$:
000000A7 C9                  A       94 	ret
                             A       95 
000000A8                     A       96 FAddtoQueue:
000000A8 1A                  A       97 	ld	a,(DE)
000000A9 3C                  A       98 	inc	a
000000AA E6 0F               A       99 	and	0Fh
000000AC B9                  A      100 	cp	c
000000AD 20 04               A      101 	jr	nz,QNotFull
000000AF 3E 00               A      102 	ld	a,0
000000B1 18 0B               A      103 	jr 	ToExit
000000B3                     A      104 QNotFull:
000000B3 1A                  A      105 	ld 	a,(DE)
000000B4 85                  A      106 	add a,L
000000B5 6F                  A      107 	ld	L,a
000000B6 70                  A      108 	ld	(HL),b
                             A      109 
000000B7 1A                  A      110 	ld	a,(DE)
000000B8 3C                  A      111 	inc	a
000000B9 E6 0F               A      112 	and a,0Fh
000000BB 12                  A      113 	ld	(DE),a
000000BC 3E 01               A      114 	ld	a,1
000000BE                     A      115 ToExit:
                             A      116 
000000BE C9                  A      117 	ret
                             A      118 
000000BF                     A      119 FReadfromQueue:		;Return in a
000000BF 0A                  A      120 	ld	a,(BC)
000000C0 BB                  A      121 	cp	e
000000C1 20 04               A      122 	jr	nz,QNotEmpty
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   12


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
000000C3 06 00               A      123 	ld	b,0		;Set B zero indicating no char found
000000C5 18 0D               A      124 	jr $ToExit
000000C7                     A      125 QNotEmpty:
000000C7 0A                  A      126 	ld a,(BC)
000000C8 85                  A      127 	add a,L
000000C9 6F                  A      128 	ld	L,a
                             A      129 
000000CA 0A                  A      130 	ld	a,(BC)
000000CB 3C                  A      131 	inc	a
000000CC E6 0F               A      132 	and a,0Fh
000000CE 02                  A      133 	ld	(BC),a
                             A      134 
000000CF 06 01               A      135 	ld	b,1
000000D1 4E                  A      136 	ld	c,(HL)
000000D2 36 40               A      137 	ld	(HL),'@'
000000D4                     A      138 $ToExit:
000000D4 C9                  A      139 	ret
                             A      140 		
                             A      141 	
000000D5                     A      142 QUEUETEST:
                             A      143 	STROUTXY 2,0,"QUEUETEST",9
000000D5 C5                  A+     143 	PUSH BC
000000D6 D5                  A+     143 	PUSH DE
000000D7 E5                  A+     143 	PUSH HL
000000D8 DD E5               A+     143 	PUSH IX
                             A+     143 
                             A+     143 	XY2SCR	XPOS, YPOS
000000DA C5                  A+     143 	PUSH BC
                             A+     143 
000000DB 06 02               A+     143 	LD 	B,XPOS
000000DD 0E 00               A+     143 	LD 	C,YPOS
                             A+     143 
000000DF CD 00 00            A+     143 	CALL	FXY2SCR
                             A+     143 
000000E2 C1                  A+     143 	POP BC
                             A+     143 
                             A+     143 
000000E3 21 F0 00            A+     143 	LD	HL,$STRSTR
000000E6 DD E5               A+     143 	PUSH	IX
000000E8 D1                  A+     143 	POP		DE
000000E9 01 09 00            A+     143 	LD	BC,STRLEN
                             A+     143 
000000EC ED B0               A+     143 	LDIR
000000EE 18 09               A+     143 	JR $LEAVE
                             A+     143 
000000F0                     A+     143 $STRSTR
000000F0 51 55 45 55 45 54   A+     143 	DB STR
000000F6 45 53 54            A+ d   143
000000F9                     A+     143 $LEAVE
000000F9 DD E1               A+     143 	POP	IX
000000FB E1                  A+     143 	POP HL
000000FC D1                  A+     143 	POP DE
000000FD C1                  A+     143 	POP BC
                             A+     143 
000000FE 1E 02               A      144 	ld	e,2
00000100                     A      145 BLING:
00000100 21 00 24            A      146 	LD	HL,VIDSTARTLOC
00000103 34                  A      147 	INC (HL)
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   13


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A      148 
00000104 16 11               A      149 	ld	d,17
00000106                     A      150 ReDo1:
00000106 3A 64 40            A      151 	LD	a,(TxQBWritePos)
                             A      152 	HOUTXY 7,d,a 
00000109 C5                  A+     152 	PUSH BC
0000010A DD E5               A+     152 	PUSH IX
                             A+     152 
                             A+     152 	XY2SCR	XPOS, YPOS
0000010C C5                  A+     152 	PUSH BC
                             A+     152 
0000010D 06 07               A+     152 	LD 	B,XPOS
0000010F 4A                  A+     152 	LD 	C,YPOS
                             A+     152 
00000110 CD 00 00            A+     152 	CALL	FXY2SCR
                             A+     152 
00000113 C1                  A+     152 	POP BC
                             A+     152 
                             A+     152 
00000114 47                  A+     152 	LD	B,DIN
00000115 CD 00 00            A+     152 	call FHOUTA
                             A+     152 
00000118 DD E1               A+     152 	POP	IX
0000011A C1                  A+     152 	POP BC
                             A+     152 
                             A      153 	HOUTXY 0,d,D 
0000011B C5                  A+     153 	PUSH BC
0000011C DD E5               A+     153 	PUSH IX
                             A+     153 
                             A+     153 	XY2SCR	XPOS, YPOS
0000011E C5                  A+     153 	PUSH BC
                             A+     153 
0000011F 06 00               A+     153 	LD 	B,XPOS
00000121 4A                  A+     153 	LD 	C,YPOS
                             A+     153 
00000122 CD 00 00            A+     153 	CALL	FXY2SCR
                             A+     153 
00000125 C1                  A+     153 	POP BC
                             A+     153 
                             A+     153 
00000126 42                  A+     153 	LD	B,DIN
00000127 CD 00 00            A+     153 	call FHOUTA
                             A+     153 
0000012A DD E1               A+     153 	POP	IX
0000012C C1                  A+     153 	POP BC
                             A+     153 
                             A      154 	AddtoQueue d,TxQB,TxQBReadPos,TxQBWritePos
0000012D C5                  A+     154 	push	bc
0000012E D5                  A+     154 	push	de
0000012F E5                  A+     154 	push	hl
                             A+     154 
00000130 42                  A+     154 	ld b,InChar
00000131 21 20 40            A+     154 	ld hl,Queue
00000134 3A 65 40            A+     154 	ld a,(RPosPtr)
00000137 4F                  A+     154 	ld c,a
00000138 11 64 40            A+     154 	ld de,WPosPtr
                             A+     154 
0000013B CD A8 00            A+     154 	call FAddtoQueue
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   14


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A+     154 
0000013E E1                  A+     154 	pop		hl
0000013F D1                  A+     154 	pop		de
00000140 C1                  A+     154 	pop		bc
                             A+     154 
00000141 FE 00               A      155 	cp 0
00000143 28 25               A      156 	jr	z,WFULL0
                             A      157 	STROUTXY 3,D,"WQS",3
00000145 C5                  A+     157 	PUSH BC
00000146 D5                  A+     157 	PUSH DE
00000147 E5                  A+     157 	PUSH HL
00000148 DD E5               A+     157 	PUSH IX
                             A+     157 
                             A+     157 	XY2SCR	XPOS, YPOS
0000014A C5                  A+     157 	PUSH BC
                             A+     157 
0000014B 06 03               A+     157 	LD 	B,XPOS
0000014D 4A                  A+     157 	LD 	C,YPOS
                             A+     157 
0000014E CD 00 00            A+     157 	CALL	FXY2SCR
                             A+     157 
00000151 C1                  A+     157 	POP BC
                             A+     157 
                             A+     157 
00000152 21 5F 01            A+     157 	LD	HL,$STRSTR
00000155 DD E5               A+     157 	PUSH	IX
00000157 D1                  A+     157 	POP		DE
00000158 01 03 00            A+     157 	LD	BC,STRLEN
                             A+     157 
0000015B ED B0               A+     157 	LDIR
0000015D 18 03               A+     157 	JR $LEAVE
                             A+     157 
0000015F                     A+     157 $STRSTR
0000015F 57 51 53            A+     157 	DB STR
00000162                     A+     157 $LEAVE
00000162 DD E1               A+     157 	POP	IX
00000164 E1                  A+     157 	POP HL
00000165 D1                  A+     157 	POP DE
00000166 C1                  A+     157 	POP BC
                             A+     157 
00000167 C3 8C 01            A      158 	jp  WCO1
0000016A                     A      159 WFULL0:
                             A      160 	STROUTXY 3,D,"WQF",3
0000016A C5                  A+     160 	PUSH BC
0000016B D5                  A+     160 	PUSH DE
0000016C E5                  A+     160 	PUSH HL
0000016D DD E5               A+     160 	PUSH IX
                             A+     160 
                             A+     160 	XY2SCR	XPOS, YPOS
0000016F C5                  A+     160 	PUSH BC
                             A+     160 
00000170 06 03               A+     160 	LD 	B,XPOS
00000172 4A                  A+     160 	LD 	C,YPOS
                             A+     160 
00000173 CD 00 00            A+     160 	CALL	FXY2SCR
                             A+     160 
00000176 C1                  A+     160 	POP BC
                             A+     160 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   15


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
                             A+     160 
00000177 21 84 01            A+     160 	LD	HL,$STRSTR
0000017A DD E5               A+     160 	PUSH	IX
0000017C D1                  A+     160 	POP		DE
0000017D 01 03 00            A+     160 	LD	BC,STRLEN
                             A+     160 
00000180 ED B0               A+     160 	LDIR
00000182 18 03               A+     160 	JR $LEAVE
                             A+     160 
00000184                     A+     160 $STRSTR
00000184 57 51 46            A+     160 	DB STR
00000187                     A+     160 $LEAVE
00000187 DD E1               A+     160 	POP	IX
00000189 E1                  A+     160 	POP HL
0000018A D1                  A+     160 	POP DE
0000018B C1                  A+     160 	POP BC
                             A+     160 
0000018C                     A      161 WCO1:
0000018C 15                  A      162 	dec	D
0000018D C2 06 01            A      163 	jr nz,ReDo1
                             A      164 	
00000190 16 11               A      165 	ld	D,17
00000192                     A      166 ReDo2:
00000192 3A 65 40            A      167 	LD	a,(TxQBReadPos)
                             A      168 	HOUTXY 17,D,a 
00000195 C5                  A+     168 	PUSH BC
00000196 DD E5               A+     168 	PUSH IX
                             A+     168 
                             A+     168 	XY2SCR	XPOS, YPOS
00000198 C5                  A+     168 	PUSH BC
                             A+     168 
00000199 06 11               A+     168 	LD 	B,XPOS
0000019B 4A                  A+     168 	LD 	C,YPOS
                             A+     168 
0000019C CD 00 00            A+     168 	CALL	FXY2SCR
                             A+     168 
0000019F C1                  A+     168 	POP BC
                             A+     168 
                             A+     168 
000001A0 47                  A+     168 	LD	B,DIN
000001A1 CD 00 00            A+     168 	call FHOUTA
                             A+     168 
000001A4 DD E1               A+     168 	POP	IX
000001A6 C1                  A+     168 	POP BC
                             A+     168 
                             A      169 	ReadfromQueue TxQB,TxQBReadPos,TxQBWritePos
                             A+     169 
000001A7 F5                  A+     169 	push	af
000001A8 D5                  A+     169 	push	de
000001A9 E5                  A+     169 	push	hl
                             A+     169 
000001AA 21 20 40            A+     169 	ld hl,Queue
000001AD 01 65 40            A+     169 	ld bc,RPosPtr
000001B0 3A 64 40            A+     169 	ld a,(WPosPtr)
000001B3 5F                  A+     169 	ld	e,a
                             A+     169 
000001B4 CD BF 00            A+     169 	call FReadfromQueue
                             A+     169 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   16


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
000001B7 E1                  A+     169 	pop		hl
000001B8 D1                  A+     169 	pop		de
000001B9 F1                  A+     169 	pop		af
                             A+     169 
000001BA 78                  A      170 	ld	a,b
000001BB FE 00               A      171 	cp 	0
000001BD 28 37               A      172 	jr	z,REMPTY
                             A      173 	HOUTXY 10,D,c 
000001BF C5                  A+     173 	PUSH BC
000001C0 DD E5               A+     173 	PUSH IX
                             A+     173 
                             A+     173 	XY2SCR	XPOS, YPOS
000001C2 C5                  A+     173 	PUSH BC
                             A+     173 
000001C3 06 0A               A+     173 	LD 	B,XPOS
000001C5 4A                  A+     173 	LD 	C,YPOS
                             A+     173 
000001C6 CD 00 00            A+     173 	CALL	FXY2SCR
                             A+     173 
000001C9 C1                  A+     173 	POP BC
                             A+     173 
                             A+     173 
000001CA 41                  A+     173 	LD	B,DIN
000001CB CD 00 00            A+     173 	call FHOUTA
                             A+     173 
000001CE DD E1               A+     173 	POP	IX
000001D0 C1                  A+     173 	POP BC
                             A+     173 
                             A      174 	STROUTXY 13,D,"RQD",3
000001D1 C5                  A+     174 	PUSH BC
000001D2 D5                  A+     174 	PUSH DE
000001D3 E5                  A+     174 	PUSH HL
000001D4 DD E5               A+     174 	PUSH IX
                             A+     174 
                             A+     174 	XY2SCR	XPOS, YPOS
000001D6 C5                  A+     174 	PUSH BC
                             A+     174 
000001D7 06 0D               A+     174 	LD 	B,XPOS
000001D9 4A                  A+     174 	LD 	C,YPOS
                             A+     174 
000001DA CD 00 00            A+     174 	CALL	FXY2SCR
                             A+     174 
000001DD C1                  A+     174 	POP BC
                             A+     174 
                             A+     174 
000001DE 21 EB 01            A+     174 	LD	HL,$STRSTR
000001E1 DD E5               A+     174 	PUSH	IX
000001E3 D1                  A+     174 	POP		DE
000001E4 01 03 00            A+     174 	LD	BC,STRLEN
                             A+     174 
000001E7 ED B0               A+     174 	LDIR
000001E9 18 03               A+     174 	JR $LEAVE
                             A+     174 
000001EB                     A+     174 $STRSTR
000001EB 52 51 44            A+     174 	DB STR
000001EE                     A+     174 $LEAVE
000001EE DD E1               A+     174 	POP	IX
000001F0 E1                  A+     174 	POP HL
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   17


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
000001F1 D1                  A+     174 	POP DE
000001F2 C1                  A+     174 	POP BC
                             A+     174 
000001F3 C3 39 02            A      175 	jp  RCO1
000001F6                     A      176 REMPTY:
                             A      177 	STROUTXY 10,D,"  ",2
000001F6 C5                  A+     177 	PUSH BC
000001F7 D5                  A+     177 	PUSH DE
000001F8 E5                  A+     177 	PUSH HL
000001F9 DD E5               A+     177 	PUSH IX
                             A+     177 
                             A+     177 	XY2SCR	XPOS, YPOS
000001FB C5                  A+     177 	PUSH BC
                             A+     177 
000001FC 06 0A               A+     177 	LD 	B,XPOS
000001FE 4A                  A+     177 	LD 	C,YPOS
                             A+     177 
000001FF CD 00 00            A+     177 	CALL	FXY2SCR
                             A+     177 
00000202 C1                  A+     177 	POP BC
                             A+     177 
                             A+     177 
00000203 21 10 02            A+     177 	LD	HL,$STRSTR
00000206 DD E5               A+     177 	PUSH	IX
00000208 D1                  A+     177 	POP		DE
00000209 01 02 00            A+     177 	LD	BC,STRLEN
                             A+     177 
0000020C ED B0               A+     177 	LDIR
0000020E 18 02               A+     177 	JR $LEAVE
                             A+     177 
00000210                     A+     177 $STRSTR
00000210 20 20               A+     177 	DB STR
00000212                     A+     177 $LEAVE
00000212 DD E1               A+     177 	POP	IX
00000214 E1                  A+     177 	POP HL
00000215 D1                  A+     177 	POP DE
00000216 C1                  A+     177 	POP BC
                             A+     177 
                             A      178 	STROUTXY 13,D,"RQE",3
00000217 C5                  A+     178 	PUSH BC
00000218 D5                  A+     178 	PUSH DE
00000219 E5                  A+     178 	PUSH HL
0000021A DD E5               A+     178 	PUSH IX
                             A+     178 
                             A+     178 	XY2SCR	XPOS, YPOS
0000021C C5                  A+     178 	PUSH BC
                             A+     178 
0000021D 06 0D               A+     178 	LD 	B,XPOS
0000021F 4A                  A+     178 	LD 	C,YPOS
                             A+     178 
00000220 CD 00 00            A+     178 	CALL	FXY2SCR
                             A+     178 
00000223 C1                  A+     178 	POP BC
                             A+     178 
                             A+     178 
00000224 21 31 02            A+     178 	LD	HL,$STRSTR
00000227 DD E5               A+     178 	PUSH	IX
00000229 D1                  A+     178 	POP		DE
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   18


g:\my drive\ace-2019\testrom\queues.asm

Location Object              Type  Line Source
0000022A 01 03 00            A+     178 	LD	BC,STRLEN
                             A+     178 
0000022D ED B0               A+     178 	LDIR
0000022F 18 03               A+     178 	JR $LEAVE
                             A+     178 
00000231                     A+     178 $STRSTR
00000231 52 51 45            A+     178 	DB STR
00000234                     A+     178 $LEAVE
00000234 DD E1               A+     178 	POP	IX
00000236 E1                  A+     178 	POP HL
00000237 D1                  A+     178 	POP DE
00000238 C1                  A+     178 	POP BC
                             A+     178 
00000239                     A      179 RCO1:
00000239 15                  A      180 	dec	D
0000023A C2 92 01            A      181 	jr nz,ReDo2
                             A      182 
0000023D 1D                  A      183 	dec	E
0000023E C2 00 01            A      184 	jr nz,BLING
                             A      185 
00000241 76                  A      186 	halt
                             A      187 
                             A      188 
00000242 76                  A      189 	HALT
                             A      190 
Zilog Macro Assembler.  Version K2.14    08-Jun-122    01:00:14    Page:   19


g:\my drive\ace-2019\testrom\queues.asm


    0 Warnings
    0 Errors
