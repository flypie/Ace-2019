Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    1


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A        1 ; Disassembly of the file "C:\ACE\JupiterAce.rom"
                             A        2 ;
                             A        3 ; CPU Type: Z80
                             A        4 ;
                             A        5 ; Created with dZ80 1.50
                             A        6 ;
                             A        7 ; on Monday, 21 of January 2002 at 07:11 PM
                             A        8 ;
                             A        9 ; last updated 02-NOV-2002
                             A       10 ;
                             A       11 ; Cross-assembles to an 16K ROM file.
                             A       12 ;
                             A       13 ; Note. A Low-level Assembly Listing only.
                             A       14 
                             A       15 	INCLUDE "iodefs.inc"
                   000000FC  B        1 KIOBASE	equ	0FCh
                             B        2 
                   00000000  B        3 PIOIOBASE	equ	00B
                   00000001  B        4 CTCIOBASE	equ	01B
                   00000002  B        5 SIOIOBASE	equ	10B
                   00000003  B        6 PIAIOBASE	equ	11B
                   00000003  B        7 KIOIOBASE	equ	11B
                             B        8 
                   00000000  B        9 PIOPORTADATA	equ	00b
                   00000001  B       10 PIOPORTACMD		equ	01b
                   00000000  B       11 PIOPORTBDATA	equ	00b
                   00000001  B       12 PIOPORTBCMD		equ	01b
                             B       13 
                   00000000  B       14 CTCCHANNEL0		equ	00b
                   00000001  B       15 CTCCHANNEL1		equ	01b
                   00000002  B       16 CTCCHANNEL2		equ	10b
                   00000003  B       17 CTCCHANNEL3		equ	11b
                             B       18 
                   00000000  B       19 SIOPORTADATA	equ	00b
                   00000001  B       20 SIOPORTACMD		equ	01b
                   00000000  B       21 SIOPORTBDATA	equ	00b
                   00000001  B       22 SIOPORTBCMD		equ	01b
                             B       23 
                   00000000  B       24 PIAPORTCDATA	equ	00b
                   00000001  B       25 PIAPORTCCMD		equ	01b
                             B       26 
                   00000002  B       27 KIOCOMMANDA		equ	10b
                   00000003  B       28 KIOCOMMANDB		equ	11b
                             B       29 
                             B       30 MAKEPORT	MACRO	Name,Base,Device,Register
                             B       31 Name equ Base|(Device<<8)|(Register<<10)
                             B       32 	endmac 
                             B       33 
                             B       34 
                             B       35 	MAKEPORT PIOADATA,KIOBASE,PIOIOBASE,PIOPORTADATA
                   000000FC  B+      35 Name equ Base|(Device<<8)|(Register<<10)
                             B       36 	MAKEPORT PIOACMD,KIOBASE,PIOIOBASE,PIOPORTACMD
                   000004FC  B+      36 Name equ Base|(Device<<8)|(Register<<10)
                             B       37 	MAKEPORT PIOBDATA,KIOBASE,PIOIOBASE,PIOPORTBDATA
                   000000FC  B+      37 Name equ Base|(Device<<8)|(Register<<10)
                             B       38 	MAKEPORT PIOBCMD,KIOBASE,PIOIOBASE,PIOPORTBCMD
                   000004FC  B+      38 Name equ Base|(Device<<8)|(Register<<10)
                             B       39 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    2


iodefs.inc

Location Object              Type  Line Source
                             B       40 	MAKEPORT CTCCH0,KIOBASE,CTCIOBASE,CTCCHANNEL0
                   000001FC  B+      40 Name equ Base|(Device<<8)|(Register<<10)
                             B       41 	MAKEPORT CTCCH1,KIOBASE,CTCIOBASE,CTCCHANNEL1
                   000005FC  B+      41 Name equ Base|(Device<<8)|(Register<<10)
                             B       42 	MAKEPORT CTCCH2,KIOBASE,CTCIOBASE,CTCCHANNEL2
                   000009FC  B+      42 Name equ Base|(Device<<8)|(Register<<10)
                             B       43 	MAKEPORT CTCCH3,KIOBASE,CTCIOBASE,CTCCHANNEL3
                   00000DFC  B+      43 Name equ Base|(Device<<8)|(Register<<10)
                             B       44 
                             B       45 	MAKEPORT SIOADATA,KIOBASE,SIOIOBASE,SIOPORTADATA
                   000002FC  B+      45 Name equ Base|(Device<<8)|(Register<<10)
                             B       46 	MAKEPORT SIOACMD,KIOBASE,SIOIOBASE,SIOPORTACMD
                   000006FC  B+      46 Name equ Base|(Device<<8)|(Register<<10)
                             B       47 	MAKEPORT SIOBDATA,KIOBASE,SIOIOBASE,SIOPORTBDATA
                   000002FC  B+      47 Name equ Base|(Device<<8)|(Register<<10)
                             B       48 	MAKEPORT SIOBCMD,KIOBASE,SIOIOBASE,SIOPORTBCMD
                   000006FC  B+      48 Name equ Base|(Device<<8)|(Register<<10)
                             B       49 
                             B       50 	MAKEPORT PIOCDATA,KIOBASE,PIAIOBASE,PIAPORTCDATA
                   000003FC  B+      50 Name equ Base|(Device<<8)|(Register<<10)
                             B       51 	MAKEPORT PIOCCMD,KIOBASE,PIAIOBASE,PIAPORTCCMD
                   000007FC  B+      51 Name equ Base|(Device<<8)|(Register<<10)
                             B       52 
                             B       53 	MAKEPORT KIOCMDA,KIOBASE,KIOIOBASE,KIOCOMMANDA
                   00000BFC  B+      53 Name equ Base|(Device<<8)|(Register<<10)
                             B       54 	MAKEPORT KIOCMDB,KIOBASE,KIOIOBASE,KIOCOMMANDB
                   00000FFC  B+      54 Name equ Base|(Device<<8)|(Register<<10)
                             B       55 
                             B       56 	
                   000000F0  B       57 WDTMT	equ	0F0h
                   000000F1  B       58 WDTCR	equ	0F1h
                             B       59 
                   000000F4  B       60 IPR		equ	0F4h
                             B       61 
                   000000EE  B       62 SCRP	equ	0EEh
                   000000EF  B       63 SCDP	equ	0EFh
                             B       64 
                   00000020  B       65 SERIALTXBUFFLEN	equ	020h	;must be power of 2
                             B       66 
                             B       67 DEFB MACRO P1
                             B       68 	DB P1
                             B       69 	MACEND
                             B       70 
                             B       71 DEFW MACRO P1
                             B       72 	DW P1
                             B       73 	MACEND
                             B       74 
                             B       75 DEFM MACRO P1
                             B       76 	DB P1
                             B       77 	MACEND
                             B       78 
                             B       79 
                             A       16 
                             A       17 	CPU = Z180
                             A       18 
                             A       19 ;RAMSTARTLOC equ  03C00h
                   00004000  A       20 RAMSTARTLOC equ	04000h
                             A       21 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    3


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A       22 	ORG	0000H
                             A       23 
                             A       24 	.DEFINE ACEROM
                             A       25 	.SECTION ACEROM
                             A       26 
                             A       27 	PUBLIC	IM1INTHANDLER
                             A       28 
                             A       29 	PUBLIC	FRAMES
                             A       30 ; -------------------
                             A       31 ; THE 'START' RESTART
                             A       32 ; -------------------
                             A       33 
00000000                     A       34 L0000:
00000000 F3                  A       35 	DI								; disable interrupts.
00000001 21 00 00            A       36 	LD		HL,RAMSTART				; start of 'User' RAM
00000004 3E FC               A       37 	LD		A,0FCh					; a test byte and 1K masking byte.
                             A       38 ;	JR		L0028					; forward to continue at Part 2. //ontobus
00000006 C3 00 00            A       39 	JP		NEWROMSTART
                             A       40 
                             A       41 ; -------------------
                             A       42 ; THE 'PRINT' RESTART
                             A       43 ; -------------------
                             A       44 
00000009 D9                  A       45 L0008:  EXX								; preserve main registers.
0000000A DD CB 3E 5E         A       46 	BIT		3,(IX+03Eh)				; test FLAGS for print destination.
0000000E C3 EE 03            A       47 	JP		L03EE					; forward to
                             A       48 
                             A       49 ; ---------------------------
                             A       50 ; THE 'STACK WORD DE' RESTART
                             A       51 ; ---------------------------
                             A       52 
                             A       53 ;L0010:  LD		HL,(SPARE)				; SPARE
00000011 2A 3B 00            A       54 L0010:  LD		HL,(SPARE)				; SPARE
00000014 73                  A       55 	LD		(HL),E
00000015 23                  A       56 	INC		HL
00000016 C3 5E 08            A       57 	JP		L085F					;
                             A       58 
                             A       59 ; -------------------------
                             A       60 ; THE 'POP WORD DE' RESTART
                             A       61 ; -------------------------
                             A       62 
                             A       63 
00000019 2A 3B 00            A       64 L0018:  LD		HL,(SPARE)				; SPARE
0000001C 2B                  A       65 	DEC		HL
0000001D 56                  A       66 	LD		D,(HL)
0000001E C3 58 08            A       67 	JP		L0859					;
                             A       68 
                             A       69 ; -------------------
                             A       70 ; THE 'ERROR' RESTART
                             A       71 ; -------------------
                             A       72 
00000021 E1                  A       73 L0020:  POP		HL
00000022 7E                  A       74 	LD		A,(HL)
00000023 32 3D 00            A       75 	LD		(ERR_NO),A				; ERR_NO
00000026 C3 AD 00            A       76 	JP		L00AD					;
                             A       77 
                             A       78 ; ------------------------------------
                             A       79 ; THE 'INITIALIZATION ROUTINE' Part 2.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    4


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A       80 ; ------------------------------------
                             A       81 
00000029 24                  A       82 L0028:  INC		H						; increase high byte
0000002A 77                  A       83 	LD		(HL),A					; insert A value
0000002B BE                  A       84 	CP		(HL)					; compare to expected
0000002C 28 FB               A       85 	JR		Z,L0028					; loop back while RAM is populated.
                             A       86 
0000002E A4                  A       87 	AND		H						; limit to nearest 1K segment.
0000002F 67                  A       88 	LD		H,A						; place back in H.
                             A       89 ;		LD		(RAMSTART+018h),HL				; set system variable RAMTOP.
00000030 22 18 00            A       90 	LD		(RAMTOP),HL					; set system variable RAMTOP.
00000033 F9                  A       91 	LD		SP,HL					; initialize the stack pointer.
                             A       92 
                             A       93 ; the Z80 instructions CALL, PUSH and POP can now be used.
                             A       94 
00000034 21 0D 01            A       95 	LD		HL,L010D				; prepare to copy the system variables
                             A       96 					; initial state from ROM.
00000037 18 03               A       97 	JR		L003B					; skip past the fixed-position restart.
                             A       98 
                             A       99 ; -----------------------
                             A      100 ; THE 'INTERRUPT' RESTART
                             A      101 ; -----------------------
                             A      102 
00000039 C3 3A 01            A      103 L0038:  JP		IM1INTHANDLER					; jump to somewhere more convenient.
                             A      104 
                             A      105 ;------------------------------------------------------------------------------
                             A      106 ;
                             A      107 ; MEMORY MAP
                             A      108 ;
                             A      109 ; 00000h +======================================================+
                             A      110 ;		|														|
                             A      111 ;		|					ROM 8K								|
                             A      112 ;		|										v 02300h			|
                             A      113 ; 02000h +======================================================+ - - - - - -
                             A      114 ;		|		copy of 02400h					|0|<  cassette  >|
                             A      115 ; 02400h +-------------------------------------+-+--------------+
                             A      116 ;		|		VIDEO MEMORY 768 bytes		|0| PAD 254 bytes| 1K RAM
                             A      117 ; 02800h +-------------------------------------+-+--------------+
                             A      118 ;		|		copy of 02c00h					^ 02700h			|
                             A      119 ; 02C00h +------------------------------------------------------+
                             A      120 ;		|		CHARACTER SET - Write-Only						| 1K RAM
                             A      121 ; 03000h +------------------------------------------------------+
                             A      122 ;		|		ROM 4K										|
                             A      123 ; 04000h +-------+----------------------------------------------+
                             A      124 ;		|SYSVARS| DICT {12} DATA STACK ->			<- RET STACK | 1K RAM
                             A      125 ;		+=======+==============================================+
                             A      126 ;		|														|
                             A      127 ;						48K AVAILABLE FOR EXPANSION.
                             A      128 ;		|														|
                             A      129 ; 0FFFFh +======================================================+
                             A      130 ;
                             A      131 ; The Ace had an 8K ROM and was sold with 3K of RAM each byte of which had
                             A      132 ; at least two addresses and sometimes four addresses so the mapping of the
                             A      133 ; 3K of RAM was as above.
                             A      134 ; The 768 bytes of video memory is accessed by the ROM using addresses
                             A      135 ; 02400h - 026FFh. This gives priority to the video circuitry which also needs
                             A      136 ; this information to build the TV picture. The byte at 02700h is set to zero
                             A      137 ; so that it is easy for the ROM to detect when it is at the end of the screen.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    5


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      138 ; The 254 bytes remaining are the PAD - the workspace used by FORTH.
                             A      139 ; This same area is used by the tape recorder routines to assemble the tape
                             A      140 ; header information but since, for accurate tape timing, the FORTH ROM needs
                             A      141 ; priority over the video circuitry, then the ROM uses addresses 02301h - 023FFh.
                             A      142 ;
                             A      143 ; Similarly the Character Set is written to by the ROM (and User) at the 1K
                             A      144 ; section starting at 02C00h. The video circuitry accesses this using addresses
                             A      145 ; 02800h - 02BFFh to build the TV picture. It is not possible for the ROM or User
                             A      146 ; to read back the information from either address so this precludes the saving
                             A      147 ; of character sets and writing a driver for a device like the ZX Printer.
                             A      148 ;
                             A      149 ;
                             A      150 ; Then comes the User Dictionary, the first word of which is "FORTH" which links
                             A      151 ; to the Dictionary in ROM. Next a gap of 12 bytes to allow for Data Stack
                             A      152 ; underflow and then the Data Stack itself which grows upwards.
                             A      153 ; At the opposite end of free memory is the Return Stack (machine stack) which
                             A      154 ; grows downwards.
                             A      155 
                             A      156 ; ------------------------------------
                             A      157 ; THE 'INITIALIZATION ROUTINE' Part 3.
                             A      158 ; ------------------------------------
                             A      159 
0000003C 11 24 00            A      160 L003B:  LD		DE,L_HALF				; destination system variable L_HALF
0000003F 01 2D 00            A      161 	LD		BC,0002Dh				; number of bytes.
00000042 ED B0               A      162 	LDIR							; copy initial state from ROM to RAM.
                             A      163 
00000044 DD 21 00 00         A      164 	LD		IX,FP_WS				; set IX to index the system variables.
00000048 FD 21 C8 04         A      165 	LD		IY,L04C8				; set IY to the SLOW return address.
                             A      166 
0000004C CD 23 0A            A      167 L004B:  CALL	L0A24					; routine CLS.
                             A      168 
0000004F AF                  A      169 	XOR		A						; clear accumulator.
                             A      170 
00000050 32 00 27            A      171 	LD		(02700h),A				; make location after screen zero.
                             A      172 
                             A      173 ; There are 128 bit-mapped 8x8 characters.
                             A      174 ; Define the 8 Battenberg graphics (010h to 017h) from low byte of address.
                             A      175 ; This routine also sets the other characters 000h to 00Fh and 018h to 01Fh
                             A      176 ; to copies of this range. The inverse form of character 017h is used as the
                             A      177 ; normal cursor - character 097h.
                             A      178 
00000053 21 00 2C            A      179 L0052:  LD		HL,02C00h				; point to the start of the 1K write-
                             A      180 					; only Character Set RAM.
                             A      181 
00000056 7D                  A      182 L0055:  LD		A,L						; set A to low byte of address
00000057 E6 BF               A      183 	AND		0BFh						; AND %10111111
00000059 0F                  A      184 	RRCA							; rotate
0000005A 0F                  A      185 	RRCA							; three times
0000005B 0F                  A      186 	RRCA							; to test bit 2
0000005C 30 02               A      187 	JR		NC,L005F				; forward if not set.
                             A      188 
0000005E 0F                  A      189 	RRCA							; else rotate
0000005F 0F                  A      190 	RRCA							; twice more.
                             A      191 
00000060 0F                  A      192 L005F:  RRCA							; set carry from bit (3) or (6)
                             A      193 
00000061 47                  A      194 	LD		B,A
                             A      195 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    6


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000062 9F                  A      196 	SBC		A,A						; 000h or 0FFh
00000063 CB 18               A      197 	RR		B
00000065 47                  A      198 	LD		B,A
00000066 9F                  A      199 	SBC		A,A
00000067 A8                  A      200 	XOR		B
00000068 E6 F0               A      201 	AND		0F0h
0000006A A8                  A      202 	XOR		B
0000006B 77                  A      203 	LD		(HL),A					; insert the byte.
0000006C 2C                  A      204 	INC		L						; increment low byte of address
0000006D 20 E7               A      205 	JR		NZ,L0055				; loop back until the first 256 bytes
                             A      206 					; have been filled with 32 repeating
                             A      207 					; characters.
                             A      208 
                             A      209 ; Now copy the bit patterns at the end of this ROM to the last 768 bytes of
                             A      210 ; the Character RAM, filling in some blank bytes omitted to save ROM space.
                             A      211 ; This process starts at high memory and works downwards.
                             A      212 
0000006F 11 FF 2F            A      213 L006E:  LD		DE,02FFFh				; top of destination.
00000072 21 FA 1F            A      214 	LD		HL,L1FFB				; end of copyright character.
00000075 01 08 00            A      215 	LD		BC,00008h				; 8 characters
                             A      216 
00000078 ED B8               A      217 	LDDR							; copy the  ï¿½  character
                             A      218 
0000007A EB                  A      219 	EX		DE,HL					; switch pointers.
                             A      220 
0000007B 3E 5F               A      221 	LD		A,05Fh					; set character counter to ninety five.
                             A      222 					; i.e. %0101 1111
                             A      223 					; bit 5 shows which 32-character sector
                             A      224 					; we are in.
                             A      225 
                             A      226 ; enter a loop for the remaining characters supplying zero bytes as required.
                             A      227 
0000007D 0E 07               A      228 L007C:  LD		C,007h					; set byte counter to seven.
                             A      229 
0000007F CB 6F               A      230 	BIT		5,A						; test bit 5 of the counter.
00000081 28 03               A      231 	JR		Z,L0085					; forward if not in middle section
                             A      232 					; which includes "[A-Z]"
                             A      233 
00000083 70                  A      234 	LD		(HL),B					; else insert a zero byte.
00000084 2B                  A      235 	DEC		HL						; decrement the destination address.
00000085 0D                  A      236 	DEC		C						; and the byte counter.
                             A      237 
00000086 EB                  A      238 L0085:  EX		DE,HL					; switch pointers.
                             A      239 
00000087 ED B8               A      240 	LDDR							; copy the 5 or 6 characters.
                             A      241 
00000089 EB                  A      242 	EX		DE,HL					; switch pointers.
                             A      243 
0000008A 70                  A      244 	LD		(HL),B					; always insert the blank top byte.
0000008B 2B                  A      245 	DEC		HL						; decrement the address.
                             A      246 
0000008C 3D                  A      247 	DEC		A						; decrement the character counter.
                             A      248 
0000008D 20 EE               A      249 	JR		NZ,L007C				; back for all 95 characters.
                             A      250 
                             A      251 ;	IM		1						; Select Interrupt Mode 1
                             A      252 ;	JR		L009B					; and then jump into the code for the
                             A      253 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    7


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      254 	.EXTERN	NEWROMSTART
0000008F C3 00 00            A      255 	JP	NEWROMSTART
                             A      256 					; QUIT word.
                             A      257 
                             A      258 
                             A      259 ; ---------------
                             A      260 ; THE 'QUIT' WORD
                             A      261 ; ---------------
                             A      262 ; (  --  )
                             A      263 ; Clears return stack, empties input buffer and returns control to the
                             A      264 ; keyboard.
                             A      265 
                             A      266 L0092:  DEFM	"QUI"					; 'name field'
00000092 51 55 49            A+     266 	DB P1
                             A      267 	DEFB	'T'+080h
00000095 D4                  A+     267 	DB P1
                             A      268 
                             A      269 L0096:  DEFW	00000h					; 'link field' - end of linked list.
00000096 00 00               A+     269 	DW P1
                             A      270 
                             A      271 L0098:  DEFB	004h						; 'name length field'
00000098 04                  A+     271 	DB P1
                             A      272 
                             A      273 L0099:  DEFW	L009B					; 'code field' 
00000099 9B 00               A+     273 	DW P1
                             A      274 					; address of machine code for routine.
                             A      275 
                             A      276 ; ---
                             A      277 	PUBLIC L009B
                             A      278 ;L009B:  LD		SP,(RAMSTART+018h)				; set stack-pointer to RAMTOP.
0000009B                     A      279 L009B:  
0000009B ED 7B 18 00         A      280 	LD		SP,(RAMTOP)				; set stack-pointer to RAMTOP.
                             A      281 
0000009F FB                  A      282 	EI								; Enable Interrupts.
                             A      283 
000000A0 C3 F2 04            A      284 	JP		L04F2					; jump forward to the main execution 
                             A      285 					; loop.
                             A      286 
                             A      287 ; ----------------
                             A      288 ; THE 'ABORT' WORD
                             A      289 ; ----------------
                             A      290 ; Clears the data and return stacks, deletes any incomplete definition
                             A      291 ; left in the dictionary, prints 'ERROR' and the byte from address ERR_NO
                             A      292 ; if the byte is non-negative, empties the input buffer, and returns
                             A      293 ; control to the keyboard.
                             A      294 
                             A      295 
                             A      296 L00A3:  DEFM	"ABOR"					; 'name field' 
000000A3 41 42 4F 52         A+     296 	DB P1
                             A      297 	DEFB	'T'+080h				
000000A7 D4                  A+     297 	DB P1
                             A      298 
                             A      299 	DEFW	L0098					; 'link field' to previous word QUIT.
000000A8 98 00               A+     299 	DW P1
                             A      300 
                             A      301 L00AA:  DEFB	005h						; 'name length field'
000000AA 05                  A+     301 	DB P1
                             A      302 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    8


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      303 L00AB:  DEFW	L00AD					; 'code field'
000000AB AD 00               A+     303 	DW P1
                             A      304 
                             A      305 ; ---
                             A      306 
                             A      307 ; -> also continuation of the error restart.
                             A      308 
000000AD FD E5               A      309 L00AD:  PUSH	IY						; preserve current IY value slow/fast.
                             A      310 
000000AF FD 21 B9 04         A      311 	LD		IY,L04B9				; set IY to FAST
                             A      312 					; now empty the data stack
000000B3 2A 37 00            A      313 	LD		HL,(STKBOT)				; STKBOT
000000B6 22 3B 00            A      314 	LD		(SPARE),HL				; SPARE
000000B9 21 3E 00            A      315 	LD		HL,FLAGS				; address FLAGS
000000BC 7E                  A      316 	LD		A,(HL)					; fetch status from FLAGS.
000000BD E6 B3               A      317 	AND		0B3h						; AND %10110011
                             A      318 					; reset bit 2 - show definition complete
                             A      319 					; reset bit 3 - output to screen.
                             A      320 					; reset bit 6 - show in interpreter mode
000000BF CB 56               A      321 	BIT		2,(HL)					; was there an incomplete definition ?
000000C1 77                  A      322 	LD		(HL),A					; update FLAGS
000000C2 28 1A               A      323 	JR		Z,L00DE					; forward if no incomplete word.
                             A      324 
000000C4 CD B9 04            A      325 L00C4:  CALL	L04B9					; do forth
                             A      326 
                             A      327 	DEFW	L0490					; dict			address of sv DICT
000000C7 90 04               A+     327 	DW P1
                             A      328 	DEFW	L08B3					; @				value of sv DICT (d).
000000C9 B2 08               A+     328 	DW P1
                             A      329 	DEFW	L104B					; stk_data		d.			length field
000000CB 4A 10               A+     329 	DW P1
                             A      330 	DEFB	005h						; five			d, 5.
000000CD 05                  A+     330 	DB P1
                             A      331 	DEFW	L0DD2					; +				d+5.		code field
000000CE D1 0D               A+     331 	DW P1
                             A      332 	DEFW	L086B					; dup			d+5, d+5.
000000D0 6A 08               A+     332 	DW P1
                             A      333 	DEFW	L1610					; prvcur		d+5.
000000D2 0F 16               A+     333 	DW P1
                             A      334 	DEFW	L15B5					; namefield		n.
000000D4 B4 15               A+     334 	DW P1
                             A      335 	DEFW	L1011					; stackwrd		n.
000000D6 10 10               A+     335 	DW P1
                             A      336 	DEFW	STKBOT					; (stkbot)		n, stkbot.
000000D8 37 00               A+     336 	DW P1
                             A      337 	DEFW	L08C1					; !				.
000000DA C0 08               A+     337 	DW P1
                             A      338 	DEFW	L1A0E					; end-forth.	.
000000DC 0D 1A               A+     338 	DW P1
                             A      339 
                             A      340 ; at this stage the system variable STKBOT holds the address of the
                             A      341 ; obsolete name field and the system variable CURRENT points to the
                             A      342 ; address of the previous complete word - obtained from the old link field.
                             A      343 
000000DE DD CB 3D 7E         A      344 L00DE:  BIT		7,(IX+03Dh)				; test ERR_NO for normal value 255.
000000E2 20 1B               A      345 	JR		NZ,L00FF				; set-min then main-loop if OK.
                             A      346 
000000E4 CD 07 18            A      347 	CALL	L1808					; else pr-inline
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:    9


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      348 
                             A      349 ; ---
                             A      350 
                             A      351 L00E7:  DEFM	"ERRO"					; the message "ERROR" with the last
000000E7 45 52 52 4F         A+     351 	DB P1
                             A      352 	DEFB	'R'+080h				; character inverted.
000000EB D2                  A+     352 	DB P1
                             A      353 
                             A      354 ; ---
                             A      355 
000000EC CD B9 04            A      356 L00EC:  CALL	L04B9					; forth
                             A      357 
                             A      358 	DEFW	L1011					; stack next word
000000EF 10 10               A+     358 	DW P1
                             A      359 	DEFW	ERR_NO					; -> system variable ERR_NO
000000F1 3D 00               A+     359 	DW P1
                             A      360 	DEFW	L0896					; C@			- fetch content byte
000000F3 95 08               A+     360 	DW P1
                             A      361 	DEFW	L09B3					; .				- print it
000000F5 B2 09               A+     361 	DW P1
                             A      362 	DEFW	L0A95					; CR
000000F7 94 0A               A+     362 	DW P1
                             A      363 	DEFW	L1A0E					; end-forth.
000000F9 0D 1A               A+     363 	DW P1
                             A      364 
000000FB DD 36 3D FF         A      365 	LD		(IX+03Dh),0FFh			; set ERR_NO to 'No Error'
                             A      366 
000000FF 2A 37 00            A      367 L00FF:  LD		HL,(STKBOT)				; fetch STKBOT
00000102 01 0C 00            A      368 	LD		BC,0000Ch				; allow twelve bytes for stack underflow
00000105 09                  A      369 	ADD		HL,BC					; add the extra
00000106 22 3B 00            A      370 	LD		(SPARE),HL				; set SPARE
00000109 FD E1               A      371 	POP		IY						; restore previous state of IY
                             A      372 
0000010B 18 8E               A      373 	JR		L009B					; rejoin main loop
                             A      374 
                             A      375 ; -------------------------
                             A      376 ; THE 'DEFAULT ENVIRONMENT'
                             A      377 ; -------------------------
                             A      378 ; This is the default environment that is copied from ROM to RAM as part of
                             A      379 ; the initialization process. This also contains the FORTH word FORTH definition
                             A      380 
                             A      381 L010D:  DEFW	026E0h					; L_HALF
0000010D E0 26               A+     381 	DW P1
                             A      382 
                             A      383 	DEFB	000h						; KEYCOD
0000010F 00                  A+     383 	DB P1
                             A      384 	DEFB	000h						; KEYCNT copy the 32 bytes.
00000110 00                  A+     384 	DB P1
                             A      385 	DEFB	000h						; STATIN
00000111 00                  A+     385 	DB P1
                             A      386 	DEFW	00000h					; EXWRCH
00000112 00 00               A+     386 	DW P1
                             A      387 	DEFB	000h						; FRAMES
00000114 00                  A+     387 	DB P1
                             A      388 	DEFB	000h						; FRAMES
00000115 00                  A+     388 	DB P1
                             A      389 	DEFB	000h						; FRAMES
00000116 00                  A+     389 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   10


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      390 	DEFB	000h						; FRAMES
00000117 00                  A+     390 	DB P1
                             A      391 	DEFB	000h						; XCOORD
00000118 00                  A+     391 	DB P1
                             A      392 	DEFB	000h						; YCOORD
00000119 00                  A+     392 	DB P1
                             A      393 	DEFW	RAMSTART+04Ch					; CURRENT
0000011A 4C 00               A+     393 	DW P1
                             A      394 	DEFW	RAMSTART+04Ch					; CONTEXT
0000011C 4C 00               A+     394 	DW P1
                             A      395 	DEFW	RAMSTART+04Fh					; VOCLNK
0000011E 4F 00               A+     395 	DW P1
                             A      396 	DEFW	RAMSTART+051h					; STKBOT
00000120 51 00               A+     396 	DW P1
                             A      397 	DEFW	RAMSTART+045h					; DICT
00000122 45 00               A+     397 	DW P1
                             A      398 	DEFW	RAMSTART+05Dh					; SPARE
00000124 5D 00               A+     398 	DW P1
                             A      399 	DEFB	0FFh						; ERR_NO
00000126 FF                  A+     399 	DB P1
                             A      400 	DEFB	000h						; FLAGS
00000127 00                  A+     400 	DB P1
                             A      401 	DEFB	00Ah						; BASE
00000128 0A                  A+     401 	DB P1
                             A      402 
                             A      403 ; FORTH
                             A      404 
                             A      405 	DEFM	"FORT"					; The 'name field'
00000129 46 4F 52 54         A+     405 	DB P1
                             A      406 	DEFB	'H'+080h				; FORTH
0000012D C8                  A+     406 	DB P1
                             A      407 
                             A      408 
                             A      409 	DEFW	00000h					; length field - filled when next word
0000012E 00 00               A+     409 	DW P1
                             A      410 					; is defined.
                             A      411 	DEFW	L1FFF					; link field copied to RAMSTART+049h.
00000130 FE 1F               A+     411 	DW P1
                             A      412 	DEFB	005h						; name length field
00000132 05                  A+     412 	DB P1
                             A      413 	DEFW	L11B5					; code field
00000133 B4 11               A+     413 	DW P1
                             A      414 	DEFW	RAMSTART+049h					; address of parameters
00000135 49 00               A+     414 	DW P1
                             A      415 	DEFB	000h						; VOCLNK						[RAMSTART+04Fh]
00000137 00                  A+     415 	DB P1
                             A      416 	DEFB	000h						; - link to next vocabulary.
00000138 00                  A+     416 	DB P1
                             A      417 	DEFB	000h						; last byte to be copied.	to [RAMSTART+051h]
00000139 00                  A+     417 	DB P1
                             A      418 
                             A      419 ; -----------------------------------------------
                             A      420 ; THE 'CONTINUATION OF THE Z80 INTERRUPT' ROUTINE
                             A      421 ; -----------------------------------------------
                             A      422 ; The destination of the jump at 00038h.
                             A      423 ; Begin by saving both accumulators and the 3 main registers.
                             A      424 
0000013A                     A      425 IM1INTHANDLER:
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   11


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000013A F5                  A      426 	PUSH	AF						; preserve both accumulators
0000013B 08                  A      427 	EX		AF,AF'					;
0000013C F5                  A      428 	PUSH	AF						;
                             A      429 
0000013D C5                  A      430 	PUSH	BC						; and main registers.
0000013E D5                  A      431 	PUSH	DE						;
0000013F E5                  A      432 	PUSH	HL						;
                             A      433 
                             A      434 ; Now wait for 62 * 12 clock cycles. ( To avoid flicker perhaps? ).
                             A      435 
00000140 06 3E               A      436 	LD		B,03Eh					; delay counter.
                             A      437 
00000142 10 FE               A      438 L0142:  DJNZ	L0142					; self loop for delay
                             A      439 
                             A      440 ; Increment the 4-byte frames counter for use as a system clock.
                             A      441 
00000144 21 2B 00            A      442 	LD		HL,FRAMES				; FRAMES1
                             A      443 
00000147                     A      444 L0147:
00000147 34                  A      445 	INC		(HL)					; increment timer.
00000148 23                  A      446 	INC		HL						; next significant byte of four.
00000149 28 FC               A      447 	JR		Z,L0147					; loop back if the value wrapped back
                             A      448 					; to zero.
                             A      449 
                             A      450 ; Note. as manual points out, there is no actual check on this and if
                             A      451 ; you leave your Ace switched on for 2.75 years it will advance to the
                             A      452 ; following system variables although it takes several millennia to advance
                             A      453 ; through the screen coordinates.
                             A      454 
                             A      455 ; Now read the keyboard and if no new key then exit after restoring the
                             A      456 ; preserved registers.
                             A      457 
0000014B CD 10 03            A      458 	CALL	L0310					; routine KEYBOARD.
                             A      459 
0000014E 21 28 00            A      460 	LD		HL,STATIN				; address system variable STATIN
                             A      461 
00000151 CB 46               A      462 	BIT		0,(HL)					; new key?
00000153 28 21               A      463 	JR		Z,L0176					; forward if not to RESTORE/EXIT
                             A      464 
00000155 A7                  A      465 	AND		A						; zero key code ?
00000156 28 1E               A      466 	JR		Z,L0176					; forward if so to EXIT.
                             A      467 
00000158 FE 20               A      468 	CP		020h						; compare to SPACE
0000015A 38 14               A      469 	JR		C,L0170					; forward if less as an Editing Key.
                             A      470 
0000015C CB 4E               A      471 	BIT		1,(HL)					; CAPS shift?
0000015E C4 06 08            A      472 	CALL	NZ,L0807				; routine TO_UPPER
                             A      473 
00000161 CB 56               A      474 	BIT		2,(HL)					; GRAPHICS mode?
00000163 28 02               A      475 	JR		Z,L0167					; skip forward if not
                             A      476 
00000165 E6 9F               A      477 	AND		09Fh						; convert to one of 8 mosaic characters
                             A      478 
00000167 CB 5E               A      479 L0167:  BIT		3,(HL)					; INVERSE mode?
00000169 28 02               A      480 	JR		Z,L016D					; forward if not.
                             A      481 
0000016B F6 80               A      482 	OR		080h						; set bit 7 to make character inverse.
                             A      483 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   12


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000016D CD 96 01            A      484 L016D:  CALL	L0196					; routine pr_buffer
                             A      485 
00000170 CD E6 01            A      486 L0170:  CALL	L01E6					; routine EDIT_KEY
00000173 CD 82 02            A      487 	CALL	L0282					; routine pr_cursor
                             A      488 
                             A      489 ; Before exiting restore the preserved registers.
                             A      490 
00000176 E1                  A      491 L0176:  POP		HL						;
00000177 D1                  A      492 	POP		DE						;
00000178 C1                  A      493 	POP		BC						;
00000179 F1                  A      494 	POP		AF						;
0000017A 08                  A      495 	EX		AF,AF'					;
0000017B F1                  A      496 	POP		AF						;
                             A      497 
0000017C FB                  A      498 	EI								; Enable Interrupts
                             A      499 
0000017D C9                  A      500 	RET								; return.
                             A      501 
                             A      502 ; -----------------------------------
                             A      503 ; THE 'PRINT to LOWER SCREEN' ROUTINE
                             A      504 ; -----------------------------------
                             A      505 
0000017E FE 0D               A      506 L017E:  CP		00Dh						; carriage return?
00000180 20 14               A      507 	JR		NZ,L0196				; forward if not
                             A      508 
                             A      509 ; a carriage return to input buffer i.e. lower screen memory.
                             A      510 
00000182 21 00 27            A      511 	LD		HL,02700h				; set pointer to location after the
                             A      512 					; input buffer.
                             A      513 
00000185 22 22 00            A      514 	LD		(ENDSUF),HL				; set ENDBUF - end of logical line
00000188 22 20 00            A      515 	LD		(CURSOR),HL				; set the CURSOR
                             A      516 
0000018B AF                  A      517 	XOR		A						; clear A
                             A      518 
0000018C CD 98 01            A      519 	CALL	L0198					; print character zero.
                             A      520 
0000018F 21 E0 26            A      521 	LD		HL,026E0h				; left hand position of bottom line.
00000192 22 1E 00            A      522 	LD		(INSCRN),HL				; set INSCRN to this position.
00000195 C9                  A      523 	RET								; return.
                             A      524 
                             A      525 ; ---------------------------------------
                             A      526 ; THE 'PRINT CHARACTER TO BUFFER' ROUTINE
                             A      527 ; ---------------------------------------
                             A      528 
00000196 A7                  A      529 L0196:  AND		A						; check for zero character
00000197 C8                  A      530 	RET		Z						; return if so.
                             A      531 
                             A      532 ; => also called from previous routine only to print a zero skipping above test.
                             A      533 
00000198 08                  A      534 L0198:  EX		AF,AF'					; preserve the output character.
                             A      535 
00000199 2A 22 00            A      536 	LD		HL,(ENDSUF)				; fetch ENDBUF end of logical line
0000019C 7E                  A      537 	LD		A,(HL)					; fetch character from position
0000019D A7                  A      538 	AND		A						; is it zero ?
0000019E 28 06               A      539 	JR		Z,L01A6					; skip forward if so.
                             A      540 
                             A      541 ; else lower screen scrolling is required.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   13


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      542 
000001A0 11 00 D9            A      543 	LD		DE,0D900h				; 00000h - 02700h
000001A3 19                  A      544 	ADD		HL,DE					; test if position is within video RAM
000001A4 30 28               A      545 	JR		NC,L01CE				; forward if < 026FFh
                             A      546 
                             A      547 ; now check that the limit of 22 lines in lower screen is not exceeded.
                             A      548 
000001A6 ED 5B 24 00         A      549 L01A6:  LD		DE,(L_HALF)				; fetch start of buffer from L_HALF
000001AA 21 A0 DB            A      550 	LD		HL,0DBA0h				; 00000h - 02460h
000001AD 19                  A      551 	ADD		HL,DE					;
000001AE 30 34               A      552 	JR		NC,L01E4				; forward to exit if buffer full.
                             A      553 
                             A      554 
000001B0 2A 1C 00            A      555 	LD		HL,(SCRPOS)				; fetch position SCRPOS for upper screen
000001B3 01 20 00            A      556 	LD		BC,00020h				; allow an extra 32 characters - 1 line.
000001B6 09                  A      557 	ADD		HL,BC					;
000001B7 ED 52               A      558 	SBC		HL,DE					; subtract the start of input buffer
000001B9 D5                  A      559 	PUSH	DE						; and save the L_HALF value
                             A      560 
000001BA D4 21 04            A      561 	CALL	NC,L0421				; routine to scroll upper display.
                             A      562 
000001BD CD B0 02            A      563 	CALL	L02B0					; find zerobyte loc in HL
                             A      564 
000001C0 D1                  A      565 	POP		DE						; retrieve the L_HALF value
                             A      566 
000001C1 CD 2F 04            A      567 	CALL	L042F					; routine scroll and blank
                             A      568 
                             A      569 ; The four system variables INSCRN, CURSOR, ENDBUF and L_HALF are each
                             A      570 ; reduced by 32 bytes a screen line.
                             A      571 
000001C4 21 1E 00            A      572 	LD		HL,INSCRN				; address INSCRN the left-hand location
                             A      573 					; of the current input line.
                             A      574 
000001C7 06 04               A      575 	LD		B,004h					; four system variables to update
                             A      576 
000001C9 CD 43 04            A      577 L01C9:  CALL	L0443					; routine SCR-PTRS
                             A      578 
000001CC 10 FB               A      579 	DJNZ	L01C9					; repeat for all four pointers.
                             A      580 
                             A      581 ; ok to print
                             A      582 
000001CE CD 02 03            A      583 L01CE:  CALL	L0302					; routine find characters to EOL.
                             A      584 
000001D1 54                  A      585 	LD		D,H						; HL is end of line
000001D2 5D                  A      586 	LD		E,L						; transfer to DE register.
000001D3 23                  A      587 	INC		HL						; increment
000001D4 22 22 00            A      588 	LD		(ENDSUF),HL				; update ENDBUF
000001D7 2B                  A      589 	DEC		HL						; decrement
000001D8 2B                  A      590 	DEC		HL						; so HL = DE -1
                             A      591 
000001D9 28 02               A      592 	JR		Z,L01DD					; skip if BC zero.
                             A      593 
000001DB ED B8               A      594 	LDDR							; else move the characters.
                             A      595 
000001DD 08                  A      596 L01DD:  EX		AF,AF'					; restore the output character.
000001DE 12                  A      597 	LD		(DE),A					; insert at screen position.
                             A      598 					; (a zero if CR lower)
000001DF 13                  A      599 	INC		DE						; next character position
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   14


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000001E0 ED 53 20 00         A      600 	LD		(CURSOR),DE				; update CURSOR
                             A      601 
000001E4 AF                  A      602 L01E4:  XOR		A						; ?
000001E5 C9                  A      603 	RET								; return.
                             A      604 
                             A      605 ; -------------------------
                             A      606 ; THE 'EDIT KEY' SUBROUTINE
                             A      607 ; -------------------------
                             A      608 
000001E6 21 F0 01            A      609 L01E6:  LD		HL,L01F0				; address the EDIT KEYS table.
                             A      610 
000001E9 16 00               A      611 	LD		D,000h					; prepare to index by one byte.
000001EB 5F                  A      612 	LD		E,A						; character code to E.
000001EC 19                  A      613 	ADD		HL,DE					; index into the table.
                             A      614 
000001ED 5E                  A      615 	LD		E,(HL)					; pick up required offset to the
                             A      616 					; handling routine.
                             A      617 
000001EE 19                  A      618 	ADD		HL,DE					; add to the current address.
000001EF E9                  A      619 	JP		(HL)					; exit via the routine.
                             A      620 
                             A      621 ; ---------------------
                             A      622 ; THE 'EDIT KEYS' TABLE
                             A      623 ; ---------------------
                             A      624 
                             A      625 L01F0:  DEFB	020h				; L0210			000h		- RET
000001F0 20                  A+     625 	DB P1
                             A      626 L01F1:  DEFB	013h				; L0204			001h		- LEFT
000001F1 13                  A+     626 	DB P1
                             A      627 L01F2:  DEFB	00Ch				; L01FE			002h		- CAPS
000001F2 0C                  A+     627 	DB P1
                             A      628 L01F3:  DEFB	01Eh				; L0211			003h		- RIGHT
000001F3 1E                  A+     628 	DB P1
                             A      629 L01F4:  DEFB	00Ah				; L01FE			004h		- GRAPH
000001F4 0A                  A+     629 	DB P1
                             A      630 L01F5:  DEFB	037h				; L022C			005h		- DEL
000001F5 37                  A+     630 	DB P1
                             A      631 L01F6:  DEFB	01Ah				; L0210			006h		- RET
000001F6 1A                  A+     631 	DB P1
                             A      632 L01F7:  DEFB	050h				; L0247			007h		- UP
000001F7 50                  A+     632 	DB P1
                             A      633 L01F8:  DEFB	006h				; L01FE			008h		- INV
000001F8 06                  A+     633 	DB P1
                             A      634 L01F9:  DEFB	09Ch				; L0295			009h		- DOWN
000001F9 9C                  A+     634 	DB P1
                             A      635 L01FA:  DEFB	0C9h				; L02C3			00Ah		- DEL LINE
000001FA C9                  A+     635 	DB P1
                             A      636 L01FB:  DEFB	015h				; L0210			0h		- RET
000001FB 15                  A+     636 	DB P1
                             A      637 L01FC:  DEFB	014h				; L0210			00Ch		- RET
000001FC 14                  A+     637 	DB P1
                             A      638 L01FD:  DEFB	0D3h				; L02D0			00Dh		- KEY-ENTER
000001FD D3                  A+     638 	DB P1
                             A      639 
                             A      640 ; -------------------------------
                             A      641 ; THE 'TOGGLE STATUS BIT' ROUTINE
                             A      642 ; -------------------------------
                             A      643 ; The keycodes have been cleverly mapped to individual bits of the STATIN
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   15


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      644 ; system variable so this simple routine maintains all three status bits.
                             A      645 ; KEY '2' - CAPS SHIFT, '4' - GRAPHICS, '8' - INVERSE VIDEO.
                             A      646 
000001FE 21 28 00            A      647 L01FE:  LD		HL,STATIN				; system variable STATIN
00000201 AE                  A      648 	XOR		(HL)					; toggle the single relevant bit.
00000202 77                  A      649 	LD		(HL),A					; put back.
00000203 C9                  A      650 	RET								; return.
                             A      651 
                             A      652 ; ----------------------------
                             A      653 ; THE 'CURSOR LEFT' SUBROUTINE
                             A      654 ; ----------------------------
                             A      655 ; this subroutine moves the cursor to the left unless the character at that
                             A      656 ; position is zero.
                             A      657 
00000204 2A 20 00            A      658 L0204:  LD		HL,(CURSOR)				; fetch CURSOR.
00000207 2B                  A      659 	DEC		HL						; decrement value.
00000208 7E                  A      660 	LD		A,(HL)					; fetch character at new position.
00000209 A7                  A      661 	AND		A						; test for zero. (cr)
0000020A C8                  A      662 	RET		Z						; return if so.					>>
                             A      663 
0000020B 22 20 00            A      664 	LD		(CURSOR),HL				; else update CURSOR
0000020E 23                  A      665 	INC		HL						; step back
0000020F 77                  A      666 	LD		(HL),A					; and put character that was at new
                             A      667 					; cursor position where cursor is now.
                             A      668 
00000210 C9                  A      669 L0210:  RET								; return.
                             A      670 
                             A      671 ; Note. various unallocated keys in the EDIT KEYS table point to the 
                             A      672 ; above RET instruction.
                             A      673 
                             A      674 ; -----------------------------
                             A      675 ; THE 'CURSOR RIGHT' SUBROUTINE
                             A      676 ; -----------------------------
                             A      677 
00000211 2A 20 00            A      678 L0211:  LD		HL,(CURSOR)				; fetch CURSOR position
00000214 23                  A      679 	INC		HL						; and increment it.
                             A      680 
00000215 ED 5B 22 00         A      681 	LD		DE,(ENDSUF)				; fetch ENDBUF - end of current line.
00000219 A7                  A      682 	AND		A						; prepare to subtract.
0000021A ED 52               A      683 	SBC		HL,DE					; test
0000021C C8                  A      684 	RET		Z						; return if zero - CURSOR is at ENDBUF
                             A      685 
0000021D 19                  A      686 	ADD		HL,DE					; else reform the pointers.
0000021E 22 20 00            A      687 	LD		(CURSOR),HL				; update CURSOR
00000221 7E                  A      688 	LD		A,(HL)					; fetch character at new position.
00000222 2B                  A      689 	DEC		HL						; decrement
00000223 77                  A      690 	LD		(HL),A					; and insert where cursor was.
00000224 C9                  A      691 	RET								; ret.
                             A      692 
                             A      693 ; ---------------------------
                             A      694 ; THE 'DELETE CURSOR' ROUTINE
                             A      695 ; ---------------------------
                             A      696 ; Moves cursor position to right and then continues into DEL-CHAR
                             A      697 
00000225 2A 20 00            A      698 L0225:  LD		HL,(CURSOR)				; fetch CURSOR
00000228 23                  A      699 	INC		HL						; increment position.
00000229 22 20 00            A      700 	LD		(CURSOR),HL				; update CURSOR
                             A      701 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   16


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      702 
                             A      703 ; ------------------------------
                             A      704 ; THE 'DELETE CHARACTER' ROUTINE
                             A      705 ; ------------------------------
                             A      706 
0000022C CD 02 03            A      707 L022C:  CALL	L0302					; routine finds characters to EOL.
                             A      708 
0000022F 62                  A      709 	LD		H,D						; transfer CURSOR position DE to HL.
00000230 6B                  A      710 	LD		L,E						;
00000231 1B                  A      711 	DEC		DE						; decrement DE
00000232 1A                  A      712 	LD		A,(DE)					; fetch character to left of original
                             A      713 					; cursor.
00000233 A7                  A      714 	AND		A						; test for zero.
00000234 C8                  A      715 	RET		Z						; return if so.					>>
                             A      716 
00000235 ED 53 20 00         A      717 	LD		(CURSOR),DE				; else update CURSOR
00000239 78                  A      718 	LD		A,B						; check for count of characters
0000023A B1                  A      719 	OR		C						; being zero
0000023B 28 02               A      720 	JR		Z,L023F					; skip if so.
                             A      721 
0000023D ED B0               A      722 L023D:  LDIR							; else shift characters to left.
                             A      723 
0000023F 2B                  A      724 L023F:  DEC		HL						; decrement HL so that points to end -
                             A      725 					; last position on the logical line.
00000240 36 20               A      726 	LD		(HL),020h				; insert a space.
00000242 22 22 00            A      727 	LD		(ENDSUF),HL				; set ENDBUF
00000245 0C                  A      728 	INC		C						; reset zero flag??
00000246 C9                  A      729 	RET								; return.
                             A      730 
                             A      731 ; -----------------------
                             A      732 ; THE 'CURSOR UP' ROUTINE
                             A      733 ; -----------------------
                             A      734 ; When the cursor is moved up while editing a multi-line word definition,
                             A      735 ; then the cursor is first moved to the left of the screen abutting the
                             A      736 ; character zeros at the leftmost position.
                             A      737 ; These zero characters appear as spaces but mark the beginning of each logical
                             A      738 ; line. A logical line may, for instance if it contains a text item, extend over
                             A      739 ; several physical screen lines.
                             A      740 
00000247 CD 04 02            A      741 L0247:  CALL	L0204					; routine CURSOR-LEFT
0000024A 28 08               A      742 	JR		Z,L0254					; skip forward if not possible.
                             A      743 
                             A      744 ; else move left by thirty two positions. This may achieve a vertical move if
                             A      745 ; attempted when a word is first being entered. Alternatively if one of the
                             A      746 ; calls to cursor left fails having encountered a zero, then all subsequent
                             A      747 ; calls will fail. The routine will return with the cursor adjacent to the zero.
                             A      748 
0000024C 06 1F               A      749 	LD		B,01Fh					; count 31 decimal
0000024E CD 04 02            A      750 L024E:  CALL	L0204					; move cursor left thirty one times.
00000251 10 FB               A      751 	DJNZ	L024E					; makes thirty two moves counting first
                             A      752 
00000253 C9                  A      753 	RET								; return.
                             A      754 
                             A      755 ; ---
                             A      756 
00000254 2A 1E 00            A      757 L0254:  LD		HL,(INSCRN)				; fetch INSCRN start of current line.
00000257 ED 5B 24 00         A      758 	LD		DE,(L_HALF)				; fetch L_HALF start of buffer.
0000025B A7                  A      759 	AND		A						; reset carry for
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   17


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000025C ED 52               A      760 	SBC		HL,DE					; true subtraction.
0000025E C8                  A      761 	RET		Z						; return if at beginning of input buffer
                             A      762 
0000025F CD 25 02            A      763 	CALL	L0225					; routine DEL-CURSOR
                             A      764 
00000262 2A 1E 00            A      765 	LD		HL,(INSCRN)				; fetch INSCRN leftmost location of
                             A      766 					; current line.
00000265 11 E0 FF            A      767 	LD		DE,0FFE0h				; make DE minus thirty two.
00000268 AF                  A      768 	XOR		A						; clear accumulator to zero.
                             A      769 
00000269 19                  A      770 L0269:  ADD		HL,DE					; subtract 32
0000026A BE                  A      771 	CP		(HL)					; compare contents to zero
                             A      772 					; ( i.e. prev (cr) or buffer start?)
0000026B 20 FC               A      773 	JR		NZ,L0269				; loop back until HL holds zero.
                             A      774 
0000026D 22 1E 00            A      775 	LD		(INSCRN),HL				; update INSCRN
                             A      776 
00000270 CD F4 02            A      777 	CALL	L02F4					; find endbuf
                             A      778 
00000273 22 20 00            A      779 	LD		(CURSOR),HL				; set CURSOR
                             A      780 
                             A      781 ; ----------
                             A      782 ; PR_CURSOR
                             A      783 ; ----------
                             A      784 
00000276 3E A0               A      785 L0276:  LD		A,0A0h					; inverse space - so solid square
                             A      786 
00000278 CD 7E 01            A      787 	CALL	L017E					; routine PR_LOWER
                             A      788 
0000027B 2A 20 00            A      789 	LD		HL,(CURSOR)				; CURSOR
0000027E 2B                  A      790 	DEC		HL
0000027F 22 20 00            A      791 	LD		(CURSOR),HL				; CURSOR
                             A      792 
                             A      793 ; -> from interrupt
00000282 2A 20 00            A      794 L0282:  LD		HL,(CURSOR)				; CURSOR
                             A      795 
00000285 3A 28 00            A      796 	LD		A,(STATIN)				; STATIN
00000288 1F                  A      797 	RRA								; ignore bit 0
00000289 36 97               A      798 	LD		(HL),097h				; pixel cursor.
0000028B 1F                  A      799 	RRA								; test bit 1 - CAPS
0000028C 30 02               A      800 	JR		NC,L0290				; forward if no CAPS SHIFT
                             A      801 
0000028E 36 C3               A      802 	LD		(HL),0C3h				; inverse [C] cursor.
                             A      803 
00000290 1F                  A      804 L0290:  RRA								; test bit 2 - GRAPHICS.
00000291 D0                  A      805 	RET		NC						; return if not
                             A      806 
00000292 36 C7               A      807 L0292:  LD		(HL),0C7h				; inverse [G] cursor.
00000294 C9                  A      808 	RET								; return
                             A      809 
                             A      810 ; -------------------------
                             A      811 ; THE 'CURSOR DOWN' ROUTINE
                             A      812 ; -------------------------
                             A      813 
                             A      814 
00000295 CD 11 02            A      815 L0295:  CALL	L0211					; routine CURSOR RIGHT
00000298 28 08               A      816 	JR		Z,L02A2					; forward if not possible.
                             A      817 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   18


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000029A 06 1F               A      818 	LD		B,01Fh					; set counter to thirty one.
                             A      819 
0000029C CD 11 02            A      820 L029C:  CALL	L0211					; routine CURSOR RIGHT
0000029F 10 FB               A      821 	DJNZ	L029C					; thirty two moves altogether.
000002A1 C9                  A      822 	RET								; return.
                             A      823 
                             A      824 ; ---
                             A      825 
000002A2 CD B0 02            A      826 L02A2:  CALL	L02B0					; find zerobyte
000002A5 E0                  A      827 	RET		PO						; return if	found
                             A      828 
000002A6 E5                  A      829 	PUSH	HL						; save position
000002A7 CD 25 02            A      830 	CALL	L0225					; routine DEL-CURSOR
000002AA E1                  A      831 	POP		HL						; retrieve position.
000002AB CD ED 02            A      832 	CALL	L02ED					; set logical line
000002AE 18 C6               A      833 	JR		L0276					; back to exit via pr_cursor.
                             A      834 
                             A      835 ; ---
                             A      836 ; find zerobyte
                             A      837 ; ---
                             A      838 ; -> called 5 times
                             A      839 
000002B0 21 00 27            A      840 L02B0:  LD		HL,02700h				; this location is always zero.
                             A      841 					; the byte following video RAM.
000002B3 ED 5B 1E 00         A      842 	LD		DE,(INSCRN)				; INSCRN		e.g. 026E0h
                             A      843 
000002B7 A7                  A      844 	AND		A						; prepare for true subtraction
                             A      845 
000002B8 ED 52               A      846 	SBC		HL,DE					; subtract to give number of chars
                             A      847 
000002BA 44                  A      848 	LD		B,H						; transfer count to
000002BB 4D                  A      849 	LD		C,L						; the BC register pair.
                             A      850 
000002BC EB                  A      851 	EX		DE,HL					; transfer INSCR value to HL.
                             A      852 
000002BD 23                  A      853 	INC		HL						; start next location
000002BE AF                  A      854 	XOR		A						; search for a zero character.
                             A      855 
000002BF ED B1               A      856 	CPIR							; at most BC locations.
                             A      857 					; sets P/O flag if BC!=0
                             A      858 
000002C1 2B                  A      859 	DEC		HL						; step back to last non-zero
000002C2 C9                  A      860 	RET								; return.
                             A      861 
                             A      862 ; -------------------------
                             A      863 ; THE 'DELETE LINE' ROUTINE
                             A      864 ; -------------------------
                             A      865 ; CHR0h 10
                             A      866 
000002C3 2A 22 00            A      867 L02C3:  LD		HL,(ENDSUF)				; ENDBUF
000002C6 2B                  A      868 	DEC		HL						;
000002C7 22 20 00            A      869 	LD		(CURSOR),HL				; CURSOR
                             A      870 
000002CA CD 2C 02            A      871 L02CA:  CALL	L022C					; KEY-DEL
000002CD 20 FB               A      872 	JR		NZ,L02CA				; repeat
                             A      873 
000002CF C9                  A      874 	RET								; return.
                             A      875 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   19


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      876 ; --------------------------
                             A      877 ; THE 'KEY-ENTER' SUBROUTINE
                             A      878 ; --------------------------
                             A      879 
000002D0 21 28 00            A      880 L02D0:  LD		HL,STATIN				; STATIN
000002D3 CB EE               A      881 	SET		5,(HL)					; signal new key.
000002D5 CB 86               A      882 	RES		0,(HL)					; reset new key flag
000002D7 C9                  A      883 	RET								; return.
                             A      884 
                             A      885 
                             A      886 ; ------------------------
                             A      887 ; THE 'SET BUFFER' ROUTINE
                             A      888 ; ------------------------
                             A      889 ; called by LIST, QUERY
                             A      890 
000002D8 21 00 27            A      891 L02D8:  LD		HL,02700h				; one past end of screen.
000002DB ED 5B 24 00         A      892 	LD		DE,(L_HALF)				; fetch start of buffer from L_HALF
                             A      893 
000002DF CD FA 07            A      894 	CALL	L07FA					; routine SPACE_FILL
                             A      895 
000002E2 21 E0 26            A      896 	LD		HL,026E0h				; first location of bottom line.
000002E5 22 24 00            A      897 	LD		(L_HALF),HL				; set L_HALF
                             A      898 
000002E8 36 00               A      899 	LD		(HL),000h				; insert a ZERO.
                             A      900 
                             A      901 ; -> called by retype
000002EA 2A 24 00            A      902 L02EA:  LD		HL,(L_HALF)				; fetch L_HALF
                             A      903 
                             A      904 ; -> from cursor down
000002ED 22 1E 00            A      905 L02ED:  LD		(INSCRN),HL				; set INSCRN
000002F0 23                  A      906 	INC		HL						; step past the zero
000002F1 22 20 00            A      907 	LD		(CURSOR),HL				; set CURSOR
                             A      908 
                             A      909 ; => from cursor up.
000002F4 CD B0 02            A      910 L02F4:  CALL	L02B0					; find zerobyte
                             A      911 
000002F7 3E 20               A      912 	LD		A,020h					; prepare a space
                             A      913 
000002F9 2B                  A      914 L02F9:  DEC		HL						; move to the left.
000002FA BE                  A      915 	CP		(HL)					; compare to space.
000002FB 28 FC               A      916 	JR		Z,L02F9					; back while spaces exist.
                             A      917 
000002FD 23                  A      918 	INC		HL						; point to last space encountered.
000002FE 22 22 00            A      919 	LD		(ENDSUF),HL				; set ENDBUF - end of logical line.
00000301 C9                  A      920 	RET								; return.
                             A      921 
                             A      922 ; ----------------------------------
                             A      923 ; THE 'COUNT TO END OF LINE' ROUTINE
                             A      924 ; ----------------------------------
                             A      925 ; Find the number of characters to the end of the logical line.
                             A      926 
00000302 2A 22 00            A      927 L0302:  LD		HL,(ENDSUF)				; system variable ENDBUF
00000305 ED 5B 20 00         A      928 	LD		DE,(CURSOR)				; system variable CURSOR
00000309 A7                  A      929 	AND		A						; prepare to subtract.
0000030A ED 52               A      930 	SBC		HL,DE					; subtract to give character places
0000030C 44                  A      931 	LD		B,H						; transfer result
0000030D 4D                  A      932 	LD		C,L						; to the BC register pair.
0000030E 19                  A      933 	ADD		HL,DE					; reform the pointers.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   20


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      934 
0000030F C9                  A      935 	RET								; return with zero flag set if cursor
                             A      936 					; at EOL.
                             A      937 
                             A      938 ; ----------------------
                             A      939 ; THE 'KEYBOARD' ROUTINE
                             A      940 ; ----------------------
                             A      941 
00000310 CD 36 03            A      942 L0310:  CALL	L0336					; routine KEY_SCAN
                             A      943 
00000313 47                  A      944 	LD		B,A						; save key in B
                             A      945 
00000314 2A 26 00            A      946 	LD		HL,(KEYCOD)				; load L with KEYCOD - last key pressed
                             A      947 					; load H with KEYCNT - debounce counter
                             A      948 
00000317 AD                  A      949 	XOR		L						; compare to previous key.
00000318 28 0B               A      950 	JR		Z,L0325					; forward if a match.
                             A      951 
0000031A AD                  A      952 	XOR		L						; reform original
0000031B 28 03               A      953 	JR		Z,L0320					; forward if zero - no key.
                             A      954 
0000031D AF                  A      955 	XOR		A						; else clear accumulator.
                             A      956 
0000031E BD                  A      957 	CP		L						; compare with last.
0000031F C0                  A      958 	RET		NZ						; return if not zero.
                             A      959 
00000320 68                  A      960 L0320:  LD		L,B						; set L to original keycode
00000321 26 20               A      961 	LD		H,020h					; set counter to thirty two.
00000323 18 0D               A      962 	JR		L0332					; forward to store values and exit
                             A      963 					; returning zero.
                             A      964 
                             A      965 ; ---
                             A      966 
                             A      967 ; Key is same as previously accepted key.
                             A      968 ; It repeats after two interrupts
                             A      969 
00000325 25                  A      970 L0325:  DEC		H						; decrement the counter.
00000326 7C                  A      971 	LD		A,H						; fetch counter to A.
00000327 FE 1E               A      972 	CP		01Eh						; compare to thirty.
00000329 28 06               A      973 	JR		Z,L0331					; forward if so to return key in A.
                             A      974 
0000032B AF                  A      975 	XOR		A						; clear accumulator.
0000032C BC                  A      976 	CP		H						; is counter zero?
0000032D 20 03               A      977 	JR		NZ,L0332				; forward if not to keep counting.
                             A      978 
0000032F 26 04               A      979 	LD		H,004h					; else set counter to four.
                             A      980 
00000331 7D                  A      981 L0331:  LD		A,L						; pick up previous key.
                             A      982 
00000332 22 26 00            A      983 L0332:  LD		(KEYCOD),HL				;  update KEYCOD/KEYCNT
                             A      984 
00000335 C9                  A      985 	RET								; return.
                             A      986 
                             A      987 ;----------------------------------------------------------------------------
                             A      988 ;							LOGICAL VIEW OF KEYBOARD
                             A      989 ;
                             A      990 ;			0		1		2		3		4 -Bits-  4		3		2		1		0
                             A      991 ; PORT																	PORT
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   21


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A      992 ;
                             A      993 ; F7FE  [ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ]  |  [ 6 ] [ 7 ] [ 8 ] [ 9 ] [ 0 ]   EFFE
                             A      994 ;  ^									|									v
                             A      995 ; FBFE  [ Q ] [ W ] [ E ] [ R ] [ T ]  |  [ Y ] [ U ] [ I ] [ O ] [ P ]   DFFE
                             A      996 ;  ^									|									v
                             A      997 ; FDFE  [ A ] [ S ] [ D ] [ F ] [ G ]  |  [ H ] [ J ] [ K ] [ L ] [ ENT ] BFFE
                             A      998 ;  ^									|									v
                             A      999 ; FEFE  [SHI] [SYM] [ Z ] [ X ] [ C ]  |  [ V ] [ B ] [ N ] [ M ] [ SPC ] 7FFE
                             A     1000 ;  ^			v												^			v
                             A     1001 ; Start			+------------>--------------------->-------------+		End
                             A     1002 ;
                             A     1003 ;
                             A     1004 ;----------------------------------------------------------------------------
                             A     1005 
                             A     1006 
                             A     1007 ; ----------------------------------
                             A     1008 ; THE 'KEYBOARD SCANNING' SUBROUTINE
                             A     1009 ; ----------------------------------
                             A     1010 ; This routine is called by the KEYBOARD routine 50 times a second and
                             A     1011 ; by the ACE FORTH 'INKEY' WORD.
                             A     1012 ; The above diagram shows the logical view of the Keyboard and PORTS.
                             A     1013 ; The physical view is similar except that the symbol shift key is to the
                             A     1014 ; left of the space key.
                             A     1015 
                             A     1016 
00000336 01 FE FE            A     1017 L0336:  LD		BC,0FEFEh				; port address - B is also an 8 counter
                             A     1018 
00000339 ED 50               A     1019 	IN		D,(C)					; read from port to D.
                             A     1020 					; when a key is pressed, the
                             A     1021 					; corresponding bit is reset.
                             A     1022 
0000033B 5A                  A     1023 	LD		E,D						; save in E
                             A     1024 
0000033C CB 3A               A     1025 	SRL		D						; read the outer SHIFT key.
                             A     1026 
0000033E 9F                  A     1027 	SBC		A,A						; 000h if SHIFT else 0FFh.
0000033F E6 D8               A     1028 	AND		0D8h						; 000h if SHIFT else 0D8h.
                             A     1029 
00000341 CB 3A               A     1030 	SRL		D						; read the symbol shift bit
00000343 38 02               A     1031 	JR		C,L0347					; skip if not pressed.
                             A     1032 
00000345 3E 28               A     1033 	LD		A,028h					; load A with 40 decimal.
                             A     1034 
00000347 C6 57               A     1035 L0347:  ADD		A,057h					; gives 07Fh SYM, 057h SHIFT, or 02Fh
                             A     1036 
                             A     1037 ; Since 8 will be subtracted from the initial key value there are three
                             A     1038 ; distinct ranges 0 - 39, 40 - 79, 80 - 119.
                             A     1039 
00000349 6F                  A     1040 	LD		L,A						; save key range value in L
0000034A 7B                  A     1041 	LD		A,E						; fetch the original port reading.
0000034B F6 03               A     1042 	OR		003h						; cancel the two shift bits.
                             A     1043 
0000034D 1E FF               A     1044 	LD		E,0FFh					; set a flag to detect multiple keys.
                             A     1045 
                             A     1046 ; KEY_LINE the half-row loop.
                             A     1047 
0000034F 2F                  A     1048 L034F:  CPL								; complement bits
                             A     1049 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   22


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000350 E6 1F               A     1050 	AND		01Fh						; mask off the rightmost five key bits.
00000352 57                  A     1051 	LD		D,A						; save a copy in D.
00000353 28 0D               A     1052 	JR		Z,L0362					; forward if no keys pressed to do the
                             A     1053 					; next row.
                             A     1054 
00000355 7D                  A     1055 	LD		A,L						; else fetch the key value
00000356 1C                  A     1056 	INC		E						; test E for 0FFh
00000357 20 12               A     1057 	JR		NZ,L036B				; forward if not now zero to quit
                             A     1058 
00000359 D6 08               A     1059 L0359:  SUB		008h						; subtract 8 from key value
                             A     1060 
0000035B CB 3A               A     1061 	SRL		D						; test next bit affecting zero and carry
                             A     1062 
0000035D 30 FA               A     1063 	JR		NC,L0359				; loop back until the set bit is found.
                             A     1064 
0000035F 5F                  A     1065 	LD		E,A						; transfer key value to E.
00000360 20 09               A     1066 	JR		NZ,L036B				; forward to abort if more than one key
                             A     1067 					; is pressed in the row.
                             A     1068 
00000362 2D                  A     1069 L0362:  DEC		L						; decrement the key value for next row.
                             A     1070 
00000363 CB 00               A     1071 	RLC		B						; rotate the 8 counter and port address
                             A     1072 
00000365 30 06               A     1073 	JR		NC,L036D				; skip forward when all 8 rows have
                             A     1074 					; been read.
                             A     1075 
00000367 ED 78               A     1076 	IN		A,(C)					; else read the next half-row.
00000369 18 E4               A     1077 	JR		L034F					; and back to KEY_LINE.
                             A     1078 
                             A     1079 ; ---
                             A     1080 ; ABORTKEY
                             A     1081 
0000036B 1E FF               A     1082 L036B:  LD		E,0FFh					; signal invalid key.
                             A     1083 
                             A     1084 ; the normal exit checks if E holds a key and not 0FFh.
                             A     1085 
0000036D 7B                  A     1086 L036D:  LD		A,E						; fetch possible key value.
0000036E 3C                  A     1087 	INC		A						; increment
0000036F C8                  A     1088 	RET		Z						; return if was 0FFh as original.
                             A     1089 
00000370 21 76 03            A     1090 	LD		HL,L0376				; else address KEY TABLE
00000373 19                  A     1091 	ADD		HL,DE					; index into table.
                             A     1092 					; (D is zero)
                             A     1093 
00000374 7E                  A     1094 	LD		A,(HL)					; pick up character.
                             A     1095 
00000375 C9                  A     1096 	RET								; return with translated character.
                             A     1097 
                             A     1098 
                             A     1099 
                             A     1100 ; ---------------
                             A     1101 ; THE 'KEY TABLE'
                             A     1102 ; ---------------
                             A     1103 
                             A     1104 ; -----------------------
                             A     1105 ; THE '40 UNSHIFTED KEYS'
                             A     1106 ; -----------------------
                             A     1107 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   23


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1108 L0376:  DEFB	076h						; V - v
00000376 76                  A+    1108 	DB P1
                             A     1109 	DEFB	068h						; H - h
00000377 68                  A+    1109 	DB P1
                             A     1110 	DEFB	079h						; Y - y
00000378 79                  A+    1110 	DB P1
                             A     1111 	DEFB	036h						; 6 - 6
00000379 36                  A+    1111 	DB P1
                             A     1112 	DEFB	035h						; 5 - 5
0000037A 35                  A+    1112 	DB P1
                             A     1113 	DEFB	074h						; T - t
0000037B 74                  A+    1113 	DB P1
                             A     1114 	DEFB	067h						; G - g
0000037C 67                  A+    1114 	DB P1
                             A     1115 	DEFB	063h						; C - c
0000037D 63                  A+    1115 	DB P1
                             A     1116 	DEFB	062h						; B - b
0000037E 62                  A+    1116 	DB P1
                             A     1117 	DEFB	06Ah						; J - j
0000037F 6A                  A+    1117 	DB P1
                             A     1118 	DEFB	075h						; U - u
00000380 75                  A+    1118 	DB P1
                             A     1119 	DEFB	037h						; 7 - 7
00000381 37                  A+    1119 	DB P1
                             A     1120 	DEFB	034h						; 4 - 4
00000382 34                  A+    1120 	DB P1
                             A     1121 	DEFB	072h						; R - r
00000383 72                  A+    1121 	DB P1
                             A     1122 	DEFB	066h						; F - f
00000384 66                  A+    1122 	DB P1
                             A     1123 	DEFB	078h						; X - x
00000385 78                  A+    1123 	DB P1
                             A     1124 	DEFB	06Eh						; N - n
00000386 6E                  A+    1124 	DB P1
                             A     1125 	DEFB	06Bh						; K - k
00000387 6B                  A+    1125 	DB P1
                             A     1126 	DEFB	069h						; I - i
00000388 69                  A+    1126 	DB P1
                             A     1127 	DEFB	038h						; 8 - 8
00000389 38                  A+    1127 	DB P1
                             A     1128 	DEFB	033h						; 3 - 3
0000038A 33                  A+    1128 	DB P1
                             A     1129 	DEFB	065h						; E - e
0000038B 65                  A+    1129 	DB P1
                             A     1130 	DEFB	064h						; D - d
0000038C 64                  A+    1130 	DB P1
                             A     1131 	DEFB	07Ah						; Z - z
0000038D 7A                  A+    1131 	DB P1
                             A     1132 	DEFB	06Dh						; M - m
0000038E 6D                  A+    1132 	DB P1
                             A     1133 	DEFB	06Ch						; L - l
0000038F 6C                  A+    1133 	DB P1
                             A     1134 	DEFB	06Fh						; O - o
00000390 6F                  A+    1134 	DB P1
                             A     1135 	DEFB	039h						; 9 - 9
00000391 39                  A+    1135 	DB P1
                             A     1136 	DEFB	032h						; 2 - 2
00000392 32                  A+    1136 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   24


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1137 	DEFB	077h						; W - w
00000393 77                  A+    1137 	DB P1
                             A     1138 	DEFB	073h						; S - s
00000394 73                  A+    1138 	DB P1
                             A     1139 	DEFB	000h						; SYMBOL
00000395 00                  A+    1139 	DB P1
                             A     1140 	DEFB	020h						; SPACE
00000396 20                  A+    1140 	DB P1
                             A     1141 	DEFB	00Dh						; ENTER
00000397 0D                  A+    1141 	DB P1
                             A     1142 	DEFB	070h						; P - p
00000398 70                  A+    1142 	DB P1
                             A     1143 	DEFB	030h						; 0 - 0
00000399 30                  A+    1143 	DB P1
                             A     1144 	DEFB	031h						; 1 - 1
0000039A 31                  A+    1144 	DB P1
                             A     1145 	DEFB	071h						; Q - q
0000039B 71                  A+    1145 	DB P1
                             A     1146 	DEFB	061h						; A - a
0000039C 61                  A+    1146 	DB P1
                             A     1147 	DEFB	000h						; SHIFT
0000039D 00                  A+    1147 	DB P1
                             A     1148 
                             A     1149 ; ---------------------
                             A     1150 ; THE '40 SHIFTED KEYS'
                             A     1151 ; ---------------------
                             A     1152 
                             A     1153 	DEFB	056h						; V - V
0000039E 56                  A+    1153 	DB P1
                             A     1154 	DEFB	048h						; H - H
0000039F 48                  A+    1154 	DB P1
                             A     1155 	DEFB	059h						; Y - Y
000003A0 59                  A+    1155 	DB P1
                             A     1156 	DEFB	007h						; 6 - 7 KEY-UP
000003A1 07                  A+    1156 	DB P1
                             A     1157 	DEFB	001h						; 5 - 1 KEY-LEFT
000003A2 01                  A+    1157 	DB P1
                             A     1158 	DEFB	054h						;
000003A3 54                  A+    1158 	DB P1
                             A     1159 	DEFB	047h
000003A4 47                  A+    1159 	DB P1
                             A     1160 	DEFB	043h
000003A5 43                  A+    1160 	DB P1
                             A     1161 	DEFB	042h
000003A6 42                  A+    1161 	DB P1
                             A     1162 	DEFB	04Ah
000003A7 4A                  A+    1162 	DB P1
                             A     1163 	DEFB	055h
000003A8 55                  A+    1163 	DB P1
                             A     1164 	DEFB	009h						; 7 - 9 KEY-DOWN
000003A9 09                  A+    1164 	DB P1
                             A     1165 	DEFB	008h						; 4 - 8 INV-VIDEO
000003AA 08                  A+    1165 	DB P1
                             A     1166 	DEFB	052h
000003AB 52                  A+    1166 	DB P1
                             A     1167 	DEFB	046h
000003AC 46                  A+    1167 	DB P1
                             A     1168 	DEFB	058h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   25


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000003AD 58                  A+    1168 	DB P1
                             A     1169 	DEFB	04Eh
000003AE 4E                  A+    1169 	DB P1
                             A     1170 	DEFB	04Bh
000003AF 4B                  A+    1170 	DB P1
                             A     1171 	DEFB	049h
000003B0 49                  A+    1171 	DB P1
                             A     1172 	DEFB	003h						; 8 - 3 KEY-RIGHT
000003B1 03                  A+    1172 	DB P1
                             A     1173 	DEFB	033h						; 3 - 3
000003B2 33                  A+    1173 	DB P1
                             A     1174 	DEFB	045h
000003B3 45                  A+    1174 	DB P1
                             A     1175 	DEFB	044h
000003B4 44                  A+    1175 	DB P1
                             A     1176 	DEFB	05Ah
000003B5 5A                  A+    1176 	DB P1
                             A     1177 	DEFB	04Dh
000003B6 4D                  A+    1177 	DB P1
                             A     1178 	DEFB	04Ch
000003B7 4C                  A+    1178 	DB P1
                             A     1179 	DEFB	04Fh
000003B8 4F                  A+    1179 	DB P1
                             A     1180 	DEFB	004h						; 9 - 4 GRAPH
000003B9 04                  A+    1180 	DB P1
                             A     1181 	DEFB	002h						; 2 - 2 CAPS LOCK
000003BA 02                  A+    1181 	DB P1
                             A     1182 	DEFB	057h						; W - W
000003BB 57                  A+    1182 	DB P1
                             A     1183 	DEFB	053h						; S - S
000003BC 53                  A+    1183 	DB P1
                             A     1184 	DEFB	000h						; SYMB
000003BD 00                  A+    1184 	DB P1
                             A     1185 	DEFB	020h						; SPACE
000003BE 20                  A+    1185 	DB P1
                             A     1186 	DEFB	00Dh						; ENTER
000003BF 0D                  A+    1186 	DB P1
                             A     1187 	DEFB	050h						; P - P
000003C0 50                  A+    1187 	DB P1
                             A     1188 	DEFB	005h						; 0 - 5   DEL
000003C1 05                  A+    1188 	DB P1
                             A     1189 	DEFB	00Ah						; 1 - 0A  DEL_LINE
000003C2 0A                  A+    1189 	DB P1
                             A     1190 	DEFB	051h						; Q - Q
000003C3 51                  A+    1190 	DB P1
                             A     1191 	DEFB	041h						; A - A
000003C4 41                  A+    1191 	DB P1
                             A     1192 	DEFB	000h						; SHIFT
000003C5 00                  A+    1192 	DB P1
                             A     1193 
                             A     1194 ; --------------------------
                             A     1195 ; THE '40 SYMBOL SHIFT KEYS'
                             A     1196 ; --------------------------
                             A     1197 
                             A     1198 	DEFB	02Fh						; V - /
000003C6 2F                  A+    1198 	DB P1
                             A     1199 	DEFB	05Eh						; H - ^
000003C7 5E                  A+    1199 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   26


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1200 	DEFB	05Bh						; Y - [
000003C8 5B                  A+    1200 	DB P1
                             A     1201 	DEFB	026h						; 6 - &
000003C9 26                  A+    1201 	DB P1
                             A     1202 	DEFB	025h						; 5 - %
000003CA 25                  A+    1202 	DB P1
                             A     1203 	DEFB	03Eh						; T - >
000003CB 3E                  A+    1203 	DB P1
                             A     1204 	DEFB	07Dh						;
000003CC 7D                  A+    1204 	DB P1
                             A     1205 	DEFB	03Fh
000003CD 3F                  A+    1205 	DB P1
                             A     1206 	DEFB	02Ah
000003CE 2A                  A+    1206 	DB P1
                             A     1207 	DEFB	02Dh
000003CF 2D                  A+    1207 	DB P1
                             A     1208 	DEFB	05Dh
000003D0 5D                  A+    1208 	DB P1
                             A     1209 	DEFB	027h
000003D1 27                  A+    1209 	DB P1
                             A     1210 	DEFB	024h
000003D2 24                  A+    1210 	DB P1
                             A     1211 	DEFB	03Ch
000003D3 3C                  A+    1211 	DB P1
                             A     1212 	DEFB	07Bh
000003D4 7B                  A+    1212 	DB P1
                             A     1213 	DEFB	060h
000003D5 60                  A+    1213 	DB P1
                             A     1214 	DEFB	02Ch
000003D6 2C                  A+    1214 	DB P1
                             A     1215 	DEFB	02Bh
000003D7 2B                  A+    1215 	DB P1
                             A     1216 	DEFB	07Fh
000003D8 7F                  A+    1216 	DB P1
                             A     1217 	DEFB	028h
000003D9 28                  A+    1217 	DB P1
                             A     1218 	DEFB	023h
000003DA 23                  A+    1218 	DB P1
                             A     1219 	DEFB	045h
000003DB 45                  A+    1219 	DB P1
                             A     1220 	DEFB	05Ch
000003DC 5C                  A+    1220 	DB P1
                             A     1221 	DEFB	03Ah
000003DD 3A                  A+    1221 	DB P1
                             A     1222 	DEFB	02Eh
000003DE 2E                  A+    1222 	DB P1
                             A     1223 	DEFB	03Dh
000003DF 3D                  A+    1223 	DB P1
                             A     1224 	DEFB	03Bh
000003E0 3B                  A+    1224 	DB P1
                             A     1225 	DEFB	029h
000003E1 29                  A+    1225 	DB P1
                             A     1226 	DEFB	040h						; 2 - @
000003E2 40                  A+    1226 	DB P1
                             A     1227 	DEFB	057h						; W - W
000003E3 57                  A+    1227 	DB P1
                             A     1228 	DEFB	07Ch						; S
000003E4 7C                  A+    1228 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   27


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1229 	DEFB	000h						; SYMB
000003E5 00                  A+    1229 	DB P1
                             A     1230 	DEFB	020h						; SPACE
000003E6 20                  A+    1230 	DB P1
                             A     1231 	DEFB	00Dh						; ENTER
000003E7 0D                  A+    1231 	DB P1
                             A     1232 	DEFB	022h						; P - "
000003E8 22                  A+    1232 	DB P1
                             A     1233 	DEFB	05Fh						; 0 - _
000003E9 5F                  A+    1233 	DB P1
                             A     1234 	DEFB	021h						; 1 - !
000003EA 21                  A+    1234 	DB P1
                             A     1235 	DEFB	051h						; Q - Q
000003EB 51                  A+    1235 	DB P1
                             A     1236 	DEFB	07Eh						; A - ~
000003EC 7E                  A+    1236 	DB P1
                             A     1237 	DEFB	000h						; SHIFT
000003ED 00                  A+    1237 	DB P1
                             A     1238 
                             A     1239 ; end of key tables
                             A     1240 
                             A     1241 
                             A     1242 ; ---------------------------
                             A     1243 ; THE 'PRINT ROUTINE' Part 2.
                             A     1244 ; ---------------------------
                             A     1245 ; If output is not directed into the input buffer then jump forward else
                             A     1246 ; call the routine to output to lower screen.
                             A     1247 
000003EE 28 05               A     1248 L03EE:  JR		Z,L03F5					; forward to main screen print.
                             A     1249 
000003F0 CD 7E 01            A     1250 	CALL	L017E					; PR_LOWER
                             A     1251 
000003F3 D9                  A     1252 	EXX								; restore main set
000003F4 C9                  A     1253 	RET								; return.				>>
                             A     1254 
                             A     1255 ; the print output is not directed to the input buffer but first check that
                             A     1256 ; the user has not set up a vector to their own routine to print characters
                             A     1257 ; for instance to a printer.
                             A     1258 
000003F5 47                  A     1259 L03F5:  LD		B,A						; save the character in the B register.
                             A     1260 
000003F6 2A 29 00            A     1261 	LD		HL,(EXWRCH)				; fetch possible vector from EXWRCH
                             A     1262 					; (normally 0)
000003F9 7C                  A     1263 	LD		A,H						; test for
000003FA B5                  A     1264 	OR		L						; the value zero.
000003FB 78                  A     1265 	LD		A,B						; fetch the character back to A.
                             A     1266 
000003FC 28 01               A     1267 	JR		Z,L03FF					; skip forward if no user-supplied
                             A     1268 					; routine.
                             A     1269 
000003FE E9                  A     1270 L03FE:  JP		(HL)					; else jump to user-supplied routine
                             A     1271 					; which should finish with a JP (IY)
                             A     1272 
                             A     1273 ; ---
                             A     1274 ; PRINTING TO UPPER SCREEN
                             A     1275 ; ---
                             A     1276 
000003FF 2A 1C 00            A     1277 L03FF:  LD		HL,(SCRPOS)				; SCRPOS
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   28


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000402 ED 5B 24 00         A     1278 	LD		DE,(L_HALF)				; L_HALF
                             A     1279 
00000406 EB                  A     1280 	EX		DE,HL					; ??
                             A     1281 
00000407 37                  A     1282 	SCF								; inclusive byte.
00000408 ED 52               A     1283 	SBC		HL,DE					; subtract screen position+1 from
                             A     1284 					; the start of input buffer.
0000040A EB                  A     1285 	EX		DE,HL					; hl=scrpos
                             A     1286 
0000040B DC 21 04            A     1287 	CALL	C,L0421					; if no room then scroll upper display
                             A     1288 
0000040E FE 0D               A     1289 	CP		00Dh						; carriage return?
                             A     1290 
00000410 28 04               A     1291 	JR		Z,L0416					; skip forward if so.
                             A     1292 
00000412 77                  A     1293 	LD		(HL),A					; else insert the character.
                             A     1294 
00000413 23                  A     1295 	INC		HL						; point to next position.
00000414 18 06               A     1296 	JR		L041C					; forward
                             A     1297 
                             A     1298 ; ---
                             A     1299 
                             A     1300 ; a carriage return
                             A     1301 
00000416 23                  A     1302 L0416:  INC		HL						; increment screen address.
00000417 7D                  A     1303 	LD		A,L						; fetch low byte of address and mask.
00000418 E6 1F               A     1304 	AND		01Fh						; a zero result indicates a line skip.
0000041A 20 FA               A     1305 	JR		NZ,L0416				; loop until a new line of 32 columns
                             A     1306 					; is started.
                             A     1307 
                             A     1308 ; both paths converge.
                             A     1309 
0000041C 22 1C 00            A     1310 L041C:  LD		(SCRPOS),HL				; update SCRPOS
                             A     1311 
0000041F D9                  A     1312 	EXX								; back to main set.
                             A     1313 
00000420 C9                  A     1314 	RET								; return.
                             A     1315 
                             A     1316 ; -------------------------------------
                             A     1317 ; The 'UPPER DISPLAY SCROLLING' ROUTINE
                             A     1318 ; -------------------------------------
                             A     1319 
00000421 F5                  A     1320 L0421:  PUSH	AF						; save character
                             A     1321 
00000422 21 1C 00            A     1322 	LD		HL,SCRPOS				; address the low order byte SCRPOS
                             A     1323 
00000425 CD 43 04            A     1324 	CALL	L0443					; routine cursor up
                             A     1325 					; i.e. SCRPOS = SCRPOS - 32
                             A     1326 
00000428 F1                  A     1327 	POP		AF						; restore character
                             A     1328 
                             A     1329 ; now calculate the number of characters to scroll in the upper display.
                             A     1330 
00000429 2A 24 00            A     1331 	LD		HL,(L_HALF)				; fetch L_HALF the start of input buffer
0000042C 11 20 24            A     1332 	LD		DE,02420h				; second line in video display
                             A     1333 
                             A     1334 ;
                             A     1335 ; => scroll lower display enters here
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   29


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000042F A7                  A     1336 L042F:  AND		A						; prepare for true subtraction.
00000430 ED 52               A     1337 	SBC		HL,DE					; find number of characters to scroll.
                             A     1338 
00000432 44                  A     1339 	LD		B,H						; result to BC
00000433 4D                  A     1340 	LD		C,L
                             A     1341 
00000434 21 E0 FF            A     1342 	LD		HL,0FFE0h				; set HL to -32d
00000437 19                  A     1343 	ADD		HL,DE					; now HL = DE -32d
00000438 EB                  A     1344 	EX		DE,HL					; switch so DE = HL - 32
                             A     1345 
00000439 ED B0               A     1346 	LDIR							; scroll the lines up.
                             A     1347 
0000043B 06 20               A     1348 	LD		B,020h					; blank a line of 32 characters
                             A     1349 
0000043D 2B                  A     1350 L043D:  DEC		HL						; decrement screen address.
0000043E 36 20               A     1351 	LD		(HL),020h				; insert a space character
00000440 10 FB               A     1352 	DJNZ	L043D					; and loop for all 32 characters
                             A     1353 
00000442 C9                  A     1354 	RET								; return.
                             A     1355 
                             A     1356 ; --------------------------------
                             A     1357 ; THE 'SCREEN POINTERS' SUBROUTINE
                             A     1358 ; --------------------------------
                             A     1359 ;
                             A     1360 
00000443 7E                  A     1361 L0443:  LD		A,(HL)					; fetch low byte of screen address
00000444 D6 20               A     1362 	SUB		020h						; subtract thirty two characters.
00000446 77                  A     1363 	LD		(HL),A					; and put back.
                             A     1364 
00000447 23                  A     1365 	INC		HL						; address high-order byte.
00000448 30 01               A     1366 	JR		NC,L044B				; forward if low byte did not wrap
                             A     1367 
0000044A 35                  A     1368 	DEC		(HL)					; else decrement the high byte as the
                             A     1369 					; position has moved across a third of
                             A     1370 					; the display.
                             A     1371 
0000044B 23                  A     1372 L044B:  INC		HL						; address following System Variable
0000044C C9                  A     1373 	RET								; return.
                             A     1374 
                             A     1375 ; -----------------------------------
                             A     1376 ; THE 'INDEX SYSTEM VARIABLE' ROUTINE
                             A     1377 ; -----------------------------------
                             A     1378 ; This routine is used by words CONTEXT, CURRENT, BASE etc. to index and then
                             A     1379 ; stack a system variable associated with a FORTH word. See shortly.
                             A     1380 ;
                             A     1381 ; It is a bit overblown considering the eventual position of the System
                             A     1382 ; Variables and ld d,03ch; rst 10h; jp (iy) could have been used instead of
                             A     1383 ; the long-winded addition below.
                             A     1384 
0000044D EB                  A     1385 L044D:  EX		DE,HL					; HL addresses the offset byte.
0000044E 5E                  A     1386 	LD		E,(HL)					; fetch to E register
                             A     1387 ;
0000044F 16 00               A     1388 	LD		D,000h					; prepare to add.
00000451 21 00 00            A     1389 	LD		HL,RAMSTART				; the address of start of SYSVARS
00000454 19                  A     1390 	ADD		HL,DE					; add the 8-bit offset
00000455 EB                  A     1391 	EX		DE,HL					; location to DE.
00000456 D7                  A     1392 	RST		10H						; push word DE
                             A     1393 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   30


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000457 FD E9               A     1394 	JP		(IY)					; to 'next'.
                             A     1395 
                             A     1396 ; ---------------
                             A     1397 ; THE 'HERE' WORD
                             A     1398 ; ---------------
                             A     1399 ; ( -- address)
                             A     1400 ; Leaves the address of one past the end of the dictionary.
                             A     1401 
                             A     1402 L0459:  DEFM	"HER"					; 'name field'
00000459 48 45 52            A+    1402 	DB P1
                             A     1403 	DEFB	'E'+080h
0000045C C5                  A+    1403 	DB P1
                             A     1404 
                             A     1405 	DEFW	L00AA					; 'link field'
0000045D AA 00               A+    1405 	DW P1
                             A     1406 
                             A     1407 L045F:  DEFB	004h						; 'name length field'
0000045F 04                  A+    1407 	DB P1
                             A     1408 
                             A     1409 L0460:  DEFW	L0462					; 'code field'
00000460 62 04               A+    1409 	DW P1
                             A     1410 
                             A     1411 ; ---
                             A     1412 
00000462 ED 5B 37 00         A     1413 L0462:  LD		DE,(STKBOT)				; system variable STKBOT.
00000466 D7                  A     1414 	RST		10H						; push word DE
                             A     1415 
00000467 FD E9               A     1416 	JP		(IY)					; to 'next'.
                             A     1417 
                             A     1418 ; ------------------
                             A     1419 ; THE 'CONTEXT' WORD
                             A     1420 ; ------------------
                             A     1421 ; (  -- 15411 )
                             A     1422 ; A system variable pointing to the context vocabulary.
                             A     1423 ; CONTEXT CONTEXT
                             A     1424 
                             A     1425 L0469:  DEFM	"CONTEX"				; 'name field'
00000469 43 4F 4E 54 45 58   A+    1425 	DB P1
                             A     1426 	DEFB	'T'+080h
0000046F D4                  A+    1426 	DB P1
                             A     1427 
                             A     1428 	DEFW	L045F					; 'link field'
00000470 5F 04               A+    1428 	DW P1
                             A     1429 
                             A     1430 L0472:  DEFB	007h						; 'name length field'
00000472 07                  A+    1430 	DB P1
                             A     1431 
                             A     1432 L0473:  DEFW	L044D					; 'code field'
00000473 4D 04               A+    1432 	DW P1
                             A     1433 
                             A     1434 ; ---
                             A     1435 
                             A     1436 L0475:  DEFB	033h						; low byte of system variable.
00000475 33                  A+    1436 	DB P1
                             A     1437 
                             A     1438 ; ------------------
                             A     1439 ; THE 'CURRENT' WORD
                             A     1440 ; ------------------
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   31


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1441 ; (  -- 15409 )
                             A     1442 ; A system variable pointing to the current vocabulary.
                             A     1443 ; CURRENT CURRENT
                             A     1444 
                             A     1445 L0476:  DEFM	"CURREN"				; 'name field'
00000476 43 55 52 52 45 4E   A+    1445 	DB P1
                             A     1446 	DEFB	'T'+080h
0000047C D4                  A+    1446 	DB P1
                             A     1447 
                             A     1448 	DEFW	L0472					; 'link field'
0000047D 72 04               A+    1448 	DW P1
                             A     1449 
                             A     1450 L047F:  DEFB	007h						; 'name length field'
0000047F 07                  A+    1450 	DB P1
                             A     1451 
                             A     1452 L0480:  DEFW	L044D					; 'code field'
00000480 4D 04               A+    1452 	DW P1
                             A     1453 
                             A     1454 ; ---
                             A     1455 
                             A     1456 L0482:  DEFB	031h						; a single parameter low-byte of CURRENT.
00000482 31                  A+    1456 	DB P1
                             A     1457 
                             A     1458 ; ---------------
                             A     1459 ; THE 'BASE' WORD
                             A     1460 ; ---------------
                             A     1461 ; ( -- 15423)
                             A     1462 ; A one-byte variable containing the system number base.
                             A     1463 ; RAMSTART+03Fh BASE
                             A     1464 
                             A     1465 L0483:  DEFM	"BAS"					; 'name field'
00000483 42 41 53            A+    1465 	DB P1
                             A     1466 	DEFB	'E'+080h
00000486 C5                  A+    1466 	DB P1
                             A     1467 
                             A     1468 	DEFW	L047F					; 'link field'
00000487 7F 04               A+    1468 	DW P1
                             A     1469 
                             A     1470 L0489:  DEFB	004h						; 'name length field'
00000489 04                  A+    1470 	DB P1
                             A     1471 
                             A     1472 L048A:  DEFW	L044D					; 'code field'
0000048A 4D 04               A+    1472 	DW P1
                             A     1473 
                             A     1474 ; ---
                             A     1475 
                             A     1476 L048C:  DEFB	03Fh						; low-byte of system variable BASE
0000048C 3F                  A+    1476 	DB P1
                             A     1477 
                             A     1478 ; ---
                             A     1479 
                             A     1480 ; These two Internal Words are used to stack the value of FLAGS and DICT.
                             A     1481 
                             A     1482 ; -------------------------
                             A     1483 ; The 'flags' Internal Word
                             A     1484 ; -------------------------
                             A     1485 
                             A     1486 L048D:  DEFW	L044D					; headerless 'code field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   32


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000048D 4D 04               A+    1486 	DW P1
                             A     1487 
                             A     1488 ; ---
                             A     1489 
                             A     1490 L048F:  DEFB	03Eh						; low-order byte of FLAGS FLAGS
0000048F 3E                  A+    1490 	DB P1
                             A     1491 
                             A     1492 ; -------------------------
                             A     1493 ; The 'dict' Internal Word
                             A     1494 ; -------------------------
                             A     1495 
                             A     1496 L0490:  DEFW	L044D					; headerless 'code field'
00000490 4D 04               A+    1496 	DW P1
                             A     1497 
                             A     1498 ; ---
                             A     1499 
                             A     1500 L0492:  DEFB	039h						; low-order byte of DICT DICT
00000492 39                  A+    1500 	DB P1
                             A     1501 
                             A     1502 
                             A     1503 ; --------------
                             A     1504 ; THE 'PAD' WORD
                             A     1505 ; --------------
                             A     1506 ; (  -- 9985 )
                             A     1507 ; Stacks the address of the 254-byte workpad.
                             A     1508 ; On most FORTH systems the PAD floats about in memory but on the Ace it is
                             A     1509 ; fixed in location and size. Its definition is simply a constant.
                             A     1510 
                             A     1511 L0493:  DEFM	"PA"			; 'name field'
00000493 50 41               A+    1511 	DB P1
                             A     1512 	DEFB	'D'+080h
00000495 C4                  A+    1512 	DB P1
                             A     1513 
                             A     1514 	DEFW	L0489					; 'link field'
00000496 89 04               A+    1514 	DW P1
                             A     1515 
                             A     1516 L0498:  DEFB	003h						; 'name length field'
00000498 03                  A+    1516 	DB P1
                             A     1517 
                             A     1518 L0499:  DEFW	L0FF5					; 'code field' - stack word
00000499 F4 0F               A+    1518 	DW P1
                             A     1519 
                             A     1520 ; ---
                             A     1521 
                             A     1522 L049B:  DEFW	02701h					; parameter is 9985 decimal -
0000049B 01 27               A+    1522 	DW P1
                             A     1523 					; work pad address
                             A     1524 
                             A     1525 ; ------------
                             A     1526 ; THE ';' WORD
                             A     1527 ; ------------
                             A     1528 ; Terminates colon, DEFINER and COMPILER definitions.
                             A     1529 
                             A     1530 L049D:  DEFB	';'+080h				; 'name field'
0000049D BB                  A+    1530 	DB P1
                             A     1531 
                             A     1532 	DEFW	L0498					; 'link field'
0000049E 98 04               A+    1532 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   33


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1533 
                             A     1534 L04A0:  DEFB	041h						; length 1+040h (immediate word)
000004A0 41                  A+    1534 	DB P1
                             A     1535 
                             A     1536 L04A1:  DEFW	L1108					; 'code field' - compile
000004A1 07 11               A+    1536 	DW P1
                             A     1537 
                             A     1538 ; ---
                             A     1539 
                             A     1540 L04A3:  DEFW	L04B6					; exit
000004A3 B6 04               A+    1540 	DW P1
                             A     1541 
                             A     1542 L04A5:  DEFW	L12D8					; check-for
000004A5 D7 12               A+    1542 	DW P1
                             A     1543 	DEFB	00Ah						; ten					marker byte?
000004A7 0A                  A+    1543 	DB P1
                             A     1544 	DEFW	L1A0E					; end-forth.
000004A8 0D 1A               A+    1544 	DW P1
                             A     1545 
                             A     1546 ; code gels
                             A     1547 
000004AA 21 3E 00            A     1548 L04AA:  LD		HL,FLAGS				; address FLAGS
000004AD 7E                  A     1549 	LD		A,(HL)					; fetch FLAGS value.
                             A     1550 
000004AE E6 BB               A     1551 	AND		0BBh						; AND %10111011
                             A     1552 					; reset bit 2 - show definition complete
                             A     1553 					; reset bit 6 - show in interpreter mode
                             A     1554 
000004B0 77                  A     1555 	LD		(HL),A					; update FLAGS value.
                             A     1556 
000004B1 FD E9               A     1557 	JP		(IY)					; to 'next'.
                             A     1558 
                             A     1559 ; ----
                             A     1560 ; Note. these backward links to the beginning of words will probably be less
                             A     1561 ; of a mystery when the syntax checking and listing modules are more fully
                             A     1562 ; explored. A value of 0FFFFh sometimes occurs.
                             A     1563 
                             A     1564 x04b3:   DEFB	000h						;;
000004B3 00                  A+    1564 	DB P1
                             A     1565 
                             A     1566 x04b4:   DEFB	0E8h						;;
000004B4 E8                  A+    1566 	DB P1
                             A     1567 x04b5:   DEFB	0FFh						;; 04b5 + ffe8 = 049d  = ';'
000004B5 FF                  A+    1567 	DB P1
                             A     1568 
                             A     1569 ; ----------------------------------
                             A     1570 ; THE 'ADDRESS' INTERPRETER ROUTINES
                             A     1571 ; ----------------------------------
                             A     1572 
                             A     1573 ; ------------------------
                             A     1574 ; The 'Exit' Internal Word
                             A     1575 ; ------------------------
                             A     1576 ; Drops the 'Next Word' pointer from the Return Stack thereby ending a 
                             A     1577 ; subroutine and returning to next word in calling thread.
                             A     1578 
                             A     1579 L04B6:  DEFW	L04B8					; headerless 'code field'
000004B6 B8 04               A+    1579 	DW P1
                             A     1580 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   34


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1581 ; ---
                             A     1582 
000004B8 E1                  A     1583 L04B8:  POP		HL						; discard the next word pointer.
                             A     1584 
                             A     1585 ; ------------------------------
                             A     1586 ; THE 'ADDRESS INTERPRETER' LOOP
                             A     1587 ; ------------------------------
                             A     1588 ; Sometimes known as the Sequencer.
                             A     1589 ;
                             A     1590 ; iy_fast
                             A     1591 
000004B9 E1                  A     1592 L04B9:  POP		HL						; word pointer.
                             A     1593 
                             A     1594 ; =====> from DOCOLON and BRANCH
                             A     1595 
000004BA 5E                  A     1596 L04BA:  LD		E,(HL)
000004BB 23                  A     1597 	INC		HL
000004BC 56                  A     1598 	LD		D,(HL)
000004BD 23                  A     1599 	INC		HL
                             A     1600 
000004BE E5                  A     1601 	PUSH	HL						; word pointer.
                             A     1602 
                             A     1603 ; ==>
                             A     1604 ;
000004BF EB                  A     1605 L04BF:  EX		DE,HL
000004C0 5E                  A     1606 	LD		E,(HL)
000004C1 23                  A     1607 	INC		HL
000004C2 56                  A     1608 	LD		D,(HL)
000004C3 23                  A     1609 	INC		HL
000004C4 EB                  A     1610 	EX		DE,HL
                             A     1611 
000004C5 E9                  A     1612 	JP		(HL)					; jump to machine code (4 clock cycles)
                             A     1613 					; which will terminate with a JP (IY)
                             A     1614 					; instruction (8 clock cycles).
                             A     1615 
                             A     1616 
                             A     1617 
                             A     1618 ; --------------------------------
                             A     1619 ; The 'Memory Check' Internal Word
                             A     1620 ; --------------------------------
                             A     1621 ; This internal word which also checks the BREAK key is only used from the 
                             A     1622 ; start of the LINE definition. However the machine code entry point is the 
                             A     1623 ; normal value of the IY register and so this code is executed at the end of
                             A     1624 ; every word. 
                             A     1625 
                             A     1626 L04C6:  DEFW	L04C8					; headerless 'code field'
000004C6 C8 04               A+    1626 	DW P1
                             A     1627 
                             A     1628 ; iy_slow
                             A     1629 
000004C8 01 0B 00            A     1630 L04C8:  LD		BC,0000Bh				; allow overhead of eleven bytes
000004CB ED 5B 3B 00         A     1631 	LD		DE,(SPARE)				; SPARE
000004CF 2A 37 00            A     1632 	LD		HL,(STKBOT)				; STKBOT
000004D2 09                  A     1633 	ADD		HL,BC					; add the overhead
000004D3 ED 52               A     1634 	SBC		HL,DE					; subtract the SPARE value
000004D5 38 02               A     1635 	JR		C,L04D9					; forward if the original 12 byte gap
                             A     1636 					; remains.
                             A     1637 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   35


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1638 ; else stack underflow has occurred.
                             A     1639 
000004D7 E7                  A     1640 L04D7:  RST		20H						; Error 2
                             A     1641 	DEFB	002h						; Data stack underflow.
000004D8 02                  A+    1641 	DB P1
                             A     1642 
                             A     1643 ; ---
                             A     1644 
000004D9 01 00 00            A     1645 L04D9:  LD		BC,00000h				; allow no overhead.
                             A     1646 
000004DC CD 8B 0F            A     1647 	CALL	L0F8C					; check free memory
000004DF CD E4 04            A     1648 	CALL	L04E4					; check BREAK key.
000004E2 18 D5               A     1649 	JR		L04B9					; back to iy_fast
                             A     1650 
                             A     1651 ; ------------------------------------
                             A     1652 ; THE 'CHECK FOR BREAK KEY' SUBROUTINE
                             A     1653 ; ------------------------------------
                             A     1654 ; Check for the key combination SHIFT/SPACE.
                             A     1655 
000004E4 3E FE               A     1656 L04E4:  LD		A,0FEh					; read port 0FEFEh -
000004E6 DB FE               A     1657 	IN		A,(0FEh)					; keys SPACE, SYMSHIFT, M, N, B.
                             A     1658 
000004E8 1F                  A     1659 	RRA								; test bit for outermost key
000004E9 D8                  A     1660 	RET		C						; return if not pressed.
                             A     1661 
000004EA 3E 7F               A     1662 	LD		A,07Fh					; read port 07FFEh -
000004EC DB FE               A     1663 	IN		A,(0FEh)					; keys SHIFT, Z, X, C, V.
                             A     1664 
000004EE 1F                  A     1665 	RRA								; test bit for outermost key
000004EF D8                  A     1666 	RET		C						; return if not pressed.
                             A     1667 
000004F0 E7                  A     1668 L04F0:  RST		20H						; Error 3.
                             A     1669 	DEFB	003h						; BREAK pressed.
000004F1 03                  A+    1669 	DB P1
                             A     1670 
                             A     1671 ; -------------------------
                             A     1672 ; THE 'MAIN EXECUTION' LOOP
                             A     1673 ; -------------------------
                             A     1674 ; The final part of the QUIT definition, as in all FORTH implementations,
                             A     1675 ; just loops through two FORTH words.
                             A     1676 
                             A     1677 ; The first call - to the Address Interpreter - does not return.
                             A     1678 ; The return address is the next word QUERY which the interpreter pops off
                             A     1679 ; the Return Stack and then before executing puts the address of the next word
                             A     1680 ; on Return Stack. The default action of the Address Interpreter is to execute
                             A     1681 ; words in turn until some word, such as branch, alters this default behaviour.
                             A     1682 
000004F2 CD B9 04            A     1683 L04F2:  CALL	L04B9					; forth.
                             A     1684 
                             A     1685 L04F5:  DEFW	L058C					; QUERY			- input buffer
000004F5 8C 05               A+    1685 	DW P1
                             A     1686 	DEFW	L0506					; LINE			- interpret buffer
000004F7 06 05               A+    1686 	DW P1
                             A     1687 	DEFW	L0536					; prOK			- print OK
000004F9 36 05               A+    1687 	DW P1
                             A     1688 	DEFW	L1276					; branch		- relative jump
000004FB 75 12               A+    1688 	DW P1
                             A     1689 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   36


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1690 L04FD:  DEFW	0FFF7h					; back to L04F5
000004FD F7 FF               A+    1690 	DW P1
                             A     1691 
                             A     1692 ; ---
                             A     1693 ; the first high-level interpreted word.
                             A     1694 ; ---
                             A     1695 
                             A     1696 ; ---------------
                             A     1697 ; THE 'LINE' WORD
                             A     1698 ; ---------------
                             A     1699 ; Interprets input buffer as a normal FORTH line.
                             A     1700 
                             A     1701 L04FF:  DEFM	"LIN"					; 'name field'
000004FF 4C 49 4E            A+    1701 	DB P1
                             A     1702 	DEFB	'E'+080h
00000502 C5                  A+    1702 	DB P1
                             A     1703 
                             A     1704 	DEFW	L04A0					; 'link field'
00000503 A0 04               A+    1704 	DW P1
                             A     1705 
                             A     1706 L0505:  DEFB	004h						; 'name length field'
00000505 04                  A+    1706 	DB P1
                             A     1707 
                             A     1708 L0506:  DEFW	L0EC3					; 'code field' - docolon
00000506 C2 0E               A+    1708 	DW P1
                             A     1709 
                             A     1710 ; ---
                             A     1711 
                             A     1712 L0508:  DEFW	L04C6					; check mem each time through loop
00000508 C6 04               A+    1712 	DW P1
                             A     1713 					; as dictionary could be expanding.
                             A     1714 
                             A     1715 	DEFW	L063D					; FIND			- search the dictionary
0000050A 3D 06               A+    1715 	DW P1
                             A     1716 	DEFW	L08EE					; ?DUP			- duplicate if found
0000050C ED 08               A+    1716 	DW P1
                             A     1717 	DEFW	L1283					; ?branch		- forward if not a 
0000050E 82 12               A+    1717 	DW P1
                             A     1718 L0510:  DEFW	00007h					; to L0518		- word.
00000510 07 00               A+    1718 	DW P1
                             A     1719 
                             A     1720 	DEFW	L054F					; test and stack??
00000512 4F 05               A+    1720 	DW P1
                             A     1721 	DEFW	L1276					; branch
00000514 75 12               A+    1721 	DW P1
                             A     1722 L0516:  DEFW	0FFF1h					; back to L0508
00000516 F1 FF               A+    1722 	DW P1
                             A     1723 
                             A     1724 L0518:  DEFW	L06A9					; NUMBER
00000518 A9 06               A+    1724 	DW P1
                             A     1725 	DEFW	L08EE					; ?DUP
0000051A ED 08               A+    1725 	DW P1
                             A     1726 	DEFW	L1283					; ?branch		- forward if not a
0000051C 82 12               A+    1726 	DW P1
                             A     1727 L051E:  DEFW	00007h					; to L0526		- number.
0000051E 07 00               A+    1727 	DW P1
                             A     1728 
                             A     1729 	DEFW	L0564					; pop de with test
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   37


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000520 64 05               A+    1729 	DW P1
                             A     1730 	DEFW	L1276					; branch
00000522 75 12               A+    1730 	DW P1
                             A     1731 L0524:  DEFW	0FFE3h					; loop back to L0508
00000524 E3 FF               A+    1731 	DW P1
                             A     1732 
                             A     1733 L0526:  DEFW	L061B					; stack-length
00000526 1B 06               A+    1733 	DW P1
                             A     1734 	DEFW	L0C1A					; 0=
00000528 19 0C               A+    1734 	DW P1
                             A     1735 	DEFW	L1283					; ?branch		- forward with anything 
0000052A 82 12               A+    1735 	DW P1
                             A     1736 L052C:  DEFW	00003h					; to L0530		- else
0000052C 03 00               A+    1736 	DW P1
                             A     1737 
                             A     1738 L052E:  DEFW	L04B6					; EXIT							>>>
0000052E B6 04               A+    1738 	DW P1
                             A     1739 
                             A     1740 ; ---
                             A     1741 
                             A     1742 L0530:  DEFW	L0578					; RETYPE		- [?] at relevant place
00000530 78 05               A+    1742 	DW P1
                             A     1743 	DEFW	L1276					; branch		- once corrected back
00000532 75 12               A+    1743 	DW P1
                             A     1744 L0534:  DEFW	0FFD3h					; to L0508		- to the loop.
00000534 D3 FF               A+    1744 	DW P1
                             A     1745 
                             A     1746 ; ----------------------------
                             A     1747 ; The 'Print OK' Internal Word
                             A     1748 ; ----------------------------
                             A     1749 ; prints the OK message after successful execution.
                             A     1750 
                             A     1751 L0536:  DEFW	L0538					; headerless 'code field'
00000536 38 05               A+    1751 	DW P1
                             A     1752 
00000538 3A 3E 00            A     1753 L0538:  LD		A,(FLAGS)				; fetch system variable FLAGS
                             A     1754 
0000053B CB 77               A     1755 	BIT		6,A						; test for 'COMPILER' mode.
0000053D 20 0E               A     1756 	JR		NZ,L054D				; forward if so.
                             A     1757 
0000053F CB 67               A     1758 	BIT		4,A						; test for 'INVIS' mode.
00000541 20 0A               A     1759 	JR		NZ,L054D				; forward if so.
                             A     1760 
00000543 CD 07 18            A     1761 	CALL	L1808					; else print the inline string.
                             A     1762 
                             A     1763 ; ---
                             A     1764 
                             A     1765 	DEFM	" OK"					; the OK message between two spaces.
00000546 20 4F 4B            A+    1765 	DB P1
                             A     1766 	DEFB	" "+080h				; last one inverted.
00000549 A0                  A+    1766 	DB P1
                             A     1767 
                             A     1768 ; ---
                             A     1769 
0000054A 3E 0D               A     1770 L054A:  LD		A,00Dh					; prepare a carriage return.
0000054C CF                  A     1771 	RST		08H						; and PRINT also.
                             A     1772 
0000054D FD E9               A     1773 L054D:  JP		(IY)					; to 'next'.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   38


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1774 
                             A     1775 ; ------------------------------
                             A     1776 ; The 'XXXXXXXXXX' Internal Word
                             A     1777 ; ------------------------------
                             A     1778 ; to handle a Word from LINE
                             A     1779 
                             A     1780 L054F:  DEFW	L0551					; headerless 'code field'
0000054F 51 05               A+    1780 	DW P1
                             A     1781 
                             A     1782 ; ---
                             A     1783 
00000551 DF                  A     1784 L0551:  RST		18H						; pop address from Data Stack to DE
                             A     1785 
00000552 1B                  A     1786 	DEC		DE						; point to the 'name length field'
                             A     1787 
00000553 1A                  A     1788 	LD		A,(DE)					; fetch contents of the address.
                             A     1789 
00000554 2F                  A     1790 	CPL								; complement.
                             A     1791 
00000555 DD A6 3E            A     1792 	AND		(IX+03Eh)				; FLAGS
                             A     1793 
00000558 E6 40               A     1794 	AND		040h						; isolate BIT 6 of FLAGS, set if in 
                             A     1795 					; compiler mode.
                             A     1796 
0000055A 13                  A     1797 	INC		DE						; increment address to 'code field'
                             A     1798 
0000055B 28 04               A     1799 	JR		Z,L0561					; forward if not in compiling mode
                             A     1800 
0000055D D7                  A     1801 	RST		10H						; push word DE			- add to dict
0000055E 11 4D 0F            A     1802 	LD		DE,L0F4E				; ','					- enclose 
                             A     1803 
00000561 C3 BF 04            A     1804 L0561:  JP		L04BF					; next word.
                             A     1805 
                             A     1806 ; -----------------------
                             A     1807 ; The '???' Internal Word
                             A     1808 ; -----------------------
                             A     1809 ; after handling a number from LINE
                             A     1810 
                             A     1811 L0564:  DEFW	L0566					; headerless 'code field'
00000564 66 05               A+    1811 	DW P1
                             A     1812 
                             A     1813 ; ---
                             A     1814 
00000566 DF                  A     1815 L0566:  RST		18H						; pop word DE
                             A     1816 
00000567 DD CB 3E 76         A     1817 	BIT		6,(IX+03Eh)				; test FLAGS - compiler mode ?
                             A     1818 
0000056B 20 F4               A     1819 	JR		NZ,L0561				; loop back while in compiler mode.
                             A     1820 
0000056D FD E9               A     1821 	JP		(IY)					; to 'next'.
                             A     1822 
                             A     1823 ; -----------------
                             A     1824 ; THE 'RETYPE' WORD
                             A     1825 ; -----------------
                             A     1826 ; Allows user to edit the input line. Turns cursor to [?].
                             A     1827 
                             A     1828 L056F:  DEFM	"RETYP"					; 'name field'
0000056F 52 45 54 59 50      A+    1828 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   39


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     1829 	DEFB	'E'+080h
00000574 C5                  A+    1829 	DB P1
                             A     1830 
                             A     1831 	DEFW	L058B					; 'link field'
00000575 8B 05               A+    1831 	DW P1
                             A     1832 
                             A     1833 L0577:  DEFB	006h						; 'name length field'
00000577 06                  A+    1833 	DB P1
                             A     1834 
                             A     1835 L0578:  DEFW	L057A					; 'code field'
00000578 7A 05               A+    1835 	DW P1
                             A     1836 
                             A     1837 ; ---
                             A     1838 
0000057A CD EA 02            A     1839 L057A:  CALL	L02EA					; routine sets logical line.
                             A     1840 
0000057D CD 76 02            A     1841 	CALL	L0276					; routine pr_cursor
                             A     1842 
00000580 36 BF               A     1843 	LD		(HL),0BFh				; the inverse [?] character
                             A     1844 
00000582 18 10               A     1845 	JR		L0594					; forward to join the QUERY routine.
                             A     1846 
                             A     1847 ; ----------------
                             A     1848 ; THE 'QUERY' WORD
                             A     1849 ; ----------------
                             A     1850 ; Clears input buffer, then accepts characters until ENTER pressed.
                             A     1851 ; Buffer can be edited as usual and is limited to 22 lines.
                             A     1852 
                             A     1853 L0584:  DEFM	"QUER"					; 'name field'
00000584 51 55 45 52         A+    1853 	DB P1
                             A     1854 	DEFB	'Y'+080h
00000588 D9                  A+    1854 	DB P1
                             A     1855 
                             A     1856 	DEFW	L0505					; 'link field'
00000589 05 05               A+    1856 	DW P1
                             A     1857 
                             A     1858 L058B:  DEFB	005h						; 'name length field'
0000058B 05                  A+    1858 	DB P1
                             A     1859 
                             A     1860 L058C:  DEFW	L058E					; 'code field'
0000058C 8E 05               A+    1860 	DW P1
                             A     1861 
                             A     1862 ; ---
                             A     1863 
0000058E CD D8 02            A     1864 L058E:  CALL	L02D8					; routine SETBUF
                             A     1865 
00000591 CD 76 02            A     1866 	CALL	L0276					; routine pr_cursor
                             A     1867 
                             A     1868 ; ->
00000594 21 28 00            A     1869 L0594:  LD		HL,STATIN				; fetch STATIN
00000597 CB C6               A     1870 	SET		0,(HL)					;
00000599 CB AE               A     1871 	RES		5,(HL)					; (bit 5 set by interrupt when the user
                             A     1872 					; presses the ENTER key)
                             A     1873 
0000059B CB 6E               A     1874 L059B:  BIT		5,(HL)					; wait for interrupt to set the bit.
0000059D 28 FC               A     1875 	JR		Z,L059B					; loop until.
                             A     1876 
0000059F CD 25 02            A     1877 	CALL	L0225					; routine DEL-CURSOR
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   40


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000005A2 FD E9               A     1878 	JP		(IY)					; to 'next'.
                             A     1879 
                             A     1880 ; ---------------
                             A     1881 ; THE 'WORD' WORD
                             A     1882 ; ---------------
                             A     1883 ; WORD text
                             A     1884 ; ( delimiter -- address )
                             A     1885 ; Takes text out of the input buffer up as far as a delimiter, and copies it
                             A     1886 ; to pad, starting at the second byte there. Puts the length (not including
                             A     1887 ; the delimiter) in the first byte of the pad, and stacks the address of the
                             A     1888 ; first byte of the pad.
                             A     1889 ; At most 253 characters are taken from the input buffer. If there are more
                             A     1890 ; left before the delimiter, then the first byte of the pad shows 254.
                             A     1891 ; Initial delimiters are ignored.
                             A     1892 
                             A     1893 L05A4:  DEFM	"WOR"					; 'name field'
000005A4 57 4F 52            A+    1893 	DB P1
                             A     1894 	DEFB	'D'+080h
000005A7 C4                  A+    1894 	DB P1
                             A     1895 
                             A     1896 	DEFW	L0577					; 'link field'
000005A8 77 05               A+    1896 	DW P1
                             A     1897 
                             A     1898 L05AA:  DEFB	004h						; 'name length field'
000005AA 04                  A+    1898 	DB P1
                             A     1899 
                             A     1900 L05AB:  DEFW	L05AD					; 'code field'
000005AB AD 05               A+    1900 	DW P1
                             A     1901 
                             A     1902 ; ---
                             A     1903 
000005AD DF                  A     1904 L05AD:  RST		18H						; pop word DE
000005AE 21 FE 27            A     1905 	LD		HL,027FEh				; set HL to penultimate byte of 'pad'.
000005B1 06 FD               A     1906 	LD		B,0FDh					; the count is 253.
                             A     1907 
000005B3 36 20               A     1908 L05B3:  LD		(HL),020h				; insert a space in pad.
000005B5 2B                  A     1909 	DEC		HL						; decrement the address.
000005B6 10 FB               A     1910 	DJNZ	L05B3					; repeat for the 253 locations.
                             A     1911 
000005B8 D5                  A     1912 	PUSH	DE						; save the delimiter.
000005B9 EB                  A     1913 	EX		DE,HL					; save in HL also, DE is start of pad.
                             A     1914 
000005BA D7                  A     1915 	RST		10H						; stack data word DE
000005BB D1                  A     1916 	POP		DE						; retrieve the delimiter.
                             A     1917 
000005BC CD E1 05            A     1918 	CALL	L05E1					;
                             A     1919 
000005BF 04                  A     1920 	INC		B
000005C0 05                  A     1921 	DEC		B
000005C1 28 03               A     1922 	JR		Z,L05C6					;
                             A     1923 
000005C3 01 FF 00            A     1924 	LD		BC,000FFh
                             A     1925 
000005C6 21 01 27            A     1926 L05C6:  LD		HL,02701h
000005C9 71                  A     1927 	LD		(HL),C
000005CA 23                  A     1928 	INC		HL
000005CB 3E FC               A     1929 	LD		A,0FCh
000005CD B9                  A     1930 	CP		C
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   41


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000005CE 30 01               A     1931 	JR		NC,L05D1				;
                             A     1932 
000005D0 4F                  A     1933 	LD		C,A
                             A     1934 
000005D1 0C                  A     1935 L05D1:  INC		C
000005D2 D5                  A     1936 	PUSH	DE
000005D3 C5                  A     1937 	PUSH	BC
000005D4 EB                  A     1938 	EX		DE,HL
000005D5 ED B0               A     1939 	LDIR
000005D7 C1                  A     1940 	POP		BC
000005D8 D1                  A     1941 	POP		DE
000005D9 0D                  A     1942 	DEC		C
000005DA CD DA 07            A     1943 	CALL	L07DA					;
000005DD FD E9               A     1944 	JP		(IY)					; to 'next'.
                             A     1945 
                             A     1946 ; --------------------------------
                             A     1947 ; THE 'GET BUFFER TEXT' SUBROUTINE
                             A     1948 ; --------------------------------
                             A     1949 ; Called from FIND, NUMBER and XXXXX. Word may have leading spaces and is
                             A     1950 ; terminated by a space or newline (zero).
                             A     1951 ; It is also used to find the end of a comment delimited by ')'.
                             A     1952 ;
                             A     1953 ; =>
000005DF 1E 20               A     1954 L05DF:  LD		E,020h					; set a space as the skip character.
                             A     1955 
                             A     1956 ; =>called with E holding delimiter.
                             A     1957 ;
000005E1 2A 24 00            A     1958 L05E1:  LD		HL,(L_HALF)				; fetch L_HALF - start of screen buffer.
000005E4 22 1E 00            A     1959 	LD		(INSCRN),HL				; make INSCRN start of logical line the
                             A     1960 					; same.
                             A     1961 
000005E7 01 00 00            A     1962 	LD		BC,00000h				; initialize letter count to zero.
                             A     1963 
                             A     1964 ; -> loop
000005EA 23                  A     1965 L05EA:  INC		HL						; increment screen address.
000005EB 7E                  A     1966 	LD		A,(HL)					; fetch character to A.
000005EC BB                  A     1967 	CP		E						; compare to character in E.
000005ED 28 FB               A     1968 	JR		Z,L05EA					; loop while character matches.
                             A     1969 
000005EF A7                  A     1970 	AND		A						; test for zero (at 02700h?)
000005F0 28 0E               A     1971 	JR		Z,L0600					; forward if so.
                             A     1972 
                             A     1973 ; a word has been found on the screen line.
                             A     1974 
000005F2 E5                  A     1975 	PUSH	HL						; save pointer to start of word.
                             A     1976 
000005F3 03                  A     1977 L05F3:  INC		BC						; increment the letter count.
000005F4 23                  A     1978 	INC		HL						; increment the screen pointer.
                             A     1979 
000005F5 7E                  A     1980 	LD		A,(HL)					; fetch new character
000005F6 A7                  A     1981 	AND		A						; test for zero.
000005F7 28 03               A     1982 	JR		Z,L05FC					; skip forward as at end of word.
                             A     1983 
000005F9 BB                  A     1984 	CP		E						; compare to the skip character.
000005FA 20 F7               A     1985 	JR		NZ,L05F3				; loop back if still within a word.
                             A     1986 
000005FC D1                  A     1987 L05FC:  POP		DE						; retrieve pointer to start of word.
                             A     1988 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   42


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000005FD AF                  A     1989 	XOR		A						;; clear A
000005FE B8                  A     1990 	CP		B						;; compare to B zero
                             A     1991 
000005FF C9                  A     1992 	RET								; return. with carry reset for success.
                             A     1993 
                             A     1994 ; ---
                             A     1995 
00000600 D5                  A     1996 L0600:  PUSH	DE						; save delimiter
                             A     1997 
00000601 CD B0 02            A     1998 	CALL	L02B0					; routine find zerobyte
00000604 E2 14 06            A     1999 	JP		PO,L0614				; jump if found to exit failure
                             A     2000 
00000607 ED 5B 24 00         A     2001 	LD		DE,(L_HALF)				; else set DE from L_HALF
0000060B CD FA 07            A     2002 	CALL	L07FA					; routine SPACE_FILL (DE-HL)
0000060E 22 24 00            A     2003 	LD		(L_HALF),HL				; set L_HALF to next line
                             A     2004 
00000611 D1                  A     2005 	POP		DE						; restore delimiter
                             A     2006 
00000612 18 CD               A     2007 	JR		L05E1					; loop back using new line.
                             A     2008 
                             A     2009 ; ---
                             A     2010 
                             A     2011 ; branch here if a word not found.
                             A     2012 
00000614 EB                  A     2013 L0614:  EX		DE,HL					; DE addresses cursor.
00000615 C1                  A     2014 	POP		BC						; discard saved delimiter
00000616 01 00 00            A     2015 	LD		BC,00000h				; set BC, to zero
00000619 37                  A     2016 	SCF								; signal not found
0000061A C9                  A     2017 	RET								; return.
                             A     2018 
                             A     2019 ; --------------------------------
                             A     2020 ; The 'stack length' Internal Word
                             A     2021 ; --------------------------------
                             A     2022 ; used once only from LINE to check for any extraneous text that is not a Word
                             A     2023 ; or a Number.
                             A     2024 
                             A     2025 L061B:  DEFW	L061D					; headerless 'code field'
0000061B 1D 06               A+    2025 	DW P1
                             A     2026 
                             A     2027 ; ---
                             A     2028 
0000061D CD DF 05            A     2029 L061D:  CALL	L05DF					; get buffer
                             A     2030 
00000620 50                  A     2031 	LD		D,B						; transfer length of word
00000621 59                  A     2032 	LD		E,C						; from BC to DE
00000622 D7                  A     2033 	RST		10H						; push word DE
00000623 FD E9               A     2034 	JP		(IY)					; to 'next'.
                             A     2035 
                             A     2036 
                             A     2037 ; ----------------
                             A     2038 ; THE 'VLIST' WORD
                             A     2039 ; ----------------
                             A     2040 ; List dictionary to screen, including words in ROM.
                             A     2041 ; (no pause after 18 lines)
                             A     2042 
                             A     2043 L0625:  DEFM	"VLIS"					; 'name field'
00000625 56 4C 49 53         A+    2043 	DB P1
                             A     2044 	DEFB	'T'+080h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   43


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000629 D4                  A+    2044 	DB P1
                             A     2045 
                             A     2046 	DEFW	L05AA					; 'link field'
0000062A AA 05               A+    2046 	DW P1
                             A     2047 
                             A     2048 L062C:  DEFB	005h						; 'name length field'
0000062C 05                  A+    2048 	DB P1
                             A     2049 
                             A     2050 L062D:  DEFW	L062F					; 'code field'
0000062D 2F 06               A+    2050 	DW P1
                             A     2051 
                             A     2052 ; ---
                             A     2053 
0000062F 3E 0D               A     2054 L062F:  LD		A,00Dh					; prepare a newline
                             A     2055 
00000631 CF                  A     2056 	RST		08H						; print it.
                             A     2057 
00000632 0E 00               A     2058 	LD		C,000h					; set a flag for 'do all names'.
                             A     2059 
00000634 18 0E               A     2060 	JR		L0644					; forward to FIND.
                             A     2061 
                             A     2062 
                             A     2063 ; ---------------
                             A     2064 ; THE 'FIND' WORD
                             A     2065 ; ---------------
                             A     2066 ; ( -- compilation address )
                             A     2067 ; Leaves compilation address of first word in input buffer, if defined in
                             A     2068 ; context vocabulary; else 0.
                             A     2069 
                             A     2070 L0636:  DEFM	"FIN"					; 'name field'
00000636 46 49 4E            A+    2070 	DB P1
                             A     2071 	DEFB	'D'+080h
00000639 C4                  A+    2071 	DB P1
                             A     2072 
                             A     2073 	DEFW	L062C					; 'link field'
0000063A 2C 06               A+    2073 	DW P1
                             A     2074 
                             A     2075 L063C:  DEFB	004h						; 'name length field'
0000063C 04                  A+    2075 	DB P1
                             A     2076 
                             A     2077 L063D:  DEFW	L063F					; 'code field'
0000063D 3F 06               A+    2077 	DW P1
                             A     2078 
                             A     2079 ; ---
                             A     2080 
0000063F CD DF 05            A     2081 L063F:  CALL	L05DF					; get buffer word, gets length in C.
                             A     2082 
00000642 38 46               A     2083 	JR		C,L068A					; back if null to stack word zero
                             A     2084 
                             A     2085 ; ->
                             A     2086 
00000644 2A 33 00            A     2087 L0644:  LD		HL,(CONTEXT)				; fetch value of system variable CONTEXT
00000647 7E                  A     2088 	LD		A,(HL)					; extract low byte of address.
00000648 23                  A     2089 	INC		HL						; increment pointer.
00000649 66                  A     2090 	LD		H,(HL)					; extract high byte of address.
0000064A 6F                  A     2091 	LD		L,A						; address now in HL.
                             A     2092 
                             A     2093 ; The address points to the 'name length field' of the most recent word in the
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   44


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2094 ; Dictionary.
                             A     2095 
                             A     2096 
0000064B 7E                  A     2097 L064B:  LD		A,(HL)					; fetch addressed byte.
0000064C E6 3F               A     2098 	AND		03Fh						; discount bit 6, the immediate word
                             A     2099 					; indicator, to give length 1-31
                             A     2100 
0000064E 28 2F               A     2101 	JR		Z,L067F					; a 'zero' length indicates this is a
                             A     2102 					; link like the example at the end of
                             A     2103 					; this ROM.
                             A     2104 
00000650 A9                  A     2105 	XOR		C						; match against C.
00000651 28 04               A     2106 	JR		Z,L0657					; skip forward if lengths match.
                             A     2107 
00000653 79                  A     2108 	LD		A,C						; test flag C
00000654 A7                  A     2109 	AND		A						; for value zero.
00000655 20 28               A     2110 	JR		NZ,L067F				; forward if C not zero.
                             A     2111 
                             A     2112 ; else a name that matches the search length or all names are required - VLIST.
                             A     2113 
                             A     2114 
00000657 D5                  A     2115 L0657:  PUSH	DE						; preserve DE
00000658 E5                  A     2116 	PUSH	HL						; preserve 'name length field' pointer.
                             A     2117 
00000659 CD E7 15            A     2118 	CALL	L15E8					; routine WORDSTART finds start of name.
                             A     2119 					; A is returned as zero.
                             A     2120 
0000065C B1                  A     2121 	OR		C						; test C for zero
0000065D 28 17               A     2122 	JR		Z,L0676					; branch forward to print if in VLIST.
                             A     2123 
                             A     2124 ; else the search is for a specific word and a word with same length, at least,
                             A     2125 ; has been found.
                             A     2126 
0000065F 41                  A     2127 	LD		B,C						; copy the length to counter B.
                             A     2128 
00000660 1A                  A     2129 L0660:  LD		A,(DE)					; fetch first letter of match word.
                             A     2130 
00000661 CD 06 08            A     2131 	CALL	L0807					; routine UPPERCASE
                             A     2132 
00000664 13                  A     2133 	INC		DE						; update pointer (in lower screen)
00000665 AE                  A     2134 	XOR		(HL)					; match against letter (in dictionary).
00000666 E6 7F               A     2135 	AND		07Fh						; disregard any inverted bit.
00000668 23                  A     2136 	INC		HL						; increment dictionary pointer.
                             A     2137 
00000669 20 12               A     2138 	JR		NZ,L067D				; exit loop to try next link if no match
                             A     2139 
0000066B 10 F3               A     2140 	DJNZ	L0660					; else loop back for all letters.
                             A     2141 
                             A     2142 ; Oh Frabjous day - a match.
                             A     2143 
0000066D D1                  A     2144 	POP		DE						; pop 'name length field' pointer.
0000066E 13                  A     2145 	INC		DE						; increment to point to compilation
                             A     2146 					; address.
0000066F D7                  A     2147 	RST		10H						; stack date word DE.
                             A     2148 
                             A     2149 ; the remaining task is to clean up the input buffer in the lower screen.
                             A     2150 
00000670 D1                  A     2151 	POP		DE						; pop the DE - screen pointer.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   45


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2152 
00000671 CD DA 07            A     2153 	CALL	L07DA					; clean up - backfill with spaces.
                             A     2154 
00000674 FD E9               A     2155 	JP		(IY)					; to 'next'.
                             A     2156 
                             A     2157 ; -----------------------
                             A     2158 ; THE 'PRINT NAME' BRANCH
                             A     2159 ; -----------------------
                             A     2160 ; This branch is taken from the above loop when all found words are to be
                             A     2161 ; printed by VLIST. It takes its time as if the user has expanded the
                             A     2162 ; dictionary then the list will scroll off the top of the screen. By waiting
                             A     2163 ; for an interrupt each time, it ensures that a standard listing takes about
                             A     2164 ; three seconds and there is ample opportunity to press BREAK to stop at a
                             A     2165 ; certain point.
                             A     2166 
00000676 CD FA 17            A     2167 L0676:  CALL	L17FB					; routine print string and space
                             A     2168 
00000679 76                  A     2169 	HALT							; wait for an interrupt.
                             A     2170 
0000067A CD E4 04            A     2171 	CALL	L04E4					; routine checks BREAK key.
                             A     2172 
0000067D E1                  A     2173 L067D:  POP		HL						; restore 'name length field' pointer
0000067E D1                  A     2174 	POP		DE						; restore DE
                             A     2175 
0000067F 2B                  A     2176 L067F:  DEC		HL						; point to high byte of 'link field'
00000680 7E                  A     2177 	LD		A,(HL)					; hold it in A.
00000681 2B                  A     2178 	DEC		HL						; point to low byte of 'link field'
00000682 6E                  A     2179 	LD		L,(HL)					; transfer address of the new
00000683 67                  A     2180 	LD		H,A						; 'name length field' to HL pointer.
                             A     2181 
00000684 B5                  A     2182 	OR		L						; test if address is zero - for the
                             A     2183 					; last entry in the linked list.
                             A     2184 
00000685 20 C4               A     2185 	JR		NZ,L064B				; loop back while this is not the
                             A     2186 					; last entry in the vocabulary.
                             A     2187 
                             A     2188 L0687:  DEFB	0C3h						; A JP instruction i.e. JP L068A
00000687 C3                  A+    2188 	DB P1
                             A     2189 
                             A     2190 ; Note. The intention is to jump past the headerless code word for the internal
                             A     2191 ; word stk_zero. Since the word that would follow the first byte of the jump
                             A     2192 ; instruction would be identical to the word it is jumping over then the word
                             A     2193 ; can be omitted. Only saves one byte but this is back in 1983.
                             A     2194 
                             A     2195 ; ----------------------------
                             A     2196 ; The 'stk-zero' Internal Word
                             A     2197 ; ----------------------------
                             A     2198 ; (  -- 0 )
                             A     2199 
                             A     2200 L0688:  DEFW	L068A					; headerless 'code field'
00000688 8A 06               A+    2200 	DW P1
                             A     2201 
                             A     2202 ; ---
                             A     2203 
0000068A 11 00 00            A     2204 L068A:  LD		DE,00000h				; load DE with the value zero.
0000068D D7                  A     2205 	RST		10H						; stack Data Word DE
                             A     2206 
0000068E FD E9               A     2207 	JP		(IY)					; to 'next'.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   46


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2208 
                             A     2209 ; ------------------
                             A     2210 ; THE 'EXECUTE' WORD
                             A     2211 ; ------------------
                             A     2212 ; ( compilation address --  )
                             A     2213 ; Executes the word with the given compilation address.
                             A     2214 
                             A     2215 L0690:  DEFM	"EXECUT"				; 'name field'
00000690 45 58 45 43 55 54   A+    2215 	DB P1
                             A     2216 	DEFB	'E'+080h
00000696 C5                  A+    2216 	DB P1
                             A     2217 
                             A     2218 	DEFW	L063C					; 'link field'
00000697 3C 06               A+    2218 	DW P1
                             A     2219 
                             A     2220 L0699:  DEFB	007h						; 'name length field'
00000699 07                  A+    2220 	DB P1
                             A     2221 
                             A     2222 L069A:  DEFW	L069C					; 'code field'
0000069A 9C 06               A+    2222 	DW P1
                             A     2223 
                             A     2224 ; ---
                             A     2225 
0000069C DF                  A     2226 L069C:  RST		18H
                             A     2227 
0000069D C3 BF 04            A     2228 	JP		L04BF					;
                             A     2229 
                             A     2230 ; -----------------
                             A     2231 ; THE 'NUMBER' WORD
                             A     2232 ; -----------------
                             A     2233 ; Takes a number from the start of the input buffer. Leaves the number and
                             A     2234 ; a non-zero address on the stack. (The address is the compilation address
                             A     2235 ; of a literal compiler, so that if you then say EXECUTE, the literal compiler
                             A     2236 ; compiles the number into the dictionary as a literal - for an integer it
                             A     2237 ; is 4102, for a floating point number it is 4181).
                             A     2238 ; If no valid number then leaves just 0 on the stack.
                             A     2239 
                             A     2240 L06A0:  DEFM	"NUMBE"					; 'name field'
000006A0 4E 55 4D 42 45      A+    2240 	DB P1
                             A     2241 	DEFB	'R'+080h
000006A5 D2                  A+    2241 	DB P1
                             A     2242 
                             A     2243 	DEFW	L0699					; 'link field'
000006A6 99 06               A+    2243 	DW P1
                             A     2244 
                             A     2245 L06A8:  DEFB	006h						; 'name length field'
000006A8 06                  A+    2245 	DB P1
                             A     2246 
                             A     2247 L06A9:  DEFW	L06AB					; 'code field'
000006A9 AB 06               A+    2247 	DW P1
                             A     2248 
                             A     2249 ; ---
                             A     2250 
000006AB CD DF 05            A     2251 L06AB:  CALL	L05DF					; get buffer
                             A     2252 
000006AE 38 DA               A     2253 	JR		C,L068A					; if empty stack word zero.
                             A     2254 
000006B0 C5                  A     2255 	PUSH	BC
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   47


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000006B1 D5                  A     2256 	PUSH	DE
                             A     2257 
000006B2 CD 4C 07            A     2258 	CALL	L074C					;
                             A     2259 
000006B5 20 05               A     2260 	JR		NZ,L06BC				;
                             A     2261 
000006B7 11 06 10            A     2262 	LD		DE,01006h				; addr literal?
000006BA 18 58               A     2263 	JR		L0714					;
                             A     2264 
                             A     2265 ; ---
                             A     2266 
000006BC DF                  A     2267 L06BC:  RST		18H						; pop word DE
000006BD 11 00 00            A     2268 	LD		DE,00000h
000006C0 D7                  A     2269 	RST		10H						; push word DE
000006C1 11 00 45            A     2270 	LD		DE,04500h
000006C4 C1                  A     2271 	POP		BC
000006C5 C5                  A     2272 	PUSH	BC
000006C6 0A                  A     2273 	LD		A,(BC)
000006C7 FE 2D               A     2274 	CP		02Dh						; is it '-' ?
000006C9 20 03               A     2275 	JR		NZ,L06CE				;
                             A     2276 
000006CB 16 C5               A     2277 	LD		D,0C5h
000006CD 03                  A     2278 	INC		BC
000006CE D7                  A     2279 L06CE:  RST		10H						; push word DE
000006CF 50                  A     2280 	LD		D,B
000006D0 59                  A     2281 	LD		E,C
000006D1 2B                  A     2282 	DEC		HL
000006D2 2B                  A     2283 	DEC		HL
                             A     2284 
000006D3 CD 23 07            A     2285 L06D3:  CALL	L0723					; routine GET_DECIMAL
                             A     2286 
000006D6 23                  A     2287 	INC		HL
000006D7 34                  A     2288 	INC		(HL)
000006D8 2B                  A     2289 	DEC		HL
000006D9 30 F8               A     2290 	JR		NC,L06D3				;
                             A     2291 
000006DB FE FE               A     2292 	CP		0FEh
000006DD 20 3D               A     2293 	JR		NZ,L071C				;
                             A     2294 
000006DF CD 23 07            A     2295 L06DF:  CALL	L0723					; routine GET_DECIMAL
                             A     2296 
000006E2 30 FB               A     2297 	JR		NC,L06DF				;
                             A     2298 
000006E4 C6 30               A     2299 	ADD		A,030h					; add '0' converting to letter.
000006E6 CD 7B 07            A     2300 	CALL	L077B					;
000006E9 20 04               A     2301 	JR		NZ,L06EF				;
                             A     2302 
000006EB 1E 00               A     2303 	LD		E,000h
000006ED 18 0E               A     2304 	JR		L06FD					;
                             A     2305 
000006EF E6 DF               A     2306 L06EF:  AND		0DFh						;
                             A     2307 
000006F1 FE 45               A     2308 	CP		045h						; is it 'E' - extended format?
000006F3 20 27               A     2309 	JR		NZ,L071C				;
                             A     2310 
000006F5 E5                  A     2311 	PUSH	HL
                             A     2312 
000006F6 CD 4C 07            A     2313 	CALL	L074C					;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   48


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2314 
000006F9 DF                  A     2315 	RST		18H						; pop word DE
000006FA E1                  A     2316 	POP		HL
000006FB 20 1F               A     2317 	JR		NZ,L071C				;
                             A     2318 
000006FD CD 40 07            A     2319 L06FD:  CALL	L0740					;
00000700 28 0F               A     2320 	JR		Z,L0711					;
                             A     2321 
00000702 23                  A     2322 	INC		HL
00000703 7E                  A     2323 	LD		A,(HL)
00000704 E6 7F               A     2324 	AND		07Fh
00000706 83                  A     2325 	ADD		A,E
                             A     2326 
00000707 FA 1C 07            A     2327 	JP		M,L071C					; forward +->
                             A     2328 
0000070A 28 10               A     2329 	JR		Z,L071C					; forward +->
                             A     2330 
0000070C AE                  A     2331 	XOR		(HL)
0000070D E6 7F               A     2332 	AND		07Fh
0000070F AE                  A     2333 	XOR		(HL)
00000710 77                  A     2334 	LD		(HL),A
00000711 11 54 10            A     2335 L0711:  LD		DE,L1055				; stk_fp
00000714 D7                  A     2336 L0714:  RST		10H						; push word DE
00000715 D1                  A     2337 	POP		DE
00000716 C1                  A     2338 	POP		BC
00000717 CD DA 07            A     2339 	CALL	L07DA					;
0000071A FD E9               A     2340 	JP		(IY)					; to 'next'.
                             A     2341 
                             A     2342 ; ---
                             A     2343 
                             A     2344 ; +->
0000071C E1                  A     2345 L071C:  POP		HL
0000071D E1                  A     2346 	POP		HL
0000071E DF                  A     2347 	RST		18H						; pop word DE
0000071F DF                  A     2348 	RST		18H						; pop word DE
00000720 C3 8A 06            A     2349 	JP		L068A					;
                             A     2350 
                             A     2351 ; ----------------------------
                             A     2352 ; THE 'GET DECIMAL' SUBROUTINE
                             A     2353 ; ----------------------------
                             A     2354 ; Fetch character and return with carry set if after conversion is not in
                             A     2355 ; range 0 to 9.
                             A     2356 
00000723 1A                  A     2357 L0723:  LD		A,(DE)
00000724 13                  A     2358 	INC		DE
00000725 D6 30               A     2359 	SUB		030h						; subtract '0'
00000727 D8                  A     2360 	RET		C						; return if was less than '0'
                             A     2361 
00000728 FE 0A               A     2362 	CP		00Ah						; compare to ten.
0000072A 3F                  A     2363 	CCF								; complement
0000072B D8                  A     2364 	RET		C						; return - with carry set if over 9.
                             A     2365 
                             A     2366 ; ---------
                             A     2367 ; normalize?
                             A     2368 ; ---------
                             A     2369 ; => from below only.
0000072C 4F                  A     2370 L072C:  LD		C,A
0000072D 7E                  A     2371 	LD		A,(HL)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   49


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000072E E6 F0               A     2372 	AND		0F0h
00000730 C0                  A     2373 	RET		NZ
                             A     2374 
00000731 79                  A     2375 	LD		A,C
                             A     2376 
                             A     2377 ; => (int/print_fp)
00000732 2B                  A     2378 L0732:  DEC		HL
00000733 2B                  A     2379 	DEC		HL
00000734 0E 03               A     2380 	LD		C,003h
                             A     2381 
00000736 ED 6F               A     2382 L0736:  RLD								;  A = xxxx3210  <--   7654<-3210 (HL)
                             A     2383 
00000738 23                  A     2384 	INC		HL						;
00000739 0D                  A     2385 	DEC		C
0000073A 20 FA               A     2386 	JR		NZ,L0736				;
                             A     2387 
0000073C 35                  A     2388 	DEC		(HL)					; decrement exponent
0000073D 2B                  A     2389 	DEC		HL						; point to start of BCD nibbles
0000073E BF                  A     2390 	CP		A
0000073F C9                  A     2391 	RET
                             A     2392 
                             A     2393 ; ---
                             A     2394 
                             A     2395 ; from ufloat to normalize 6-nibble mantissa
                             A     2396 
00000740 06 06               A     2397 L0740:  LD		B,006h					; six nibbles
                             A     2398 
00000742 AF                  A     2399 L0742:  XOR		A
                             A     2400 
00000743 CD 2C 07            A     2401 	CALL	L072C					;
                             A     2402 
00000746 C0                  A     2403 	RET		NZ
                             A     2404 
00000747 10 F9               A     2405 	DJNZ	L0742					;
                             A     2406 
00000749 23                  A     2407 	INC		HL
0000074A 70                  A     2408 	LD		(HL),B
                             A     2409 
0000074B C9                  A     2410 	RET
                             A     2411 
                             A     2412 ; ---------------------------
                             A     2413 ; THE 'GET NUMBER' SUBROUTINE
                             A     2414 ; ---------------------------
                             A     2415 ; can be called twice by the above code for the word 'NUMBER'.
                             A     2416 ; Once to get the first number encountered and sometimes, if in extended
                             A     2417 ; format, the exponent as well.
                             A     2418 
0000074C D7                  A     2419 L074C:  RST		10H						; push word DE
                             A     2420 
0000074D CD B9 04            A     2421 	CALL	L04B9					; forth
                             A     2422 
                             A     2423 L0750:  DEFW	L086B					; dup
00000750 6A 08               A+    2423 	DW P1
                             A     2424 	DEFW	L0896					; C@
00000752 95 08               A+    2424 	DW P1
                             A     2425 	DEFW	L104B					; stk-data
00000754 4A 10               A+    2425 	DW P1
                             A     2426 	DEFB	02Dh						;  chr '-'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   50


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000756 2D                  A+    2426 	DB P1
                             A     2427 	DEFW	L0C4A					; =
00000757 49 0C               A+    2427 	DW P1
                             A     2428 	DEFW	L086B					; dup
00000759 6A 08               A+    2428 	DW P1
                             A     2429 	DEFW	L0DA9					; negate
0000075B A8 0D               A+    2429 	DW P1
                             A     2430 	DEFW	L08D2					; >R
0000075D D1 08               A+    2430 	DW P1
                             A     2431 	DEFW	L0DD2					; +
0000075F D1 0D               A+    2431 	DW P1
                             A     2432 	DEFW	L0E1F					; 1-
00000761 1E 0E               A+    2432 	DW P1
                             A     2433 	DEFW	L0688					; stk-zero
00000763 88 06               A+    2433 	DW P1
                             A     2434 	DEFW	L0688					; stk-zero
00000765 88 06               A+    2434 	DW P1
                             A     2435 	DEFW	L08FF					; rot
00000767 FE 08               A+    2435 	DW P1
                             A     2436 L0769:  DEFW	L078A					; convert
00000769 8A 07               A+    2436 	DW P1
                             A     2437 	DEFW	L08FF					; rot
0000076B FE 08               A+    2437 	DW P1
                             A     2438 	DEFW	L08DF					; R>
0000076D DE 08               A+    2438 	DW P1
                             A     2439 	DEFW	L0D94					; pos
0000076F 93 0D               A+    2439 	DW P1
                             A     2440 	DEFW	L08FF					; rot
00000771 FE 08               A+    2440 	DW P1
                             A     2441 	DEFW	L0879					; drop
00000773 78 08               A+    2441 	DW P1
                             A     2442 	DEFW	L0885					; swap
00000775 84 08               A+    2442 	DW P1
                             A     2443 	DEFW	L1A0E					; end-forth.
00000777 0D 1A               A+    2443 	DW P1
                             A     2444 
00000779 DF                  A     2445 L0779:  RST		18H						; pop word DE
0000077A 1A                  A     2446 	LD		A,(DE)
                             A     2447 
0000077B FE 20               A     2448 L077B:  CP		020h
0000077D C8                  A     2449 	RET		Z
                             A     2450 
0000077E A7                  A     2451 	AND		A
0000077F C9                  A     2452 	RET
                             A     2453 
                             A     2454 ; ------------------
                             A     2455 ; THE 'CONVERT' WORD
                             A     2456 ; ------------------
                             A     2457 ; (  ud1, addr1 -- ud2, addr2  )
                             A     2458 ; Accumulates digits from text into an unsigned double length
                             A     2459 ; number ud1: for each digit, the double length accumulator is
                             A     2460 ; multiplied by the system number base and the digit (converted
                             A     2461 ; from ASCII) is added on. The text starts at addr1 + 1. addr2 is
                             A     2462 ; the address of the first unconvertible character, ud2 is the
                             A     2463 ; final value of the accumulator.
                             A     2464 
                             A     2465 L0780:  DEFM	"CONVER"				; 'name field'
00000780 43 4F 4E 56 45 52   A+    2465 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   51


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2466 	DEFB	'T'+080h
00000786 D4                  A+    2466 	DB P1
                             A     2467 
                             A     2468 	DEFW	L06A8					; 'link field'
00000787 A8 06               A+    2468 	DW P1
                             A     2469 
                             A     2470 L0789:  DEFB	007h						; 'name length field'
00000789 07                  A+    2470 	DB P1
                             A     2471 
                             A     2472 L078A:  DEFW	L0EC3					; 'code field' - docolon
0000078A C2 0E               A+    2472 	DW P1
                             A     2473 
                             A     2474 ; ---
                             A     2475 
                             A     2476 L078C:  DEFW	L0E09					; 1+
0000078C 08 0E               A+    2476 	DW P1
                             A     2477 L078E:  DEFW	L086B					; dup
0000078E 6A 08               A+    2477 	DW P1
                             A     2478 L0790:  DEFW	L08D2					; >R
00000790 D1 08               A+    2478 	DW P1
                             A     2479 L0792:  DEFW	L0896					; C@
00000792 95 08               A+    2479 	DW P1
                             A     2480 L0794:  DEFW	L07B8					; stk_digit
00000794 B8 07               A+    2480 	DW P1
                             A     2481 L0796:  DEFW	L1283					; ?branch
00000796 82 12               A+    2481 	DW P1
                             A     2482 L0798:  DEFW	0001Bh					; to 0799 + 1B = 007B4h
00000798 1B 00               A+    2482 	DW P1
                             A     2483 
                             A     2484 L079A:  DEFW	L0885					; swap
0000079A 84 08               A+    2484 	DW P1
                             A     2485 L079C:  DEFW	L048A					; get base
0000079C 8A 04               A+    2485 	DW P1
                             A     2486 L079E:  DEFW	L0896					; C@
0000079E 95 08               A+    2486 	DW P1
                             A     2487 L07A0:  DEFW	L0CA8					; u*
000007A0 A7 0C               A+    2487 	DW P1
                             A     2488 L07A2:  DEFW	L0879					; drop
000007A2 78 08               A+    2488 	DW P1
                             A     2489 L07A4:  DEFW	L08FF					; rot
000007A4 FE 08               A+    2489 	DW P1
                             A     2490 L07A6:  DEFW	L048A					; get base
000007A6 8A 04               A+    2490 	DW P1
                             A     2491 L07A8:  DEFW	L0896					; C@
000007A8 95 08               A+    2491 	DW P1
                             A     2492 L07AA:  DEFW	L0CA8					; U*
000007AA A7 0C               A+    2492 	DW P1
                             A     2493 L07AC:  DEFW	L0DEE					; D+
000007AC ED 0D               A+    2493 	DW P1
                             A     2494 L07AE:  DEFW	L08DF					; R>
000007AE DE 08               A+    2494 	DW P1
                             A     2495 L07B0:  DEFW	L1276					; branch
000007B0 75 12               A+    2495 	DW P1
                             A     2496 L07B2:  DEFW	0FFD9h					; loop back to L078C
000007B2 D9 FF               A+    2496 	DW P1
                             A     2497 
                             A     2498 L07B4:  DEFW	L08DF					; R>
000007B4 DE 08               A+    2498 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   52


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2499 L07B6:  DEFW	L04B6					; exit
000007B6 B6 04               A+    2499 	DW P1
                             A     2500 
                             A     2501 ; -----------------------------
                             A     2502 ; The 'stk_digit' Internal Word
                             A     2503 ; -----------------------------
                             A     2504 
                             A     2505 L07B8:  DEFW	L07BA					; headerless 'code field'
000007B8 BA 07               A+    2505 	DW P1
                             A     2506 
                             A     2507 ; ---
                             A     2508 
000007BA DF                  A     2509 L07BA:  RST		18H						; pop word DE
                             A     2510 
000007BB 7B                  A     2511 	LD		A,E						; character to A
                             A     2512 
000007BC CD 06 08            A     2513 	CALL	L0807					; to_upper
                             A     2514 
000007BF C6 D0               A     2515 	ADD		A,0D0h					; add to give carry with '0' and more.
                             A     2516 
000007C1 30 14               A     2517 	JR		NC,L07D7				; if less than '0' push byte 0 false.
                             A     2518 
000007C3 FE 0A               A     2519 	CP		00Ah						; compare to ten.
000007C5 38 06               A     2520 	JR		C,L07CD					; forward to stack bytes 0 - 9.
                             A     2521 
000007C7 C6 EF               A     2522 	ADD		A,0EFh					;
000007C9 30 0C               A     2523 	JR		NC,L07D7				; push word false 0.
                             A     2524 
000007CB C6 0A               A     2525 	ADD		A,00Ah
                             A     2526 
000007CD DD BE 3F            A     2527 L07CD:  CP		(IX+03Fh)				; compare to BASE
000007D0 30 05               A     2528 	JR		NC,L07D7				; push word false 0.
                             A     2529 
                             A     2530 ; else digit is within range of number base
                             A     2531 
000007D2 16 00               A     2532 	LD		D,000h
000007D4 5F                  A     2533 	LD		E,A
000007D5 D7                  A     2534 	RST		10H						; push word DE
000007D6 37                  A     2535 	SCF								; set carry to signal true
                             A     2536 
000007D7 C3 20 0C            A     2537 L07D7:  JP		L0C21					; push word 1 or 0
                             A     2538 
                             A     2539 ; ---
                             A     2540 ;		??
                             A     2541 ; ---
                             A     2542 
000007DA 62                  A     2543 L07DA:  LD		H,D
000007DB 6B                  A     2544 	LD		L,E
000007DC 03                  A     2545 	INC		BC
000007DD 09                  A     2546 	ADD		HL,BC
000007DE E5                  A     2547 	PUSH	HL
000007DF DD CB 3E 66         A     2548 	BIT		4,(IX+03Eh)				; FLAGS
000007E3 CC 7E 09            A     2549 	CALL	Z,L097F					; pr_string
                             A     2550 
000007E6 CD B0 02            A     2551 	CALL	L02B0					; curs?
                             A     2552 
000007E9 D1                  A     2553 	POP		DE
000007EA A7                  A     2554 	AND		A
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   53


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000007EB ED 52               A     2555 	SBC		HL,DE
000007ED 44                  A     2556 	LD		B,H
000007EE 4D                  A     2557 	LD		C,L
000007EF 2A 1E 00            A     2558 	LD		HL,(INSCRN)				; INSCRN
000007F2 23                  A     2559 	INC		HL
000007F3 EB                  A     2560 	EX		DE,HL
000007F4 38 05               A     2561 	JR		C,L07FB					;
                             A     2562 
000007F6 28 02               A     2563 	JR		Z,L07FA					; forward to SPACE_FILL.
                             A     2564 
000007F8 ED B0               A     2565 	LDIR
                             A     2566 
                             A     2567 ; ------------------------
                             A     2568 ; The 'SPACE FILL' routine
                             A     2569 ; ------------------------
                             A     2570 ; -> from cls
                             A     2571 
000007FA A7                  A     2572 L07FA:  AND		A						; prepare to subtract two screen
                             A     2573 					; pointers.
                             A     2574 
000007FB ED 52               A     2575 L07FB:  SBC		HL,DE					; number of bytes in HL.
000007FD EB                  A     2576 	EX		DE,HL					; now in DE, HL = start of area.
                             A     2577 
000007FE 7A                  A     2578 L07FE:  LD		A,D						; check if the
000007FF B3                  A     2579 	OR		E						; counter is zero.
00000800 C8                  A     2580 	RET		Z						; return if so.					>>
                             A     2581 
                             A     2582 ;	LD		(HL),020h				; insert a space character.
00000801 75                  A     2583 	LD		(HL),L				; insert a space character. //Ontobus
                             A     2584 
00000802 23                  A     2585 	INC		HL						; next address.
00000803 1B                  A     2586 	DEC		DE						; decrement byte counter.
00000804 18 F8               A     2587 	JR		L07FE					; loop back to exit on zero.
                             A     2588 
                             A     2589 ; --------------------------
                             A     2590 ; THE 'UPPERCASE' SUBROUTINE
                             A     2591 ; --------------------------
                             A     2592 ; converts characters to uppercase.
                             A     2593 
00000806 E6 7F               A     2594 L0807:  AND		07Fh						; ignore inverse bit 7
00000808 FE 61               A     2595 	CP		061h						; compare to 'a'
0000080A D8                  A     2596 	RET		C						; return if lower
                             A     2597 
0000080B FE 7B               A     2598 	CP		07Bh						; compare to 'z' + 1
0000080D D0                  A     2599 	RET		NC						; return if higher than 'z'
                             A     2600 
0000080E E6 5F               A     2601 	AND		05Fh						; make uppercase
00000810 C9                  A     2602 	RET								; return.
                             A     2603 
                             A     2604 ; --------------
                             A     2605 ; THE 'VIS' WORD
                             A     2606 ; --------------
                             A     2607 ; Allows copy-up mechanism and 'OK'.
                             A     2608 
                             A     2609 L0812:  DEFM	"VI"					; 'name field'
00000811 56 49               A+    2609 	DB P1
                             A     2610 	DEFB	'S'+080h
00000813 D3                  A+    2610 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   54


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2611 
                             A     2612 	DEFW	L0789					; 'link field'
00000814 89 07               A+    2612 	DW P1
                             A     2613 
                             A     2614 L0817:  DEFB	003h						; 'name length field'
00000816 03                  A+    2614 	DB P1
                             A     2615 
                             A     2616 L0818:  DEFW	L081A					; 'code field'
00000817 19 08               A+    2616 	DW P1
                             A     2617 
                             A     2618 ; ---
                             A     2619 
00000819 DD CB 3E A6         A     2620 L081A:  RES		4,(IX+03Eh)				; update FLAGS signal visible mode.
0000081D FD E9               A     2621 	JP		(IY)					; to 'next'.
                             A     2622 
                             A     2623 ; ----------------
                             A     2624 ; THE 'INVIS' WORD
                             A     2625 ; ----------------
                             A     2626 ; Suppresses copy-up mechanism and 'OK'.
                             A     2627 
                             A     2628 L0820:  DEFM	"INVI"					; 'name field'
0000081F 49 4E 56 49         A+    2628 	DB P1
                             A     2629 	DEFB	'S'+080h
00000823 D3                  A+    2629 	DB P1
                             A     2630 
                             A     2631 	DEFW	L0817					; 'link field'
00000824 16 08               A+    2631 	DW P1
                             A     2632 
                             A     2633 L0827:  DEFB	005h						; 'name length field'
00000826 05                  A+    2633 	DB P1
                             A     2634 
                             A     2635 L0828:  DEFW	L082A					; 'code field'
00000827 29 08               A+    2635 	DW P1
                             A     2636 
                             A     2637 ; ---
                             A     2638 
00000829 DD CB 3E E6         A     2639 L082A:  SET		4,(IX+03Eh)				; update FLAGS signal invisible mode.
                             A     2640 
0000082D FD E9               A     2641 	JP		(IY)					; to 'next'.
                             A     2642 
                             A     2643 
                             A     2644 ; ---------------
                             A     2645 ; THE 'FAST' WORD
                             A     2646 ; ---------------
                             A     2647 ; Fast mode - runs without error checks.
                             A     2648 ; Debugged programs run 25% faster.
                             A     2649 
                             A     2650 L0830:  DEFM	"FAS"					; 'name field'
0000082F 46 41 53            A+    2650 	DB P1
                             A     2651 	DEFB	'T'+080h
00000832 D4                  A+    2651 	DB P1
                             A     2652 
                             A     2653 	DEFW	L0827					; 'link field'
00000833 26 08               A+    2653 	DW P1
                             A     2654 
                             A     2655 L0836:  DEFB	004h						; 'name length field'
00000835 04                  A+    2655 	DB P1
                             A     2656 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   55


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2657 L0837:  DEFW	L0839					; 'code field'
00000836 38 08               A+    2657 	DW P1
                             A     2658 
                             A     2659 ; ---
                             A     2660 
00000838 FD 21 B9 04         A     2661 L0839:  LD		IY,L04B9				; miss memory checks on return
                             A     2662 
0000083C FD E9               A     2663 	JP		(IY)					; to 'next'.
                             A     2664 
                             A     2665 ; ---------------
                             A     2666 ; THE 'SLOW' WORD
                             A     2667 ; ---------------
                             A     2668 ; ( -- )
                             A     2669 ; Slow mode with error checking.
                             A     2670 ; Make IY point to a return routine that performs housekeeping.
                             A     2671 
                             A     2672 
                             A     2673 L083F:  DEFM	"SLO"					; 'name field'
0000083E 53 4C 4F            A+    2673 	DB P1
                             A     2674 	DEFB	'W'+080h
00000841 D7                  A+    2674 	DB P1
                             A     2675 
                             A     2676 	DEFW	L0836					; 'link field'
00000842 35 08               A+    2676 	DW P1
                             A     2677 
                             A     2678 L0845:  DEFB	004h						; 'name length field'
00000844 04                  A+    2678 	DB P1
                             A     2679 
                             A     2680 
                             A     2681 L0846:  DEFW	L0848					; 'code field'
00000845 47 08               A+    2681 	DW P1
                             A     2682 
                             A     2683 ; ---
                             A     2684 
00000847 FD 21 C8 04         A     2685 L0848:  LD		IY,L04C8				; set vector to memory checks each pass
                             A     2686 
0000084B FD E9               A     2687 	JP		(IY)					; to 'next'.
                             A     2688 
                             A     2689 ; ---------------------------------
                             A     2690 ; THE 'DATA STACK TO BC' SUBROUTINE
                             A     2691 ; ---------------------------------
                             A     2692 ; Called on twenty occasions to fetch a word from the Data Stack into the
                             A     2693 ; BC register pair. Very similar to RST 18H which does the same thing with the
                             A     2694 ; DE register pair as the destination on 73 occasions.
                             A     2695 ; In fact, as two Z80 restarts are unused, then 40 bytes of ROM code could have
                             A     2696 ; been saved by making this a restart also.
                             A     2697 
0000084D 2A 3B 00            A     2698 L084E:  LD		HL,(SPARE)				; fetch SPARE - start of Spare Memory.
00000850 2B                  A     2699 	DEC		HL						; decrement to point to last stack item
00000851 46                  A     2700 	LD		B,(HL)					; load high byte to B.
00000852 2B                  A     2701 	DEC		HL						; address low byte of word.
00000853 4E                  A     2702 	LD		C,(HL)					; and load to C.
00000854 22 3B 00            A     2703 	LD		(SPARE),HL				; update the system variable SPARE to
                             A     2704 					; a location two bytes less than it was.
00000857 C9                  A     2705 	RET								; return.
                             A     2706 
                             A     2707 ; -----------------------------------------
                             A     2708 ; THE 'CONTINUATION OF THE RST 18H' RESTART
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   56


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2709 ; -----------------------------------------
                             A     2710 ; complete the operation of popping a word to DE from the data stack.
                             A     2711 
00000858 2B                  A     2712 L0859:  DEC		HL						;
00000859 5E                  A     2713 	LD		E,(HL)					;
0000085A 22 3B 00            A     2714 	LD		(SPARE),HL				; update SPARE
0000085D C9                  A     2715 	RET								; return.
                             A     2716 
                             A     2717 ; -----------------------------------------
                             A     2718 ; THE 'CONTINUATION OF THE RST 10H' RESTART
                             A     2719 ; -----------------------------------------
                             A     2720 ; complete the operation of pushing a word in DE to the data stack.
                             A     2721 
0000085E 72                  A     2722 L085F:  LD		(HL),D					;
0000085F 23                  A     2723 	INC		HL						;
00000860 22 3B 00            A     2724 	LD		(SPARE),HL				; update SPARE
00000863 C9                  A     2725 	RET								; return.
                             A     2726 
                             A     2727 ; --------------
                             A     2728 ; THE 'DUP' WORD
                             A     2729 ; --------------
                             A     2730 ; ( n -- n, n )
                             A     2731 ; Duplicates the top of the stack.
                             A     2732 
                             A     2733 L0865:  DEFM	"DU"					; 'name field'
00000864 44 55               A+    2733 	DB P1
                             A     2734 	DEFB	'P'+080h
00000866 D0                  A+    2734 	DB P1
                             A     2735 
                             A     2736 	DEFW	L0845					; 'link field'
00000867 44 08               A+    2736 	DW P1
                             A     2737 
                             A     2738 L086A:  DEFB	003h						; 'name length field'
00000869 03                  A+    2738 	DB P1
                             A     2739 
                             A     2740 L086B:  DEFW	L086D					; 'code field'
0000086A 6C 08               A+    2740 	DW P1
                             A     2741 
                             A     2742 ; ---
                             A     2743 
0000086C DF                  A     2744 L086D:  RST		18H						; unstack Data Word DE
0000086D D7                  A     2745 	RST		10H						; stack Data Word DE
0000086E D7                  A     2746 	RST		10H						; stack Data Word DE
                             A     2747 
0000086F FD E9               A     2748 	JP		(IY)					; to 'next'.
                             A     2749 
                             A     2750 ; ---------------
                             A     2751 ; THE 'DROP' WORD
                             A     2752 ; ---------------
                             A     2753 ; ( n -- )
                             A     2754 ; Throws away the top of the stack.
                             A     2755 
                             A     2756 L0872:  DEFM	"DRO"					; 'name field'
00000871 44 52 4F            A+    2756 	DB P1
                             A     2757 	DEFB	'P'+080h
00000874 D0                  A+    2757 	DB P1
                             A     2758 
                             A     2759 	DEFW	L086A					; 'link field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   57


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000875 69 08               A+    2759 	DW P1
                             A     2760 
                             A     2761 L0878:  DEFB	004h						; 'name length field'
00000877 04                  A+    2761 	DB P1
                             A     2762 
                             A     2763 L0879:  DEFW	L087B					; 'code field'
00000878 7A 08               A+    2763 	DW P1
                             A     2764 
                             A     2765 ; ---
                             A     2766 
0000087A DF                  A     2767 L087B:  RST		18H						; unstack Data Word DE 
0000087B FD E9               A     2768 	JP		(IY)					; to 'next'.
                             A     2769 
                             A     2770 ; ---------------
                             A     2771 ; THE 'SWAP' WORD
                             A     2772 ; ---------------
                             A     2773 ; (n1, n2 -- n2, n1)
                             A     2774 
                             A     2775 L087E:  DEFM	"SWA"					; 'name field'
0000087D 53 57 41            A+    2775 	DB P1
                             A     2776 	DEFB	'P'+080h
00000880 D0                  A+    2776 	DB P1
                             A     2777 
                             A     2778 	DEFW	L0878					; 'link field'
00000881 77 08               A+    2778 	DW P1
                             A     2779 
                             A     2780 L0884:  DEFB	004h						; 'name length field'
00000883 04                  A+    2780 	DB P1
                             A     2781 
                             A     2782 L0885:  DEFW	L0887					; 'code field'
00000884 86 08               A+    2782 	DW P1
                             A     2783 
                             A     2784 ; ---
                             A     2785 
00000886 DF                  A     2786 L0887:  RST		18H						; pop word DE
00000887 CD 4D 08            A     2787 	CALL	L084E					; stk_to_bc
0000088A D7                  A     2788 	RST		10H						; push word DE
0000088B 50                  A     2789 	LD		D,B						;
0000088C 59                  A     2790 	LD		E,C						;
0000088D D7                  A     2791 	RST		10H						; push word DE
                             A     2792 
0000088E FD E9               A     2793 	JP		(IY)					; to 'next'.
                             A     2794 
                             A     2795 ; -------------
                             A     2796 ; THE 'C@' WORD
                             A     2797 ; -------------
                             A     2798 ; (address -- byte)
                             A     2799 ; Fetches the contents of a given address.
                             A     2800 
                             A     2801 L0891:  DEFB	'C'						; 'name field'
00000890 43                  A+    2801 	DB P1
                             A     2802 	DEFB	'@'+080h
00000891 C0                  A+    2802 	DB P1
                             A     2803 
                             A     2804 	DEFW	L0884					; 'link field'
00000892 83 08               A+    2804 	DW P1
                             A     2805 
                             A     2806 L0895:  DEFB	002h						; 'name length field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   58


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000894 02                  A+    2806 	DB P1
                             A     2807 
                             A     2808 L0896:  DEFW	L0898					; 'code field'
00000895 97 08               A+    2808 	DW P1
                             A     2809 
                             A     2810 ; ---
                             A     2811 
00000897 DF                  A     2812 L0898:  RST		18H						; pop word DE
00000898 1A                  A     2813 	LD		A,(DE)
00000899 5F                  A     2814 	LD		E,A
0000089A 16 00               A     2815 	LD		D,000h
                             A     2816 
0000089C D7                  A     2817 	RST		10H						; push word DE
                             A     2818 
0000089D FD E9               A     2819 	JP		(IY)					; to 'next'.
                             A     2820 
                             A     2821 ; -------------
                             A     2822 ; THE 'C!' WORD
                             A     2823 ; -------------
                             A     2824 ; (n, address -- )
                             A     2825 ; Stores the less significant byte on n at a given address.
                             A     2826 
                             A     2827 L08A0:  DEFB	'C'						; 'name field'
0000089F 43                  A+    2827 	DB P1
                             A     2828 	DEFB	'!'+080h
000008A0 A1                  A+    2828 	DB P1
                             A     2829 
                             A     2830 	DEFW	L0895					; 'link field'
000008A1 94 08               A+    2830 	DW P1
                             A     2831 
                             A     2832 L08A4:  DEFB	002h						; 'name length field'
000008A3 02                  A+    2832 	DB P1
                             A     2833 
                             A     2834 L08A5:  DEFW	L08A7					; 'code field'
000008A4 A6 08               A+    2834 	DW P1
                             A     2835 
                             A     2836 ; ---
                             A     2837 
000008A6 DF                  A     2838 L08A7:  RST		18H						; pop word DE
000008A7 CD 4D 08            A     2839 	CALL	L084E					; stk_to_bc
000008AA 79                  A     2840 	LD		A,C
000008AB 12                  A     2841 	LD		(DE),A
                             A     2842 
000008AC FD E9               A     2843 	JP		(IY)					; to 'next'.
                             A     2844 
                             A     2845 ; ------------
                             A     2846 ; THE '@' WORD
                             A     2847 ; ------------
                             A     2848 ; (address -- n)
                             A     2849 ; Leaves on stack the single length integer at the given address.
                             A     2850 
                             A     2851 L08AF:  DEFB	'@'+080h				; 'name field'
000008AE C0                  A+    2851 	DB P1
                             A     2852 
                             A     2853 	DEFW	L08A4					; 'link field'
000008AF A3 08               A+    2853 	DW P1
                             A     2854 
                             A     2855 L08B2:  DEFB	001h						; 'name length field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   59


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000008B1 01                  A+    2855 	DB P1
                             A     2856 
                             A     2857 L08B3:  DEFW	L08B5					; 'code field'
000008B2 B4 08               A+    2857 	DW P1
                             A     2858 
                             A     2859 ; ---
                             A     2860 
000008B4 DF                  A     2861 L08B5:  RST		18H						; pop word DE
                             A     2862 
000008B5 EB                  A     2863 	EX		DE,HL
000008B6 5E                  A     2864 	LD		E,(HL)
000008B7 23                  A     2865 	INC		HL
000008B8 56                  A     2866 	LD		D,(HL)
                             A     2867 
000008B9 D7                  A     2868 	RST		10H						; push word DE
                             A     2869 
000008BA FD E9               A     2870 	JP		(IY)					; to 'next'.
                             A     2871 
                             A     2872 ; ------------
                             A     2873 ; THE '!' WORD
                             A     2874 ; ------------
                             A     2875 ; (n,address --)
                             A     2876 ; Stores the single-length integer n at the given address in memory.
                             A     2877 
                             A     2878 L08BD:  DEFB	'!'+080h				; 'name field'
000008BC A1                  A+    2878 	DB P1
                             A     2879 
                             A     2880 	DEFW	L08B2					; 'link field'
000008BD B1 08               A+    2880 	DW P1
                             A     2881 
                             A     2882 L08C0:  DEFB	001h						; 'name length field'
000008BF 01                  A+    2882 	DB P1
                             A     2883 
                             A     2884 L08C1:  DEFW	L08C3					; 'code field'
000008C0 C2 08               A+    2884 	DW P1
                             A     2885 
                             A     2886 ; ---
                             A     2887 
000008C2 DF                  A     2888 L08C3:  RST		18H						; pop word DE
000008C3 CD 4D 08            A     2889 	CALL	L084E					; stk_to_bc
000008C6 EB                  A     2890 	EX		DE,HL
000008C7 71                  A     2891 	LD		(HL),C
000008C8 23                  A     2892 	INC		HL
000008C9 70                  A     2893 	LD		(HL),B
                             A     2894 
000008CA FD E9               A     2895 	JP		(IY)					; to 'next'.
                             A     2896 
                             A     2897 ; -------------
                             A     2898 ; THE '>R' WORD
                             A     2899 ; -------------
                             A     2900 ; (n -- )
                             A     2901 ; Transfers top entry on data stack to return stack.
                             A     2902 ; It can be copied back using 'I'.
                             A     2903 
                             A     2904 L08CD:  DEFB	'>'						; 'name field'
000008CC 3E                  A+    2904 	DB P1
                             A     2905 	DEFB	'R'+080h
000008CD D2                  A+    2905 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   60


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     2906 
                             A     2907 	DEFW	L08C0					; 'link field'
000008CE BF 08               A+    2907 	DW P1
                             A     2908 
                             A     2909 L08D1:  DEFB	002h						; 'name length field'
000008D0 02                  A+    2909 	DB P1
                             A     2910 
                             A     2911 L08D2:  DEFW	L08D4					; 'code field'
000008D1 D3 08               A+    2911 	DW P1
                             A     2912 
                             A     2913 ; ---
                             A     2914 
000008D3 DF                  A     2915 L08D4:  RST		18H
000008D4 C1                  A     2916 	POP		BC
000008D5 D5                  A     2917 	PUSH	DE
000008D6 C5                  A     2918 	PUSH	BC
000008D7 FD E9               A     2919 	JP		(IY)					; to 'next'.
                             A     2920 
                             A     2921 ; -------------
                             A     2922 ; THE 'R>' WORD
                             A     2923 ; -------------
                             A     2924 ; ( -- entry from return stack)
                             A     2925 ; Transfers top entry on return stack to data stack.
                             A     2926 
                             A     2927 L08DA:  DEFB	'R'						; 'name field'
000008D9 52                  A+    2927 	DB P1
                             A     2928 	DEFB	'>'+080h
000008DA BE                  A+    2928 	DB P1
                             A     2929 
                             A     2930 	DEFW	L08D1					; 'link field'
000008DB D0 08               A+    2930 	DW P1
                             A     2931 
                             A     2932 L08DE:  DEFB	002h						; 'name length field'
000008DD 02                  A+    2932 	DB P1
                             A     2933 
                             A     2934 L08DF:  DEFW	L08E1					; 'code field'
000008DE E0 08               A+    2934 	DW P1
                             A     2935 
                             A     2936 ; ---
                             A     2937 
000008E0 C1                  A     2938 L08E1:  POP		BC
000008E1 D1                  A     2939 	POP		DE
000008E2 C5                  A     2940 	PUSH	BC
000008E3 D7                  A     2941 	RST		10H						; push word DE
000008E4 FD E9               A     2942 	JP		(IY)					; to 'next'.
                             A     2943 
                             A     2944 ; ---------------
                             A     2945 ; THE '?DUP' WORD
                             A     2946 ; ---------------
                             A     2947 ; (n -- n, n)	if n!=0.
                             A     2948 ; (n -- n)		if n=0.
                             A     2949 
                             A     2950 L08E7:  DEFM	"?DU"					; 'name field'
000008E6 3F 44 55            A+    2950 	DB P1
                             A     2951 	DEFB	'P'+080h
000008E9 D0                  A+    2951 	DB P1
                             A     2952 
                             A     2953 	DEFW	L08DE					; 'link field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   61


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000008EA DD 08               A+    2953 	DW P1
                             A     2954 
                             A     2955 L08ED:  DEFB	004h						; 'name length field'
000008EC 04                  A+    2955 	DB P1
                             A     2956 
                             A     2957 L08EE:  DEFW	L08F0					; 'code field'
000008ED EF 08               A+    2957 	DW P1
                             A     2958 
                             A     2959 ; ---
                             A     2960 
                             A     2961 
000008EF DF                  A     2962 L08F0:  RST		18H						; fetch word DE
000008F0 D7                  A     2963 	RST		10H						; push it back
000008F1 7A                  A     2964 	LD		A,D						; test if fetched
000008F2 B3                  A     2965 	OR		E						; word is zero
000008F3 C4 11 00            A     2966 	CALL	NZ,L0010				; push word DE if non-zero
000008F6 FD E9               A     2967 	JP		(IY)					; to 'next'.
                             A     2968 
                             A     2969 ; --------------
                             A     2970 ; THE 'ROT' WORD
                             A     2971 ; --------------
                             A     2972 ; (n1, n2, n3 -- n2, n3, n1)
                             A     2973 
                             A     2974 L08F9:  DEFM	"RO"					; 'name field'
000008F8 52 4F               A+    2974 	DB P1
                             A     2975 	DEFB	'T'+080h
000008FA D4                  A+    2975 	DB P1
                             A     2976 
                             A     2977 	DEFW	L08ED					; 'link field'
000008FB EC 08               A+    2977 	DW P1
                             A     2978 
                             A     2979 L08FE:  DEFB	003h						; 'name length field'
000008FD 03                  A+    2979 	DB P1
                             A     2980 
                             A     2981 L08FF:  DEFW	L0EC3					; 'code field' - docolon
000008FE C2 0E               A+    2981 	DW P1
                             A     2982 
                             A     2983 ; ---
                             A     2984 
                             A     2985 L0901:  DEFW	L08D2					; >R
00000900 D1 08               A+    2985 	DW P1
                             A     2986 L0903:  DEFW	L0885					; swap
00000902 84 08               A+    2986 	DW P1
                             A     2987 L0905:  DEFW	L08DF					; R>
00000904 DE 08               A+    2987 	DW P1
                             A     2988 L0907:  DEFW	L0885					; swap
00000906 84 08               A+    2988 	DW P1
                             A     2989 L0909:  DEFW	L04B6					; exit
00000908 B6 04               A+    2989 	DW P1
                             A     2990 
                             A     2991 ; ---------------
                             A     2992 ; THE 'OVER' WORD
                             A     2993 ; ---------------
                             A     2994 ; (n1, n2 -- n1, n2, n1)
                             A     2995 
                             A     2996 L090B:  DEFM	"OVE"					; 'name field'
0000090A 4F 56 45            A+    2996 	DB P1
                             A     2997 	DEFB	'R'+080h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   62


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000090D D2                  A+    2997 	DB P1
                             A     2998 
                             A     2999 	DEFW	L08FE					; 'link field'
0000090E FD 08               A+    2999 	DW P1
                             A     3000 
                             A     3001 L0911:  DEFB	004h						; 'name length field'
00000910 04                  A+    3001 	DB P1
                             A     3002 
                             A     3003 L0912:  DEFW	L0EC3					; 'code field' - docolon
00000911 C2 0E               A+    3003 	DW P1
                             A     3004 
                             A     3005 ; ---
                             A     3006 
                             A     3007 L0914:  DEFW	L08D2					; >R
00000913 D1 08               A+    3007 	DW P1
                             A     3008 L0916:  DEFW	L086B					; dup
00000915 6A 08               A+    3008 	DW P1
                             A     3009 L0918:  DEFW	L08DF					; R>
00000917 DE 08               A+    3009 	DW P1
                             A     3010 L091A:  DEFW	L0885					; swap
00000919 84 08               A+    3010 	DW P1
                             A     3011 L091C:  DEFW	L04B6					; exit
0000091B B6 04               A+    3011 	DW P1
                             A     3012 
                             A     3013 ; ---------------
                             A     3014 ; THE 'PICK' WORD
                             A     3015 ; ---------------
                             A     3016 ; (n1 -- n2)
                             A     3017 ; Copies the n1-th stack entry (after dropping n1 itself) to the top.
                             A     3018 ; Error 7 if n1 <= 0.
                             A     3019 
                             A     3020 L091E:  DEFM	"PIC"					; 'name field'
0000091D 50 49 43            A+    3020 	DB P1
                             A     3021 	DEFB	'K'+080h
00000920 CB                  A+    3021 	DB P1
                             A     3022 
                             A     3023 	DEFW	L0911					; 'link field'
00000921 10 09               A+    3023 	DW P1
                             A     3024 
                             A     3025 L0924:  DEFB	004h						; 'name length field'
00000923 04                  A+    3025 	DB P1
                             A     3026 
                             A     3027 	DEFW	L0927					; 'code field'
00000924 26 09               A+    3027 	DW P1
                             A     3028 
                             A     3029 ; ---
                             A     3030 
00000926 CD 4C 09            A     3031 L0927:  CALL	L094D					;
00000929 FD E9               A     3032 	JP		(IY)					; to 'next'.
                             A     3033 
                             A     3034 ; ---------------
                             A     3035 ; THE 'ROLL' WORD
                             A     3036 ; ---------------
                             A     3037 ; (n -- )
                             A     3038 ; Extracts the nth stack value to the top of the stack, after dropping n
                             A     3039 ; itself, and moves the remaining values down to fill the vacated position.
                             A     3040 ; Error 7 if n <= 0.
                             A     3041 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   63


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3042 L092C:  DEFM	"ROL"					; 'name field'
0000092B 52 4F 4C            A+    3042 	DB P1
                             A     3043 	DEFB	'L'+080h
0000092E CC                  A+    3043 	DB P1
                             A     3044 
                             A     3045 	DEFW	L0924					; 'link field'
0000092F 23 09               A+    3045 	DW P1
                             A     3046 
                             A     3047 L0932:  DEFB	004h						; 'name length field'
00000931 04                  A+    3047 	DB P1
                             A     3048 
                             A     3049 L0933:  DEFW	L0935					; 'code field'
00000932 34 09               A+    3049 	DW P1
                             A     3050 
                             A     3051 ; ---
                             A     3052 
00000934 CD 4C 09            A     3053 L0935:  CALL	L094D					;
00000937 EB                  A     3054 	EX		DE,HL
00000938 2A 37 00            A     3055 	LD		HL,(STKBOT)				; STKBOT
0000093B ED 52               A     3056 	SBC		HL,DE
0000093D D2 D7 04            A     3057 	JP		NC,L04D7				; jump back to Error 2
                             A     3058 
00000940 62                  A     3059 	LD		H,D
00000941 6B                  A     3060 	LD		L,E
00000942 23                  A     3061 	INC		HL
00000943 23                  A     3062 	INC		HL
00000944 ED B0               A     3063 	LDIR
00000946 ED 53 3B 00         A     3064 	LD		(SPARE),DE				; SPARE
0000094A FD E9               A     3065 	JP		(IY)					; to 'next'.
                             A     3066 
                             A     3067 ; ---
                             A     3068 
0000094C CD 4D 08            A     3069 L094D:  CALL	L084E					; stk_to_bc
0000094F 0B                  A     3070 	DEC		BC
00000950 CB 21               A     3071 	SLA		C
00000952 CB 10               A     3072 	RL		B
00000954 03                  A     3073 	INC		BC
00000955 03                  A     3074 	INC		BC
00000956 30 02               A     3075 	JR		NC,L095B				; skip the error routine
                             A     3076 
00000958 E7                  A     3077 	RST		20H						; Error 7
                             A     3078 	DEFB	007h						; PICK or ROLL used with operand 0
00000959 07                  A+    3078 	DB P1
                             A     3079 					; or negative
                             A     3080 
                             A     3081 ; ---
                             A     3082 
0000095A 2A 3B 00            A     3083 L095B:  LD		HL,(SPARE)				; SPARE
0000095D ED 42               A     3084 	SBC		HL,BC
0000095F E5                  A     3085 	PUSH	HL
00000960 5E                  A     3086 	LD		E,(HL)
00000961 23                  A     3087 	INC		HL
00000962 56                  A     3088 	LD		D,(HL)
00000963 D7                  A     3089 	RST		10H						; push word DE
00000964 E1                  A     3090 	POP		HL
00000965 C9                  A     3091 	RET
                             A     3092 
                             A     3093 ; ---------------
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   64


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3094 ; THE 'TYPE' WORD
                             A     3095 ; ---------------
                             A     3096 ; (address, n -- )
                             A     3097 ; EMITs n characters from memory starting at the address.
                             A     3098 
                             A     3099 
                             A     3100 L0967:  DEFM	"TYP"					; 'name field'
00000966 54 59 50            A+    3100 	DB P1
                             A     3101 	DEFB	'E'+080h
00000969 C5                  A+    3101 	DB P1
                             A     3102 
                             A     3103 	DEFW	L0932					; 'link field'
0000096A 31 09               A+    3103 	DW P1
                             A     3104 
                             A     3105 L096D:  DEFB	004h						; 'name length field'
0000096C 04                  A+    3105 	DB P1
                             A     3106 
                             A     3107 L096E:  DEFW	L0970					; 'code field'
0000096D 6F 09               A+    3107 	DW P1
                             A     3108 
                             A     3109 ; ---
                             A     3110 
0000096F CD 4D 08            A     3111 L0970:  CALL	L084E					; stk_to_bc
00000972 DF                  A     3112 	RST		18H						; pop word DE
00000973 CD 7E 09            A     3113 	CALL	L097F					; routine pr_string (below)
                             A     3114 
00000976 FD E9               A     3115 	JP		(IY)					; to 'next'.
                             A     3116 
                             A     3117 ; --------------------------
                             A     3118 ; THE 'PRINT STRING' ROUTINE
                             A     3119 ; --------------------------
                             A     3120 ; The first entry point prints strings embedded in the Dictionary with the 
                             A     3121 ; DE pointing to the preceding length word.
                             A     3122 ; 
                             A     3123 ; The second entry point prints a string with length in BC and start in DE.
                             A     3124 ; It is called by TYPE above and to print comment fields.
                             A     3125 
                             A     3126 ; ->
                             A     3127 
00000978 1A                  A     3128 L0979:  LD		A,(DE)
00000979 4F                  A     3129 	LD		C,A
0000097A 13                  A     3130 	INC		DE
0000097B 1A                  A     3131 	LD		A,(DE)
0000097C 47                  A     3132 	LD		B,A
0000097D 13                  A     3133 	INC		DE
                             A     3134 
                             A     3135 ; -->
0000097E 78                  A     3136 L097F:  LD		A,B
0000097F B1                  A     3137 	OR		C
00000980 C8                  A     3138 	RET		Z
                             A     3139 
00000981 1A                  A     3140 	LD		A,(DE)
00000982 13                  A     3141 	INC		DE
00000983 0B                  A     3142 	DEC		BC
00000984 CF                  A     3143 	RST		08H						; print_ch
                             A     3144 
00000985 18 F7               A     3145 	JR		L097F					;
                             A     3146 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   65


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3147 ; -------------
                             A     3148 ; THE '<#' WORD
                             A     3149 ; -------------
                             A     3150 ; (  --  )
                             A     3151 ; Initiates formatted output.
                             A     3152 
                             A     3153 L0988:  DEFB	'<'						; 'name field'
00000987 3C                  A+    3153 	DB P1
                             A     3154 	DEFB	'#'+080h
00000988 A3                  A+    3154 	DB P1
                             A     3155 
                             A     3156 	DEFW	L096D					; 'link field'
00000989 6C 09               A+    3156 	DW P1
                             A     3157 
                             A     3158 L098C:  DEFB	002h						; 'name length field'
0000098B 02                  A+    3158 	DB P1
                             A     3159 
                             A     3160 L098D:  DEFW	L098F					; 'code field'
0000098C 8E 09               A+    3160 	DW P1
                             A     3161 
                             A     3162 ; ---
                             A     3163 
0000098E 21 FF 27            A     3164 L098F:  LD		HL,027FFh				; end of pad
00000991 22 1A 00            A     3165 	LD		(HLD),HL				; update system variable HLD
00000994 FD E9               A     3166 	JP		(IY)					; to 'next'.
                             A     3167 
                             A     3168 ; -------------
                             A     3169 ; THE '#>' WORD
                             A     3170 ; -------------
                             A     3171 ; (ud -- address, n)
                             A     3172 ; Finishes formatted output, leaving the address and length (n) of the
                             A     3173 ; resultant string.
                             A     3174 
                             A     3175 L0997:  DEFB	'#'						; 'name field'
00000996 23                  A+    3175 	DB P1
                             A     3176 	DEFB	'>'+080h
00000997 BE                  A+    3176 	DB P1
                             A     3177 
                             A     3178 	DEFW	L098C					; 'link field'
00000998 8B 09               A+    3178 	DW P1
                             A     3179 
                             A     3180 L099B:  DEFB	002h						; 'name length field'
0000099A 02                  A+    3180 	DB P1
                             A     3181 
                             A     3182 L099C:  DEFW	L099E					; 'code field'
0000099B 9D 09               A+    3182 	DW P1
                             A     3183 
                             A     3184 ; ---
                             A     3185 
0000099D DF                  A     3186 L099E:  RST		18H						; pop word DE
0000099E DF                  A     3187 	RST		18H						; pop word DE
0000099F ED 5B 1A 00         A     3188 	LD		DE,(HLD)				; HLD
000009A3 D7                  A     3189 	RST		10H						; push word DE (address)
000009A4 21 FF 27            A     3190 	LD		HL,027FFh				; end of pad.
000009A7 A7                  A     3191 	AND		A						; prepare to subtract.
000009A8 ED 52               A     3192 	SBC		HL,DE					; find length of string.
000009AA EB                  A     3193 	EX		DE,HL					; transfer to DE
000009AB D7                  A     3194 	RST		10H						; push word DE (n)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   66


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3195 
000009AC FD E9               A     3196 	JP		(IY)					; to 'next'.
                             A     3197 
                             A     3198 ; ------------
                             A     3199 ; THE '.' WORD
                             A     3200 ; ------------
                             A     3201 ;
                             A     3202 
                             A     3203 L09AF:  DEFB	'.'+080h				; 'name field'
000009AE AE                  A+    3203 	DB P1
                             A     3204 
                             A     3205 	DEFW	L0A49					; 'link field'
000009AF 48 0A               A+    3205 	DW P1
                             A     3206 
                             A     3207 L09B2:  DEFB	001h						; 'name length field'
000009B1 01                  A+    3207 	DB P1
                             A     3208 
                             A     3209 L09B3:  DEFW	L0EC3					; 'code field' - docolon
000009B2 C2 0E               A+    3209 	DW P1
                             A     3210 
                             A     3211 ; ---
                             A     3212 
                             A     3213 L09B5:  DEFW	L098D					; <#
000009B4 8C 09               A+    3213 	DW P1
                             A     3214 	DEFW	L086B					; dup
000009B6 6A 08               A+    3214 	DW P1
                             A     3215 	DEFW	L0C0D					; abs
000009B8 0C 0C               A+    3215 	DW P1
                             A     3216 	DEFW	L0688					; stk-zero
000009BA 88 06               A+    3216 	DW P1
                             A     3217 	DEFW	L09E1					; #s
000009BC E0 09               A+    3217 	DW P1
                             A     3218 	DEFW	L08FF					; rot
000009BE FE 08               A+    3218 	DW P1
                             A     3219 	DEFW	L0A4A					; sign
000009C0 49 0A               A+    3219 	DW P1
                             A     3220 
                             A     3221 L09C3:  DEFW	L099C					; #>
000009C2 9B 09               A+    3221 	DW P1
                             A     3222 	DEFW	L096E					; type
000009C4 6D 09               A+    3222 	DW P1
                             A     3223 	DEFW	L0A73					; space
000009C6 72 0A               A+    3223 	DW P1
                             A     3224 	DEFW	L04B6					; exit
000009C8 B6 04               A+    3224 	DW P1
                             A     3225 
                             A     3226 ; -------------
                             A     3227 ; THE 'U.' WORD
                             A     3228 ; -------------
                             A     3229 ; (un -- )
                             A     3230 ; Prints the unsigned single length integer 'un' to the television screen,
                             A     3231 ; followed by a space.
                             A     3232 
                             A     3233 L09CB:  DEFB	'U'						; 'name field'
000009CA 55                  A+    3233 	DB P1
                             A     3234 	DEFB	'.'+080h
000009CB AE                  A+    3234 	DB P1
                             A     3235 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   67


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3236 	DEFW	L09B2					; 'link field'
000009CC B1 09               A+    3236 	DW P1
                             A     3237 
                             A     3238 L09CF:  DEFB	002h						; 'name length field'
000009CE 02                  A+    3238 	DB P1
                             A     3239 
                             A     3240 L09D0:  DEFW	L0EC3					; 'code field' - docolon
000009CF C2 0E               A+    3240 	DW P1
                             A     3241 
                             A     3242 ; ---
                             A     3243 
                             A     3244 L09D2:  DEFW	L0688					; stk-zero
000009D1 88 06               A+    3244 	DW P1
                             A     3245 L09D4:  DEFW	L098D					; <#
000009D3 8C 09               A+    3245 	DW P1
                             A     3246 L09D6:  DEFW	L09E1					; #S
000009D5 E0 09               A+    3246 	DW P1
                             A     3247 L09D8:  DEFW	L1276					; branch
000009D7 75 12               A+    3247 	DW P1
                             A     3248 L09DA:  DEFW	0FFE8h					; -> 09C3
000009D9 E8 FF               A+    3248 	DW P1
                             A     3249 
                             A     3250 
                             A     3251 ; -------------
                             A     3252 ; THE '#S' WORD
                             A     3253 ; -------------
                             A     3254 ; (ud -- 0,0)
                             A     3255 ; Applies # repeatedly (at least once) until the double length number left
                             A     3256 ; on the stack is 0.
                             A     3257 
                             A     3258 L09DC:  DEFB	'#'						; 'name field'
000009DB 23                  A+    3258 	DB P1
                             A     3259 	DEFB	'S'+080h
000009DC D3                  A+    3259 	DB P1
                             A     3260 
                             A     3261 	DEFW	L09CF					; 'link field'
000009DD CE 09               A+    3261 	DW P1
                             A     3262 
                             A     3263 L09E0:  DEFB	002h						; 'name length field'
000009DF 02                  A+    3263 	DB P1
                             A     3264 
                             A     3265 L09E1:  DEFW	L0EC3					; 'code field' - docolon
000009E0 C2 0E               A+    3265 	DW P1
                             A     3266 
                             A     3267 ; ---
                             A     3268 
                             A     3269 L09E3:  DEFW	L09F7					; #
000009E2 F6 09               A+    3269 	DW P1
                             A     3270 	DEFW	L0912					; over
000009E4 11 09               A+    3270 	DW P1
                             A     3271 	DEFW	L0912					; over
000009E6 11 09               A+    3271 	DW P1
                             A     3272 	DEFW	L0E36					; or
000009E8 35 0E               A+    3272 	DW P1
                             A     3273 	DEFW	L0C1A					; 0=
000009EA 19 0C               A+    3273 	DW P1
                             A     3274 	DEFW	L128D					; ?branch
000009EC 8C 12               A+    3274 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   68


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3275 
                             A     3276 L09EF:  DEFW	0FFF3h					; back to L09E3
000009EE F3 FF               A+    3276 	DW P1
                             A     3277 
                             A     3278 	DEFW	L04B6					; exit
000009F0 B6 04               A+    3278 	DW P1
                             A     3279 
                             A     3280 ; ------------
                             A     3281 ; THE '#' WORD
                             A     3282 ; ------------
                             A     3283 ; (ud1 -- ud2)
                             A     3284 ; used in formatted output. Generates one digit from the unsigned double
                             A     3285 ; length integer ud1 and holds it in the pad. The unsigned double length
                             A     3286 ; integer ud2 is the quotient when ud1 is divided by the number base.
                             A     3287 
                             A     3288 L09F3:  DEFB	'#'+080h				; 'name field'
000009F2 A3                  A+    3288 	DB P1
                             A     3289 
                             A     3290 	DEFW	L09E0					; 'link field'
000009F3 DF 09               A+    3290 	DW P1
                             A     3291 
                             A     3292 L09F6:  DEFB	001h						; 'name length field'
000009F5 01                  A+    3292 	DB P1
                             A     3293 
                             A     3294 L09F7:  DEFW	L0EC3					; 'code field' - docolon
000009F6 C2 0E               A+    3294 	DW P1
                             A     3295 
                             A     3296 ; ---
                             A     3297 
                             A     3298 L09F9:  DEFW	L048A					; get base
000009F8 8A 04               A+    3298 	DW P1
                             A     3299 L09FB:  DEFW	L0896					; C@
000009FA 95 08               A+    3299 	DW P1
                             A     3300 L09FD:  DEFW	L0CC4					; div?
000009FC C3 0C               A+    3300 	DW P1
                             A     3301 L09FF:  DEFW	L08FF					; rot
000009FE FE 08               A+    3301 	DW P1
                             A     3302 L0A01:  DEFW	L0A07					; stk-char
00000A00 06 0A               A+    3302 	DW P1
                             A     3303 L0A03:  DEFW	L0A5C					; hold
00000A02 5B 0A               A+    3303 	DW P1
                             A     3304 L0A05:  DEFW	L04B6					; exit
00000A04 B6 04               A+    3304 	DW P1
                             A     3305 
                             A     3306 ; ----------------------------
                             A     3307 ; The 'stk-char' Internal Word
                             A     3308 ; ----------------------------
                             A     3309 ; used from above thread.
                             A     3310 
                             A     3311 L0A07:  DEFW	L0A09					; headerless 'code field'
00000A06 08 0A               A+    3311 	DW P1
                             A     3312 
                             A     3313 ; ---
                             A     3314 
00000A08 DF                  A     3315 L0A09:  RST		18H						; data stack to DE
00000A09 7B                  A     3316 	LD		A,E						; character to A
00000A0A C6 30               A     3317 	ADD		A,030h					; convert digit to ASCII
00000A0C FE 3A               A     3318 	CP		03Ah						; compare to '9'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   69


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000A0E 38 02               A     3319 	JR		C,L0A13					; forward if digit
00000A10 C6 07               A     3320 	ADD		A,007h					; else add for hex
                             A     3321 
00000A12 5F                  A     3322 L0A13:  LD		E,A						; back to E
00000A13 D7                  A     3323 	RST		10H						; push ASCII on data stack.
00000A14 FD E9               A     3324 	JP		(IY)					; to 'next'.
                             A     3325 
                             A     3326 ; --------------
                             A     3327 ; THE 'CLS' WORD
                             A     3328 ; --------------
                             A     3329 ; ( -- )
                             A     3330 ; Clears the screen and sets the print position to the top left of
                             A     3331 ; the screen.
                             A     3332 
                             A     3333 L0A17:  DEFM	"CL"					; 'name field'
00000A16 43 4C               A+    3333 	DB P1
                             A     3334 	DEFB	'S'+080h
00000A18 D3                  A+    3334 	DB P1
                             A     3335 
                             A     3336 	DEFW	L09F6					; 'link field'
00000A19 F5 09               A+    3336 	DW P1
                             A     3337 
                             A     3338 L0A1C:  DEFB	003h						; 'name length field'
00000A1B 03                  A+    3338 	DB P1
                             A     3339 
                             A     3340 	DEFW	L0A1F					; 'code field'
00000A1C 1E 0A               A+    3340 	DW P1
                             A     3341 
                             A     3342 ; ---
                             A     3343 
00000A1E CD 23 0A            A     3344 L0A1F:  CALL	L0A24					; routine CLS below.
                             A     3345 
00000A21 FD E9               A     3346 	JP		(IY)					; to 'next'.
                             A     3347 
                             A     3348 
                             A     3349 ; --------------------
                             A     3350 ; THE 'CLS' SUBROUTINE
                             A     3351 ; --------------------
                             A     3352 ; Called from the 'CLS' word definition above and also from the initialization
                             A     3353 ; routine.
                             A     3354 
00000A23 11 FF 26            A     3355 L0A24:  LD		DE,026FFh				; point destination to end of video
                             A     3356 					; memory.
00000A26 2A 24 00            A     3357 	LD		HL,(L_HALF)				; set HL to first byte of input buffer
                             A     3358 					; from system variable L_HALF.
                             A     3359 					; (at initialization 026E0h).
                             A     3360 
00000A29 01 20 00            A     3361 	LD		BC,00020h				; set count to thirty two.
                             A     3362 
00000A2C 09                  A     3363 	ADD		HL,BC					; add to the low address.
00000A2D 2B                  A     3364 	DEC		HL						; step back and
00000A2E ED B8               A     3365 	LDDR							; copy the 32 bytes.
                             A     3366 
                             A     3367 ; while BC is zero, set the plotting coordinates.
                             A     3368 
00000A30 ED 43 2F 00         A     3369 	LD		(XCOORD),BC				; set XCOORD and YCOORD to zero.
                             A     3370 
                             A     3371 ; set the screen position to the start of video memory.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   70


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3372 
00000A34 21 00 24            A     3373 	LD		HL,02400h				; start of the 768 bytes of video RAM.
00000A37 22 1C 00            A     3374 	LD		(SCRPOS),HL				; set system variable SCRPOS.
                             A     3375 
00000A3A 13                  A     3376 	INC		DE						; the byte before logical line.
00000A3B EB                  A     3377 	EX		DE,HL					; transfer to HL.
00000A3C 22 24 00            A     3378 	LD		(L_HALF),HL				; set L_HALF.
00000A3F C3 FA 07            A     3379 	JP		L07FA					; jump back to fill the locations
                             A     3380 					; from DE to HL -1 with spaces.
                             A     3381 
                             A     3382 ; ---------------
                             A     3383 ; THE 'SIGN' WORD
                             A     3384 ; ---------------
                             A     3385 ; (n -- )
                             A     3386 ; In formatted output, holds a minus sign in the pad if n is negative.
                             A     3387 
                             A     3388 
                             A     3389 L0A43:  DEFM	"SIG"					; 'name field'
00000A42 53 49 47            A+    3389 	DB P1
                             A     3390 	DEFB	'N'+080h
00000A45 CE                  A+    3390 	DB P1
                             A     3391 
                             A     3392 	DEFW	L099B					; 'link field'
00000A46 9A 09               A+    3392 	DW P1
                             A     3393 
                             A     3394 L0A49:  DEFB	004h						; 'name length field'
00000A48 04                  A+    3394 	DB P1
                             A     3395 
                             A     3396 L0A4A:  DEFW	L0A4C					; 'code field'
00000A49 4B 0A               A+    3396 	DW P1
                             A     3397 
                             A     3398 ; ---
                             A     3399 
00000A4B DF                  A     3400 L0A4C:  RST		18H						; pop word DE
00000A4C CB 12               A     3401 	RL		D						; test sign bit
00000A4E 1E 2D               A     3402 	LD		E,02Dh					; prepare a '-'
00000A50 38 0C               A     3403 	JR		C,L0A5F					; forward if minus
00000A52 FD E9               A     3404 	JP		(IY)					; to 'next'.
                             A     3405 
                             A     3406 ; ---------------
                             A     3407 ; THE 'HOLD' WORD
                             A     3408 ; ---------------
                             A     3409 ; (character -- )
                             A     3410 ; Used in formatted output to hold the character in the pad.
                             A     3411 
                             A     3412 L0A55:  DEFM	"HOL"					; 'name field'
00000A54 48 4F 4C            A+    3412 	DB P1
                             A     3413 	DEFB	'D'+080h
00000A57 C4                  A+    3413 	DB P1
                             A     3414 
                             A     3415 L0A59:  DEFW	L0A1C					; 'link field'
00000A58 1B 0A               A+    3415 	DW P1
                             A     3416 
                             A     3417 L0A5B:  DEFB	004h						; 'name length field'
00000A5A 04                  A+    3417 	DB P1
                             A     3418 
                             A     3419 L0A5C:  DEFW	L0A5E					; 'code field'
00000A5B 5D 0A               A+    3419 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   71


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3420 
                             A     3421 ; ---
                             A     3422 
00000A5D DF                  A     3423 L0A5E:  RST		18H						; data stack to DE
                             A     3424 
00000A5E 2A 1A 00            A     3425 L0A5F:  LD		HL,(HLD)				; HLD
00000A61 2D                  A     3426 	DEC		L
00000A62 28 04               A     3427 	JR		Z,L0A69					; forward when full
                             A     3428 
00000A64 22 1A 00            A     3429 	LD		(HLD),HL				; update HLD
00000A67 73                  A     3430 	LD		(HL),E					; and place character in buffer
                             A     3431 
00000A68 FD E9               A     3432 L0A69:  JP		(IY)					; to 'next'.
                             A     3433 
                             A     3434 ; ----------------
                             A     3435 ; THE 'SPACE' WORD
                             A     3436 ; ----------------
                             A     3437 ; (  --  )
                             A     3438 ; EMITs a space.
                             A     3439 
                             A     3440 L0A6B:  DEFM	"SPAC"					; 'name field'
00000A6A 53 50 41 43         A+    3440 	DB P1
                             A     3441 	DEFB	'E'+080h
00000A6E C5                  A+    3441 	DB P1
                             A     3442 
                             A     3443 	DEFW	L0A5B					; 'link field'
00000A6F 5A 0A               A+    3443 	DW P1
                             A     3444 
                             A     3445 L0A72:  DEFB	005h						; 'name length field'
00000A71 05                  A+    3445 	DB P1
                             A     3446 
                             A     3447 L0A73:  DEFW	L0A75					; 'code field'
00000A72 74 0A               A+    3447 	DW P1
                             A     3448 
                             A     3449 ; ---
                             A     3450 
00000A74 3E 20               A     3451 L0A75:  LD		A,020h					; load accumulator with the ASCII
                             A     3452 					; code for space.
00000A76 CF                  A     3453 	RST		08H						; print_ch
                             A     3454 
00000A77 FD E9               A     3455 L0A78:  JP		(IY)					; to 'next'.
                             A     3456 
                             A     3457 ; -----------------
                             A     3458 ; THE 'SPACES' WORD
                             A     3459 ; -----------------
                             A     3460 ; (n -- )
                             A     3461 ; EMITs n spaces if n >= 1.
                             A     3462 
                             A     3463 L0A7A:  DEFM	"SPACE"					; 'name field'
00000A79 53 50 41 43 45      A+    3463 	DB P1
                             A     3464 	DEFB	'S'+080h
00000A7E D3                  A+    3464 	DB P1
                             A     3465 
                             A     3466 	DEFW	L0A72					; 'link field'
00000A7F 71 0A               A+    3466 	DW P1
                             A     3467 
                             A     3468 L0A82:  DEFB	006h						; 'name length field'
00000A81 06                  A+    3468 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   72


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3469 
                             A     3470 	DEFW	L0A85					; 'code field'
00000A82 84 0A               A+    3470 	DW P1
                             A     3471 
                             A     3472 ; ---
                             A     3473 
00000A84 DF                  A     3474 L0A85:  RST		18H						; fetch stack data to DE
                             A     3475 
00000A85 1B                  A     3476 L0A86:  DEC		DE						; decrement the counter.
00000A86 CB 7A               A     3477 	BIT		7,D						; test for a negative value
00000A88 20 ED               A     3478 	JR		NZ,L0A78				; back to a jp iy  when done	>>
                             A     3479 
00000A8A 3E 20               A     3480 	LD		A,020h					; prepare a space
00000A8C CF                  A     3481 	RST		08H						; print it
00000A8D 18 F6               A     3482 	JR		L0A86					; loop back for more.
                             A     3483 
                             A     3484 ; -------------
                             A     3485 ; THE 'CR' WORD
                             A     3486 ; -------------
                             A     3487 ; Outputs a carriage return character to the television.
                             A     3488 
                             A     3489 L0A90:  DEFB	'C'						; 'name field'
00000A8F 43                  A+    3489 	DB P1
                             A     3490 	DEFB	'R'+080h
00000A90 D2                  A+    3490 	DB P1
                             A     3491 
                             A     3492 	DEFW	L0A82					; 'link field'
00000A91 81 0A               A+    3492 	DW P1
                             A     3493 
                             A     3494 L0A94:  DEFB	002h						; 'name length field'
00000A93 02                  A+    3494 	DB P1
                             A     3495 
                             A     3496 L0A95:  DEFW	L0A97					; 'code field'
00000A94 96 0A               A+    3496 	DW P1
                             A     3497 
                             A     3498 ; ---
                             A     3499 
00000A96 3E 0D               A     3500 L0A97:  LD		A,00Dh					; prepare a CR
00000A98 CF                  A     3501 	RST		08H						; print it.
                             A     3502 
00000A99 FD E9               A     3503 	JP		(IY)					; to 'next'.
                             A     3504 
                             A     3505 ; ---------------
                             A     3506 ; THE 'EMIT' WORD
                             A     3507 ; ---------------
                             A     3508 ; (character -- )
                             A     3509 ; writes the character to the television screen.
                             A     3510 
                             A     3511 L0A9C:  DEFM	"EMI"					; 'name field'
00000A9B 45 4D 49            A+    3511 	DB P1
                             A     3512 	DEFB	'T'+080h
00000A9E D4                  A+    3512 	DB P1
                             A     3513 
                             A     3514 	DEFW	L0A94					; 'link field'
00000A9F 93 0A               A+    3514 	DW P1
                             A     3515 
                             A     3516 L0AA2:  DEFB	004h						; 'name length field'
00000AA1 04                  A+    3516 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   73


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3517 
                             A     3518 L0AA3:  DEFW	L0AA5					; 'code field'
00000AA2 A4 0A               A+    3518 	DW P1
                             A     3519 
                             A     3520 ; ---
                             A     3521 
00000AA4 DF                  A     3522 L0AA5:  RST		18H						; pop de off data stack
00000AA5 7B                  A     3523 	LD		A,E						; character to A
00000AA6 CF                  A     3524 	RST		08H						; print it.
                             A     3525 
00000AA7 FD E9               A     3526 	JP		(IY)					; to 'next'.
                             A     3527 
                             A     3528 
                             A     3529 ; -------------
                             A     3530 ; THE 'F.' WORD
                             A     3531 ; -------------
                             A     3532 ; (f -- )
                             A     3533 ; print a floating point number.
                             A     3534 ; If 1.0E-4 <= f < 1.0E9, then f is printed without an exponent and with a
                             A     3535 ; decimal point in the appropriate place. If f is outside this range, then
                             A     3536 ; it is printed in standard form f'En where 0 <= f' < 10 and -64 <= n <= 62.
                             A     3537 ; Input may be either form, but only six significant digits are accepted -
                             A     3538 ; further digits are ignored.
                             A     3539 ; Floating point numbers are stored as 3 bytes of binary coded decimal
                             A     3540 ; mantissa and 1 byte for sign and decimal exponents.
                             A     3541 ;
                             A     3542 ; e.g. the number 123.456 on Data Stack would be two words, four bytes.
                             A     3543 ;
                             A     3544 ;		^		43				01000011   bits 5 - 0 are exponent
                             A     3545 ;		|		12		BCD		||
                             A     3546 ;		|		34		BCD		|sign of exponent 1=positive (bit 6)
                             A     3547 ;		|		56		BCD		sign of number 0=positive (bit 7)
                             A     3548 ;
                             A     3549 ; Zero 0. is a special case floating point number with all four bytes set 
                             A     3550 ; to zero.
                             A     3551 
                             A     3552 
                             A     3553 L0AAA:  DEFB	'F'						; 'name field'
00000AA9 46                  A+    3553 	DB P1
                             A     3554 	DEFB	'.'+080h
00000AAA AE                  A+    3554 	DB P1
                             A     3555 
                             A     3556 	DEFW	00AA2h					; 'link field'
00000AAB A2 0A               A+    3556 	DW P1
                             A     3557 
                             A     3558 L0AAE:  DEFB	002h						; 'name length field'
00000AAD 02                  A+    3558 	DB P1
                             A     3559 
                             A     3560 L0AAF:  DEFW	00AB1h					; 'code field'
00000AAE B1 0A               A+    3560 	DW P1
                             A     3561 
                             A     3562 ; ---
                             A     3563 
00000AB0 2A 3B 00            A     3564 L0AB1:  LD		HL,(SPARE)				; set pointer from system variable SPARE
00000AB3 2B                  A     3565 	DEC		HL						; now points to last byte of data stack.
00000AB4 CB 7E               A     3566 	BIT		7,(HL)					; test sign of number.
00000AB6 CB BE               A     3567 	RES		7,(HL)					; reset the sign bit.
00000AB8 28 03               A     3568 	JR		Z,L0ABE					; forward if initially positive.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   74


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3569 
00000ABA 3E 2D               A     3570 	LD		A,02Dh					; prepare  the '-' character.
00000ABC CF                  A     3571 	RST		08H						; print the minus sign.
                             A     3572 
                             A     3573 ; The E register is initialized to zero to denote not E-FORMAT 
                             A     3574 
00000ABD 1E 00               A     3575 L0ABE:  LD		E,000h					; signal not scientific notation.
                             A     3576 
00000ABF 7E                  A     3577 	LD		A,(HL)					; fetch exponent byte
00000AC0 3D                  A     3578 	DEC		A						; adjust to make zero 0FFh
                             A     3579 
00000AC1 FE 49               A     3580 	CP		049h						; compare to +9   e.g.  123456000.
00000AC3 30 04               A     3581 	JR		NC,L0ACA				; skip forward if out of range.
                             A     3582 
00000AC5 FE 3C               A     3583 	CP		03Ch						; compare to -4   e.g  .000123456
00000AC7 30 04               A     3584 	JR		NC,L0ACE				; skip forward if in range.
                             A     3585 
                             A     3586 ; else E format printing will be used with decimal point after first digit.
                             A     3587 
00000AC9 36 41               A     3588 L0ACA:  LD		(HL),041h				; make Data Stack exponent +1
00000ACB 3C                  A     3589 	INC		A						; restore true exponent byte
00000ACC 5F                  A     3590 	LD		E,A						; transfer to E.
                             A     3591 
                             A     3592 ; the branch was here when within range for normal printing.
                             A     3593 
00000ACD 3E 40               A     3594 L0ACE:  LD		A,040h					; test value is plus zero.
00000ACF 96                  A     3595 	SUB		(HL)					; subtract signed exponent.
00000AD0 38 09               A     3596 	JR		C,L0ADC					; forward if positive
                             A     3597 
                             A     3598 ; exponent is negative so decimal point comes first. e.g. .001
                             A     3599 
00000AD2 47                  A     3600 	LD		B,A						; result of subtraction to B.
00000AD3 04                  A     3601 	INC		B						; B is now one less than count of 
                             A     3602 					; leading zeros.
                             A     3603 
00000AD4 3E 2E               A     3604 	LD		A,02Eh					; prepare '.'
                             A     3605 
00000AD6 CF                  A     3606 L0AD7:  RST		08H						; print decimal point or zero.
                             A     3607 
00000AD7 3E 30               A     3608 	LD		A,030h					; prepare a zero - '0'
                             A     3609 
00000AD9 10 FB               A     3610 	DJNZ	L0AD7					; loop back to print leading zeros 
                             A     3611 					; unless the counter was 1.
                             A     3612 
                             A     3613 ; the branch was here with positive exponent (and zero)
                             A     3614 ; now enter a loop to print each of the leading BCD digits
                             A     3615 ; the loop will end when the exponent is <= +0 and all 6 nibbles contain zero. 
                             A     3616 
00000ADB 3E 40               A     3617 L0ADC:  LD		A,040h					; set accumulator to plus 0
00000ADD BE                  A     3618 	CP		(HL)					; compare to exponent on data stack.
00000ADE 9F                  A     3619 	SBC		A,A						; 0FFh if more leading digits else 000h.
00000ADF 2B                  A     3620 	DEC		HL						; address first two nibbles.
00000AE0 B6                  A     3621 	OR		(HL)					; combine.
00000AE1 2B                  A     3622 	DEC		HL						; address next two nibbles.
00000AE2 B6                  A     3623 	OR		(HL)					; combine.
00000AE3 2B                  A     3624 	DEC		HL						; address last two nibbles.
00000AE4 B6                  A     3625 	OR		(HL)					; combine.
                             A     3626 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   75


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000AE5 23                  A     3627 	INC		HL						; adjust the pointer to
00000AE6 23                  A     3628 	INC		HL						; the start of the mantissa.
                             A     3629 
00000AE7 28 12               A     3630 	JR		Z,L0AFC					; forward if all digits have been 
                             A     3631 					; printed.
                             A     3632 
                             A     3633 ; else print each binary coded decimal in turn.
                             A     3634 
00000AE9 AF                  A     3635 	XOR		A						; prepare to feed a zero nibble in.
                             A     3636 
00000AEA CD 32 07            A     3637 	CALL	L0732					; routine shift_fp extracts the most 
                             A     3638 					; significant nibble from the 3 bytes
                             A     3639 					; also decrementing the exponent.
                             A     3640 
00000AED C6 30               A     3641 	ADD		A,030h					; convert to ASCII
00000AEF CF                  A     3642 	RST		08H						; print digit
                             A     3643 
00000AF0 23                  A     3644 	INC		HL						; point to reduced exponent.
00000AF1 7E                  A     3645 	LD		A,(HL)					; fetch to accumulator and
00000AF2 FE 40               A     3646 	CP		040h						; compare to zero.
                             A     3647 
00000AF4 20 E5               A     3648 	JR		NZ,L0ADC				; loop back while more digits.
                             A     3649 
                             A     3650 ; else this is the place to print the mid or trailing decimal point.
                             A     3651 
00000AF6 3E 2E               A     3652 	LD		A,02Eh					; prepare '.'
00000AF8 CF                  A     3653 	RST		08H						; print it.
                             A     3654 
00000AF9 18 E0               A     3655 	JR		L0ADC					; loop back for end test and any digits
                             A     3656 					; following the decimal point.
                             A     3657 
                             A     3658 ; ---
                             A     3659 
                             A     3660 ; the branch was to here when all digits of the mantissa have been printed.
                             A     3661 
00000AFB 7B                  A     3662 L0AFC:  LD		A,E						; fetch the exponent format flag - from
                             A     3663 					; the E register appropriately.
00000AFC A7                  A     3664 	AND		A						; test for zero - normal format.
00000AFD 20 05               A     3665 	JR		NZ,L0B05				; forward to E_FORMAT if not.
                             A     3666 
00000AFF 3E 20               A     3667 	LD		A,020h					; else prepare a space
00000B01 CF                  A     3668 	RST		08H						; print it
                             A     3669 
00000B02 18 0B               A     3670 	JR		L0B10					; forward to delete the two words from 
                             A     3671 					; the data stack and exit.
                             A     3672 
                             A     3673 ; ---
                             A     3674 
                             A     3675 ; this branch deals with scientific notation. The accumulator holds the
                             A     3676 ; original exponent. 001h-03Ch (negative) 049h-07Fh (positive).
                             A     3677 
00000B04 D6 41               A     3678 L0B05:  SUB		041h						; convert to signed 8-bit.
00000B06 6F                  A     3679 	LD		L,A						; low order byte to L.
00000B07 9F                  A     3680 	SBC		A,A						; 0FFh negative or 000h positive
00000B08 67                  A     3681 	LD		H,A						; set the high order byte.
                             A     3682 
00000B09 3E 45               A     3683 	LD		A,045h					; prepare a 'E'
00000B0B CF                  A     3684 	RST		08H						; print it
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   76


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3685 
00000B0C CD 0D 18            A     3686 	CALL	L180E					; routine pr_int_hl prints the signed 
                             A     3687 					; integer followed by a space.
                             A     3688 
                             A     3689 ; finally delete the floating point number from the Data Stack.
                             A     3690 
                             A     3691 
00000B0F DF                  A     3692 L0B10:  RST		18H						; unstack word DE
00000B10 DF                  A     3693 	RST		18H						; unstack word DE
                             A     3694 
00000B11 FD E9               A     3695 	JP		(IY)					; to 'next'.
                             A     3696 
                             A     3697 ; -------------
                             A     3698 ; THE 'AT' WORD
                             A     3699 ; -------------
                             A     3700 ; (line, column -- )
                             A     3701 ; Sets print position to line and column numbers on the stack.
                             A     3702 ; There are 23 lines (0 to 22) and 32 columns (0 to 31). The
                             A     3703 ; column number is taken modulo 32, and ERROR 9 if trying to print
                             A     3704 ; in the input buffer at the bottom.
                             A     3705 
                             A     3706 L0B14:  DEFB	'A'						; 'name field'
00000B13 41                  A+    3706 	DB P1
                             A     3707 	DEFB	'T'+080h
00000B14 D4                  A+    3707 	DB P1
                             A     3708 
                             A     3709 	DEFW	L0AAE					; 'link field'
00000B15 AD 0A               A+    3709 	DW P1
                             A     3710 
                             A     3711 L0B18:  DEFB	002h						; 'name length field'
00000B17 02                  A+    3711 	DB P1
                             A     3712 
                             A     3713 	DEFW	L0B1B					; 'code field'
00000B18 1A 0B               A+    3713 	DW P1
                             A     3714 
                             A     3715 ; ---
                             A     3716 
00000B1A DF                  A     3717 L0B1B:  RST		18H						; pop word DE
                             A     3718 
00000B1B CD 4D 08            A     3719 	CALL	L084E					; stk_to_bc
                             A     3720 
00000B1E 79                  A     3721 	LD		A,C
                             A     3722 
00000B1F CD 27 0B            A     3723 	CALL	L0B28					;
                             A     3724 
00000B22 22 1C 00            A     3725 	LD		(SCRPOS),HL				; update system variable SCRPOS
                             A     3726 
00000B25 FD E9               A     3727 	JP		(IY)					; to 'next'.
                             A     3728 
                             A     3729 ; ---
                             A     3730 
                             A     3731 ; plotsub
                             A     3732 
00000B27 C6 20               A     3733 L0B28:  ADD		A,020h
00000B29 6F                  A     3734 	LD		L,A
00000B2A 26 01               A     3735 	LD		H,001h
00000B2C 29                  A     3736 	ADD		HL,HL
00000B2D 29                  A     3737 	ADD		HL,HL
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   77


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000B2E 29                  A     3738 	ADD		HL,HL
00000B2F 29                  A     3739 	ADD		HL,HL
00000B30 29                  A     3740 	ADD		HL,HL
00000B31 16 00               A     3741 	LD		D,000h
00000B33 7B                  A     3742 	LD		A,E
00000B34 E6 1F               A     3743 	AND		01Fh
00000B36 5F                  A     3744 	LD		E,A
00000B37 19                  A     3745 	ADD		HL,DE
00000B38 ED 5B 24 00         A     3746 	LD		DE,(L_HALF)				; fetch start of lower half from L_HALF
00000B3C ED 52               A     3747 	SBC		HL,DE
00000B3E 19                  A     3748 	ADD		HL,DE
00000B3F D8                  A     3749 	RET		C
                             A     3750 
                             A     3751 ;
                             A     3752 
00000B40 E7                  A     3753 	RST		20H						; Error 9
                             A     3754 	DEFB	009h						; Erroneous 'AT' Command.
00000B41 09                  A+    3754 	DB P1
                             A     3755 
                             A     3756 ; ---------------
                             A     3757 ; THE 'PLOT' WORD
                             A     3758 ; ---------------
                             A     3759 ; (x, y, n -- )
                             A     3760 ; Plots pixel (x, y) with plot mode n.
                             A     3761 ; n =   0		unplot
                             A     3762 ;		1		plot
                             A     3763 ;		2		move
                             A     3764 ;		3		change
                             A     3765 ; If n>3, takes value modulo 4.
                             A     3766 
                             A     3767 L0B43:  DEFM	"PLO"					; 'name field'
00000B42 50 4C 4F            A+    3767 	DB P1
                             A     3768 	DEFB	'T'+080h
00000B45 D4                  A+    3768 	DB P1
                             A     3769 
                             A     3770 	DEFW	L0B18					; 'link field'
00000B46 17 0B               A+    3770 	DW P1
                             A     3771 
                             A     3772 L0B49:  DEFB	004h						; 'name length field'
00000B48 04                  A+    3772 	DB P1
                             A     3773 
                             A     3774 	DEFW	L0B4C					; 'code field'
00000B49 4B 0B               A+    3774 	DW P1
                             A     3775 
                             A     3776 ; ---
                             A     3777 
00000B4B CD 4D 08            A     3778 L0B4C:  CALL	L084E					; stk_to_bc
                             A     3779 
00000B4E DF                  A     3780 	RST		18H						; pop word DE
00000B4F DD 73 30            A     3781 	LD		(IX+030h),E				; YCOORD
00000B52 CB 3B               A     3782 	SRL		E
00000B54 CB 11               A     3783 	RL		C
00000B56 3E 16               A     3784 	LD		A,016h					; 24
00000B58 93                  A     3785 	SUB		E
                             A     3786 
00000B59 DF                  A     3787 	RST		18H						; pop word DE
00000B5A DD 73 2F            A     3788 	LD		(IX+02Fh),E				; XCOORD
00000B5D CB 3B               A     3789 	SRL		E
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   78


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000B5F CB 11               A     3790 	RL		C
                             A     3791 
00000B61 CD 27 0B            A     3792 	CALL	L0B28					;
                             A     3793 
00000B64 7E                  A     3794 	LD		A,(HL)
00000B65 E6 78               A     3795 	AND		078h						; 01111000
00000B67 FE 10               A     3796 	CP		010h
00000B69 7E                  A     3797 	LD		A,(HL)
00000B6A 28 02               A     3798 	JR		Z,L0B6F					;
                             A     3799 
00000B6C 3E 10               A     3800 	LD		A,010h
                             A     3801 
00000B6E 5F                  A     3802 L0B6F:  LD		E,A
00000B6F 16 87               A     3803 	LD		D,087h
00000B71 79                  A     3804 	LD		A,C
00000B72 E6 03               A     3805 	AND		003h
00000B74 47                  A     3806 	LD		B,A
00000B75 28 07               A     3807 	JR		Z,L0B7F					;
                             A     3808 
00000B77 2F                  A     3809 	CPL
                             A     3810 
00000B78 C6 02               A     3811 	ADD		A,002h
00000B7A CE 03               A     3812 	ADC		A,003h
00000B7C 57                  A     3813 	LD		D,A
00000B7D 43                  A     3814 	LD		B,E
00000B7E 79                  A     3815 L0B7F:  LD		A,C
00000B7F 0F                  A     3816 	RRCA
00000B80 0F                  A     3817 	RRCA
00000B81 0F                  A     3818 	RRCA
00000B82 9F                  A     3819 	SBC		A,A
00000B83 CB 59               A     3820 	BIT		3,C
00000B85 20 04               A     3821 	JR		NZ,L0B8C				;
00000B87 AB                  A     3822 	XOR		E
00000B88 07                  A     3823 	RLCA
00000B89 9F                  A     3824 	SBC		A,A
00000B8A A8                  A     3825 	XOR		B
                             A     3826 
00000B8B A2                  A     3827 L0B8C:  AND		D
00000B8C AB                  A     3828 	XOR		E
00000B8D 77                  A     3829 	LD		(HL),A
00000B8E FD E9               A     3830 	JP		(IY)					; to 'next'.
                             A     3831 
                             A     3832 ; ---------------
                             A     3833 ; THE 'BEEP' WORD
                             A     3834 ; ---------------
                             A     3835 ; ( m, n --  )
                             A     3836 ; Plays a note on the loudspeaker. 8 * m = period in microseconds,
                             A     3837 ; n = time in milliseconds.
                             A     3838 
                             A     3839 L0B91:  DEFM	"BEE"					; 'name field'
00000B90 42 45 45            A+    3839 	DB P1
                             A     3840 	DEFB	'P'+080h
00000B93 D0                  A+    3840 	DB P1
                             A     3841 
                             A     3842 	DEFW	L0B49					; 'link field'
00000B94 48 0B               A+    3842 	DW P1
                             A     3843 
                             A     3844 L0B97:  DEFB	004h						; 'name length field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   79


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000B96 04                  A+    3844 	DB P1
                             A     3845 
                             A     3846 	DEFW	L0EC3					; 'code field'  m, n.
00000B97 C2 0E               A+    3846 	DW P1
                             A     3847 
                             A     3848 ; ---
                             A     3849 
                             A     3850 L0B9A:  DEFW	L0912					; OVER			m, n, m.
00000B99 11 09               A+    3850 	DW P1
                             A     3851 	DEFW	L104B					; stk-data		m, n, m, 125.
00000B9B 4A 10               A+    3851 	DW P1
                             A     3852 	DEFB	07Dh						;  (125)
00000B9D 7D                  A+    3852 	DB P1
                             A     3853 	DEFW	L0885					; SWAP			m, n, 125, m.
00000B9E 84 08               A+    3853 	DW P1
                             A     3854 	DEFW	L0D7A					; */			m, (n*125)/m
00000BA0 79 0D               A+    3854 	DW P1
                             A     3855 	DEFW	L1A0E					; end
00000BA2 0D 1A               A+    3855 	DW P1
                             A     3856 
                             A     3857 ; ---
                             A     3858 
00000BA4 DF                  A     3859 L0BA5:  RST		18H						; pop word DE
                             A     3860 
00000BA5 CD 4D 08            A     3861 	CALL	L084E					; stk_to_bc
                             A     3862 
00000BA8 21 F9 00            A     3863 	LD		HL,000F9h				;
00000BAB 09                  A     3864 	ADD		HL,BC					;
00000BAC 2C                  A     3865 	INC		L						;
                             A     3866 
00000BAD F3                  A     3867 	DI								; Disable Interrupts.
                             A     3868 
00000BAE 3E 7F               A     3869 L0BAF:  LD		A,07Fh					; place 07FFEh on address bus and read
00000BB0 DB FE               A     3870 	IN		A,(0FEh)					; from port, pushing the loudspeaker
                             A     3871 					; diaphragm in.
                             A     3872 
00000BB2 0F                  A     3873 	RRCA							; test the read 'SPACE' key bit.
                             A     3874 
00000BB3 30 11               A     3875 	JR		NC,L0BC7				; forward if BREAK pressed.
                             A     3876 
00000BB5 CD C8 0B            A     3877 	CALL	L0BC9					; routine delay_HL
                             A     3878 
00000BB8 1B                  A     3879 	DEC		DE						; decrement counter.
                             A     3880 
00000BB9 7A                  A     3881 	LD		A,D						; all even addresses are reserved for 
                             A     3882 					; Jupiter Ace so any value does for the
                             A     3883 					; high order byte. 0FEh is low value.
                             A     3884 
00000BBA D3 FE               A     3885 	OUT		(0FEh),A					; push the loudspeaker diaphragm out.
                             A     3886 
00000BBC CD C8 0B            A     3887 	CALL	L0BC9					; routine delay_HL
                             A     3888 
00000BBF B3                  A     3889 	OR		E						; test for counter DE reaching zero.
00000BC0 C2 AE 0B            A     3890 	JP		NZ,L0BAF				; loop back if not.
                             A     3891 
00000BC3 FB                  A     3892 	EI								; Enable Interrupts.
                             A     3893 
00000BC4 FD E9               A     3894 	JP		(IY)					; to 'next'.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   80


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3895 
                             A     3896 ; ---
                             A     3897 
00000BC6 E7                  A     3898 L0BC7:  RST		20H						; Error 3
                             A     3899 	DEFB	003h						; BREAK pressed.
00000BC7 03                  A+    3899 	DB P1
                             A     3900 
                             A     3901 ; ---------------------------
                             A     3902 ; THE 'BEEP DELAY' SUBROUTINE
                             A     3903 ; ---------------------------
                             A     3904 ; called twice from the above BEEP routine.
                             A     3905 
00000BC8 45                  A     3906 L0BC9:  LD		B,L						; transfer the value of
00000BC9 4C                  A     3907 	LD		C,H						; the HL register to BC.
                             A     3908 
00000BCA 10 FE               A     3909 L0BCB:  DJNZ	L0BCB					; self-loop for B times
                             A     3910 
00000BCC 05                  A     3911 	DEC		B						; set B to 0FFh for future loops
00000BCD 0D                  A     3912 	DEC		C						; decrement outer loop counter C
00000BCE C2 CA 0B            A     3913 	JP		NZ,L0BCB				; JUMP back if not zero			(10)
                             A     3914 
00000BD1 C9                  A     3915 	RET								; return
                             A     3916 
                             A     3917 ; ----------------
                             A     3918 ; THE 'INKEY' WORD
                             A     3919 ; ----------------
                             A     3920 ; ( -- ASCII code)
                             A     3921 ; Reads the keyboard. Puts ASCII value on the stack if a key is pressed, 0
                             A     3922 ; otherwise.
                             A     3923 
                             A     3924 
                             A     3925 L0BD3:  DEFM	"INKE"					; 'name field'
00000BD2 49 4E 4B 45         A+    3925 	DB P1
                             A     3926 	DEFB	'Y'+080h
00000BD6 D9                  A+    3926 	DB P1
                             A     3927 
                             A     3928 	DEFW	L0B97					; 'link field'
00000BD7 96 0B               A+    3928 	DW P1
                             A     3929 
                             A     3930 L0BDA:  DEFB	005h						; 'name length field'
00000BD9 05                  A+    3930 	DB P1
                             A     3931 
                             A     3932 L0BDB:  DEFW	L0BDD					; 'code field'
00000BDA DC 0B               A+    3932 	DW P1
                             A     3933 
                             A     3934 ; ---
                             A     3935 
00000BDC CD 36 03            A     3936 L0BDD:  CALL	L0336					; routine KEY-SCAN
                             A     3937 
00000BDF 5F                  A     3938 	LD		E,A						; transfer the key code to E.
00000BE0 16 00               A     3939 	LD		D,000h					; make high order byte zero.
                             A     3940 
00000BE2 D7                  A     3941 	RST		10H						; stack Data Word DE
                             A     3942 
00000BE3 FD E9               A     3943 	JP		(IY)					; to 'next'.
                             A     3944 
                             A     3945 ; -------------
                             A     3946 ; THE 'IN' WORD
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   81


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     3947 ; -------------
                             A     3948 ; (port address -- data byte)
                             A     3949 ; Inputs a data byte from an I/O port.
                             A     3950 
                             A     3951 L0BE6:  DEFB	'I'						; 'name field'
00000BE5 49                  A+    3951 	DB P1
                             A     3952 	DEFB	'N'+080h
00000BE6 CE                  A+    3952 	DB P1
                             A     3953 
                             A     3954 	DEFW	L0BDA					; 'link field'
00000BE7 D9 0B               A+    3954 	DW P1
                             A     3955 
                             A     3956 L0BEA:  DEFB	002h						; 'name length field'
00000BE9 02                  A+    3956 	DB P1
                             A     3957 
                             A     3958 	DEFW	L0BED					; 'code field'
00000BEA EC 0B               A+    3958 	DW P1
                             A     3959 
                             A     3960 ; ---
                             A     3961 
00000BEC CD 4D 08            A     3962 L0BED:  CALL	L084E					; stk_to_bc
00000BEF 16 00               A     3963 	LD		D,000h					; make high order byte zero.
                             A     3964 
00000BF1 ED 58               A     3965 	IN		E,(C)					; read the port to E.
                             A     3966 
00000BF3 D7                  A     3967 	RST		10H						; stack Data Word DE.
                             A     3968 
00000BF4 FD E9               A     3969 L0BF5:  JP		(IY)					; to 'next'.
                             A     3970 
                             A     3971 ; --------------
                             A     3972 ; THE 'OUT' WORD
                             A     3973 ; --------------
                             A     3974 ; (data byte, port address -- )
                             A     3975 ; Outputs a data byte to an I/O port.
                             A     3976 
                             A     3977 L0BF7:  DEFM	"OU"					; 'name field'
00000BF6 4F 55               A+    3977 	DB P1
                             A     3978 	DEFB	'T'+080h
00000BF8 D4                  A+    3978 	DB P1
                             A     3979 
                             A     3980 	DEFW	L0BEA					; 'link field'
00000BF9 E9 0B               A+    3980 	DW P1
                             A     3981 
                             A     3982 L0BFC:  DEFB	003h						; 'name length field'
00000BFB 03                  A+    3982 	DB P1
                             A     3983 
                             A     3984 	DEFW	L0BFF					; 'code field'
00000BFC FE 0B               A+    3984 	DW P1
                             A     3985 
                             A     3986 ; ---
                             A     3987 
00000BFE CD 4D 08            A     3988 L0BFF:  CALL	L084E					; stk_to_bc
                             A     3989 					; all 16 bits are placed on the
                             A     3990 					; Z80A address bus.
00000C01 DF                  A     3991 	RST		18H						; pop word DE
                             A     3992 
00000C02 ED 59               A     3993 	OUT		(C),E					; output byte to port address.
                             A     3994 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   82


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000C04 FD E9               A     3995 	JP		(IY)					; to 'next'.
                             A     3996 
                             A     3997 ; --------------
                             A     3998 ; THE 'ABS' WORD
                             A     3999 ; --------------
                             A     4000 ; (n -- absolute value of n)
                             A     4001 
                             A     4002 L0C07:  DEFM	"AB"					; 'name field'
00000C06 41 42               A+    4002 	DB P1
                             A     4003 	DEFB	'S'+080h
00000C08 D3                  A+    4003 	DB P1
                             A     4004 
                             A     4005 	DEFW	L0BFC					; 'link field'
00000C09 FB 0B               A+    4005 	DW P1
                             A     4006 
                             A     4007 L0C0C:  DEFB	003h						; 'name length field'
00000C0B 03                  A+    4007 	DB P1
                             A     4008 
                             A     4009 L0C0D:  DEFW	L0EC3					; 'code field' - docolon
00000C0C C2 0E               A+    4009 	DW P1
                             A     4010 
                             A     4011 ; ---
                             A     4012 
                             A     4013 	DEFW	L086B					; DUP
00000C0E 6A 08               A+    4013 	DW P1
                             A     4014 	DEFW	L0D94					; pos
00000C10 93 0D               A+    4014 	DW P1
                             A     4015 	DEFW	L04B6					; EXIT
00000C12 B6 04               A+    4015 	DW P1
                             A     4016 
                             A     4017 ; -------------
                             A     4018 ; THE '0=' WORD
                             A     4019 ; -------------
                             A     4020 ; (n -- flag)
                             A     4021 ; flag is 1 in n = 0.
                             A     4022 
                             A     4023 L0C15:  DEFB	'0'						; 'name field'
00000C14 30                  A+    4023 	DB P1
                             A     4024 	DEFB	'='+080h
00000C15 BD                  A+    4024 	DB P1
                             A     4025 
                             A     4026 	DEFW	L0C0C					; 'link field'
00000C16 0B 0C               A+    4026 	DW P1
                             A     4027 
                             A     4028 L0C19:  DEFB	002h						; 'name length field'
00000C18 02                  A+    4028 	DB P1
                             A     4029 
                             A     4030 L0C1A:  DEFW	L0C1C					; 'code field'
00000C19 1B 0C               A+    4030 	DW P1
                             A     4031 
                             A     4032 ; ---
                             A     4033 
00000C1B DF                  A     4034 L0C1C:  RST		18H						; pop word DE
00000C1C 7A                  A     4035 	LD		A,D						; test for
00000C1D B3                  A     4036 	OR		E						; zero
00000C1E FE 01               A     4037 	CP		001h						; sets carry if word is zero
                             A     4038 
                             A     4039 ; -> zero_or_one
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   83


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4040 
00000C20 3E 00               A     4041 L0C21:  LD		A,000h					; make accumulator zero.
00000C22 57                  A     4042 	LD		D,A						; set D to zero
00000C23 17                  A     4043 	RLA								; pick up carry (1/0)
00000C24 5F                  A     4044 	LD		E,A						; set DE to one or zero
00000C25 D7                  A     4045 	RST		10H						; push word DE
                             A     4046 
00000C26 FD E9               A     4047 	JP		(IY)					; to 'next'.
                             A     4048 
                             A     4049 ; -------------
                             A     4050 ; THE '0<' WORD
                             A     4051 ; -------------
                             A     4052 ; (n -- flag)
                             A     4053 ; flag is 1 if n is negative
                             A     4054 
                             A     4055 L0C29:  DEFB	'0'						; 'name field'
00000C28 30                  A+    4055 	DB P1
                             A     4056 	DEFB	'<'+080h
00000C29 BC                  A+    4056 	DB P1
                             A     4057 
                             A     4058 	DEFW	L0C19					; 'link field'
00000C2A 18 0C               A+    4058 	DW P1
                             A     4059 
                             A     4060 L0C2D:  DEFB	002h						; 'name length field'
00000C2C 02                  A+    4060 	DB P1
                             A     4061 
                             A     4062 L0C2E:  DEFW	L0C30					; 'code field'
00000C2D 2F 0C               A+    4062 	DW P1
                             A     4063 
                             A     4064 ; ---
                             A     4065 
00000C2F DF                  A     4066 L0C30:  RST		18H						; pop word DE
00000C30 CB 12               A     4067 	RL		D						; test the sign bit.
                             A     4068 
00000C32 18 EC               A     4069 	JR		L0C21					; back to above routine to stack the
                             A     4070 					; carry as one (true) or zero (false).
                             A     4071 
                             A     4072 ; -------------
                             A     4073 ; THE '0>' WORD
                             A     4074 ; -------------
                             A     4075 ; (n -- flag)
                             A     4076 ; flag is 1 if n is positive.
                             A     4077 
                             A     4078 
                             A     4079 L0C35:  DEFB	'0'						; 'name field'
00000C34 30                  A+    4079 	DB P1
                             A     4080 	DEFB	'>'+080h
00000C35 BE                  A+    4080 	DB P1
                             A     4081 
                             A     4082 	DEFW	L0C2D					; 'link field'
00000C36 2C 0C               A+    4082 	DW P1
                             A     4083 
                             A     4084 L0C39:  DEFB	002h						; 'name length field'
00000C38 02                  A+    4084 	DB P1
                             A     4085 
                             A     4086 L0C3A:  DEFW	L0C3C					; 'code field'
00000C39 3B 0C               A+    4086 	DW P1
                             A     4087 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   84


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4088 ; ---
                             A     4089 
00000C3B DF                  A     4090 L0C3C:  RST		18H						; pop word DE
00000C3C 7A                  A     4091 	LD		A,D
00000C3D B3                  A     4092 	OR		E
00000C3E 28 E0               A     4093 	JR		Z,L0C21					; to stack word one or zero
                             A     4094 
00000C40 CB 12               A     4095 	RL		D
00000C42 3F                  A     4096 	CCF
00000C43 18 DB               A     4097 	JR		L0C21					; to stack word one or zero
                             A     4098 
                             A     4099 ; ------------
                             A     4100 ; THE '=' WORD
                             A     4101 ; ------------
                             A     4102 ; (n1, n2 -- flag)
                             A     4103 ; flag is 1 if n1=n2.
                             A     4104 
                             A     4105 L0C46:  DEFB	'='+080h				; 'name field'
00000C45 BD                  A+    4105 	DB P1
                             A     4106 
                             A     4107 	DEFW	L0C39					; 'link field'
00000C46 38 0C               A+    4107 	DW P1
                             A     4108 
                             A     4109 L0C49:  DEFB	001h						; 'name length field'
00000C48 01                  A+    4109 	DB P1
                             A     4110 
                             A     4111 L0C4A:  DEFW	L0EC3					; 'code field' - docolon
00000C49 C2 0E               A+    4111 	DW P1
                             A     4112 
                             A     4113 ; ---
                             A     4114 
                             A     4115 L0C4C:  DEFW	L0DE1					; -
00000C4B E0 0D               A+    4115 	DW P1
                             A     4116 	DEFW	L0C1A					; 0=
00000C4D 19 0C               A+    4116 	DW P1
                             A     4117 	DEFW	L04B6					; exit
00000C4F B6 04               A+    4117 	DW P1
                             A     4118 
                             A     4119 ; ------------
                             A     4120 ; THE '>' WORD
                             A     4121 ; ------------
                             A     4122 ; (n1, n2 -- flag)
                             A     4123 ; flag is 1 if n1>n2.
                             A     4124 
                             A     4125 L0C52:  DEFB	'>'+080h				; 'name field'
00000C51 BE                  A+    4125 	DB P1
                             A     4126 
                             A     4127 	DEFW	L0C49					; 'link field'
00000C52 48 0C               A+    4127 	DW P1
                             A     4128 
                             A     4129 L0C55:  DEFB	001h						; 'name length field'
00000C54 01                  A+    4129 	DB P1
                             A     4130 
                             A     4131 L0C56:  DEFW	L0C58					; 'code field'
00000C55 57 0C               A+    4131 	DW P1
                             A     4132 
                             A     4133 ; ---
                             A     4134 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   85


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000C57 DF                  A     4135 L0C58:  RST		18H						; pop word DE
00000C58 D5                  A     4136 	PUSH	DE						;
00000C59 DF                  A     4137 	RST		18H						; pop word DE
00000C5A E1                  A     4138 	POP		HL						;
                             A     4139 
00000C5B CD 98 0C            A     4140 	CALL	L0C99					;
                             A     4141 
00000C5E 18 C0               A     4142 	JR		L0C21					; to stack word one or zero
                             A     4143 
                             A     4144 ; ------------
                             A     4145 ; THE '<' WORD
                             A     4146 ; ------------
                             A     4147 ; (n1, n2 -- flag)
                             A     4148 ; flag is 1 if n1 < n2.
                             A     4149 
                             A     4150 L0C61:  DEFB	'<'+080h				; 'name field'
00000C60 BC                  A+    4150 	DB P1
                             A     4151 
                             A     4152 	DEFW	L0C55					; 'link field'
00000C61 54 0C               A+    4152 	DW P1
                             A     4153 
                             A     4154 L0C64:  DEFB	001h						; 'name length field'
00000C63 01                  A+    4154 	DB P1
                             A     4155 
                             A     4156 L0C65:  DEFW	L0EC3					; 'code field' - docolon
00000C64 C2 0E               A+    4156 	DW P1
                             A     4157 
                             A     4158 ; ---
                             A     4159 
                             A     4160 	DEFW	L0885					; swap
00000C66 84 08               A+    4160 	DW P1
                             A     4161 	DEFW	L0C56					; >
00000C68 55 0C               A+    4161 	DW P1
                             A     4162 	DEFW	L04B6					; exit
00000C6A B6 04               A+    4162 	DW P1
                             A     4163 
                             A     4164 
                             A     4165 ; -------------
                             A     4166 ; THE 'U<' WORD
                             A     4167 ; -------------
                             A     4168 ; (un1, un2 -- flag)
                             A     4169 ; The flag is 1 if, of the two unsigned single length integers, un1 is less
                             A     4170 ; than un2.
                             A     4171 
                             A     4172 L0C6D:  DEFB	'U'						; 'name field'
00000C6C 55                  A+    4172 	DB P1
                             A     4173 	DEFB	'<'+080h
00000C6D BC                  A+    4173 	DB P1
                             A     4174 
                             A     4175 	DEFW	L0C64					; 'link field'
00000C6E 63 0C               A+    4175 	DW P1
                             A     4176 
                             A     4177 L0C71:  DEFB	002h						; 'name length field'
00000C70 02                  A+    4177 	DB P1
                             A     4178 
                             A     4179 L0C72:  DEFW	L0C74					; 'code field'
00000C71 73 0C               A+    4179 	DW P1
                             A     4180 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   86


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4181 ; ---
                             A     4182 
00000C73 CD 4D 08            A     4183 L0C74:  CALL	L084E					; stk_to_bc
                             A     4184 
00000C76 DF                  A     4185 L0C77:  RST		18H						; pop word DE
00000C77 EB                  A     4186 	EX		DE,HL
00000C78 A7                  A     4187 	AND		A
00000C79 ED 42               A     4188 	SBC		HL,BC
00000C7B 18 A3               A     4189 	JR		L0C21					; to stack word one or zero
                             A     4190 
                             A     4191 ; -------------
                             A     4192 ; THE 'D<' WORD
                             A     4193 ; -------------
                             A     4194 ; (d1, d2 -- flag)
                             A     4195 ; flag is 1 if the signed double integer, d1 < d2.
                             A     4196 
                             A     4197 L0C7E:  DEFB	'D'						; 'name field'
00000C7D 44                  A+    4197 	DB P1
                             A     4198 	DEFB	'<'+080h
00000C7E BC                  A+    4198 	DB P1
                             A     4199 
                             A     4200 	DEFW	L0C71					; 'link field'
00000C7F 70 0C               A+    4200 	DW P1
                             A     4201 
                             A     4202 L0C82:  DEFB	002h						; 'name length field'
00000C81 02                  A+    4202 	DB P1
                             A     4203 
                             A     4204 L0C83:  DEFW	L0C85					; 'code field'
00000C82 84 0C               A+    4204 	DW P1
                             A     4205 
                             A     4206 ; ---
                             A     4207 
00000C84 DF                  A     4208 L0C85:  RST		18H						; pop word DE
00000C85 D5                  A     4209 	PUSH	DE
00000C86 CD 4D 08            A     4210 	CALL	L084E					; stk_to_bc
00000C89 DF                  A     4211 	RST		18H						; pop word DE
00000C8A E1                  A     4212 	POP		HL
00000C8B A7                  A     4213 	AND		A
00000C8C ED 52               A     4214 	SBC		HL,DE
00000C8E 28 E6               A     4215 	JR		Z,L0C77					;
                             A     4216 
00000C90 19                  A     4217 	ADD		HL,DE
00000C91 EB                  A     4218 	EX		DE,HL
                             A     4219 
00000C92 CD 98 0C            A     4220 	CALL	L0C99					;
                             A     4221 
00000C95 DF                  A     4222 	RST		18H						; pop word DE
00000C96 18 88               A     4223 	JR		L0C21					; to stack word one or zero
                             A     4224 
                             A     4225 ; ---
                             A     4226 ; THE 'sign?' SUBROUTINE
                             A     4227 ; ---
                             A     4228 
00000C98 7C                  A     4229 L0C99:  LD		A,H
00000C99 AA                  A     4230 	XOR		D
00000C9A FA 9F 0C            A     4231 	JP		M,L0CA0					;
                             A     4232 
00000C9D ED 52               A     4233 	SBC		HL,DE
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   87


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4234 
00000C9F CB 14               A     4235 L0CA0:  RL		H
00000CA1 C9                  A     4236 	RET
                             A     4237 
                             A     4238 ; -------------
                             A     4239 ; THE 'U*' WORD
                             A     4240 ; -------------
                             A     4241 ; (un1, un2 -- double length(un1 * un2))
                             A     4242 ; Multiplies two unsigned single length integers to give an unsigned
                             A     4243 ; double length product.
                             A     4244 
                             A     4245 L0CA3:  DEFB	'U'						; 'name field'
00000CA2 55                  A+    4245 	DB P1
                             A     4246 	DEFB	'*'+080h
00000CA3 AA                  A+    4246 	DB P1
                             A     4247 
                             A     4248 	DEFW	L0C82					; 'link field'
00000CA4 81 0C               A+    4248 	DW P1
                             A     4249 
                             A     4250 L0CA7:  DEFB	002h						; 'name length field'
00000CA6 02                  A+    4250 	DB P1
                             A     4251 
                             A     4252 L0CA8:  DEFW	L0CAA					; 'code field'
00000CA7 A9 0C               A+    4252 	DW P1
                             A     4253 
                             A     4254 ; => mult
                             A     4255 
00000CA9 DF                  A     4256 L0CAA:  RST		18H						; pop word DE
00000CAA CD 4D 08            A     4257 	CALL	L084E					; stk_to_bc
00000CAD 21 00 00            A     4258 	LD		HL,00000h
00000CB0 3E 10               A     4259 	LD		A,010h
00000CB2 29                  A     4260 L0CB3:  ADD		HL,HL
00000CB3 EB                  A     4261 	EX		DE,HL
00000CB4 ED 6A               A     4262 	ADC		HL,HL
00000CB6 EB                  A     4263 	EX		DE,HL
00000CB7 30 04               A     4264 	JR		NC,L0CBE				;
                             A     4265 
00000CB9 09                  A     4266 	ADD		HL,BC
00000CBA 30 01               A     4267 	JR		NC,L0CBE				;
                             A     4268 
00000CBC 13                  A     4269 	INC		DE
                             A     4270 
00000CBD 3D                  A     4271 L0CBE:  DEC		A
00000CBE 20 F2               A     4272 	JR		NZ,L0CB3				;
                             A     4273 
00000CC0 EB                  A     4274 	EX		DE,HL
00000CC1 18 2F               A     4275 	JR		L0CF3					;
                             A     4276 
                             A     4277 ; ---
                             A     4278 ; The 'div?' Internal Word
                             A     4279 ; ---
                             A     4280 
                             A     4281 L0CC4:  DEFW	L0CC6
00000CC3 C5 0C               A+    4281 	DW P1
                             A     4282 
00000CC5 DF                  A     4283 L0CC6:  RST		18H						; pop word DE
00000CC6 D9                  A     4284 	EXX
00000CC7 DF                  A     4285 	RST		18H						; pop word DE
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   88


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000CC8 D5                  A     4286 	PUSH	DE
00000CC9 DF                  A     4287 	RST		18H						; pop word DE
00000CCA E1                  A     4288 	POP		HL
00000CCB 7C                  A     4289 	LD		A,H
00000CCC B5                  A     4290 	OR		L
00000CCD 3E 21               A     4291 	LD		A,021h					; 33
00000CCF 20 03               A     4292 	JR		NZ,L0CD5				;
                             A     4293 
00000CD1 EB                  A     4294 	EX		DE,HL
00000CD2 3E 11               A     4295 	LD		A,011h					; 17
                             A     4296 
00000CD4 D9                  A     4297 L0CD5:  EXX
00000CD5 47                  A     4298 	LD		B,A
00000CD6 AF                  A     4299 	XOR		A
00000CD7 67                  A     4300 	LD		H,A
00000CD8 6F                  A     4301 	LD		L,A
00000CD9 4F                  A     4302 	LD		C,A
                             A     4303 
00000CDA ED 6A               A     4304 L0CDB:  ADC		HL,HL
00000CDC 9F                  A     4305 	SBC		A,A
00000CDD A7                  A     4306 	AND		A
00000CDE ED 52               A     4307 	SBC		HL,DE
00000CE0 99                  A     4308 	SBC		A,C
00000CE1 30 01               A     4309 	JR		NC,L0CE5				;
00000CE3 19                  A     4310 	ADD		HL,DE
                             A     4311 
00000CE4 3F                  A     4312 L0CE5:  CCF
00000CE5 D9                  A     4313 	EXX
00000CE6 EB                  A     4314 	EX		DE,HL
00000CE7 ED 6A               A     4315 	ADC		HL,HL
00000CE9 EB                  A     4316 	EX		DE,HL
00000CEA ED 6A               A     4317 	ADC		HL,HL
00000CEC D9                  A     4318 	EXX
00000CED 10 EB               A     4319 	DJNZ	L0CDB					;
                             A     4320 
00000CEF EB                  A     4321 	EX		DE,HL
00000CF0 D7                  A     4322 	RST		10H						; push word DE
00000CF1 D9                  A     4323 	EXX
                             A     4324 
00000CF2 E5                  A     4325 L0CF3:  PUSH	HL
00000CF3 D7                  A     4326 	RST		10H						; push word DE
00000CF4 D1                  A     4327 	POP		DE
00000CF5 D7                  A     4328 	RST		10H						; push word DE
                             A     4329 
00000CF6 FD E9               A     4330 	JP		(IY)					; to 'next'.
                             A     4331 
                             A     4332 ; ---------------
                             A     4333 ; THE '/MOD' WORD
                             A     4334 ; ---------------
                             A     4335 ; (n1, n2 -- remainder, quotient of n1/n2)
                             A     4336 ; The remainder has the same sign as the dividend n1.
                             A     4337 
                             A     4338 L0CF9:  DEFM	"/MO"					; 'name field'
00000CF8 2F 4D 4F            A+    4338 	DB P1
                             A     4339 	DEFB	'D'+080h
00000CFB C4                  A+    4339 	DB P1
                             A     4340 
                             A     4341 	DEFW	L0CA7					; 'link field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   89


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000CFC A6 0C               A+    4341 	DW P1
                             A     4342 
                             A     4343 L0CFF:  DEFB	004h						; 'name length field'
00000CFE 04                  A+    4343 	DB P1
                             A     4344 
                             A     4345 L0D00:  DEFW	L0EC3					; 'code field' - docolon
00000CFF C2 0E               A+    4345 	DW P1
                             A     4346 
                             A     4347 ; ---
                             A     4348 
                             A     4349 L0D02:  DEFW	L0885					; swap
00000D01 84 08               A+    4349 	DW P1
                             A     4350 	DEFW	L08D2					; >R
00000D03 D1 08               A+    4350 	DW P1
                             A     4351 	DEFW	L12E9					; I
00000D05 E8 12               A+    4351 	DW P1
                             A     4352 	DEFW	L0C0D					; abs
00000D07 0C 0C               A+    4352 	DW P1
                             A     4353 	DEFW	L104B					; stk_data
00000D09 4A 10               A+    4353 	DW P1
                             A     4354 	DEFB	000h						; zero
00000D0B 00                  A+    4354 	DB P1
                             A     4355 ; ->
                             A     4356 L0D0D:  DEFW	L08FF					; rot
00000D0C FE 08               A+    4356 	DW P1
                             A     4357 	DEFW	L086B					; dup
00000D0E 6A 08               A+    4357 	DW P1
                             A     4358 	DEFW	L12E9					; I
00000D10 E8 12               A+    4358 	DW P1
                             A     4359 	DEFW	L0E60					; xor
00000D12 5F 0E               A+    4359 	DW P1
                             A     4360 	DEFW	L08D2					; >R
00000D14 D1 08               A+    4360 	DW P1
                             A     4361 	DEFW	L0C0D					; abs
00000D16 0C 0C               A+    4361 	DW P1
                             A     4362 	DEFW	L0D8C					; U/MOD
00000D18 8B 0D               A+    4362 	DW P1
                             A     4363 	DEFW	L08DF					; >R
00000D1A DE 08               A+    4363 	DW P1
                             A     4364 	DEFW	L0D94					; pos
00000D1C 93 0D               A+    4364 	DW P1
                             A     4365 	DEFW	L0885					; swap
00000D1E 84 08               A+    4365 	DW P1
                             A     4366 	DEFW	L08DF					; >R
00000D20 DE 08               A+    4366 	DW P1
                             A     4367 	DEFW	L0D94					; pos
00000D22 93 0D               A+    4367 	DW P1
                             A     4368 	DEFW	L0885					; swap
00000D24 84 08               A+    4368 	DW P1
                             A     4369 	DEFW	L04B6					; exit
00000D26 B6 04               A+    4369 	DW P1
                             A     4370 
                             A     4371 ; ----------------
                             A     4372 ; THE '*/MOD' WORD
                             A     4373 ; ----------------
                             A     4374 ; (n1, n2, n3 -- remainder, quotient of (n1 * n2)/n3)
                             A     4375 ; As in */, n1 * n2 is held to double length.
                             A     4376 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   90


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4377 L0D29:  DEFM	"*/MO"					; 'name field'
00000D28 2A 2F 4D 4F         A+    4377 	DB P1
                             A     4378 	DEFB	'D'+080h
00000D2C C4                  A+    4378 	DB P1
                             A     4379 
                             A     4380 	DEFW	L0CFF					; 'link field'
00000D2D FE 0C               A+    4380 	DW P1
                             A     4381 
                             A     4382 L0D30:  DEFB	005h						; 'name length field'
00000D2F 05                  A+    4382 	DB P1
                             A     4383 
                             A     4384 L0D31:  DEFW	L0EC3					; 'code field' - docolon
00000D30 C2 0E               A+    4384 	DW P1
                             A     4385 
                             A     4386 ; ---
                             A     4387 
                             A     4388 	DEFW	L08FF					; rot
00000D32 FE 08               A+    4388 	DW P1
                             A     4389 	DEFW	L08D2					; >R
00000D34 D1 08               A+    4389 	DW P1
                             A     4390 	DEFW	L12E9					; I
00000D36 E8 12               A+    4390 	DW P1
                             A     4391 	DEFW	L0C0D					; abs
00000D38 0C 0C               A+    4391 	DW P1
                             A     4392 	DEFW	L08FF					; rot
00000D3A FE 08               A+    4392 	DW P1
                             A     4393 	DEFW	L086B					; dup
00000D3C 6A 08               A+    4393 	DW P1
                             A     4394 	DEFW	L08DF					; >R
00000D3E DE 08               A+    4394 	DW P1
                             A     4395 	DEFW	L0E60					; xor
00000D40 5F 0E               A+    4395 	DW P1
                             A     4396 	DEFW	L08D2					; >R
00000D42 D1 08               A+    4396 	DW P1
                             A     4397 	DEFW	L0C0D					; abs
00000D44 0C 0C               A+    4397 	DW P1
                             A     4398 	DEFW	L0CA8					; u*
00000D46 A7 0C               A+    4398 	DW P1
                             A     4399 	DEFW	L1276					; branch
00000D48 75 12               A+    4399 	DW P1
                             A     4400 
                             A     4401 L0D4B:  DEFW	0FFC1h					; back to L0D0D  (in /MOD)
00000D4A C1 FF               A+    4401 	DW P1
                             A     4402 
                             A     4403 
                             A     4404 
                             A     4405 
                             A     4406 ; ------------
                             A     4407 ; THE '/' WORD
                             A     4408 ; ------------
                             A     4409 ; (n1, n2 -- n1/n2)
                             A     4410 ; Single length signed integer division.
                             A     4411 
                             A     4412 L0D4D:  DEFB	'/'+080h				; 'name field'
00000D4C AF                  A+    4412 	DB P1
                             A     4413 
                             A     4414 	DEFW	L0D30					; 'link field'
00000D4D 2F 0D               A+    4414 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   91


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4415 
                             A     4416 L0D50:  DEFB	001h						; 'name length field'
00000D4F 01                  A+    4416 	DB P1
                             A     4417 
                             A     4418 L0D51:  DEFW	L0EC3					; 'code field' - docolon
00000D50 C2 0E               A+    4418 	DW P1
                             A     4419 
                             A     4420 ; ---
                             A     4421 
                             A     4422 L0D53:  DEFW	L0D00					; /MOD
00000D52 FF 0C               A+    4422 	DW P1
                             A     4423 	DEFW	L0885					; swap
00000D54 84 08               A+    4423 	DW P1
                             A     4424 	DEFW	L0879					; drop
00000D56 78 08               A+    4424 	DW P1
                             A     4425 	DEFW	L04B6					; exit
00000D58 B6 04               A+    4425 	DW P1
                             A     4426 
                             A     4427 ; --------------
                             A     4428 ; THE 'MOD' WORD
                             A     4429 ; --------------
                             A     4430 ; (n1, n2 -- remainder n1/n2)
                             A     4431 ; The remainder has the same sign as the dividend.
                             A     4432 
                             A     4433 L0D5B:  DEFM	"MO"					; 'name field'
00000D5A 4D 4F               A+    4433 	DB P1
                             A     4434 	DEFB	'D'+080h
00000D5C C4                  A+    4434 	DB P1
                             A     4435 
                             A     4436 	DEFW	L0D50					; 'link field'
00000D5D 4F 0D               A+    4436 	DW P1
                             A     4437 
                             A     4438 L0D60:  DEFB	003h						; 'name length field'
00000D5F 03                  A+    4438 	DB P1
                             A     4439 
                             A     4440 L0D61:  DEFW	L0EC3					; 'code field' - docolon
00000D60 C2 0E               A+    4440 	DW P1
                             A     4441 
                             A     4442 ; ---
                             A     4443 
                             A     4444 	DEFW	L0D00					; /MOD
00000D62 FF 0C               A+    4444 	DW P1
                             A     4445 	DEFW	L0879					; drop
00000D64 78 08               A+    4445 	DW P1
                             A     4446 	DEFW	L04B6					; exit
00000D66 B6 04               A+    4446 	DW P1
                             A     4447 
                             A     4448 
                             A     4449 ; ------------
                             A     4450 ; THE '*' WORD
                             A     4451 ; ------------
                             A     4452 ; (n1, n2 -- n1*n2)
                             A     4453 
                             A     4454 L0D69:  DEFB	'*'+080h				; 'name field'
00000D68 AA                  A+    4454 	DB P1
                             A     4455 
                             A     4456 	DEFW	L0D60					; 'link field'
00000D69 5F 0D               A+    4456 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   92


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4457 
                             A     4458 L0D6C:  DEFB	001h						; 'name length field'
00000D6B 01                  A+    4458 	DB P1
                             A     4459 
                             A     4460 	DEFW	L0EC3					; 'code field' - docolon
00000D6C C2 0E               A+    4460 	DW P1
                             A     4461 
                             A     4462 ; ---
                             A     4463 
                             A     4464 	DEFW	L0CA8					; u*
00000D6E A7 0C               A+    4464 	DW P1
                             A     4465 	DEFW	L0879					; drop
00000D70 78 08               A+    4465 	DW P1
                             A     4466 	DEFW	L04B6					; exit
00000D72 B6 04               A+    4466 	DW P1
                             A     4467 
                             A     4468 
                             A     4469 ; -------------
                             A     4470 ; THE '*/' WORD
                             A     4471 ; -------------
                             A     4472 ; (n1, n2, n3 -- (n1*n2)/n3)
                             A     4473 ; The intermediate product n1*n2 is held to double length.
                             A     4474 
                             A     4475 L0D75:  DEFB	'*'						; 'name field'
00000D74 2A                  A+    4475 	DB P1
                             A     4476 	DEFB	'/'+080h
00000D75 AF                  A+    4476 	DB P1
                             A     4477 
                             A     4478 	DEFW	L0D6C					; 'link field'
00000D76 6B 0D               A+    4478 	DW P1
                             A     4479 
                             A     4480 L0D79:  DEFB	002h						; 'name length field'
00000D78 02                  A+    4480 	DB P1
                             A     4481 
                             A     4482 L0D7A:  DEFW	L0EC3					; 'code field' - docolon
00000D79 C2 0E               A+    4482 	DW P1
                             A     4483 
                             A     4484 ; ---
                             A     4485 
                             A     4486 	DEFW	L0D31					; */MOD
00000D7B 30 0D               A+    4486 	DW P1
                             A     4487 	DEFW	L0885					; swap
00000D7D 84 08               A+    4487 	DW P1
                             A     4488 	DEFW	L0879					; drop
00000D7F 78 08               A+    4488 	DW P1
                             A     4489 	DEFW	L04B6					; exit
00000D81 B6 04               A+    4489 	DW P1
                             A     4490 
                             A     4491 ; --------------
                             A     4492 ; THE 'U/MOD' WORD
                             A     4493 ; --------------
                             A     4494 ; (ud1, un2 -- un3, un4)
                             A     4495 ; In unsigned arithmetic throughout, divides the double length integer ud1
                             A     4496 ; by the single length integer un2 to give a single length remainder un3
                             A     4497 ; and a single length quotient un4.
                             A     4498 
                             A     4499 L0D84:  DEFM	"U/MO"					; 'name field'
00000D83 55 2F 4D 4F         A+    4499 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   93


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4500 	DEFB	'D'+080h
00000D87 C4                  A+    4500 	DB P1
                             A     4501 
                             A     4502 	DEFW	L0D79					; 'link field'
00000D88 78 0D               A+    4502 	DW P1
                             A     4503 
                             A     4504 L0D8B:  DEFB	005h						; 'name length field'
00000D8A 05                  A+    4504 	DB P1
                             A     4505 
                             A     4506 L0D8C:  DEFW	L0EC3					; 'code field' - docolon
00000D8B C2 0E               A+    4506 	DW P1
                             A     4507 
                             A     4508 ; ---
                             A     4509 
                             A     4510 L0D8E:  DEFW	L0CC4					; div?
00000D8D C3 0C               A+    4510 	DW P1
                             A     4511 	DEFW	L0879					; drop
00000D8F 78 08               A+    4511 	DW P1
                             A     4512 	DEFW	L04B6					; exit
00000D91 B6 04               A+    4512 	DW P1
                             A     4513 
                             A     4514 ; ---
                             A     4515 
                             A     4516 ; make positive
                             A     4517 
                             A     4518 L0D94:  DEFW	L0EC3					; 'code field' - docolon
00000D93 C2 0E               A+    4518 	DW P1
                             A     4519 
                             A     4520 ; ---
                             A     4521 
                             A     4522 L0D96:  DEFW	L0C2E					; 0<
00000D95 2D 0C               A+    4522 	DW P1
                             A     4523 	DEFW	L1283					; ?branch				(if false)
00000D97 82 12               A+    4523 	DW P1
                             A     4524 L0D9A:  DEFW	00003h					; to L0D9E
00000D99 03 00               A+    4524 	DW P1
                             A     4525 
                             A     4526 	DEFW	L0DA9					; negate
00000D9B A8 0D               A+    4526 	DW P1
                             A     4527 
                             A     4528 L0D9E:  DEFW	L04B6					; exit
00000D9D B6 04               A+    4528 	DW P1
                             A     4529 
                             A     4530 ; -----------------
                             A     4531 ; THE 'NEGATE' WORD
                             A     4532 ; -----------------
                             A     4533 ; (n -- -n)
                             A     4534 
                             A     4535 
                             A     4536 L0DA0:  DEFM	"NEGAT"					; 'name field'
00000D9F 4E 45 47 41 54      A+    4536 	DB P1
                             A     4537 	DEFB	'E'+080h
00000DA4 C5                  A+    4537 	DB P1
                             A     4538 
                             A     4539 	DEFW	L0D8B					; 'link field'
00000DA5 8A 0D               A+    4539 	DW P1
                             A     4540 
                             A     4541 L0DA8:  DEFB	006h						; 'name length field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   94


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000DA7 06                  A+    4541 	DB P1
                             A     4542 
                             A     4543 L0DA9:  DEFW	L0DAB					; 'code field'
00000DA8 AA 0D               A+    4543 	DW P1
                             A     4544 
                             A     4545 ; ---
                             A     4546 
00000DAA 01 02 00            A     4547 L0DAB:  LD		BC,00002h				; 
00000DAD 18 0F               A     4548 	JR		L0DBF					;
                             A     4549 
                             A     4550 ; ------------------
                             A     4551 ; THE 'DNEGATE' WORD
                             A     4552 ; ------------------
                             A     4553 ; (d -- -d)
                             A     4554 ; Double length integer negation.
                             A     4555 
                             A     4556 L0DB0:  DEFM	"DNEGAT"				; 'name field'
00000DAF 44 4E 45 47 41 54   A+    4556 	DB P1
                             A     4557 	DEFB	'E'+080h
00000DB5 C5                  A+    4557 	DB P1
                             A     4558 
                             A     4559 	DEFW	L0DA8					; 'link field'
00000DB6 A7 0D               A+    4559 	DW P1
                             A     4560 
                             A     4561 L0DB9:  DEFB	007h						; 'name length field'
00000DB8 07                  A+    4561 	DB P1
                             A     4562 
                             A     4563 L0DBA:  DEFW	L0DBC					; 'code field'
00000DB9 BB 0D               A+    4563 	DW P1
                             A     4564 
                             A     4565 ; ---
                             A     4566 
00000DBB 01 04 00            A     4567 L0DBC:  LD		BC,00004h
                             A     4568 
                             A     4569 ; NEGATE joins here with bc=2
                             A     4570 
00000DBE 2A 3B 00            A     4571 L0DBF:  LD		HL,(SPARE)				; SPARE
00000DC1 A7                  A     4572 	AND		A
00000DC2 ED 42               A     4573 	SBC		HL,BC
                             A     4574 
00000DC4 78                  A     4575 L0DC5:  LD		A,B
00000DC5 9E                  A     4576 	SBC		A,(HL)
00000DC6 77                  A     4577 	LD		(HL),A
00000DC7 23                  A     4578 	INC		HL
00000DC8 0D                  A     4579 	DEC		C
00000DC9 20 F9               A     4580 	JR		NZ,L0DC5				;
                             A     4581 
00000DCB FD E9               A     4582 	JP		(IY)					; to 'next'.
                             A     4583 
                             A     4584 ; ------------
                             A     4585 ; THE '+' WORD
                             A     4586 ; ------------
                             A     4587 ; (n1, n2 -- n1 + n2)
                             A     4588 
                             A     4589 L0DCE:  DEFB	'+'+080h				; 'name field'
00000DCD AB                  A+    4589 	DB P1
                             A     4590 
                             A     4591 	DEFW	L0DB9					; 'link field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   95


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000DCE B8 0D               A+    4591 	DW P1
                             A     4592 
                             A     4593 L0DD1:  DEFB	001h						; 'name length field'
00000DD0 01                  A+    4593 	DB P1
                             A     4594 
                             A     4595 L0DD2:  DEFW	L0DD4					; 'code field'
00000DD1 D3 0D               A+    4595 	DW P1
                             A     4596 
                             A     4597 ; ---
                             A     4598 
00000DD3 DF                  A     4599 L0DD4:  RST		18H						; pop word DE
00000DD4 D5                  A     4600 	PUSH	DE						; save on machine stack
00000DD5 DF                  A     4601 	RST		18H						; pop word DE
00000DD6 E1                  A     4602 	POP		HL						; first number to HL
                             A     4603 
00000DD7 19                  A     4604 	ADD		HL,DE					; the actual addition
                             A     4605 
00000DD8 EB                  A     4606 	EX		DE,HL					; result to DE
00000DD9 D7                  A     4607 	RST		10H						; push word DE
                             A     4608 
00000DDA FD E9               A     4609 	JP		(IY)					; to 'next'.
                             A     4610 
                             A     4611 ; ------------
                             A     4612 ; THE '-' WORD
                             A     4613 ; ------------
                             A     4614 ; (n1, n2 -- n1-n2)
                             A     4615 ; flip the sign and do a plus.
                             A     4616 
                             A     4617 L0DDD:  DEFB	'-'+080h				; 'name field'
00000DDC AD                  A+    4617 	DB P1
                             A     4618 
                             A     4619 	DEFW	L0DD1					; 'link field'
00000DDD D0 0D               A+    4619 	DW P1
                             A     4620 
                             A     4621 L0DE0:  DEFB	001h						; 'name length field'
00000DDF 01                  A+    4621 	DB P1
                             A     4622 
                             A     4623 L0DE1:  DEFW	L0EC3					; 'code field' - docolon
00000DE0 C2 0E               A+    4623 	DW P1
                             A     4624 
                             A     4625 ; ---
                             A     4626 
                             A     4627 L0DE3:  DEFW	L0DA9					; negate
00000DE2 A8 0D               A+    4627 	DW P1
                             A     4628 	DEFW	L0DD2					; +
00000DE4 D1 0D               A+    4628 	DW P1
                             A     4629 	DEFW	L04B6					; exit
00000DE6 B6 04               A+    4629 	DW P1
                             A     4630 
                             A     4631 ; -------------
                             A     4632 ; THE 'D+' WORD
                             A     4633 ; -------------
                             A     4634 ; (d1, d2 -- d1 + d2)
                             A     4635 ; double length integer addition.
                             A     4636 
                             A     4637 L0DE9:  DEFB	'D'						; 'name field'
00000DE8 44                  A+    4637 	DB P1
                             A     4638 	DEFB	'+'+080h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   96


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000DE9 AB                  A+    4638 	DB P1
                             A     4639 
                             A     4640 	DEFW	L0DE0					; 'link field'
00000DEA DF 0D               A+    4640 	DW P1
                             A     4641 
                             A     4642 L0DED:  DEFB	002h						; 'name length field'
00000DEC 02                  A+    4642 	DB P1
                             A     4643 
                             A     4644 L0DEE:  DEFW	L0DF0					; 'code field'
00000DED EF 0D               A+    4644 	DW P1
                             A     4645 
                             A     4646 ; ---
                             A     4647 
00000DEF DF                  A     4648 L0DF0:  RST		18H						; pop word DE
                             A     4649 
00000DF0 D5                  A     4650 	PUSH	DE
00000DF1 CD 4D 08            A     4651 	CALL	L084E					; stk_to_bc
00000DF4 DF                  A     4652 	RST		18H						; pop word DE
00000DF5 D5                  A     4653 	PUSH	DE
00000DF6 DF                  A     4654 	RST		18H						; pop word DE
00000DF7 EB                  A     4655 	EX		DE,HL
00000DF8 09                  A     4656 	ADD		HL,BC
00000DF9 EB                  A     4657 	EX		DE,HL
00000DFA D7                  A     4658 	RST		10H						; push word DE
00000DFB C1                  A     4659 	POP		BC
00000DFC E1                  A     4660 	POP		HL
00000DFD ED 4A               A     4661 	ADC		HL,BC
00000DFF EB                  A     4662 	EX		DE,HL
00000E00 D7                  A     4663 	RST		10H						; push word DE
                             A     4664 
00000E01 FD E9               A     4665 	JP		(IY)					; to 'next'.
                             A     4666 
                             A     4667 ; -------------
                             A     4668 ; THE '1+' WORD
                             A     4669 ; -------------
                             A     4670 ; (n -- n+1)
                             A     4671 
                             A     4672 L0E04:  DEFB	'1'						; 'name field'
00000E03 31                  A+    4672 	DB P1
                             A     4673 	DEFB	'+'+080h
00000E04 AB                  A+    4673 	DB P1
                             A     4674 
                             A     4675 	DEFW	L0DED					; 'link field'
00000E05 EC 0D               A+    4675 	DW P1
                             A     4676 
                             A     4677 L0E08:  DEFB	002h						; 'name length field'
00000E07 02                  A+    4677 	DB P1
                             A     4678 
                             A     4679 L0E09:  DEFW	L0E0B					; 'code field'
00000E08 0A 0E               A+    4679 	DW P1
                             A     4680 
                             A     4681 ; ---
                             A     4682 
00000E0A DF                  A     4683 L0E0B:  RST		18H						; get word 'n' in DE
00000E0B 18 09               A     4684 	JR		L0E17					; forward to increment and stack
                             A     4685 
                             A     4686 ; -------------
                             A     4687 ; THE '2+' WORD
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   97


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4688 ; -------------
                             A     4689 ; (n -- n+2)
                             A     4690 
                             A     4691 L0E0E:  DEFB	'2'						; 'name field'
00000E0D 32                  A+    4691 	DB P1
                             A     4692 	DEFB	'+'+080h
00000E0E AB                  A+    4692 	DB P1
                             A     4693 
                             A     4694 	DEFW	L0E08					; 'link field'
00000E0F 07 0E               A+    4694 	DW P1
                             A     4695 
                             A     4696 L0E12:  DEFB	002h						; 'name length field'
00000E11 02                  A+    4696 	DB P1
                             A     4697 
                             A     4698 L0E13:  DEFW	L0E15					; 'code field'
00000E12 14 0E               A+    4698 	DW P1
                             A     4699 
                             A     4700 ; ---
                             A     4701 
00000E14 DF                  A     4702 L0E15:  RST		18H						; get word 'n' in DE.
00000E15 13                  A     4703 	INC		DE						; increment n					(4)
                             A     4704 ; ->
00000E16 13                  A     4705 L0E17:  INC		DE						; increment n					(4)
00000E17 18 14               A     4706 	JR		L0E2E					; forward to push word DE and exit
                             A     4707 
                             A     4708 ; -------------
                             A     4709 ; THE '1-' WORD
                             A     4710 ; -------------
                             A     4711 ; (n -- n-1)
                             A     4712 
                             A     4713 
                             A     4714 L0E1A:  DEFB	'1'						; 'name field'
00000E19 31                  A+    4714 	DB P1
                             A     4715 	DEFB	'-'+080h
00000E1A AD                  A+    4715 	DB P1
                             A     4716 
                             A     4717 	DEFW	L0E12					; 'link field'
00000E1B 11 0E               A+    4717 	DW P1
                             A     4718 
                             A     4719 L0E1E:  DEFB	002h						; 'name length field'
00000E1D 02                  A+    4719 	DB P1
                             A     4720 
                             A     4721 L0E1F:  DEFW	L0E21					; 'code field'
00000E1E 20 0E               A+    4721 	DW P1
                             A     4722 
                             A     4723 ; ---
                             A     4724 
00000E20 DF                  A     4725 L0E21:  RST		18H						;
00000E21 18 09               A     4726 	JR		L0E2D					;
                             A     4727 
                             A     4728 ; -------------
                             A     4729 ; THE '2-' WORD
                             A     4730 ; -------------
                             A     4731 ; (n -- n-2)
                             A     4732 
                             A     4733 
                             A     4734 L0E24:  DEFB	'2'						; 'name field'
00000E23 32                  A+    4734 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   98


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4735 L0E25:  DEFB	'-'+080h
00000E24 AD                  A+    4735 	DB P1
                             A     4736 
                             A     4737 L0E26:  DEFW	L0E1E					; 'link field'
00000E25 1D 0E               A+    4737 	DW P1
                             A     4738 
                             A     4739 L0E28:  DEFB	002h						; 'name length field'
00000E27 02                  A+    4739 	DB P1
                             A     4740 
                             A     4741 L0E29:  DEFW	L0E2B					; 'code field'
00000E28 2A 0E               A+    4741 	DW P1
                             A     4742 
                             A     4743 ; ---
                             A     4744 
                             A     4745 ;
00000E2A DF                  A     4746 L0E2B:  RST		18H
00000E2B 1B                  A     4747 	DEC		DE
                             A     4748 
                             A     4749 ; ->
00000E2C 1B                  A     4750 L0E2D:  DEC		DE
                             A     4751 
                             A     4752 ; ->
00000E2D D7                  A     4753 L0E2E:  RST		10H						; push word DE
                             A     4754 
00000E2E FD E9               A     4755 	JP		(IY)					; to 'next'.
                             A     4756 
                             A     4757 ; -------------
                             A     4758 ; THE 'OR' WORD
                             A     4759 ; -------------
                             A     4760 ; (n1, n2 -- n1 OR n2)
                             A     4761 ; Bitwise Boolean operation.
                             A     4762 
                             A     4763 
                             A     4764 L0E31:  DEFB	'O'						; 'name field'
00000E30 4F                  A+    4764 	DB P1
                             A     4765 	DEFB	'R'+080h
00000E31 D2                  A+    4765 	DB P1
                             A     4766 
                             A     4767 	DEFW	L0E28					; 'link field'
00000E32 27 0E               A+    4767 	DW P1
                             A     4768 
                             A     4769 L0E35:  DEFB	002h						; 'name length field'
00000E34 02                  A+    4769 	DB P1
                             A     4770 
                             A     4771 L0E36:  DEFW	L0E38					; 'code field'
00000E35 37 0E               A+    4771 	DW P1
                             A     4772 
                             A     4773 ; ---
                             A     4774 
00000E37 DF                  A     4775 L0E38:  RST		18H						; pop word DE
00000E38 CD 4D 08            A     4776 	CALL	L084E					; stk_to_bc
                             A     4777 
00000E3B 7B                  A     4778 	LD		A,E						;
00000E3C B1                  A     4779 	OR		C						; OR low order bytes
00000E3D 5F                  A     4780 	LD		E,A						;
                             A     4781 
00000E3E 7A                  A     4782 	LD		A,D						;
00000E3F B0                  A     4783 	OR		B						; OR high order bytes
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:   99


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000E40 57                  A     4784 	LD		D,A						;
                             A     4785 
00000E41 D7                  A     4786 	RST		10H						; push word DE
                             A     4787 
00000E42 FD E9               A     4788 	JP		(IY)					; to 'next'.
                             A     4789 
                             A     4790 ; --------------
                             A     4791 ; THE 'AND' WORD
                             A     4792 ; --------------
                             A     4793 ; (n1, n2 -- n1 AND n2)
                             A     4794 ; Bitwise Boolean operation.
                             A     4795 
                             A     4796 
                             A     4797 L0E45:  DEFM	"AN"					; 'name field'
00000E44 41 4E               A+    4797 	DB P1
                             A     4798 	DEFB	'D'+080h
00000E46 C4                  A+    4798 	DB P1
                             A     4799 
                             A     4800 	DEFW	L0E35					; 'link field'
00000E47 34 0E               A+    4800 	DW P1
                             A     4801 
                             A     4802 L0E4A:  DEFB	003h						; 'name length field'
00000E49 03                  A+    4802 	DB P1
                             A     4803 
                             A     4804 	DEFW	L0E4D					; 'code field'
00000E4A 4C 0E               A+    4804 	DW P1
                             A     4805 
                             A     4806 ; ---
                             A     4807 
00000E4C DF                  A     4808 L0E4D:  RST		18H
00000E4D CD 4D 08            A     4809 	CALL	L084E					; stk_to_bc
                             A     4810 
00000E50 7B                  A     4811 	LD		A,E						;
00000E51 A1                  A     4812 	AND		C						;
00000E52 5F                  A     4813 	LD		E,A						;
                             A     4814 
00000E53 7A                  A     4815 	LD		A,D						;
00000E54 A0                  A     4816 	AND		B						;
00000E55 57                  A     4817 	LD		D,A						;
                             A     4818 
00000E56 D7                  A     4819 	RST		10H						; push word DE
00000E57 FD E9               A     4820 	JP		(IY)					; to 'next'.
                             A     4821 
                             A     4822 ; --------------
                             A     4823 ; THE 'XOR' WORD
                             A     4824 ; --------------
                             A     4825 ; (n1, n2 -- n1 XOR n2)
                             A     4826 ; Bitwise Boolean XOR (exclusive or)
                             A     4827 
                             A     4828 L0E5A:  DEFM	"XO"					; 'name field'
00000E59 58 4F               A+    4828 	DB P1
                             A     4829 	DEFB	'R'+080h
00000E5B D2                  A+    4829 	DB P1
                             A     4830 
                             A     4831 	DEFW	L0E4A					; 'link field'
00000E5C 49 0E               A+    4831 	DW P1
                             A     4832 
                             A     4833 L0E5F:  DEFB	003h						; 'name length field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  100


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000E5E 03                  A+    4833 	DB P1
                             A     4834 
                             A     4835 L0E60:  DEFW	L0E62					; 'code field'
00000E5F 61 0E               A+    4835 	DW P1
                             A     4836 
                             A     4837 ; ---
                             A     4838 
00000E61 DF                  A     4839 L0E62:  RST		18H
00000E62 CD 4D 08            A     4840 	CALL	L084E					; stk_to_bc
                             A     4841 
00000E65 7B                  A     4842 	LD		A,E						;
00000E66 A9                  A     4843 	XOR		C						;
00000E67 5F                  A     4844 	LD		E,A						;
                             A     4845 
00000E68 7A                  A     4846 	LD		A,D						;
00000E69 A8                  A     4847 	XOR		B						;
00000E6A 57                  A     4848 	LD		D,A						;
                             A     4849 
00000E6B D7                  A     4850 	RST		10H						; push word DE
00000E6C FD E9               A     4851 	JP		(IY)					; to 'next'.
                             A     4852 
                             A     4853 ; --------------
                             A     4854 ; THE 'MAX' WORD
                             A     4855 ; --------------
                             A     4856 ; (n1, n2 -- max (n1, n2))
                             A     4857 ; Calculates the larger of two numbers.
                             A     4858 
                             A     4859 L0E72:  DEFM	"MA"					; 'name field'
00000E6E 4D 41               A+    4859 	DB P1
                             A     4860 	DEFB	'X'+080h
00000E70 D8                  A+    4860 	DB P1
                             A     4861 
                             A     4862 	DEFW	L0E5F					; 'link field'
00000E71 5E 0E               A+    4862 	DW P1
                             A     4863 
                             A     4864 L0E74:  DEFB	003h						; 'name length field'
00000E73 03                  A+    4864 	DB P1
                             A     4865 
                             A     4866 L0E75:  DEFW	L0EC3					; 'code field' - docolon
00000E74 C2 0E               A+    4866 	DW P1
                             A     4867 
                             A     4868 ; ---
                             A     4869 
                             A     4870 L0E77:  DEFW	L0912					; over
00000E76 11 09               A+    4870 	DW P1
                             A     4871 	DEFW	L0912					; over
00000E78 11 09               A+    4871 	DW P1
                             A     4872 	DEFW	L0C65					; <
00000E7A 64 0C               A+    4872 	DW P1
                             A     4873 	DEFW	L1271					; branch
00000E7C 70 12               A+    4873 	DW P1
                             A     4874 L0E7F:  DEFW	0000Fh					; forward to L0E8F
00000E7E 0F 00               A+    4874 	DW P1
                             A     4875 
                             A     4876 ; --------------
                             A     4877 ; THE 'MIN' WORD
                             A     4878 ; --------------
                             A     4879 ; (n1, n2 -- min (n1, n2))
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  101


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4880 ; Calculates the smaller of two numbers.
                             A     4881 
                             A     4882 L0E81:  DEFM	"MI"					; 'name field'
00000E80 4D 49               A+    4882 	DB P1
                             A     4883 	DEFB	'N'+080h
00000E82 CE                  A+    4883 	DB P1
                             A     4884 
                             A     4885 	DEFW	L0E74					; 'link field'
00000E83 73 0E               A+    4885 	DW P1
                             A     4886 
                             A     4887 L0E86:  DEFB	003h						; 'name length field'
00000E85 03                  A+    4887 	DB P1
                             A     4888 
                             A     4889 	DEFW	L0EC3					; 'code field' - docolon
00000E86 C2 0E               A+    4889 	DW P1
                             A     4890 
                             A     4891 ; ---
                             A     4892 
                             A     4893 L0E89:  DEFW	L0912					; over
00000E88 11 09               A+    4893 	DW P1
                             A     4894 	DEFW	L0912					; over
00000E8A 11 09               A+    4894 	DW P1
                             A     4895 	DEFW	L0C56					; >
00000E8C 55 0C               A+    4895 	DW P1
                             A     4896 ; ->
                             A     4897 L0E8F:  DEFW	L1283					; ?branch
00000E8E 82 12               A+    4897 	DW P1
                             A     4898 L0E91:  DEFW	00003h					; forward to L0995
00000E90 03 00               A+    4898 	DW P1
                             A     4899 
                             A     4900 	DEFW	L0885					; swap
00000E92 84 08               A+    4900 	DW P1
                             A     4901 
                             A     4902 L0995:  DEFW	L0879					; drop
00000E94 78 08               A+    4902 	DW P1
                             A     4903 	DEFW	L04B6					; exit
00000E96 B6 04               A+    4903 	DW P1
                             A     4904 
                             A     4905 ; ------------------
                             A     4906 ; THE 'DECIMAL' WORD
                             A     4907 ; ------------------
                             A     4908 ; (  --  )
                             A     4909 ; Sets the system number base to ten.
                             A     4910 
                             A     4911 L0E99:  DEFM	"DECIMA"				; 'name field'
00000E98 44 45 43 49 4D 41   A+    4911 	DB P1
                             A     4912 	DEFB	'L'+080h
00000E9E CC                  A+    4912 	DB P1
                             A     4913 
                             A     4914 	DEFW	L0E86					; 'link field'
00000E9F 85 0E               A+    4914 	DW P1
                             A     4915 
                             A     4916 L0EA2:  DEFB	007h						; 'name length field'
00000EA1 07                  A+    4916 	DB P1
                             A     4917 
                             A     4918 	DEFW	L0EA5					; 'code field'
00000EA2 A4 0E               A+    4918 	DW P1
                             A     4919 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  102


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     4920 ; ---
                             A     4921 
00000EA4 DD 36 3F 0A         A     4922 L0EA5:  LD		(IX+03Fh),00Ah			; update system variable BASE to 10
                             A     4923 
00000EA8 FD E9               A     4924 	JP		(IY)					; to 'next'.
                             A     4925 
                             A     4926 ; ------------
                             A     4927 ; THE ':' WORD
                             A     4928 ; ------------
                             A     4929 ; Introduces colon definitions.
                             A     4930 
                             A     4931 L0EAB:  DEFB	':'+080h				; 'name field'
00000EAA BA                  A+    4931 	DB P1
                             A     4932 
                             A     4933 	DEFW	L0EA2					; 'link field'
00000EAB A1 0E               A+    4933 	DW P1
                             A     4934 
                             A     4935 L0EAE:  DEFB	001h						; 'name length field'
00000EAD 01                  A+    4935 	DB P1
                             A     4936 
                             A     4937 L0EAF:  DEFW	L1085					; 'code field' - create and enclose
00000EAE 84 10               A+    4937 	DW P1
                             A     4938 
                             A     4939 ; ---
                             A     4940 
                             A     4941 L0EB1:  DEFW	L0EC3					; do_colon
00000EB0 C2 0E               A+    4941 	DW P1
                             A     4942 
                             A     4943 	DEFW	L104B					; stk_data
00000EB2 4A 10               A+    4943 	DW P1
                             A     4944 	DEFB	00Ah						; ten					marker byte?
00000EB4 0A                  A+    4944 	DB P1
                             A     4945 ; ->
                             A     4946 L0EB6:  DEFW	L1A0E					; end_forth
00000EB5 0D 1A               A+    4946 	DW P1
                             A     4947 
00000EB7 21 3E 00            A     4948 L0EB8:  LD		HL,FLAGS				; FLAGS
                             A     4949 
00000EBA 7E                  A     4950 	LD		A,(HL)					; update bits 6 and 2.
00000EBB F6 44               A     4951 	OR		044h						; signal in compile mode, definition
                             A     4952 					; incomplete.
00000EBD 77                  A     4953 	LD		(HL),A					; update FLAGS.
                             A     4954 
00000EBE FD E9               A     4955 	JP		(IY)					; to 'next'.
                             A     4956 
                             A     4957 ; ---
                             A     4958 
                             A     4959 x0EC1:   DEFB	0E9h						;;
00000EC0 E9                  A+    4959 	DB P1
                             A     4960 x0Ec2:   DEFB	0FFh						;; 0ec2 + ffe9 =  0eab = ':'
00000EC1 FF                  A+    4960 	DB P1
                             A     4961 
                             A     4962 ; -------------------------------
                             A     4963 ; THE 'ENTER' or 'DOCOLON' action
                             A     4964 ; -------------------------------
                             A     4965 ;
                             A     4966 
00000EC2 EB                  A     4967 L0EC3:  EX		DE,HL					;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  103


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000EC3 C3 BA 04            A     4968 	JP		L04BA					;
                             A     4969 
                             A     4970 
                             A     4971 ; -----------------
                             A     4972 ; THE 'CREATE' WORD
                             A     4973 ; -----------------
                             A     4974 ; CREATE name
                             A     4975 ; (  --  )
                             A     4976 ; Defines a new word with a header and an empty parameter field.
                             A     4977 ; When executed, the new word stacks its parameter field address.
                             A     4978 
                             A     4979 L0EC7:  DEFM	"CREAT"					; 'name field'
00000EC6 43 52 45 41 54      A+    4979 	DB P1
                             A     4980 	DEFB	'E'+080h
00000ECB C5                  A+    4980 	DB P1
                             A     4981 
                             A     4982 	DEFW	L0EAE					; 'link field'
00000ECC AD 0E               A+    4982 	DW P1
                             A     4983 
                             A     4984 L0ECF:  DEFB	006h						; 'name length field'
00000ECE 06                  A+    4984 	DB P1
                             A     4985 
                             A     4986 L0ED0:  DEFW	L0EC3					; 'code field' - docolon
00000ECF C2 0E               A+    4986 	DW P1
                             A     4987 
                             A     4988 ; ---
                             A     4989 
                             A     4990 L0ED2:  DEFW	L104B					; stk_data
00000ED1 4A 10               A+    4990 	DW P1
                             A     4991 	DEFB	020h						; a space				delimiter
00000ED3 20                  A+    4991 	DB P1
                             A     4992 	DEFW	L05AB					; word to pad
00000ED4 AB 05               A+    4992 	DW P1
                             A     4993 	DEFW	L0EFB					; get-name				in dict
00000ED6 FA 0E               A+    4993 	DW P1
                             A     4994 	DEFW	L0688					; stk-zero				link
00000ED8 88 06               A+    4994 	DW P1
                             A     4995 	DEFW	L0F4E					; ,
00000EDA 4D 0F               A+    4995 	DW P1
                             A     4996 	DEFW	L0480					; current
00000EDC 80 04               A+    4996 	DW P1
                             A     4997 	DEFW	L08B3					; @
00000EDE B2 08               A+    4997 	DW P1
                             A     4998 	DEFW	L086B					; dup
00000EE0 6A 08               A+    4998 	DW P1
                             A     4999 	DEFW	L08B3					; @
00000EE2 B2 08               A+    4999 	DW P1
                             A     5000 	DEFW	L0F4E					; ,
00000EE4 4D 0F               A+    5000 	DW P1
                             A     5001 	DEFW	L0460					; here
00000EE6 60 04               A+    5001 	DW P1
                             A     5002 	DEFW	L0885					; swap
00000EE8 84 08               A+    5002 	DW P1
                             A     5003 	DEFW	L08C1					; !
00000EEA C0 08               A+    5003 	DW P1
                             A     5004 	DEFW	L0499					; pad
00000EEC 99 04               A+    5004 	DW P1
                             A     5005 	DEFW	L0896					; C@			fetch 1 byte
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  104


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000EEE 95 08               A+    5005 	DW P1
                             A     5006 	DEFW	L0F5F					; C,
00000EF0 5E 0F               A+    5006 	DW P1
                             A     5007 	DEFW	L1011					; stack next word
00000EF2 10 10               A+    5007 	DW P1
                             A     5008 	DEFW	00FECh					; ???
00000EF4 EC 0F               A+    5008 	DW P1
                             A     5009 	DEFW	L0F4E					; ,
00000EF6 4D 0F               A+    5009 	DW P1
                             A     5010 L0EF9:  DEFW	L04B6					; exit
00000EF8 B6 04               A+    5010 	DW P1
                             A     5011 
                             A     5012 ; ----------------------------
                             A     5013 ; The 'get_name' Internal Word
                             A     5014 ; ----------------------------
                             A     5015 ; Used only by the above CREATE thread.
                             A     5016 
                             A     5017 L0EFB:  DEFW	L0EFD					; headerless 'code field'
00000EFA FC 0E               A+    5017 	DW P1
                             A     5018 
                             A     5019 ; ---
                             A     5020 
00000EFC CD 2D 0F            A     5021 L0EFD:  CALL	L0F2E					; blank stack
                             A     5022 
00000EFF DF                  A     5023 	RST		18H						; pop word DE
                             A     5024 
00000F00 1A                  A     5025 	LD		A,(DE)
00000F01 3D                  A     5026 	DEC		A						; zero becomes 0FFh
00000F02 FE 3F               A     5027 	CP		03Fh						; max length is 64
00000F04 38 02               A     5028 	JR		C,L0F09					; forward if n range 1 - 64.
                             A     5029 
00000F06 E7                  A     5030 	RST		20H						; Error 6
                             A     5031 	DEFB	006h						; Name of new word too short or long.
00000F07 06                  A+    5031 	DB P1
                             A     5032 
                             A     5033 ; ---
                             A     5034 
00000F08 C6 08               A     5035 L0F09:  ADD		A,008h					; allow for prev/len/addr 3 missing
                             A     5036 
00000F0A 4F                  A     5037 	LD		C,A						;
00000F0B 06 00               A     5038 	LD		B,000h					; length to BC
                             A     5039 
00000F0D CD 8B 0F            A     5040 L0F0E:  CALL	L0F8C					; check free memory.
                             A     5041 
00000F10 1A                  A     5042 x0f11:   LD		A,(DE)					; true length to A
00000F11 4F                  A     5043 	LD		C,A						; and BC again
                             A     5044 
00000F12 2A 37 00            A     5045 	LD		HL,(STKBOT)				; STKBOT
                             A     5046 
00000F15 D5                  A     5047 	PUSH	DE						;
00000F16 CD 9D 0F            A     5048 	CALL	L0F9E					; routine MAKE ROOM
00000F19 D1                  A     5049 	POP		DE						;
                             A     5050 
00000F1A 1A                  A     5051 	LD		A,(DE)					; length of word in pad
00000F1B 47                  A     5052 	LD		B,A						; transfer to counter.
                             A     5053 
00000F1C 13                  A     5054 L0F1D:  INC		DE						; increase source
00000F1D 1A                  A     5055 	LD		A,(DE)					; fetch character
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  105


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5056 
00000F1E CD 06 08            A     5057 	CALL	L0807					; to_upper makes uppercase.
                             A     5058 
00000F21 77                  A     5059 	LD		(HL),A					; store in dictionary
00000F22 23                  A     5060 	INC		HL						; increase destination
00000F23 10 F7               A     5061 	DJNZ	L0F1D					; loop back for all letters.
                             A     5062 
00000F25 22 39 00            A     5063 	LD		(DICT),HL				; store this location in SPARE
00000F28 2B                  A     5064 	DEC		HL						; step back to last letter of word.
00000F29 CB FE               A     5065 	SET		7,(HL)					; and 'invert' it.
00000F2B FD E9               A     5066 	JP		(IY)					; to 'next'.
                             A     5067 
                             A     5068 ; ---
                             A     5069 
                             A     5070 
00000F2D DD CB 3E 56         A     5071 L0F2E:  BIT		2,(IX+03Eh)				; test FLAGS incomplete definition ?
00000F31 28 02               A     5072 	JR		Z,L0F36					; forward if not.
                             A     5073 
00000F33 E7                  A     5074 	RST		20H						; Error 12
                             A     5075 	DEFB	00Ch						; Incomplete definition in dictionary.
00000F34 0C                  A+    5075 	DB P1
                             A     5076 
                             A     5077 ; ---
                             A     5078 
00000F35 2A 37 00            A     5079 L0F36:  LD		HL,(STKBOT)				; fetch STKBOT
00000F38 ED 5B 39 00         A     5080 	LD		DE,(DICT)				; fetch SPARE
                             A     5081 
00000F3C AF                  A     5082 	XOR		A						; clear accumulator and carry flag
                             A     5083 
00000F3D ED 52               A     5084 	SBC		HL,DE					; subtract
                             A     5085 
00000F3F EB                  A     5086 	EX		DE,HL					;
00000F40 73                  A     5087 	LD		(HL),E					; place low byte at next STACK slot.
00000F41 23                  A     5088 	INC		HL						;
00000F42 72                  A     5089 	LD		(HL),D					; place high byte
00000F43 67                  A     5090 	LD		H,A						; make HL zero
00000F44 6F                  A     5091 	LD		L,A						;
00000F45 22 39 00            A     5092 	LD		(DICT),HL				; update system variable SPARE to zero
                             A     5093 
00000F48 C9                  A     5094 	RET								; return
                             A     5095 
                             A     5096 ; ---------------------
                             A     5097 
                             A     5098 ; ------------
                             A     5099 ; THE ',' WORD
                             A     5100 ; ------------
                             A     5101 ; ( n --   )
                             A     5102 ; Encloses the single length integer in the dictionary.
                             A     5103 
                             A     5104 L0F4A:  DEFB	","+080h				; 'name field'
00000F49 AC                  A+    5104 	DB P1
                             A     5105 
                             A     5106 	DEFW	L0ECF					; 'link field'
00000F4A CE 0E               A+    5106 	DW P1
                             A     5107 
                             A     5108 L0F4D:  DEFB	001h						; 'name length field'
00000F4C 01                  A+    5108 	DB P1
                             A     5109 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  106


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5110 L0F4E:  DEFW	L0EC3					; 'code field' - docolon
00000F4D C2 0E               A+    5110 	DW P1
                             A     5111 
                             A     5112 ; ---
                             A     5113 
                             A     5114 L0F50:  DEFW	L0F83					; allot2
00000F4F 82 0F               A+    5114 	DW P1
                             A     5115 
                             A     5116 	DEFW	L0460					; here
00000F51 60 04               A+    5116 	DW P1
                             A     5117 	DEFW	L0E29					; 2-
00000F53 28 0E               A+    5117 	DW P1
                             A     5118 	DEFW	L08C1					; !
00000F55 C0 08               A+    5118 	DW P1
                             A     5119 	DEFW	L04B6					; exit
00000F57 B6 04               A+    5119 	DW P1
                             A     5120 
                             A     5121 
                             A     5122 ; -------------
                             A     5123 ; THE 'C,' WORD
                             A     5124 ; -------------
                             A     5125 ; ( n --   )
                             A     5126 ; Encloses the less significant byte of n in the dictionary.
                             A     5127 
                             A     5128 L0F5A:  DEFB	'C'						; 'name field'
00000F59 43                  A+    5128 	DB P1
                             A     5129 	DEFB	","+080h
00000F5A AC                  A+    5129 	DB P1
                             A     5130 
                             A     5131 	DEFW	L0F4D					; 'link field'
00000F5B 4C 0F               A+    5131 	DW P1
                             A     5132 
                             A     5133 L0F5E:  DEFB	002h						; 'name length field'
00000F5D 02                  A+    5133 	DB P1
                             A     5134 
                             A     5135 L0F5F:  DEFW	L0EC3					; 'code field' - docolon
00000F5E C2 0E               A+    5135 	DW P1
                             A     5136 
                             A     5137 ; ---
                             A     5138 
                             A     5139 L0F61:  DEFW	L104B					; stk-data
00000F60 4A 10               A+    5139 	DW P1
                             A     5140 	DEFB	001h						; one
00000F62 01                  A+    5140 	DB P1
                             A     5141 	DEFW	L0F76					; allot
00000F63 75 0F               A+    5141 	DW P1
                             A     5142 
                             A     5143 x0f66:   DEFW	L0460					; here
00000F65 60 04               A+    5143 	DW P1
                             A     5144 	DEFW	L0E1F					; 1-
00000F67 1E 0E               A+    5144 	DW P1
                             A     5145 	DEFW	L08A5					; C!
00000F69 A4 08               A+    5145 	DW P1
                             A     5146 	DEFW	L04B6					; exit
00000F6B B6 04               A+    5146 	DW P1
                             A     5147 
                             A     5148 ; ----------------
                             A     5149 ; THE 'ALLOT' WORD
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  107


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5150 ; ----------------
                             A     5151 ; (n -- )
                             A     5152 ; Encloses n bytes in the dictionary, without initializing them.
                             A     5153 
                             A     5154 L0F6E:  DEFM	"ALLO"					; 'name field'
00000F6D 41 4C 4C 4F         A+    5154 	DB P1
                             A     5155 	DEFB	'T'+080h
00000F71 D4                  A+    5155 	DB P1
                             A     5156 
                             A     5157 	DEFW	L0F5E					; 'link field'
00000F72 5D 0F               A+    5157 	DW P1
                             A     5158 
                             A     5159 L0F75:  DEFB	005h						; 'name length field'
00000F74 05                  A+    5159 	DB P1
                             A     5160 
                             A     5161 L0F76:  DEFW	L0F78					; 'code field'
00000F75 77 0F               A+    5161 	DW P1
                             A     5162 
                             A     5163 ; ---
                             A     5164 
00000F77 CD 4D 08            A     5165 L0F78:  CALL	L084E					; stk_to_bc
00000F7A 2A 37 00            A     5166 	LD		HL,(STKBOT)				; STKBOT
00000F7D CD 9D 0F            A     5167 	CALL	L0F9E					; routine MAKE ROOM
00000F80 FD E9               A     5168 	JP		(IY)					; to 'next'.
                             A     5169 
                             A     5170 ; --------------------------
                             A     5171 ; The 'allot2' Internal Word
                             A     5172 ; --------------------------
                             A     5173 ; Encloses 2 bytes in the dictionary, without initializing them.
                             A     5174 
                             A     5175 L0F83:  DEFW	L0EC3					; headerless 'code field' - docolon
00000F82 C2 0E               A+    5175 	DW P1
                             A     5176 
                             A     5177 ; ---
                             A     5178 
                             A     5179 L0F85:  DEFW	L104B					; stk_data
00000F84 4A 10               A+    5179 	DW P1
                             A     5180 	DEFB	002h						; two bytes required
00000F86 02                  A+    5180 	DB P1
                             A     5181 	DEFW	L0F76					; allot
00000F87 75 0F               A+    5181 	DW P1
                             A     5182 	DEFW	L04B6					; exit
00000F89 B6 04               A+    5182 	DW P1
                             A     5183 
                             A     5184 ; ----------------------------------
                             A     5185 ; THE 'DEFAULT MEMORY CHECK' ROUTINE
                             A     5186 ; ----------------------------------
                             A     5187 ; called each cycle in slow mode to check free memory.
                             A     5188 
00000F8B 21 1E 00            A     5189 L0F8C:  LD		HL,0001Eh				; Allow a thirty byte overhead.
                             A     5190 
                             A     5191 ; ----------------------------------
                             A     5192 ; THE 'CHECK FREE MEMORY' SUBROUTINE
                             A     5193 ; ----------------------------------
                             A     5194 
00000F8E C5                  A     5195 L0F8F:  PUSH	BC						; save bytes to check.
                             A     5196 
00000F8F 09                  A     5197 	ADD		HL,BC					;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  108


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00000F90 ED 4B 3B 00         A     5198 	LD		BC,(SPARE)				; SPARE
00000F94 09                  A     5199 	ADD		HL,BC					; carry indicates error - past 65535
                             A     5200 
00000F95 C1                  A     5201 	POP		BC						; restore number of bytes
00000F96 38 03               A     5202 	JR		C,L0F9C					; forward with error
                             A     5203 
00000F98 ED 72               A     5204 	SBC		HL,SP					; now check against the return stack
                             A     5205 					; (machine stack)
00000F9A D8                  A     5206 	RET		C						; return if value is less
                             A     5207 
00000F9B E7                  A     5208 L0F9C:  RST		20H						; Error 1
                             A     5209 	DEFB	001h						; Not enough memory
00000F9C 01                  A+    5209 	DB P1
                             A     5210 
                             A     5211 ; --------------------------
                             A     5212 ; THE 'MAKE ROOM' SUBROUTINE
                             A     5213 ; --------------------------
                             A     5214 
00000F9D EB                  A     5215 L0F9E:  EX		DE,HL					; first new location to DE
00000F9E 21 28 00            A     5216 	LD		HL,00028h				; overhead 40 bytes.
                             A     5217 
00000FA1 CD 8E 0F            A     5218 L0FA2:  CALL	L0F8F					; check free memory.
                             A     5219 
                             A     5220 ; now increase the two data stack pointers.
                             A     5221 
00000FA4 2A 37 00            A     5222 	LD		HL,(STKBOT)				; fetch value of STKBOT
00000FA7 09                  A     5223 	ADD		HL,BC					; add required room.
00000FA8 22 37 00            A     5224 	LD		(STKBOT),HL				; update STKBOT.
                             A     5225 
00000FAB 2A 3B 00            A     5226 	LD		HL,(SPARE)				; fetch value of SPARE
00000FAE E5                  A     5227 	PUSH	HL						; take a copy of 'old' value
00000FAF 09                  A     5228 	ADD		HL,BC					; add required room.
00000FB0 22 3B 00            A     5229 	LD		(SPARE),HL				; update SPARE.
                             A     5230 
00000FB3 E3                  A     5231 	EX		(SP),HL					; new SPARE value to stack,
                             A     5232 					; old SPARE value to HL.
00000FB4 E5                  A     5233 	PUSH	HL						; push old SPARE value.
00000FB5 A7                  A     5234 	AND		A						; clear carry.
                             A     5235 
00000FB6 ED 52               A     5236 	SBC		HL,DE					; get length of stack and 12
00000FB8 44                  A     5237 	LD		B,H						;
00000FB9 4D                  A     5238 	LD		C,L						;
00000FBA E1                  A     5239 	POP		HL						; old spare
00000FBB D1                  A     5240 	POP		DE						; new spare
00000FBC C8                  A     5241 	RET		Z						; return if same.
                             A     5242 
                             A     5243 ; else new SPARE must be higher than old spare.
                             A     5244 
00000FBD 2B                  A     5245 	DEC		HL						; point to end of data stack
00000FBE 1B                  A     5246 	DEC		DE						; adjust destination.
00000FBF ED B8               A     5247 	LDDR							; copy the Data Stack + gap upwards.
                             A     5248 
00000FC1 23                  A     5249 L0FC2:  INC		HL						; point to first new location.
                             A     5250 
00000FC2 C9                  A     5251 	RET								; return.
                             A     5252 
                             A     5253 ; -------------------
                             A     5254 ; THE 'VARIABLE' WORD
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  109


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5255 ; -------------------
                             A     5256 ; VARIABLE name
                             A     5257 ; (n -- )
                             A     5258 ; Sets up a variable with the given name, and initializes its value to n.
                             A     5259 
                             A     5260 L0FC4:  DEFM	"VARIABL"				; 'name field'
00000FC3 56 41 52 49 41 42   A+    5260 	DB P1
00000FC9 4C                  A+ d  5260
                             A     5261 	DEFB	'E'+080h
00000FCA C5                  A+    5261 	DB P1
                             A     5262 
                             A     5263 	DEFW	L0F75					; 'link field'
00000FCB 74 0F               A+    5263 	DW P1
                             A     5264 
                             A     5265 L0FCE:  DEFB	008h						; 'name length field'
00000FCD 08                  A+    5265 	DB P1
                             A     5266 
                             A     5267 	DEFW	L1085					; 'code field' - create and enclose
00000FCE 84 10               A+    5267 	DW P1
                             A     5268 
                             A     5269 ; ---
                             A     5270 
                             A     5271 L0FD1:  DEFW	L0FF0					; push word DE
00000FD0 EF 0F               A+    5271 	DW P1
                             A     5272 	DEFW	L0F4E					; ,
00000FD2 4D 0F               A+    5272 	DW P1
                             A     5273 
                             A     5274 	DEFW	L04B6					; exit
00000FD4 B6 04               A+    5274 	DW P1
                             A     5275 
                             A     5276 ; -------------------
                             A     5277 ; THE 'CONSTANT' WORD
                             A     5278 ; -------------------
                             A     5279 ; CONSTANT name
                             A     5280 ; (n -- )
                             A     5281 ; Defines a constant with the given name and value n.
                             A     5282 
                             A     5283 L0FD7:  DEFM	"CONSTAN"				; 'name field'
00000FD6 43 4F 4E 53 54 41   A+    5283 	DB P1
00000FDC 4E                  A+ d  5283
                             A     5284 	DEFB	'T'+080h
00000FDD D4                  A+    5284 	DB P1
                             A     5285 
                             A     5286 	DEFW	L0FCE					; 'link field'
00000FDE CD 0F               A+    5286 	DW P1
                             A     5287 
                             A     5288 L0FE1:  DEFB	008h						; 'name length field'
00000FE0 08                  A+    5288 	DB P1
                             A     5289 
                             A     5290 L0FE2:  DEFW	L1085					; 'code field' - create and enclose
00000FE1 84 10               A+    5290 	DW P1
                             A     5291 
                             A     5292 ; ---
                             A     5293 
                             A     5294 L0FE4:  DEFW	L0FF5					; pad??
00000FE3 F4 0F               A+    5294 	DW P1
                             A     5295 	DEFW	L0F4E					; ,
00000FE5 4D 0F               A+    5295 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  110


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5296 	DEFW	L04B6					; exit
00000FE7 B6 04               A+    5296 	DW P1
                             A     5297 
                             A     5298 ; ---
                             A     5299 ; ???
                             A     5300 
                             A     5301 x0fea:   DEFB	0DCh						;;
00000FE9 DC                  A+    5301 	DB P1
                             A     5302 x0feb:   DEFB	0FEh						;;  0feb + fedc = 0Ec7 = CREATE
00000FEA FE                  A+    5302 	DB P1
                             A     5303 
                             A     5304 ; ->
00000FEB 18 02               A     5305 L0FEC:  JR		L0FF0					; skip forward
                             A     5306 
                             A     5307 x0fee:  DEFB	0D5h						;;
00000FED D5                  A+    5307 	DB P1
                             A     5308 x0fef:   DEFB	0FFh						;;  0fef + ffd5 = 0fc4 = VARIABLE
00000FEE FF                  A+    5308 	DB P1
                             A     5309 
                             A     5310 ; ---
                             A     5311 
00000FEF D7                  A     5312 L0FF0:  RST		10H						; push word DE
00000FF0 FD E9               A     5313 	JP		(IY)					; to 'next'.
                             A     5314 
                             A     5315 ; ---
                             A     5316 
                             A     5317 x0FF3:   DEFB	0E3h						;;
00000FF2 E3                  A+    5317 	DB P1
                             A     5318 x0ff4:   DEFB	0FFh						;;  0ff4 + ffe3 = 0fd7 = CONSTANT
00000FF3 FF                  A+    5318 	DB P1
                             A     5319 
                             A     5320 ; --> pad
                             A     5321 
00000FF4 EB                  A     5322 L0FF5:  EX		DE,HL
00000FF5 5E                  A     5323 	LD		E,(HL)
00000FF6 23                  A     5324 	INC		HL
00000FF7 56                  A     5325 	LD		D,(HL)
00000FF8 D7                  A     5326 	RST		10H						; push word DE
00000FF9 FD E9               A     5327 	JP		(IY)					; to 'next'.
                             A     5328 
                             A     5329 ; ------------------
                             A     5330 ; THE 'LITERAL' WORD
                             A     5331 ; ------------------
                             A     5332 ; (n -- )
                             A     5333 ; Compiles the top of the stack into a word definition as a literal.
                             A     5334 ; Compiles integers. decimal 4102 = 01006h. c.f. 01055h
                             A     5335 
                             A     5336 L0FFC:  DEFM	"LITERA"				; 'name field'
00000FFB 4C 49 54 45 52 41   A+    5336 	DB P1
                             A     5337 	DEFB	'L'+080h
00001001 CC                  A+    5337 	DB P1
                             A     5338 
                             A     5339 	DEFW	L0FE1					; 'link field'
00001002 E0 0F               A+    5339 	DW P1
                             A     5340 
                             A     5341 L1005:  DEFB	047h						; 'name length field'
00001004 47                  A+    5341 	DB P1
                             A     5342 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  111


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5343 L1006:  DEFW	L1108					; 'code field' - compile
00001005 07 11               A+    5343 	DW P1
                             A     5344 
                             A     5345 ; ---
                             A     5346 
                             A     5347 L1008:  DEFW	L1011					; stack next word
00001007 10 10               A+    5347 	DW P1
                             A     5348 	DEFW	L0F4E					; ,
00001009 4D 0F               A+    5348 	DW P1
                             A     5349 	DEFW	L04B6					; exit
0000100B B6 04               A+    5349 	DW P1
                             A     5350 
                             A     5351 ; ---
                             A     5352 
                             A     5353 x100E:  DEFB	002h						;;
0000100D 02                  A+    5353 	DB P1
                             A     5354 x100f:   DEFB	0FFh						;; 100f + ff02 = 0f11 nah!
0000100E FF                  A+    5354 	DB P1
                             A     5355 x1010:   DEFB	0FFh						;;
0000100F FF                  A+    5355 	DB P1
                             A     5356 
                             A     5357 ; -----------------------------------
                             A     5358 ; The 'Stack Next Word' Internal Word
                             A     5359 ; -----------------------------------
                             A     5360 
                             A     5361 L1011:  DEFW	L1013					; headerless 'code field'
00001010 12 10               A+    5361 	DW P1
                             A     5362 
                             A     5363 ; ---
                             A     5364 
00001012 06 01               A     5365 L1013:  LD		B,001h					; counter - one word to push
                             A     5366 
00001014 E1                  A     5367 L1015:  POP		HL						; drop the 'Next Word' pointer.
00001015 5E                  A     5368 	LD		E,(HL)					; low byte to E.
00001016 23                  A     5369 	INC		HL						; increment pointer.
00001017 56                  A     5370 	LD		D,(HL)					; high byte to D.
                             A     5371 
                             A     5372 ; -> E B=1 (one byte op)
                             A     5373 
00001018 23                  A     5374 L1019:  INC		HL						; increment the 'Next Word' pointer
                             A     5375 
00001019 E5                  A     5376 L101A:  PUSH	HL						; the 'Next Word' pointer goes to
                             A     5377 					; the Return Stack.
0000101A D7                  A     5378 	RST		10H						; stack Data Word DE
0000101B 10 F7               A     5379 	DJNZ	L1015					; loop back if more than one.
                             A     5380 
0000101D FD E9               A     5381 L101E:  JP		(IY)					; to 'next'.
                             A     5382 
                             A     5383 
                             A     5384 ; ----------------
                             A     5385 ; THE 'ASCII' WORD
                             A     5386 ; ----------------
                             A     5387 ; Takes the next word from the input buffer, and yields the ASCII code
                             A     5388 ; of its first character. If compiling, then compiles this as a literal.
                             A     5389 ;
                             A     5390 ; e.g.		:STARS 0 DO ASCII * EMIT LOOP ;
                             A     5391 ; (--ASCII code)			(if interpreting)
                             A     5392 ; (--)					(if compiling)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  112


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5393 
                             A     5394 L1020:  DEFM	"ASCI"					; 'name field'
0000101F 41 53 43 49         A+    5394 	DB P1
                             A     5395 	DEFB	'I'+080h
00001023 C9                  A+    5395 	DB P1
                             A     5396 
                             A     5397 	DEFW	L1005					; 'link field'
00001024 04 10               A+    5397 	DW P1
                             A     5398 
                             A     5399 L1027:  DEFB	045h						; 'name length field' (immediate mode)
00001026 45                  A+    5399 	DB P1
                             A     5400 
                             A     5401 L1029:  DEFW	L0EC3					; 'code field' - docolon
00001027 C2 0E               A+    5401 	DW P1
                             A     5402 
                             A     5403 ; ----------------
                             A     5404 
                             A     5405 L102A:  DEFW	L104B					; stk_data
00001029 4A 10               A+    5405 	DW P1
                             A     5406 	DEFB	020h						; space delimiter
0000102B 20                  A+    5406 	DB P1
                             A     5407 	DEFW	L05AB					; word  to pad
0000102C AB 05               A+    5407 	DW P1
                             A     5408 	DEFW	L0E09					; 1+
0000102E 08 0E               A+    5408 	DW P1
                             A     5409 	DEFW	L0896					; C@
00001030 95 08               A+    5409 	DW P1
                             A     5410 	DEFW	L1A0E					; end-forth.
00001032 0D 1A               A+    5410 	DW P1
                             A     5411 
00001034 DD CB 3E 76         A     5412 	BIT		6,(IX+03Eh)				; FLAGS
00001038 28 E3               A     5413 	JR		Z,L101E					; back to a jp (iy)
                             A     5414 
0000103A CD B9 04            A     5415 	CALL	L04B9					; forth
                             A     5416 
                             A     5417 L103E:  DEFW	L1011					; stack next word
0000103D 10 10               A+    5417 	DW P1
                             A     5418 	DEFW	L104B					; (stk_data)
0000103F 4A 10               A+    5418 	DW P1
                             A     5419 	DEFW	L0F4E					; ,
00001041 4D 0F               A+    5419 	DW P1
                             A     5420 	DEFW	L0F5F					; c,
00001043 5E 0F               A+    5420 	DW P1
                             A     5421 	DEFW	L04B6					; exit
00001045 B6 04               A+    5421 	DW P1
                             A     5422 
                             A     5423 ; ---
                             A     5424 
                             A     5425 x1048:   DEFB	001h						;; ?
00001047 01                  A+    5425 	DB P1
                             A     5426 
                             A     5427 x1049:   DEFB	0D6h						;; ?
00001048 D6                  A+    5427 	DB P1
                             A     5428 x104a:   DEFB	0FFh						;; ?  104a + ffd6 = 1020 = ASCII
00001049 FF                  A+    5428 	DB P1
                             A     5429 
                             A     5430 ; ----------------------------
                             A     5431 ; The 'stk-data' Internal Word
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  113


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5432 ; ----------------------------
                             A     5433 ; used succinctly to stack the following byte as a word.
                             A     5434 
                             A     5435 L104B:  DEFW	L104D					; headerless 'code field'
0000104A 4C 10               A+    5435 	DW P1
                             A     5436 
                             A     5437 ; ---
                             A     5438 
0000104C E1                  A     5439 L104D:  POP		HL						; retrieve the 'Next Word' pointer.
                             A     5440 
0000104D 5E                  A     5441 	LD		E,(HL)					; fetch the single byte from there.
0000104E 16 00               A     5442 	LD		D,000h					; set high order byte to zero.
                             A     5443 
00001050 06 01               A     5444 	LD		B,001h					; set counter to 1.
                             A     5445 
00001052 18 C4               A     5446 	JR		L1019					; back to stack one word and
                             A     5447 					; put the incremented pointer back on
                             A     5448 					; the Return Stack.
                             A     5449 
                             A     5450 ; --------------------------
                             A     5451 ; The 'stk_fp' Internal Word
                             A     5452 ; --------------------------
                             A     5453 ; stack and enclose a floating point number - two words.
                             A     5454 
                             A     5455 L1055:  DEFW	L1108					; headerless 'code field' - compile
00001054 07 11               A+    5455 	DW P1
                             A     5456 
                             A     5457 ; ---
                             A     5458 
                             A     5459 	DEFW	L1064					; stack two words.
00001056 63 10               A+    5459 	DW P1
                             A     5460 	DEFW	L0885					; swap
00001058 84 08               A+    5460 	DW P1
                             A     5461 	DEFW	L0F4E					; ,
0000105A 4D 0F               A+    5461 	DW P1
                             A     5462 	DEFW	L0F4E					; ,
0000105C 4D 0F               A+    5462 	DW P1
                             A     5463 	DEFW	L04B6					; exit
0000105E B6 04               A+    5463 	DW P1
                             A     5464 ; ---
                             A     5465 
                             A     5466 x1061:   DEFB	004h						;;
00001060 04                  A+    5466 	DB P1
                             A     5467 x1062:   DEFB	0FFh						;; 1062 + ff04 = 0f66 XX
00001061 FF                  A+    5467 	DB P1
                             A     5468 x1063:   DEFB	0FFh						;;
00001062 FF                  A+    5468 	DB P1
                             A     5469 
                             A     5470 ; -----------------------------------
                             A     5471 ; The 'STACK TWO WORDS' Internal Word
                             A     5472 ; -----------------------------------
                             A     5473 
                             A     5474 L1064:  DEFW	L1066					; headerless 'code field'
00001063 65 10               A+    5474 	DW P1
                             A     5475 
                             A     5476 ; ---
                             A     5477 
00001065 06 02               A     5478 L1066:  LD		B,002h					; set counter to two
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  114


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5479 
00001067 18 AB               A     5480 	JR		L1015					; back to stack 2 words
                             A     5481 
                             A     5482 
                             A     5483 ; -----------------
                             A     5484 ; THE 'DEFINER' WORD
                             A     5485 ; -----------------
                             A     5486 ; Used with 'DOES>' to define new defining words. i.e. words that themselves
                             A     5487 ; define new words.
                             A     5488 ; The format is
                             A     5489 ; DEFINER name
                             A     5490 ;		defining routine
                             A     5491 ; DOES>
                             A     5492 ;		action routine
                             A     5493 ; ;
                             A     5494 ; name is the name of the new defining word; when executed it will set up
                             A     5495 ; the header of a new word and use its defining routine to set up the
                             A     5496 ; parameter field. When this new word in its turn is executed, its parameter
                             A     5497 ; field will be put on the stack and the action routine will be executed.
                             A     5498 
                             A     5499 L106A:  DEFM	"DEFINE"				; 'name field'
00001069 44 45 46 49 4E 45   A+    5499 	DB P1
                             A     5500 	DEFB	'R'+080h
0000106F D2                  A+    5500 	DB P1
                             A     5501 
                             A     5502 	DEFW	L1027					; 'link field'
00001070 26 10               A+    5502 	DW P1
                             A     5503 
                             A     5504 L1073:  DEFB	007h						; 'name length field'
00001072 07                  A+    5504 	DB P1
                             A     5505 
                             A     5506 L1074:  DEFW	L1085					; 'code field' - create and enclose
00001073 84 10               A+    5506 	DW P1
                             A     5507 
                             A     5508 ; ---
                             A     5509 
                             A     5510 L1076:  DEFW	L1085					; create and enclose
00001075 84 10               A+    5510 	DW P1
                             A     5511 	DEFW	L0460					; here
00001077 60 04               A+    5511 	DW P1
                             A     5512 
                             A     5513 	DEFW	L104B					; stk-data
00001079 4A 10               A+    5513 	DW P1
                             A     5514 
                             A     5515 	DEFB	00Ch						; 12					marker byte
0000107B 0C                  A+    5515 	DB P1
                             A     5516 
                             A     5517 	DEFW	L0F83					; allot2
0000107C 82 0F               A+    5517 	DW P1
                             A     5518 	DEFW	L1276					; branch
0000107E 75 12               A+    5518 	DW P1
                             A     5519 L1081:  DEFW	0FE34h					; back to L0EB6
00001080 34 FE               A+    5519 	DW P1
                             A     5520 
                             A     5521 ; ---
                             A     5522 
                             A     5523 x1083:   DEFB	0E6h						;;
00001082 E6                  A+    5523 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  115


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5524 x1084:   DEFB	0FFh						;; 1084 + ffe6 = 106a = DEFINER
00001083 FF                  A+    5524 	DB P1
                             A     5525 
                             A     5526 ; ---
                             A     5527 ;; createe and fill
                             A     5528 ; ----
                             A     5529 ; used seven times as a code word.
                             A     5530 
00001084 CD EF 0F            A     5531 L1085:  CALL	L0FF0					; push word DE (save addr nxt wrd on DS)
                             A     5532 
                             A     5533 	DEFW	L0ED0					; create
00001087 CF 0E               A+    5533 	DW P1
                             A     5534 	DEFW	L086B					; dup
00001089 6A 08               A+    5534 	DW P1
                             A     5535 	DEFW	L08B3					; @
0000108B B2 08               A+    5535 	DW P1
                             A     5536 	DEFW	L0460					; here
0000108D 60 04               A+    5536 	DW P1
                             A     5537 	DEFW	L0E29					; 2-
0000108F 28 0E               A+    5537 	DW P1
                             A     5538 	DEFW	L08C1					; !
00001091 C0 08               A+    5538 	DW P1
                             A     5539 
                             A     5540 L1094:  DEFW	L0E13					; 2+
00001093 12 0E               A+    5540 	DW P1
                             A     5541 	DEFW	L109A					; pop DE
00001095 99 10               A+    5541 	DW P1
                             A     5542 	DEFW	L04B6					; exit
00001097 B6 04               A+    5542 	DW P1
                             A     5543 
                             A     5544 ; -----------
                             A     5545 ; pop word DE
                             A     5546 ; -----------
                             A     5547 ; branch to addr on stack???
                             A     5548 
                             A     5549 L109A:  DEFW	L109C					; headerless 'code field'
00001099 9B 10               A+    5549 	DW P1
                             A     5550 
                             A     5551 ; ---
                             A     5552 
0000109B DF                  A     5553 L109C:  RST		18H						; unstack Data Word DE
                             A     5554 
0000109C C3 C2 0E            A     5555 	JP		L0EC3					; start new thread.
                             A     5556 
                             A     5557 ; ---------------
                             A     5558 ; THE 'CALL' WORD
                             A     5559 ; ---------------
                             A     5560 ; (address -- )
                             A     5561 ; Executes Z80 machine code at address on the stack. The code is terminated
                             A     5562 ; by a jp (iy)
                             A     5563 ; e.g. in hex
                             A     5564 ; DEFINER CODE DOES> CALL ;
                             A     5565 ; CODE EI FB C, FD C, E9 C,
                             A     5566 ; The word EI will enable interrupts.
                             A     5567 
                             A     5568 L10A0:  DEFM	"CAL"					; 'name field'
0000109F 43 41 4C            A+    5568 	DB P1
                             A     5569 	DEFB	'L'+080h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  116


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000010A2 CC                  A+    5569 	DB P1
                             A     5570 
                             A     5571 	DEFW	L1073					; 'link field'
000010A3 72 10               A+    5571 	DW P1
                             A     5572 
                             A     5573 L10A6:  DEFB	004h						; 'name length field'
000010A5 04                  A+    5573 	DB P1
                             A     5574 
                             A     5575 L10A7:  DEFW	L10A9					; 'code field'
000010A6 A8 10               A+    5575 	DW P1
                             A     5576 
                             A     5577 ; ---
                             A     5578 
000010A8 DF                  A     5579 L10A9:  RST		18H
000010A9 EB                  A     5580 	EX		DE,HL
                             A     5581 
000010AA E9                  A     5582 	JP		(HL)
                             A     5583 
                             A     5584 ; ----------------
                             A     5585 ; THE 'DOES>' WORD
                             A     5586 ; ----------------
                             A     5587 ; See DEFINER.
                             A     5588 
                             A     5589 L10AC:  DEFM	"DOES"					; 'name field'
000010AB 44 4F 45 53         A+    5589 	DB P1
                             A     5590 	DEFB	'>'+080h
000010AF BE                  A+    5590 	DB P1
                             A     5591 
                             A     5592 	DEFW	L10F4					; 'link field'
000010B0 F3 10               A+    5592 	DW P1
                             A     5593 
                             A     5594 L10B3:  DEFB	045h						; 'name length field' (immediate mode)
000010B2 45                  A+    5594 	DB P1
                             A     5595 
                             A     5596 L10B4:  DEFW	L1108					; 'code field' - compile
000010B3 07 11               A+    5596 	DW P1
                             A     5597 
                             A     5598 L10B6:  DEFW	L10E8					; exit
000010B5 E7 10               A+    5598 	DW P1
                             A     5599 
                             A     5600 	DEFW	L12D8					; check??
000010B7 D7 12               A+    5600 	DW P1
                             A     5601 
                             A     5602 	DEFB	00Ch						; 12	
000010B9 0C                  A+    5602 	DB P1
                             A     5603 
                             A     5604 	DEFW	L10CD					;
000010BA CC 10               A+    5604 	DW P1
                             A     5605 	DEFW	L104B					; stk_data
000010BC 4A 10               A+    5605 	DW P1
                             A     5606 
                             A     5607 	DEFB	0CDh						; data					call ?
000010BE CD                  A+    5607 	DB P1
                             A     5608 
                             A     5609 	DEFW	L0F5F					; C,
000010BF 5E 0F               A+    5609 	DW P1
                             A     5610 	DEFW	L1011					; stack next word
000010C1 10 10               A+    5610 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  117


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5611 	DEFW	L0FF0					; (push word DE)
000010C3 EF 0F               A+    5611 	DW P1
                             A     5612 	DEFW	L0F4E					; ,
000010C5 4D 0F               A+    5612 	DW P1
                             A     5613 	DEFW	L104B					; stk-data
000010C7 4A 10               A+    5613 	DW P1
                             A     5614 
                             A     5615 	DEFB	00Ah						; ten					marker byte.
000010C9 0A                  A+    5615 	DB P1
                             A     5616 
                             A     5617 	DEFW	L04B6					; exit
000010CA B6 04               A+    5617 	DW P1
                             A     5618 
                             A     5619 ; -----------------------
                             A     5620 ; The '???' Internal Word
                             A     5621 ; -----------------------
                             A     5622 
                             A     5623 L10CD:  DEFW	L0EC3					; headerless 'code field' - docolon
000010CC C2 0E               A+    5623 	DW P1
                             A     5624 
                             A     5625 ; ---
                             A     5626 
                             A     5627 	DEFW	L086B					; dup
000010CE 6A 08               A+    5627 	DW P1
                             A     5628 	DEFW	L0E29					; 2-
000010D0 28 0E               A+    5628 	DW P1
                             A     5629 	DEFW	L15B5					; namefield
000010D2 B4 15               A+    5629 	DW P1
                             A     5630 	DEFW	L0460					; here
000010D4 60 04               A+    5630 	DW P1
                             A     5631 	DEFW	L0DE1					; -
000010D6 E0 0D               A+    5631 	DW P1
                             A     5632 	DEFW	L0E1F					; 1-
000010D8 1E 0E               A+    5632 	DW P1
                             A     5633 	DEFW	L0F4E					; ,
000010DA 4D 0F               A+    5633 	DW P1
                             A     5634 	DEFW	L0460					; here
000010DC 60 04               A+    5634 	DW P1
                             A     5635 	DEFW	L0885					; swap
000010DE 84 08               A+    5635 	DW P1
                             A     5636 	DEFW	L08C1					; !
000010E0 C0 08               A+    5636 	DW P1
                             A     5637 	DEFW	L04B6					; exit
000010E2 B6 04               A+    5637 	DW P1
                             A     5638 
                             A     5639 ; ---
                             A     5640 
                             A     5641 x10e5:   DEFB	005h						;;
000010E4 05                  A+    5641 	DB P1
                             A     5642 
                             A     5643 x10e6:   DEFB	0C5h						;;
000010E5 C5                  A+    5643 	DB P1
                             A     5644 x10e7:   DEFB	0FFh						;; 10e7 + ffc5 = 10ac = DOES>
000010E6 FF                  A+    5644 	DB P1
                             A     5645 
                             A     5646 ; ---
                             A     5647 
                             A     5648 L10E8:  DEFW	L04B8					; exit?
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  118


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000010E7 B8 04               A+    5648 	DW P1
                             A     5649 
                             A     5650 ; -------------------
                             A     5651 ; THE 'COMPILER' WORD
                             A     5652 ; -------------------
                             A     5653 ; Used with 'RUNS>' for defining new compiling words, i.e. words that are
                             A     5654 ; used within word definitions to give an immediate effect of compiling
                             A     5655 ; some information into the dictionary.
                             A     5656 ; (This is traditionally done with IMMEDIATE, but COMPILER...RUNS> works
                             A     5657 ; better with EDIT etc.)
                             A     5658 
                             A     5659 L10EA:  DEFM	"COMPILE"				; 'name field'
000010E9 43 4F 4D 50 49 4C   A+    5659 	DB P1
000010EF 45                  A+ d  5659
                             A     5660 	DEFB	'R'+080h
000010F0 D2                  A+    5660 	DB P1
                             A     5661 
                             A     5662 	DEFW	L10A6					; 'link field'
000010F1 A5 10               A+    5662 	DW P1
                             A     5663 
                             A     5664 L10F4:  DEFB	008h						; 'name length field'
000010F3 08                  A+    5664 	DB P1
                             A     5665 
                             A     5666 L10F5:  DEFW	L1085					; 'code field' - create and enclose
000010F4 84 10               A+    5666 	DW P1
                             A     5667 
                             A     5668 ; ---
                             A     5669 
                             A     5670 	DEFW	L1108					; compile
000010F6 07 11               A+    5670 	DW P1
                             A     5671 	DEFW	L1160					; immediate
000010F8 5F 11               A+    5671 	DW P1
                             A     5672 	DEFW	L0460					; here
000010FA 60 04               A+    5672 	DW P1
                             A     5673 	DEFW	L104B					; stk_data
000010FC 4A 10               A+    5673 	DW P1
                             A     5674 
                             A     5675 L10FF:  DEFB	00Bh						; 11					marker byte
000010FE 0B                  A+    5675 	DB P1
                             A     5676 
                             A     5677 	DEFW	L0F83					; allot2
000010FF 82 0F               A+    5677 	DW P1
                             A     5678 	DEFW	L1276					; branch
00001101 75 12               A+    5678 	DW P1
                             A     5679 L1104:  DEFW	0FDB1h					; back to L0EB6
00001103 B1 FD               A+    5679 	DW P1
                             A     5680 
                             A     5681 ; ---
                             A     5682 
                             A     5683 x1106:   DEFB	0E3h						;;
00001105 E3                  A+    5683 	DB P1
                             A     5684 x1107:   DEFB	0FFh						;; 1107 + ffe3 = 10ea = COMPILER
00001106 FF                  A+    5684 	DB P1
                             A     5685 
                             A     5686 ; ---------------------
                             A     5687 ; THE 'COMPILE' ROUTINE
                             A     5688 ; ---------------------
                             A     5689 ; Instead of executing code words as they are encountered, lay them down in
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  119


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5690 ; the dictionary along with any parameters.
                             A     5691 
00001107 DD CB 3E 76         A     5692 L1108:  BIT		6,(IX+03Eh)				; test FLAGS - compiler mode ?
0000110B 20 02               A     5693 	JR		NZ,L1110				; skip error if so.
                             A     5694 
0000110D E7                  A     5695 	RST		20H						; Error 4.
                             A     5696 	DEFB	004h						; Compiling word used in interpret mode.
0000110E 04                  A+    5696 	DB P1
                             A     5697 
0000110F CD EF 0F            A     5698 L1110:  CALL	L0FF0					; push word DE (then jp (iy))
                             A     5699 
                             A     5700 	DEFW	L086B					; dup
00001112 6A 08               A+    5700 	DW P1
                             A     5701 	DEFW	L08B3					; @
00001114 B2 08               A+    5701 	DW P1
                             A     5702 	DEFW	L0F4E					; ,
00001116 4D 0F               A+    5702 	DW P1
                             A     5703 	DEFW	L1276					; branch
00001118 75 12               A+    5703 	DW P1
                             A     5704 L111B:  DEFW	0FF78h					; to L1094 - definer code
0000111A 78 FF               A+    5704 	DW P1
                             A     5705 
                             A     5706 ; ----------------
                             A     5707 ; THE 'RUNS>' WORD
                             A     5708 ; ----------------
                             A     5709 ; See COMPILER
                             A     5710 
                             A     5711 L111D:  DEFM	"RUNS"					; 'name field'
0000111C 52 55 4E 53         A+    5711 	DB P1
                             A     5712 	DEFB	'>'+080h
00001120 BE                  A+    5712 	DB P1
                             A     5713 
                             A     5714 	DEFW	L10B3					; 'link field'
00001121 B2 10               A+    5714 	DW P1
                             A     5715 
                             A     5716 L1124:  DEFB	045h						; 'name length field' (immediate mode)
00001123 45                  A+    5716 	DB P1
                             A     5717 
                             A     5718 L1125:  DEFW	L1108					; 'code field' - compile
00001124 07 11               A+    5718 	DW P1
                             A     5719 
                             A     5720 ; ---
                             A     5721 
                             A     5722 L1127:  DEFW	L1140					; vv
00001126 3F 11               A+    5722 	DW P1
                             A     5723 	DEFW	L12D8					; check-for
00001128 D7 12               A+    5723 	DW P1
                             A     5724 	DEFB	00Bh						; 11					marker byte.
0000112A 0B                  A+    5724 	DB P1
                             A     5725 	DEFW	L0885					; swap
0000112B 84 08               A+    5725 	DW P1
                             A     5726 	DEFW	L0F5F					; c,
0000112D 5E 0F               A+    5726 	DW P1
                             A     5727 	DEFW	L10CD					; ?
0000112F CC 10               A+    5727 	DW P1
                             A     5728 	DEFW	L1011					; stack next word
00001131 10 10               A+    5728 	DW P1
                             A     5729 	DEFW	L1142
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  120


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001133 41 11               A+    5729 	DW P1
                             A     5730 	DEFW	L0F4E					; ,
00001135 4D 0F               A+    5730 	DW P1
                             A     5731 
                             A     5732 	DEFW	L104B					; stk-data
00001137 4A 10               A+    5732 	DW P1
                             A     5733 	DEFB	00Ah						; ten.					marker byte.
00001139 0A                  A+    5733 	DB P1
                             A     5734 	DEFW	L04B6					; exit
0000113A B6 04               A+    5734 	DW P1
                             A     5735 
                             A     5736 ; ---
                             A     5737 
                             A     5738 x113d:   DEFB	005h						;;
0000113C 05                  A+    5738 	DB P1
                             A     5739 
                             A     5740 x113e:   DEFB	0DEh						;;
0000113D DE                  A+    5740 	DB P1
                             A     5741 x113f:   DEFB	0FFh						;; 113f + ffde = 111d = RUNS>
0000113E FF                  A+    5741 	DB P1
                             A     5742 
                             A     5743 ; ---
                             A     5744 
                             A     5745 L1140:  DEFW	L04B8
0000113F B8 04               A+    5745 	DW P1
                             A     5746 
00001141 E1                  A     5747 L1142:  POP		HL
00001142 D5                  A     5748 	PUSH	DE
00001143 EB                  A     5749 	EX		DE,HL
                             A     5750 
00001144 D7                  A     5751 	RST		10H						; push word DE
00001145 42                  A     5752 	LD		B,D
00001146 4B                  A     5753 	LD		C,E
00001147 D1                  A     5754 	POP		DE
00001148 D5                  A     5755 	PUSH	DE
00001149 1B                  A     5756 	DEC		DE
0000114A 1B                  A     5757 	DEC		DE
                             A     5758 
0000114B CD 9D 15            A     5759 	CALL	L159E					;
                             A     5760 
0000114E D1                  A     5761 	POP		DE
0000114F C5                  A     5762 	PUSH	BC
00001150 C3 C2 0E            A     5763 	JP		L0EC3					;
                             A     5764 
                             A     5765 ; --------------------
                             A     5766 ; THE 'IMMEDIATE' WORD
                             A     5767 ; --------------------
                             A     5768 ; (  --  )
                             A     5769 ; The most recent word in the current vocabulary is made immediate, so that
                             A     5770 ; it will execute even in compile mode.
                             A     5771 
                             A     5772 L1154:  DEFM	"IMMEDIAT"				; 'name field'
00001153 49 4D 4D 45 44 49   A+    5772 	DB P1
00001159 41 54               A+ d  5772
                             A     5773 	DEFB	'E'+080h
0000115B C5                  A+    5773 	DB P1
                             A     5774 
                             A     5775 	DEFW	L1124					; 'link field'
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  121


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000115C 23 11               A+    5775 	DW P1
                             A     5776 
                             A     5777 L115F:  DEFB	009h						; 'name length field'
0000115E 09                  A+    5777 	DB P1
                             A     5778 
                             A     5779 L1160:  DEFW	L0EC3					; 'code field' - docolon
0000115F C2 0E               A+    5779 	DW P1
                             A     5780 
                             A     5781 ; ---
                             A     5782 
                             A     5783 L1162:  DEFW	L0480					; current
00001161 80 04               A+    5783 	DW P1
                             A     5784 	DEFW	L08B3					; @
00001163 B2 08               A+    5784 	DW P1
                             A     5785 	DEFW	L08B3					; @
00001165 B2 08               A+    5785 	DW P1
                             A     5786 	DEFW	L1A0E					; end-forth.
00001167 0D 1A               A+    5786 	DW P1
                             A     5787 
00001169 DF                  A     5788 L116A:  RST		18H						; pop word DE
0000116A EB                  A     5789 	EX		DE,HL
0000116B CB F6               A     5790 	SET		6,(HL)
0000116D FD E9               A     5791 	JP		(IY)					; to 'next'.
                             A     5792 
                             A     5793 ; ---------------------
                             A     5794 ; THE 'VOCABULARY' WORD
                             A     5795 ; ---------------------
                             A     5796 ; (  --  )
                             A     5797 ; Defines a new vocabulary with the given name.
                             A     5798 
                             A     5799 L1170:  DEFM	"VOCABULAR"				; 'name field'
0000116F 56 4F 43 41 42 55   A+    5799 	DB P1
00001175 4C 41 52            A+ d  5799
                             A     5800 	DEFB	'Y'+080h
00001178 D9                  A+    5800 	DB P1
                             A     5801 
                             A     5802 	DEFW	L115F					; 'link field'
00001179 5E 11               A+    5802 	DW P1
                             A     5803 
                             A     5804 L117C:  DEFB	00Ah						; 'name length field'
0000117B 0A                  A+    5804 	DB P1
                             A     5805 
                             A     5806 L117D:  DEFW	L1085					; 'code field' - create and enclose
0000117C 84 10               A+    5806 	DW P1
                             A     5807 
                             A     5808 ; ---
                             A     5809 
                             A     5810 L117F:  DEFW	L11B5					; set context
0000117E B4 11               A+    5810 	DW P1
                             A     5811 	DEFW	L0480					; current
00001180 80 04               A+    5811 	DW P1
                             A     5812 	DEFW	L08B3					; @
00001182 B2 08               A+    5812 	DW P1
                             A     5813 	DEFW	L0E13					; 2+
00001184 12 0E               A+    5813 	DW P1
                             A     5814 	DEFW	L0F4E					; ,
00001186 4D 0F               A+    5814 	DW P1
                             A     5815 	DEFW	L0688					; stk-zero
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  122


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001188 88 06               A+    5815 	DW P1
                             A     5816 	DEFW	L0F5F					; C,
0000118A 5E 0F               A+    5816 	DW P1
                             A     5817 	DEFW	L0460					; here
0000118C 60 04               A+    5817 	DW P1
                             A     5818 	DEFW	L1011					; stack next word
0000118E 10 10               A+    5818 	DW P1
                             A     5819 	DEFW	VOCLNK					; (VOCLNK)
00001190 35 00               A+    5819 	DW P1
                             A     5820 	DEFW	L086B					; dup
00001192 6A 08               A+    5820 	DW P1
                             A     5821 	DEFW	L08B3					; @
00001194 B2 08               A+    5821 	DW P1
                             A     5822 	DEFW	L0F4E					; ,
00001196 4D 0F               A+    5822 	DW P1
                             A     5823 	DEFW	L08C1					; !
00001198 C0 08               A+    5823 	DW P1
                             A     5824 	DEFW	L04B6					; exit
0000119A B6 04               A+    5824 	DW P1
                             A     5825 
                             A     5826 ; ----------------------
                             A     5827 ; THE 'DEFINITIONS' WORD
                             A     5828 ; ----------------------
                             A     5829 ; (  --  )
                             A     5830 ; The CONTEXT vocabulary is made the CURRENT vocabulary as well.
                             A     5831 
                             A     5832 L119D:  DEFM	"DEFINITION"			; 'name field'
0000119C 44 45 46 49 4E 49   A+    5832 	DB P1
000011A2 54 49 4F 4E         A+ d  5832
                             A     5833 	DEFB	'S'+080h
000011A6 D3                  A+    5833 	DB P1
                             A     5834 
                             A     5835 	DEFW	L117C					; 'link field'
000011A7 7B 11               A+    5835 	DW P1
                             A     5836 
                             A     5837 L11AA:  DEFB	00Bh						; 'name length field'
000011A9 0B                  A+    5837 	DB P1
                             A     5838 
                             A     5839 L11AB:  DEFW	L11AD					; 'code field'
000011AA AC 11               A+    5839 	DW P1
                             A     5840 
                             A     5841 ; ---
                             A     5842 
000011AC 2A 33 00            A     5843 L11AD:  LD		HL,(CONTEXT)				; CONTEXT
000011AF 22 31 00            A     5844 	LD		(CURRENT),HL				; CURRENT
000011B2 FD E9               A     5845 	JP		(IY)					; to 'next'.
                             A     5846 
                             A     5847 ; ---
                             A     5848 
000011B4 ED 53 33 00         A     5849 L11B5:  LD		(CONTEXT),DE				; CONTEXT
000011B8 FD E9               A     5850 	JP		(IY)					; to 'next'.
                             A     5851 
                             A     5852 ; ---
                             A     5853 
                             A     5854 ; -------------
                             A     5855 ; THE 'IF' WORD
                             A     5856 ; -------------
                             A     5857 ; (n -- )
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  123


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5858 ; Used in the form
                             A     5859 ; IF ... THEN
                             A     5860 ; or
                             A     5861 ; IF ... ELSE ... THEN
                             A     5862 ; In the first form, if n is non-zero then the words between IF and THEN
                             A     5863 ; are executed; otherwise they are skipped over.
                             A     5864 ; In the second form, if n is non-zero then the words between IF and ELSE
                             A     5865 ; are executed and those between ELSE and THEN are skipped over, while if
                             A     5866 ; n is zero then the words between IF and ELSE are skipped over and those
                             A     5867 ; between ELSE and THEN are executed.
                             A     5868 
                             A     5869 L11BB:  DEFB	'I'						; 'name field'
000011BA 49                  A+    5869 	DB P1
                             A     5870 	DEFB	'F'+080h
000011BB C6                  A+    5870 	DB P1
                             A     5871 
                             A     5872 	DEFW	L13E0					; 'link field'
000011BC DF 13               A+    5872 	DW P1
                             A     5873 
                             A     5874 L11BF:  DEFB	042h						; 'name length field' (immediate word)
000011BE 42                  A+    5874 	DB P1
                             A     5875 
                             A     5876 	DEFW	L1108					; 'code field' - compile
000011BF 07 11               A+    5876 	DW P1
                             A     5877 
                             A     5878 ; ---
                             A     5879 
                             A     5880 	DEFW	L1283					; ?branch
000011C1 82 12               A+    5880 	DW P1
                             A     5881 	DEFW	L0460					; here
000011C3 60 04               A+    5881 	DW P1
                             A     5882 
                             A     5883 	DEFW	L104B					; stk_data
000011C5 4A 10               A+    5883 	DW P1
                             A     5884 	DEFB	002h						; 2 locations required for jump length
000011C7 02                  A+    5884 	DB P1
                             A     5885 	DEFW	L0F83					; allot2
000011C8 82 0F               A+    5885 	DW P1
                             A     5886 	DEFW	L04B6					; exit
000011CA B6 04               A+    5886 	DW P1
                             A     5887 
                             A     5888 ; ----------------
                             A     5889 ; THE 'WHILE' WORD
                             A     5890 ; ----------------
                             A     5891 ; (n -- )
                             A     5892 ; Used in BEGIN ... WHILE ... REPEAT. If n = 0 then skips over to just past
                             A     5893 ; REPEAT.
                             A     5894 
                             A     5895 L11CD:  DEFM	"WHIL"					; 'name field'
000011CC 57 48 49 4C         A+    5895 	DB P1
                             A     5896 	DEFB	'E'+080h
000011D0 C5                  A+    5896 	DB P1
                             A     5897 
                             A     5898 	DEFW	L11BF					; 'link field'
000011D1 BE 11               A+    5898 	DW P1
                             A     5899 
                             A     5900 L11D4:  DEFB	045h						; 'name length field' (immediate mode)
000011D3 45                  A+    5900 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  124


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     5901 
                             A     5902 L11D5:  DEFW	L1108					; 'code field' - compile
000011D4 07 11               A+    5902 	DW P1
                             A     5903 
                             A     5904 ; ---
                             A     5905 
                             A     5906 	DEFW	L1288					; ?branch
000011D6 87 12               A+    5906 	DW P1
                             A     5907 
                             A     5908 	DEFW	L12D8					; check-for
000011D8 D7 12               A+    5908 	DW P1
                             A     5909 	DEFB	001h						;  1
000011DA 01                  A+    5909 	DB P1
                             A     5910 	DEFW	L0460					; here
000011DB 60 04               A+    5910 	DW P1
                             A     5911 	DEFW	L104B					; stk-data
000011DD 4A 10               A+    5911 	DW P1
                             A     5912 	DEFB	004h						;  four
000011DF 04                  A+    5912 	DB P1
                             A     5913 	DEFW	L0F83					; allot
000011E0 82 0F               A+    5913 	DW P1
                             A     5914 	DEFW	L04B6					; exit
000011E2 B6 04               A+    5914 	DW P1
                             A     5915 
                             A     5916 ; ---------------
                             A     5917 ; THE 'ELSE' WORD
                             A     5918 ; ---------------
                             A     5919 ; (  --  )
                             A     5920 ; Used with IF and THEN.
                             A     5921 
                             A     5922 L11E5:  DEFM	"ELS"					; 'name field'
000011E4 45 4C 53            A+    5922 	DB P1
                             A     5923 	DEFB	'E'+080h
000011E7 C5                  A+    5923 	DB P1
                             A     5924 
                             A     5925 	DEFW	L11D4					; 'link field'
000011E8 D3 11               A+    5925 	DW P1
                             A     5926 
                             A     5927 L11EB:  DEFB	044h						; 'name length field' (immediate mode)
000011EA 44                  A+    5927 	DB P1
                             A     5928 
                             A     5929 L11EC:  DEFW	L1108					; 'code field' - compile
000011EB 07 11               A+    5929 	DW P1
                             A     5930 
                             A     5931 ; ---
                             A     5932 
                             A     5933 	DEFW	L1271					; branch
000011ED 70 12               A+    5933 	DW P1
                             A     5934 
                             A     5935 	DEFW	L12D8					; check-for
000011EF D7 12               A+    5935 	DW P1
                             A     5936 	DEFB	002h						; two
000011F1 02                  A+    5936 	DB P1
                             A     5937 	DEFW	L0F83					; allot2
000011F2 82 0F               A+    5937 	DW P1
                             A     5938 	DEFW	L1225					; ?
000011F4 24 12               A+    5938 	DW P1
                             A     5939 	DEFW	L0460					; here
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  125


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000011F6 60 04               A+    5939 	DW P1
                             A     5940 	DEFW	L0E29					; 2-
000011F8 28 0E               A+    5940 	DW P1
                             A     5941 	DEFW	L104B					; stk-data
000011FA 4A 10               A+    5941 	DW P1
                             A     5942 	DEFB	002h						; two
000011FC 02                  A+    5942 	DB P1
                             A     5943 	DEFW	L04B6					; exit
000011FD B6 04               A+    5943 	DW P1
                             A     5944 
                             A     5945 ; ---------------
                             A     5946 ; THE 'THEN' WORD
                             A     5947 ; ---------------
                             A     5948 ; Used with IF.
                             A     5949 
                             A     5950 L1200:  DEFM	"THE"					; 'name field'
000011FF 54 48 45            A+    5950 	DB P1
                             A     5951 	DEFB	'N'+080h
00001202 CE                  A+    5951 	DB P1
                             A     5952 
                             A     5953 	DEFW	L11EB					; 'link field'
00001203 EA 11               A+    5953 	DW P1
                             A     5954 
                             A     5955 L1206:  DEFB	044h						; 'name length field' (immediate mode)
00001205 44                  A+    5955 	DB P1
                             A     5956 
                             A     5957 L1207:  DEFW	L1108					; 'code field' - compile
00001206 07 11               A+    5957 	DW P1
                             A     5958 
                             A     5959 ; ---
                             A     5960 
                             A     5961 	DEFW	L12A4					; end?
00001208 A3 12               A+    5961 	DW P1
                             A     5962 
                             A     5963 	DEFW	L12D8					; check-for
0000120A D7 12               A+    5963 	DW P1
                             A     5964 	DEFB	002h
0000120C 02                  A+    5964 	DB P1
                             A     5965 	DEFW	L1225					; ?
0000120D 24 12               A+    5965 	DW P1
                             A     5966 	DEFW	L04B6					; exit
0000120F B6 04               A+    5966 	DW P1
                             A     5967 
                             A     5968 ; ---------------
                             A     5969 ; THE 'BEGIN' WORD
                             A     5970 ; ---------------
                             A     5971 ; (  --  )
                             A     5972 ; Used with either UNTIL or WHILE...REPEAT.
                             A     5973 
                             A     5974 L1212:  DEFM	"BEGI"					; 'name field'
00001211 42 45 47 49         A+    5974 	DB P1
                             A     5975 	DEFB	'N'+080h
00001215 CE                  A+    5975 	DB P1
                             A     5976 
                             A     5977 	DEFW	L1206					; 'link field'
00001216 05 12               A+    5977 	DW P1
                             A     5978 
                             A     5979 L1219:  DEFB	045h						; 'name length field' (immediate mode)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  126


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001218 45                  A+    5979 	DB P1
                             A     5980 
                             A     5981 L121A:  DEFW	L1108					; 'code field' - compile
00001219 07 11               A+    5981 	DW P1
                             A     5982 
                             A     5983 ; ---
                             A     5984 
                             A     5985 	DEFW	L129F
0000121B 9E 12               A+    5985 	DW P1
                             A     5986 	DEFW	L0460					; here
0000121D 60 04               A+    5986 	DW P1
                             A     5987 	DEFW	L104B					; stk_data
0000121F 4A 10               A+    5987 	DW P1
                             A     5988 	DEFB	001h						; 1
00001221 01                  A+    5988 	DB P1
                             A     5989 	DEFW	L04B6					; exit
00001222 B6 04               A+    5989 	DW P1
                             A     5990 
                             A     5991 ; -----------------------
                             A     5992 ; The '???' Internal Word
                             A     5993 ; -----------------------
                             A     5994 
                             A     5995 L1225:  DEFW	L0EC3					; headerless 'code field' - docolon
00001224 C2 0E               A+    5995 	DW P1
                             A     5996 
                             A     5997 ; ---
                             A     5998 
                             A     5999 	DEFW	L086B					; dup
00001226 6A 08               A+    5999 	DW P1
                             A     6000 	DEFW	L0460					; here
00001228 60 04               A+    6000 	DW P1
                             A     6001 	DEFW	L0885					; swap
0000122A 84 08               A+    6001 	DW P1
                             A     6002 	DEFW	L0DE1					; -
0000122C E0 0D               A+    6002 	DW P1
                             A     6003 	DEFW	L0E1F					; 1-
0000122E 1E 0E               A+    6003 	DW P1
                             A     6004 	DEFW	L0885					; swap
00001230 84 08               A+    6004 	DW P1
                             A     6005 	DEFW	L08C1					; !
00001232 C0 08               A+    6005 	DW P1
                             A     6006 	DEFW	L04B6					; exit
00001234 B6 04               A+    6006 	DW P1
                             A     6007 
                             A     6008 ; -----------------------
                             A     6009 ; The '???' Internal Word
                             A     6010 ; -----------------------
                             A     6011 
                             A     6012 L1237:  DEFW	L0EC3					; headerless 'code field' - docolon
00001236 C2 0E               A+    6012 	DW P1
                             A     6013 
                             A     6014 ; ---
                             A     6015 
                             A     6016 	DEFW	L0460					; here
00001238 60 04               A+    6016 	DW P1
                             A     6017 	DEFW	L0DE1					; -
0000123A E0 0D               A+    6017 	DW P1
                             A     6018 	DEFW	L0E1F					; 1-
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  127


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000123C 1E 0E               A+    6018 	DW P1
                             A     6019 	DEFW	L0F4E					; ,
0000123E 4D 0F               A+    6019 	DW P1
                             A     6020 	DEFW	L04B6					; exit
00001240 B6 04               A+    6020 	DW P1
                             A     6021 
                             A     6022 
                             A     6023 ; -----------------
                             A     6024 ; THE 'REPEAT' WORD
                             A     6025 ; -----------------
                             A     6026 ; (  --  )
                             A     6027 ; Used in construction BEGIN ... WHILE .. REPEAT.
                             A     6028 ; Causes a jump back to just after BEGIN.
                             A     6029 
                             A     6030 
                             A     6031 L1243:  DEFM	"REPEA"					; 'name field'
00001242 52 45 50 45 41      A+    6031 	DB P1
                             A     6032 	DEFB	'T'+080h
00001247 D4                  A+    6032 	DB P1
                             A     6033 
                             A     6034 	DEFW	L1219					; 'link field'
00001248 18 12               A+    6034 	DW P1
                             A     6035 
                             A     6036 L124B:  DEFB	046h						; 'name length field' (immediate mode)
0000124A 46                  A+    6036 	DB P1
                             A     6037 
                             A     6038 L124C:  DEFW	L1108					; 'code field' - compile
0000124B 07 11               A+    6038 	DW P1
                             A     6039 
                             A     6040 ; ---
                             A     6041 
                             A     6042 L124E:   DEFW	L1276					; branch
0000124D 75 12               A+    6042 	DW P1
                             A     6043 L1250:  DEFW	L12D8					; check_for
0000124F D7 12               A+    6043 	DW P1
                             A     6044 	DEFB	004h						; four
00001251 04                  A+    6044 	DB P1
                             A     6045 	DEFW	L0885					; swap
00001252 84 08               A+    6045 	DW P1
                             A     6046 	DEFW	L1237					; ?
00001254 36 12               A+    6046 	DW P1
                             A     6047 	DEFW	L1225					; ?
00001256 24 12               A+    6047 	DW P1
                             A     6048 	DEFW	L04B6					; exit
00001258 B6 04               A+    6048 	DW P1
                             A     6049 
                             A     6050 ; ----------------
                             A     6051 ; THE 'UNTIL' WORD
                             A     6052 ; ----------------
                             A     6053 ; (n -- )
                             A     6054 ; Used in BEGIN ... UNTIL.
                             A     6055 ; Loops back to BEGIN if n = 0
                             A     6056 
                             A     6057 L125B:  DEFM	"UNTI"					; 'name field'
0000125A 55 4E 54 49         A+    6057 	DB P1
                             A     6058 	DEFB	'L'+080h
0000125E CC                  A+    6058 	DB P1
                             A     6059 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  128


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6060 	DEFW	L124B					; 'link field'
0000125F 4A 12               A+    6060 	DW P1
                             A     6061 
                             A     6062 L1262:  DEFB	045h						; 'name length field' (immediate mode)
00001261 45                  A+    6062 	DB P1
                             A     6063 
                             A     6064 L1263:  DEFW	L1108					; 'code field' - compile
00001262 07 11               A+    6064 	DW P1
                             A     6065 
                             A     6066 ; ---
                             A     6067 
                             A     6068 	DEFW	L128D					; ?branch
00001264 8C 12               A+    6068 	DW P1
                             A     6069 	DEFW	L12D8					; check_for
00001266 D7 12               A+    6069 	DW P1
                             A     6070 	DEFB	001h						;
00001268 01                  A+    6070 	DB P1
                             A     6071 	DEFW	L1237					; ?
00001269 36 12               A+    6071 	DW P1
                             A     6072 	DEFW	L04B6					; exit
0000126B B6 04               A+    6072 	DW P1
                             A     6073 
                             A     6074 ; ---
                             A     6075 
                             A     6076 x126E:   DEFB	002h						;;
0000126D 02                  A+    6076 	DB P1
                             A     6077 
                             A     6078 x126F:   DEFB	075h						;;
0000126E 75                  A+    6078 	DB P1
                             A     6079 x1270:   DEFB	0FFh						;; 1270 + ff75 = 11e5 = ELSE
0000126F FF                  A+    6079 	DB P1
                             A     6080 
                             A     6081 ; ---
                             A     6082 
                             A     6083 
                             A     6084 L1271:  DEFW	L1278					; ?
00001270 77 12               A+    6084 	DW P1
                             A     6085 
                             A     6086 ; ---
                             A     6087 x1273:   DEFB	002h						;;
00001272 02                  A+    6087 	DB P1
                             A     6088 
                             A     6089 x1274:   DEFB	0CEh						;;
00001273 CE                  A+    6089 	DB P1
                             A     6090 x1275:   DEFB	0FFh						;; 1275 + ffce = 1243 = REPEAT
00001274 FF                  A+    6090 	DB P1
                             A     6091 
                             A     6092 ; --------------------------
                             A     6093 ; The 'branch' Internal Word
                             A     6094 ; --------------------------
                             A     6095 
                             A     6096 L1276:  DEFW	L1278					; headerless 'code field'
00001275 77 12               A+    6096 	DW P1
                             A     6097 
                             A     6098 ; ---
                             A     6099 
00001277 E1                  A     6100 L1278:  POP		HL						; drop next word pointer
00001278 5E                  A     6101 	LD		E,(HL)					; read the 16-bit offset
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  129


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001279 23                  A     6102 	INC		HL						; that is 
0000127A 56                  A     6103 	LD		D,(HL)					; stored there.
                             A     6104 
0000127B 19                  A     6105 L127C:  ADD		HL,DE					; add to current address.
                             A     6106 
0000127C C3 BA 04            A     6107 	JP		L04BA					; jump back into address loop so that
                             A     6108 					; a new address gets stacked as IP.
                             A     6109 
                             A     6110 ; ---
                             A     6111 
                             A     6112 x1280:   DEFB	002h						;;
0000127F 02                  A+    6112 	DB P1
                             A     6113 
                             A     6114 x1281:   DEFB	039h						;;
00001280 39                  A+    6114 	DB P1
                             A     6115 x1282:   DEFB	0FFh						;; 1282 + ff39 = 11bb = IF
00001281 FF                  A+    6115 	DB P1
                             A     6116 
                             A     6117 ; ---
                             A     6118 
                             A     6119 L1283:  DEFW	L128F					; from IF, convert, line, min, etc.
00001282 8E 12               A+    6119 	DW P1
                             A     6120 
                             A     6121 ; ---
                             A     6122 
                             A     6123 x1285:   DEFB	002h						;;
00001284 02                  A+    6123 	DB P1
                             A     6124 
                             A     6125 x1286:   DEFB	046h						;;
00001285 46                  A+    6125 	DB P1
                             A     6126 x1287:   DEFB	0FFh						;; 1287 + ff46 = 11cd = WHILE
00001286 FF                  A+    6126 	DB P1
                             A     6127 
                             A     6128 ; ---
                             A     6129 
                             A     6130 L1288:  DEFW	L128F					; from WHILE
00001287 8E 12               A+    6130 	DW P1
                             A     6131 
                             A     6132 ; ---
                             A     6133 
                             A     6134 x128A:  DEFB	002h						;;
00001289 02                  A+    6134 	DB P1
                             A     6135 
                             A     6136 x128B:   DEFB	0CFh						;;
0000128A CF                  A+    6136 	DB P1
                             A     6137 x128C:   DEFB	0FFh						;; 128c + ffcf = 125b = UNTIL
0000128B FF                  A+    6137 	DB P1
                             A     6138 
                             A     6139 ; ---------------------------
                             A     6140 ; The '?branch' Internal Word
                             A     6141 ; ---------------------------
                             A     6142 
                             A     6143 L128D:  DEFW	L128F					; headerless 'code field'
0000128C 8E 12               A+    6143 	DW P1
                             A     6144 
                             A     6145 ; ---
                             A     6146 
0000128E CD 4D 08            A     6147 L128F:  CALL	L084E					; stk_to_bc
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  130


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6148 
00001291 78                  A     6149 	LD		A,B						; test for
00001292 B1                  A     6150 	OR		C						; zero
                             A     6151 
                             A     6152 ; -> from +loop
00001293 28 E2               A     6153 L1294:  JR		Z,L1278					; make the jump to "branch" if zero.
                             A     6154 
00001295 E1                  A     6155 	POP		HL						; else drop the pointer.
00001296 23                  A     6156 	INC		HL						; step over.
00001297 23                  A     6157 	INC		HL						; the jump bytes
00001298 C3 BA 04            A     6158 	JP		L04BA					; jump back into address loop so that
                             A     6159 					; a new address gets stacked as IP.
                             A     6160 
                             A     6161 ; ---
                             A     6162 
                             A     6163 x129C:   DEFB	000h						;;
0000129B 00                  A+    6163 	DB P1
                             A     6164 x129D:   DEFB	074h						;;
0000129C 74                  A+    6164 	DB P1
                             A     6165 x129E:   DEFB	0FFh						;; 129e + ff74 = 1212 = BEGIN
0000129D FF                  A+    6165 	DB P1
                             A     6166 
                             A     6167 ; ---
                             A     6168 
                             A     6169 L129F:  DEFW	L04B9					; forth
0000129E B9 04               A+    6169 	DW P1
                             A     6170 
                             A     6171 ; ---
                             A     6172 
                             A     6173 x12A1:   DEFB	000h						;;
000012A0 00                  A+    6173 	DB P1
                             A     6174 x12A2:   DEFB	05Dh						;;
000012A1 5D                  A+    6174 	DB P1
                             A     6175 x12A3:   DEFB	0FFh						;; 12a3 + ff5d = 1200 = THEN
000012A2 FF                  A+    6175 	DB P1
                             A     6176 
                             A     6177 ; ---
                             A     6178 
                             A     6179 L12A4:  DEFW	L04B9
000012A3 B9 04               A+    6179 	DW P1
                             A     6180 
                             A     6181 ; -------------
                             A     6182 ; THE 'DO' WORD
                             A     6183 ; -------------
                             A     6184 ; (limit, initial value -- )
                             A     6185 ; Sets up a DO loop, initializing the loop counter to the initial value.
                             A     6186 ; The limit and loop counter are stored on the return stack.
                             A     6187 ; See LOOP and +LOOP.
                             A     6188 
                             A     6189 L12A6:  DEFB	'D'						; 'name field'
000012A5 44                  A+    6189 	DB P1
                             A     6190 	DEFB	'O'+080h
000012A6 CF                  A+    6190 	DB P1
                             A     6191 
                             A     6192 	DEFW	L1262					; 'link field'
000012A7 61 12               A+    6192 	DW P1
                             A     6193 
                             A     6194 L12AA:  DEFB	042h						; 'name length field' (immediate mode)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  131


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000012A9 42                  A+    6194 	DB P1
                             A     6195 
                             A     6196 L12AB:  DEFW	L1108					; 'code field' - compile
000012AA 07 11               A+    6196 	DW P1
                             A     6197 
                             A     6198 ; ---
                             A     6199 
                             A     6200 	DEFW	L1323					; shuffle
000012AC 22 13               A+    6200 	DW P1
                             A     6201 	DEFW	L0460					; here
000012AE 60 04               A+    6201 	DW P1
                             A     6202 	DEFW	L104B					; stk_data
000012B0 4A 10               A+    6202 	DW P1
                             A     6203 	DEFB	003h						; 3						marker byte.
000012B2 03                  A+    6203 	DB P1
                             A     6204 	DEFW	L04B6					; exit
000012B3 B6 04               A+    6204 	DW P1
                             A     6205 
                             A     6206 ; ---------------
                             A     6207 ; THE 'LOOP' WORD
                             A     6208 ; ---------------
                             A     6209 ; (  --  )
                             A     6210 ; Like +LOOP (below) but the number added onto the loop counter is 1.
                             A     6211 
                             A     6212 L12B6:  DEFM	"LOO"					; 'name field'
000012B5 4C 4F 4F            A+    6212 	DB P1
                             A     6213 	DEFB	'P'+080h
000012B8 D0                  A+    6213 	DB P1
                             A     6214 
                             A     6215 	DEFW	L12AA					; 'link field'
000012B9 A9 12               A+    6215 	DW P1
                             A     6216 
                             A     6217 L12BC:  DEFB	044h						; 'name length field' (immediate mode)
000012BB 44                  A+    6217 	DB P1
                             A     6218 
                             A     6219 L12BD:  DEFW	L1108					; 'code field' - compile
000012BC 07 11               A+    6219 	DW P1
                             A     6220 
                             A     6221 ; ---
                             A     6222 
                             A     6223 	DEFW	L1332					; shuffle more
000012BE 31 13               A+    6223 	DW P1
                             A     6224 
                             A     6225 L12C1:  DEFW	L12D8					; check-for
000012C0 D7 12               A+    6225 	DW P1
                             A     6226 	DEFB	003h						; 3						marker byte
000012C2 03                  A+    6226 	DB P1
                             A     6227 	DEFW	L1237					; ?
000012C3 36 12               A+    6227 	DW P1
                             A     6228 	DEFW	L04B6					; exit
000012C5 B6 04               A+    6228 	DW P1
                             A     6229 
                             A     6230 ; ----------------
                             A     6231 ; THE '+LOOP' WORD
                             A     6232 ; ----------------
                             A     6233 ; (n -- )
                             A     6234 ; Used with DO. Adds n to the loop counter, and loops back if the loop counter
                             A     6235 ; is now less than the limit (if n >= 0) or greater than the limit (if n < 0).
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  132


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6236 
                             A     6237 L12C8:  DEFM	"+LOO"					; 'name field'
000012C7 2B 4C 4F 4F         A+    6237 	DB P1
                             A     6238 	DEFB	'P'+080h
000012CB D0                  A+    6238 	DB P1
                             A     6239 
                             A     6240 	DEFW	L12BC					; 'link field'
000012CC BB 12               A+    6240 	DW P1
                             A     6241 
                             A     6242 L12CF:  DEFB	045h						; 'name length field' (immediate mode)
000012CE 45                  A+    6242 	DB P1
                             A     6243 
                             A     6244 L12D0:  DEFW	L1108					; 'code field' - compile
000012CF 07 11               A+    6244 	DW P1
                             A     6245 
                             A     6246 ; ---
                             A     6247 
                             A     6248 L12D2:  DEFW	L133C					; ?
000012D1 3B 13               A+    6248 	DW P1
                             A     6249 	DEFW	L1276					; branch
000012D3 75 12               A+    6249 	DW P1
                             A     6250 
                             A     6251 L12D6:  DEFW	0FFEAh					; back to L12C1
000012D5 EA FF               A+    6251 	DW P1
                             A     6252 
                             A     6253 ; -----------------------------
                             A     6254 ; The 'check-for' Internal Word
                             A     6255 ; -----------------------------
                             A     6256 ; Checks for expected marker byte which indicates stack is balanced and that
                             A     6257 ; a previous mandatory word was present.
                             A     6258 
                             A     6259 L12D8:  DEFW	L12DA					; headerless 'code field'
000012D7 D9 12               A+    6259 	DW P1
                             A     6260 
                             A     6261 ; ---
                             A     6262 
000012D9 DF                  A     6263 L12DA:  RST		18H						; pop word DE
000012DA E1                  A     6264 	POP		HL						;
000012DB 7E                  A     6265 	LD		A,(HL)					;
000012DC 23                  A     6266 	INC		HL						;
000012DD E5                  A     6267 	PUSH	HL						;
000012DE 93                  A     6268 	SUB		E						;
000012DF B2                  A     6269 	OR		D						;
                             A     6270 
000012E0 28 4A               A     6271 	JR		Z,L132D					; to next via jp (iy).
                             A     6272 
                             A     6273 ; else...
                             A     6274 
000012E2 E7                  A     6275 	RST		20H						; Error 5
                             A     6276 	DEFB	005h						; Word is not properly structured.
000012E3 05                  A+    6276 	DB P1
                             A     6277 
                             A     6278 ; ------------
                             A     6279 ; THE 'I' WORD
                             A     6280 ; ------------
                             A     6281 ; ( -- loop counter)
                             A     6282 ; Copies the top of the return stack to the data stack. This will be either
                             A     6283 ; the loop counter for the innermost DO...LOOP, or the number most recently
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  133


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6284 ; transferred by >R.
                             A     6285 
                             A     6286 
                             A     6287 L12E5:  DEFB	'I'+080h				; 'name field'
000012E4 C9                  A+    6287 	DB P1
                             A     6288 
                             A     6289 	DEFW	L11AA					; 'link field'
000012E5 A9 11               A+    6289 	DW P1
                             A     6290 
                             A     6291 L12E8:  DEFB	001h						; 'name length field'
000012E7 01                  A+    6291 	DB P1
                             A     6292 
                             A     6293 L12E9:  DEFW	L12EB					; 'code field'
000012E8 EA 12               A+    6293 	DW P1
                             A     6294 
                             A     6295 ; ---
                             A     6296 
000012EA C1                  A     6297 L12EB:  POP		BC						; pop return address
000012EB D1                  A     6298 	POP		DE						; pop the loop counter to DE.
000012EC D5                  A     6299 	PUSH	DE						; now restore the stack
000012ED C5                  A     6300 	PUSH	BC						; exactly as it was.
                             A     6301 
000012EE D7                  A     6302 	RST		10H						; push Data Word DE - inner loop counter
                             A     6303 
000012EF FD E9               A     6304 	JP		(IY)					; to 'next'.
                             A     6305 
                             A     6306 ; -------------
                             A     6307 ; THE 'I'' WORD
                             A     6308 ; -------------
                             A     6309 ; ( -- limit)
                             A     6310 ; Copies the second number down on the return stack to the data stack
                             A     6311 ; (so in a DO loop it copies  the limit of the loop).
                             A     6312 
                             A     6313 L12F2:  DEFB	'I'						; 'name field'
000012F1 49                  A+    6313 	DB P1
                             A     6314 	DEFB	0A7h						; "'"+080h
000012F2 A7                  A+    6314 	DB P1
                             A     6315 
                             A     6316 	DEFW	L12E8					; 'link field'
000012F3 E7 12               A+    6316 	DW P1
                             A     6317 
                             A     6318 L12F6:  DEFB	002h						; 'name length field'
000012F5 02                  A+    6318 	DB P1
                             A     6319 
                             A     6320 L12F7:  DEFW	L12F9					; 'code field'
000012F6 F8 12               A+    6320 	DW P1
                             A     6321 
                             A     6322 ; ---
                             A     6323 
000012F8 21 04 00            A     6324 L12F9:  LD		HL,00004h				; two bytes per entry.
000012FB 18 09               A     6325 	JR		L1307					; forward to use the 'J' indexing 
                             A     6326 					; routine
                             A     6327 
                             A     6328 ; ------------
                             A     6329 ; THE 'J' WORD
                             A     6330 ; ------------
                             A     6331 ; ( -- loop counter)
                             A     6332 ; Copies the third entry on the return stack to the data stack.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  134


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6333 ; This will be either the loop counter for the second innermost DO loop
                             A     6334 ; or the number put on the return stack by the most recent >R.
                             A     6335 
                             A     6336 L12FE:  DEFB	'J'+080h				; 'name field'
000012FD CA                  A+    6336 	DB P1
                             A     6337 
                             A     6338 	DEFW	L12F6					; 'link field'
000012FE F5 12               A+    6338 	DW P1
                             A     6339 
                             A     6340 L1301:  DEFB	001h						; 'name length field'
00001300 01                  A+    6340 	DB P1
                             A     6341 
                             A     6342 L1302:  DEFW	L1304					; 'code field'
00001301 03 13               A+    6342 	DW P1
                             A     6343 
                             A     6344 ; ---
                             A     6345 
00001303 21 06 00            A     6346 L1304:  LD		HL,00006h				; two bytes per entry
                             A     6347 
                             A     6348 ; -> I' joins here with HL=4
                             A     6349 
00001306 39                  A     6350 L1307:  ADD		HL,SP					; index the stack pointer.
00001307 5E                  A     6351 	LD		E,(HL)					; low order byte to E
00001308 23                  A     6352 	INC		HL						; address high byte.
00001309 56                  A     6353 	LD		D,(HL)					; DE now holds a copy of the required
                             A     6354 					; entry from the Return Stack
                             A     6355 
0000130A D7                  A     6356 	RST		10H						; stack Data Word DE
                             A     6357 
0000130B FD E9               A     6358 	JP		(IY)					; to 'next'.
                             A     6359 
                             A     6360 ; ----------------
                             A     6361 ; THE 'LEAVE' WORD
                             A     6362 ; ----------------
                             A     6363 ; (  --  )
                             A     6364 ; Forces termination of a DO loop at the next LOOP or +LOOP by setting the
                             A     6365 ; loop counter equal to the limit.
                             A     6366 
                             A     6367 L130E:  DEFM	"LEAV"					; 'name field'
0000130D 4C 45 41 56         A+    6367 	DB P1
                             A     6368 	DEFB	'E'+080h
00001311 C5                  A+    6368 	DB P1
                             A     6369 
                             A     6370 	DEFW	L1301					; 'link field'
00001312 00 13               A+    6370 	DW P1
                             A     6371 
                             A     6372 L1315:  DEFB	005h						; 'name length field'
00001314 05                  A+    6372 	DB P1
                             A     6373 
                             A     6374 L1316:  DEFW	L1318					; 'code field'
00001315 17 13               A+    6374 	DW P1
                             A     6375 
                             A     6376 ; ---
                             A     6377 
00001317 C1                  A     6378 L1318:  POP		BC						; pop return address to BC.
00001318 E1                  A     6379 	POP		HL						; pop the loop counter.
00001319 E1                  A     6380 	POP		HL						; now the limit.
0000131A E5                  A     6381 	PUSH	HL						; push unaltered limit.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  135


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000131B E5                  A     6382 	PUSH	HL						; push counter - now limit.
0000131C C5                  A     6383 	PUSH	BC						; restore return address.
                             A     6384 
0000131D FD E9               A     6385 	JP		(IY)					; to 'next'.
                             A     6386 
                             A     6387 ; ---
                             A     6388 
                             A     6389 
                             A     6390 x1320:   DEFB	000h						;;
0000131F 00                  A+    6390 	DB P1
                             A     6391 x1321:   DEFB	084h						;;
00001320 84                  A+    6391 	DB P1
                             A     6392 x1322:   DEFB	0FFh						;; 1322 + ff84 = 12a6 = DO
00001321 FF                  A+    6392 	DB P1
                             A     6393 
                             A     6394 ; -----------------------
                             A     6395 ; The '???' Internal Word
                             A     6396 ; -----------------------
                             A     6397 
                             A     6398 L1323:  DEFW	L1325					; headerless 'code field'
00001322 24 13               A+    6398 	DW P1
                             A     6399 
                             A     6400 ; ---
                             A     6401 
00001324 CD 4D 08            A     6402 L1325:  CALL	L084E					; stk_to_bc
00001327 DF                  A     6403 	RST		18H						; pop word DE
00001328 E1                  A     6404 	POP		HL
00001329 D5                  A     6405 	PUSH	DE
                             A     6406 
0000132A C5                  A     6407 L132B:  PUSH	BC
0000132B E5                  A     6408 	PUSH	HL
                             A     6409 
0000132C FD E9               A     6410 L132D:  JP		(IY)					; to 'next'.
                             A     6411 
                             A     6412 ; ---
                             A     6413 
                             A     6414 x132F:   DEFB	002h						;;
0000132E 02                  A+    6414 	DB P1
                             A     6415 x1330:   DEFB	085h						;;
0000132F 85                  A+    6415 	DB P1
                             A     6416 x1331:   DEFB	0FFh						;; 1331 + ff85 = 12b6 = LOOP
00001330 FF                  A+    6416 	DB P1
                             A     6417 
                             A     6418 ; -----------------------
                             A     6419 ; The '???' Internal Word
                             A     6420 ; -----------------------
                             A     6421 
                             A     6422 L1332:  DEFW	L1334					; headerless 'code field'
00001331 33 13               A+    6422 	DW P1
                             A     6423 
                             A     6424 ; ---
                             A     6425 
00001333 11 01 00            A     6426 L1334:  LD		DE,00001h
00001336 18 06               A     6427 	JR		L133F					; forward =>
                             A     6428 
                             A     6429 ; ---
                             A     6430 
                             A     6431 x1339:   DEFB	002h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  136


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001338 02                  A+    6431 	DB P1
                             A     6432 x133A:   DEFB	08Dh
00001339 8D                  A+    6432 	DB P1
                             A     6433 x133B:   DEFB	0FFh
0000133A FF                  A+    6433 	DB P1
                             A     6434 
                             A     6435 ; -----------------------
                             A     6436 ; The '???' Internal Word
                             A     6437 ; -----------------------
                             A     6438 ; loop counter + n
                             A     6439 ; Note. ADC HL,DE is used in preference to ADD HL,DE as affects P/O flag
                             A     6440 
                             A     6441 L133C:  DEFW	L133E					; headerless 'code field'
0000133B 3D 13               A+    6441 	DW P1
                             A     6442 
                             A     6443 ; ---
                             A     6444 
0000133D DF                  A     6445 L133E:  RST		18H						; pop word DE - number to be added (n)
                             A     6446 ; =>
0000133E C1                  A     6447 L133F:  POP		BC						; pop return address to BC.
0000133F E1                  A     6448 	POP		HL						; loop counter to HL.
00001340 A7                  A     6449 	AND		A						; clear carry.
00001341 ED 5A               A     6450 	ADC		HL,DE					; add the number specified.
00001343 7A                  A     6451 	LD		A,D						; save MSB of (n) in A.
00001344 D1                  A     6452 	POP		DE						; now pop the limit to DE.
00001345 37                  A     6453 	SCF								; set carry.
00001346 EA 57 13            A     6454 	JP		PE,L1358				; jump forward with overflow.
                             A     6455 
00001349 D5                  A     6456 	PUSH	DE						; push limit 
0000134A E5                  A     6457 	PUSH	HL						; push adjusted counter.
0000134B 07                  A     6458 	RLCA							; now test sign of number (n)
0000134C 30 01               A     6459 	JR		NC,L1350				;
                             A     6460 
0000134E EB                  A     6461 	EX		DE,HL
                             A     6462 
0000134F CD 98 0C            A     6463 L1350:  CALL	L0C99					;
                             A     6464 
00001352 3F                  A     6465 	CCF
                             A     6466 
00001353 30 02               A     6467 	JR		NC,L1358				;
                             A     6468 
00001355 E1                  A     6469 	POP		HL
00001356 E1                  A     6470 	POP		HL
                             A     6471 
00001357 C5                  A     6472 L1358:  PUSH	BC
00001358 9F                  A     6473 	SBC		A,A
00001359 C3 93 12            A     6474 	JP		L1294					; jump to branch on zero.
                             A     6475 
                             A     6476 ; ------------
                             A     6477 ; THE '(' WORD
                             A     6478 ; ------------
                             A     6479 ; Starts a comment terminated by ')'
                             A     6480 
                             A     6481 L135D:  DEFB	'('+080h				; 'name field'
0000135C A8                  A+    6481 	DB P1
                             A     6482 
                             A     6483 	DEFW	L13D4					; 'link field'
0000135D D3 13               A+    6483 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  137


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6484 
                             A     6485 L1360:  DEFB	041h						; 'name length field' (immediate mode)
0000135F 41                  A+    6485 	DB P1
                             A     6486 
                             A     6487 L1361:  DEFW	L1108					; 'code field' - compile
00001360 07 11               A+    6487 	DW P1
                             A     6488 
                             A     6489 ; ---
                             A     6490 
                             A     6491 L1363:  DEFW	L1379					;
00001362 78 13               A+    6491 	DW P1
                             A     6492 	DEFW	L104B					; stk_data
00001364 4A 10               A+    6492 	DW P1
                             A     6493 
                             A     6494 	DEFB	029h						; character ')'			- delimiter
00001366 29                  A+    6494 	DB P1
                             A     6495 
                             A     6496 L1368:  DEFW	L0460					; here
00001367 60 04               A+    6496 	DW P1
                             A     6497 	DEFW	L0885					; swap
00001369 84 08               A+    6497 	DW P1
                             A     6498 	DEFW	L0F83					; allot2
0000136B 82 0F               A+    6498 	DW P1
                             A     6499 	DEFW	L139F					; find)
0000136D 9E 13               A+    6499 	DW P1
                             A     6500 	DEFW	L0885					; swap
0000136F 84 08               A+    6500 	DW P1
                             A     6501 	DEFW	L08C1					; !
00001371 C0 08               A+    6501 	DW P1
                             A     6502 
                             A     6503 	DEFW	L04B6					; exit
00001373 B6 04               A+    6503 	DW P1
                             A     6504 
                             A     6505 ; ---
                             A     6506 
                             A     6507 x1376:   DEFB	0FFh						;;
00001375 FF                  A+    6507 	DB P1
                             A     6508 x1377:   DEFB	0E5h						;;
00001376 E5                  A+    6508 	DB P1
                             A     6509 x1378:   DEFB	0FFh						;; 1378 + ffe5 = 135d = '('
00001377 FF                  A+    6509 	DB P1
                             A     6510 
                             A     6511 ; -----------------------
                             A     6512 ; The '???' Internal Word
                             A     6513 ; -----------------------
                             A     6514 
                             A     6515 L1379:  DEFW	L137B					; headerless 'code field'
00001378 7A 13               A+    6515 	DW P1
                             A     6516 
                             A     6517 ; ---
                             A     6518 
0000137A E1                  A     6519 L137B:  POP		HL
0000137B 5E                  A     6520 	LD		E,(HL)
0000137C 23                  A     6521 	INC		HL
0000137D 56                  A     6522 	LD		D,(HL)
                             A     6523 
0000137E 13                  A     6524 	INC		DE
                             A     6525 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  138


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000137F C3 7B 12            A     6526 	JP		L127C					;
                             A     6527 
                             A     6528 ; -------------
                             A     6529 ; THE '."' WORD
                             A     6530 ; -------------
                             A     6531 ; (  --  )
                             A     6532 ; Prints the following string terminated by ".
                             A     6533 
                             A     6534 L1383:  DEFB	'.'						; 'name field'
00001382 2E                  A+    6534 	DB P1
                             A     6535 	DEFB	'"'+080h
00001383 A2                  A+    6535 	DB P1
                             A     6536 
                             A     6537 	DEFW	L1360					; 'link field'
00001384 5F 13               A+    6537 	DW P1
                             A     6538 
                             A     6539 L1387:  DEFB	042h						; 'name length field' (immediate mode)
00001386 42                  A+    6539 	DB P1
                             A     6540 
                             A     6541 L1388:  DEFW	L1108					; 'code field' - compile
00001387 07 11               A+    6541 	DW P1
                             A     6542 
                             A     6543 ; ---
                             A     6544 
                             A     6545 L138A:  DEFW	L1396					; pr_embedded string.
00001389 95 13               A+    6545 	DW P1
                             A     6546 	DEFW	L104B					; stk_data
0000138B 4A 10               A+    6546 	DW P1
                             A     6547 	DEFB	022h						; '"'					- delimiter
0000138D 22                  A+    6547 	DB P1
                             A     6548 
                             A     6549 	DEFW	L1276					; branch
0000138E 75 12               A+    6549 	DW P1
                             A     6550 L1391:  DEFW	0FFD6h					; back to 1368 (1392+0FFD6h)
00001390 D6 FF               A+    6550 	DW P1
                             A     6551 					; same routine as for matching comments
                             A     6552 
                             A     6553 ; ---
                             A     6554 
                             A     6555 x1393:   DEFB	0FFh						;;
00001392 FF                  A+    6555 	DB P1
                             A     6556 x1394:   DEFB	0EEh						;;
00001393 EE                  A+    6556 	DB P1
                             A     6557 x1395:   DEFB	0FFh						;; 1395 + ffee = 1383 = ."
00001394 FF                  A+    6557 	DB P1
                             A     6558 
                             A     6559 ; -----------------------
                             A     6560 ; The '???' Internal Word
                             A     6561 ; -----------------------
                             A     6562 ; print string embedded in Dictionary
                             A     6563 
                             A     6564 L1396:  DEFW	L1398					; headerless 'code field'
00001395 97 13               A+    6564 	DW P1
                             A     6565 
                             A     6566 ; ---
                             A     6567 
00001397 D1                  A     6568 L1398:  POP		DE
00001398 CD 78 09            A     6569 	CALL	L0979					; pr_string1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  139


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000139B D5                  A     6570 	PUSH	DE
0000139C FD E9               A     6571 	JP		(IY)					; to 'next'.
                             A     6572 
                             A     6573 ; -----------------------
                             A     6574 ; The '???' Internal Word
                             A     6575 ; -----------------------
                             A     6576 ; enclose comment
                             A     6577 ; comments may be multiple 
                             A     6578 ; e.g. : SV ( system) ( variables) CLS BEGIN 0 0 AT 15360 80 TYPE 0 UNTIL ;
                             A     6579 
                             A     6580 
                             A     6581 L139F:  DEFW	L13A1					; headerless 'code field'
0000139E A0 13               A+    6581 	DW P1
                             A     6582 
                             A     6583 ; ---
                             A     6584 
000013A0 DF                  A     6585 L13A1:  RST		18H						; pop word DE
000013A1 D5                  A     6586 	PUSH	DE						; save delimiter.
                             A     6587 
000013A2 CD E1 05            A     6588 	CALL	L05E1					; find the ')' delimiter
                             A     6589 
000013A5 62                  A     6590 	LD		H,D
000013A6 6B                  A     6591 	LD		L,E
000013A7 09                  A     6592 	ADD		HL,BC
000013A8 7E                  A     6593 	LD		A,(HL)
000013A9 E1                  A     6594 	POP		HL						; pop the delimiter.
000013AA BD                  A     6595 	CP		L
000013AB 28 0A               A     6596 	JR		Z,L13B8					; forward with a match.			=->
                             A     6597 
000013AD EB                  A     6598 	EX		DE,HL					; 
000013AE D7                  A     6599 	RST		10H						; push word DE
000013AF 11 78 05            A     6600 	LD		DE,00578h				; addr retype?
                             A     6601 
000013B2 CD 14 18            A     6602 	CALL	L1815					; pr2
                             A     6603 
000013B5 18 E9               A     6604 	JR		L13A1					; loop back
                             A     6605 
                             A     6606 ; ---
                             A     6607 ; =->
                             A     6608 
000013B7 D5                  A     6609 L13B8:  PUSH	DE
000013B8 C5                  A     6610 	PUSH	BC
000013B9 2A 37 00            A     6611 	LD		HL,(STKBOT)				; STKBOT
                             A     6612 
000013BC CD 9D 0F            A     6613 	CALL	L0F9E					; routine MAKE ROOM
                             A     6614 
000013BF C1                  A     6615 	POP		BC
000013C0 D1                  A     6616 	POP		DE
000013C1 D5                  A     6617 	PUSH	DE
000013C2 C5                  A     6618 	PUSH	BC
000013C3 EB                  A     6619 	EX		DE,HL
000013C4 ED B0               A     6620 	LDIR							; copy comment to dictionary.
000013C6 C1                  A     6621 	POP		BC
000013C7 50                  A     6622 	LD		D,B
000013C8 59                  A     6623 	LD		E,C
000013C9 D7                  A     6624 	RST		10H						; push word DE
000013CA D1                  A     6625 	POP		DE
                             A     6626 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  140


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000013CB CD DA 07            A     6627 	CALL	L07DA					;
                             A     6628 
000013CE FD E9               A     6629 	JP		(IY)					; to 'next'.
                             A     6630 
                             A     6631 ; ------------
                             A     6632 ; THE '[' WORD
                             A     6633 ; ------------
                             A     6634 ; (  --  )
                             A     6635 ; Enters interpret mode.
                             A     6636 
                             A     6637 L13D1:  DEFB	'['+080h				; 'name field'
000013D0 DB                  A+    6637 	DB P1
                             A     6638 
                             A     6639 	DEFW	L12CF					; 'link field'
000013D1 CE 12               A+    6639 	DW P1
                             A     6640 
                             A     6641 L13D4:  DEFB	041h						; 'name length field' (immediate mode)
000013D3 41                  A+    6641 	DB P1
                             A     6642 
                             A     6643 L13D5:  DEFW	L13D7					; 'code field'
000013D4 D6 13               A+    6643 	DW P1
                             A     6644 
                             A     6645 ; ---
                             A     6646 
000013D6 DD CB 3E B6         A     6647 L13D7:  RES		6,(IX+03Eh)				; FLAGS
000013DA FD E9               A     6648 	JP		(IY)					; to 'next'.
                             A     6649 
                             A     6650 ; ------------
                             A     6651 ; THE ']' WORD
                             A     6652 ; ------------
                             A     6653 ; (  --  )
                             A     6654 ; Enters compile mode.
                             A     6655 
                             A     6656 L13DD:  DEFB	']'+080h				; 'name field'
000013DC DD                  A+    6656 	DB P1
                             A     6657 
                             A     6658 	DEFW	L1315					; 'link field'
000013DD 14 13               A+    6658 	DW P1
                             A     6659 
                             A     6660 L13E0:  DEFB	001h						; 'name length field'
000013DF 01                  A+    6660 	DB P1
                             A     6661 
                             A     6662 L13E1:  DEFW	L13E3					; 'code field'
000013E0 E2 13               A+    6662 	DW P1
                             A     6663 
                             A     6664 ; ---
                             A     6665 
000013E2 DD CB 3E F6         A     6666 L13E3:  SET		6,(IX+03Eh)				; FLAGS
000013E6 FD E9               A     6667 	JP		(IY)					; to 'next'.
                             A     6668 
                             A     6669 
                             A     6670 ; ---------------
                             A     6671 ; THE 'EXIT' WORD
                             A     6672 ; ---------------
                             A     6673 ; (  --  )
                             A     6674 ; Exits immediately from the word in whose definition it is contained.
                             A     6675 ; Cannot be used between DO and LOOP or +LOOP, nor between >R and R>.
                             A     6676 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  141


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     6677 L13E9:  DEFM	"EXI"					; 'name field'
000013E8 45 58 49            A+    6677 	DB P1
                             A     6678 	DEFB	'T'+080h
000013EB D4                  A+    6678 	DB P1
                             A     6679 
                             A     6680 	DEFW	L1387					; 'link field'
000013EC 86 13               A+    6680 	DW P1
                             A     6681 
                             A     6682 L13EF:  DEFB	004h						; 'name length field'
000013EE 04                  A+    6682 	DB P1
                             A     6683 
                             A     6684 L13F0:  DEFW	L04B8					; 'code field'
000013EF B8 04               A+    6684 	DW P1
                             A     6685 
                             A     6686 ; -------------------
                             A     6687 ; THE 'REDEFINE' WORD
                             A     6688 ; -------------------
                             A     6689 ; REDEFINE name
                             A     6690 ; (  --  )
                             A     6691 ; Takes word 'name' and replaces it with the most recent word in the
                             A     6692 ; dictionary. Updates entire dictionary to take changes into account.
                             A     6693 ; Most commonly used as
                             A     6694 ;  EDIT name
                             A     6695 ;  REDEFINE name
                             A     6696 
                             A     6697 L13F2:  DEFM	"REDEFIN"				; 'name field'
000013F1 52 45 44 45 46 49   A+    6697 	DB P1
000013F7 4E                  A+ d  6697
                             A     6698 	DEFB	'E'+080h
000013F8 C5                  A+    6698 	DB P1
                             A     6699 
                             A     6700 	DEFW	L13EF					; 'link field'
000013F9 EE 13               A+    6700 	DW P1
                             A     6701 
                             A     6702 L13FC:  DEFB	008h						; 'name length field'
000013FB 08                  A+    6702 	DB P1
                             A     6703 
                             A     6704 L13FD:  DEFW	L13FF					; 'code field'
000013FC FE 13               A+    6704 	DW P1
                             A     6705 
                             A     6706 ; ---
                             A     6707 
000013FE CD 2D 0F            A     6708 L13FF:  CALL	L0F2E					; blank stack
                             A     6709 
00001401 2A 31 00            A     6710 	LD		HL,(CURRENT)				; CURRENT
                             A     6711 
00001404 5E                  A     6712 	LD		E,(HL)
00001405 23                  A     6713 	INC		HL
00001406 56                  A     6714 	LD		D,(HL)
                             A     6715 
00001407 EB                  A     6716 	EX		DE,HL					; transfer value to HL
00001408 23                  A     6717 	INC		HL
00001409 22 05 27            A     6718 	LD		(02705h),HL				; store in pad
                             A     6719 
0000140C E5                  A     6720 	PUSH	HL						; (*)
                             A     6721 
0000140D CD BF 15            A     6722 	CALL	L15C0					; get 'name field' address
                             A     6723 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  142


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001410 22 0D 27            A     6724 	LD		(0270Dh),HL				; name field addr
00001413 ED 43 07 27         A     6725 	LD		(02707h),BC				; parameter field addr
00001417 ED 53 0B 27         A     6726 	LD		(0270Bh),DE				; length field value
                             A     6727 
0000141B 2A 37 00            A     6728 	LD		HL,(STKBOT)				; STKBOT
0000141E ED 52               A     6729 	SBC		HL,DE
00001420 C2 D9 14            A     6730 	JP		NZ,L14DA				; forward if not matched to Error 11.
                             A     6731 
00001423 D1                  A     6732 	POP		DE						; (*)
                             A     6733 
00001424 D7                  A     6734 	RST		10H						; push word DE
                             A     6735 
00001425 CD B9 04            A     6736 	CALL	L04B9					; forth
                             A     6737 
                             A     6738 L1429:  DEFW	L1610					; prvcur
00001428 0F 16               A+    6738 	DW P1
                             A     6739 	DEFW	L063D					; find
0000142A 3D 06               A+    6739 	DW P1
                             A     6740 	DEFW	L1A0E					; end-forth.
0000142C 0D 1A               A+    6740 	DW P1
                             A     6741 
                             A     6742 ; ---
                             A     6743 
0000142E DF                  A     6744 L1425:  RST		18H						; pop word DE
0000142F 21 AF C3            A     6745 	LD		HL,0C3AFh
00001432 19                  A     6746 	ADD		HL,DE
00001433 D2 CE 14            A     6747 	JP		NC,L14CF				;
                             A     6748 
00001436 EB                  A     6749 	EX		DE,HL
00001437 22 03 27            A     6750 	LD		(02703h),HL
                             A     6751 
0000143A CD BF 15            A     6752 	CALL	L15C0					; get 'name field' address
                             A     6753 
0000143D 22 01 27            A     6754 	LD		(02701h),HL
                             A     6755 
00001440 E5                  A     6756 L1441:  PUSH	HL
00001441 ED 53 09 27         A     6757 	LD		(02709h),DE
00001445 78                  A     6758 	LD		A,B
00001446 B1                  A     6759 	OR		C
00001447 ED 5B 07 27         A     6760 	LD		DE,(02707h)
0000144B 28 04               A     6761 	JR		Z,L1452					;
                             A     6762 
0000144D 7A                  A     6763 	LD		A,D
0000144E B3                  A     6764 	OR		E
0000144F 28 7D               A     6765 	JR		Z,L14CF					;
                             A     6766 
00001451 E1                  A     6767 L1452:  POP		HL
00001452 ED 4B 0D 27         A     6768 	LD		BC,(0270Dh)
00001456 ED 42               A     6769 	SBC		HL,BC
00001458 EB                  A     6770 	EX		DE,HL
00001459 19                  A     6771 	ADD		HL,DE
0000145A 22 07 27            A     6772 	LD		(02707h),HL
0000145D 2A 0B 27            A     6773 	LD		HL,(0270Bh)
00001460 19                  A     6774 	ADD		HL,DE
00001461 ED 4B 09 27         A     6775 	LD		BC,(02709h)
00001465 A7                  A     6776 	AND		A
00001466 ED 42               A     6777 	SBC		HL,BC
00001468 22 0B 27            A     6778 	LD		(0270Bh),HL
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  143


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000146B 01 2E 00            A     6779 	LD		BC,0002Eh				; 46d
0000146E 09                  A     6780 	ADD		HL,BC
0000146F CB 7C               A     6781 	BIT		7,H
00001471 20 0B               A     6782 	JR		NZ,L147F				;
                             A     6783 
00001473 ED 4B 3B 00         A     6784 	LD		BC,(SPARE)				; SPARE
00001477 09                  A     6785 	ADD		HL,BC
00001478 38 54               A     6786 	JR		C,L14CF					;
                             A     6787 
0000147A ED 72               A     6788 	SBC		HL,SP
0000147C 30 50               A     6789 	JR		NC,L14CF				;
                             A     6790 
0000147E 2A 03 27            A     6791 L147F:  LD		HL,(02703h)
00001481 E5                  A     6792 	PUSH	HL
00001482 2B                  A     6793 	DEC		HL
00001483 2B                  A     6794 	DEC		HL
00001484 46                  A     6795 	LD		B,(HL)
00001485 2B                  A     6796 	DEC		HL
00001486 4E                  A     6797 	LD		C,(HL)
00001487 2A 05 27            A     6798 	LD		HL,(02705h)
0000148A E5                  A     6799 	PUSH	HL
0000148B 2B                  A     6800 	DEC		HL
0000148C 2B                  A     6801 	DEC		HL
0000148D 70                  A     6802 	LD		(HL),B
0000148E 2B                  A     6803 	DEC		HL
0000148F 71                  A     6804 	LD		(HL),C
00001490 E1                  A     6805 	POP		HL
00001491 19                  A     6806 	ADD		HL,DE
00001492 C1                  A     6807 	POP		BC
00001493 A7                  A     6808 	AND		A
00001494 ED 42               A     6809 	SBC		HL,BC
00001496 22 05 27            A     6810 	LD		(02705h),HL
00001499 ED 5B 01 27         A     6811 	LD		DE,(02701h)
0000149D 2A 09 27            A     6812 	LD		HL,(02709h)
000014A0 A7                  A     6813 	AND		A
000014A1 ED 52               A     6814 	SBC		HL,DE
000014A3 44                  A     6815 	LD		B,H
000014A4 4D                  A     6816 	LD		C,L
000014A5 D5                  A     6817 	PUSH	DE
000014A6 C5                  A     6818 	PUSH	BC
                             A     6819 
000014A7 CD DB 14            A     6820 	CALL	L14DC					; RECLAIM
                             A     6821 
000014AA 2A 0B 27            A     6822 	LD		HL,(0270Bh)
000014AD C1                  A     6823 	POP		BC
000014AE 09                  A     6824 	ADD		HL,BC
000014AF 44                  A     6825 	LD		B,H
000014B0 4D                  A     6826 	LD		C,L
000014B1 E1                  A     6827 	POP		HL
000014B2 C5                  A     6828 	PUSH	BC
                             A     6829 
000014B3 CD 9D 0F            A     6830 	CALL	L0F9E					; routine MAKE ROOM
                             A     6831 
000014B6 EB                  A     6832 	EX		DE,HL					;
000014B7 2A 0D 27            A     6833 	LD		HL,(0270Dh)				;
000014BA ED 4B 0B 27         A     6834 	LD		BC,(0270Bh)				;
000014BE 09                  A     6835 	ADD		HL,BC					;
000014BF C1                  A     6836 	POP		BC						;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  144


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000014C0 C5                  A     6837 	PUSH	BC						;
000014C1 E5                  A     6838 	PUSH	HL						;
                             A     6839 
000014C2 ED B0               A     6840 	LDIR							;
                             A     6841 
000014C4 D1                  A     6842 	POP		DE
000014C5 C1                  A     6843 	POP		BC
                             A     6844 
000014C6 CD DB 14            A     6845 	CALL	L14DC					; RECLAIM
000014C9 CD F7 14            A     6846 	CALL	L14F8					;
                             A     6847 
000014CC FD E9               A     6848 	JP		(IY)					; to 'next'.
                             A     6849 
                             A     6850 ; ---
                             A     6851 
000014CE 2A 31 00            A     6852 L14CF:  LD		HL,(CURRENT)				; CURRENT
000014D1 ED 5B 05 27         A     6853 	LD		DE,(02705h)
000014D5 1B                  A     6854 	DEC		DE
000014D6 73                  A     6855 	LD		(HL),E
000014D7 23                  A     6856 	INC		HL
000014D8 72                  A     6857 	LD		(HL),D
                             A     6858 
000014D9 E7                  A     6859 L14DA:  RST		20H						; Error 11
                             A     6860 	DEFB	00Bh						; Error in REDEFINE or FORGET
000014DA 0B                  A+    6860 	DB P1
                             A     6861 
                             A     6862 ; ---------------------------
                             A     6863 ; THE 'RECLAIMING' SUBROUTINE
                             A     6864 ; ---------------------------
                             A     6865 
000014DB 2A 37 00            A     6866 L14DC:  LD		HL,(STKBOT)				; fetch STKBOT
000014DE A7                  A     6867 	AND		A						; clear carry flag
000014DF ED 42               A     6868 	SBC		HL,BC					; subtract number of bytes to reclaim.
000014E1 22 37 00            A     6869 	LD		(STKBOT),HL				; update STKBOT
                             A     6870 
000014E4 2A 3B 00            A     6871 	LD		HL,(SPARE)				; fetch SPARE
000014E7 ED 42               A     6872 	SBC		HL,BC					; subtract number of bytes to reclaim.
000014E9 22 3B 00            A     6873 	LD		(SPARE),HL				; update SPARE
                             A     6874 
000014EC ED 52               A     6875 	SBC		HL,DE					; subtract
000014EE C8                  A     6876 	RET		Z						; return if same address.
                             A     6877 
000014EF C5                  A     6878 	PUSH	BC						;
000014F0 44                  A     6879 	LD		B,H						;
000014F1 4D                  A     6880 	LD		C,L						;
000014F2 E1                  A     6881 	POP		HL						;
000014F3 19                  A     6882 	ADD		HL,DE					;
                             A     6883 
000014F4 ED B0               A     6884 	LDIR							;
                             A     6885 
000014F6 C9                  A     6886 	RET								;
                             A     6887 
                             A     6888 ; ---
                             A     6889 ;
                             A     6890 ; ---
                             A     6891 
000014F7 01 31 00            A     6892 L14F8:  LD		BC,CURRENT				; CURRENT
                             A     6893 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  145


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000014FA CD 56 15            A     6894 	CALL	L1557					;
000014FD CD 56 15            A     6895 	CALL	L1557					;
                             A     6896 
00001500 01 40 00            A     6897 	LD		BC,RAMSTART+040h				; addr. of "FORTH" in RAM.
                             A     6898 
00001503 2A 37 00            A     6899 L1504:  LD		HL,(STKBOT)				; STKBOT
00001506 37                  A     6900 	SCF								;
00001507 ED 42               A     6901 	SBC		HL,BC					;
00001509 D8                  A     6902 	RET		C						;
                             A     6903 
0000150A 0A                  A     6904 L150B:  LD		A,(BC)					;
0000150B 17                  A     6905 	RLA								;
0000150C 03                  A     6906 	INC		BC						;
0000150D 30 FB               A     6907 	JR		NC,L150B				;
                             A     6908 
0000150F 03                  A     6909 	INC		BC						;
00001510 03                  A     6910 	INC		BC						;
00001511 CD 56 15            A     6911 	CALL	L1557					;
00001514 03                  A     6912 	INC		BC						;
00001515 CD 56 15            A     6913 	CALL	L1557					;
                             A     6914 
00001518 CD FA 15            A     6915 L1519:  CALL	L15FB					; routine INDEXER
                             A     6916 
                             A     6917 ; -------------------------------------------------------
                             A     6918 
                             A     6919 	DEFW	L0EC3					; DE value
0000151B C2 0E               A+    6919 	DW P1
                             A     6920 L151E:  DEFB	01Ch						; to L153A
0000151D 1C                  A+    6920 	DB P1
                             A     6921 
                             A     6922 	DEFW	L1085					; DE value
0000151E 84 10               A+    6922 	DW P1
                             A     6923 L1521:  DEFB	016h						; to L1537
00001520 16                  A+    6923 	DB P1
                             A     6924 
                             A     6925 	DEFW	L1108					; DE value
00001521 07 11               A+    6925 	DW P1
                             A     6926 L1524:  DEFB	013h						; to L1537
00001523 13                  A+    6926 	DB P1
                             A     6927 
                             A     6928 	DEFW	L11B5					; DE value
00001524 B4 11               A+    6928 	DW P1
                             A     6929 L1527:  DEFB	018h						; to L153F
00001526 18                  A+    6929 	DB P1
                             A     6930 
                             A     6931 	DEFW	00000h					; zero end marker
00001527 00 00               A+    6931 	DW P1
                             A     6932 
                             A     6933 ; -------------------------------------------------------
                             A     6934 
00001529 21 F9 FF            A     6935 L152A:  LD		HL,0FFF9h
0000152C 09                  A     6936 	ADD		HL,BC
                             A     6937 
0000152D 4E                  A     6938 	LD		C,(HL)
0000152E 23                  A     6939 	INC		HL
0000152F 46                  A     6940 	LD		B,(HL)
00001530 2B                  A     6941 	DEC		HL
                             A     6942 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  146


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001531 09                  A     6943 	ADD		HL,BC
                             A     6944 
00001532 44                  A     6945 	LD		B,H
00001533 4D                  A     6946 	LD		C,L
00001534 18 CD               A     6947 	JR		L1504					;
                             A     6948 
                             A     6949 ; -------------------------------------------------------
                             A     6950 
00001536 CD 56 15            A     6951 L1537:  CALL	L1557					;
                             A     6952 
                             A     6953 ; ->
                             A     6954 
00001539 CD 47 15            A     6955 L153A:  CALL	L1548					;
0000153C 18 C5               A     6956 	JR		L1504					;
                             A     6957 
                             A     6958 ; ---
                             A     6959 
0000153E CD 56 15            A     6960 L153F:  CALL	L1557					;
00001541 03                  A     6961 	INC		BC						;
00001542 CD 56 15            A     6962 	CALL	L1557					;
00001545 18 BC               A     6963 	JR		L1504					;
                             A     6964 
                             A     6965 ; -------------------------------------------------------
                             A     6966 
                             A     6967 ; XXX?
                             A     6968 
00001547 CD 56 15            A     6969 L1548:  CALL	L1557					;
0000154A 21 B6 04            A     6970 	LD		HL,L04B6				;
0000154D A7                  A     6971 	AND		A						;
0000154E ED 52               A     6972 	SBC		HL,DE					;
00001550 C8                  A     6973 	RET		Z						;
                             A     6974 
00001551 CD 9D 15            A     6975 	CALL	L159E					;
                             A     6976 
00001554 18 F1               A     6977 	JR		L1548					;
                             A     6978 
                             A     6979 ; ---
                             A     6980 ; often called twice
                             A     6981 ; ---
                             A     6982 
                             A     6983 
00001556 0A                  A     6984 L1557:  LD		A,(BC)					; lo byte
00001557 5F                  A     6985 	LD		E,A						;
00001558 03                  A     6986 	INC		BC						;
00001559 0A                  A     6987 	LD		A,(BC)					; hi byte
0000155A 57                  A     6988 	LD		D,A						;
0000155B 0B                  A     6989 	DEC		BC						; BC now unchanged, DE contents
                             A     6990 
0000155C CD 67 15            A     6991 	CALL	L1568					; routine below. header?
                             A     6992 
0000155F EB                  A     6993 	EX		DE,HL					; value to DE
00001560 7B                  A     6994 	LD		A,E						;
00001561 02                  A     6995 	LD		(BC),A					; lo byte
00001562 03                  A     6996 	INC		BC						;
00001563 7A                  A     6997 	LD		A,D						;
00001564 02                  A     6998 	LD		(BC),A					; hi byte
00001565 03                  A     6999 	INC		BC						;
00001566 C9                  A     7000 	RET								; to next - BC+=2
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  147


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7001 
                             A     7002 ; ---
                             A     7003 
00001567 2A 01 27            A     7004 L1568:  LD		HL,(02701h)				; first bytes of pad.
0000156A A7                  A     7005 	AND		A						;
0000156B ED 52               A     7006 	SBC		HL,DE					; subtract the DE value read from
                             A     7007 					; memory
0000156D 62                  A     7008 	LD		H,D						;
0000156E 6B                  A     7009 	LD		L,E						; transfer that DE to HL as well
                             A     7010 
0000156F D0                  A     7011 	RET		NC						; return if HL was higher than DE
                             A     7012 
00001570 2A 09 27            A     7013 	LD		HL,(02709h)				; tape header
00001573 ED 52               A     7014 	SBC		HL,DE
00001575 30 0C               A     7015 	JR		NC,L1584				; forward if higher to
                             A     7016 
00001577 2A 0D 27            A     7017 	LD		HL,(0270Dh)
0000157A ED 52               A     7018 	SBC		HL,DE
0000157C 38 13               A     7019 	JR		C,L1592					; forward if lower to
                             A     7020 
0000157E 2A 0B 27            A     7021 	LD		HL,(0270Bh)				;
00001581 19                  A     7022 	ADD		HL,DE
00001582 C9                  A     7023 	RET								; return
                             A     7024 
                             A     7025 ; ---
                             A     7026 
00001583 2A 03 27            A     7027 L1584:  LD		HL,(02703h)
00001586 ED 52               A     7028 	SBC		HL,DE
00001588 2A 07 27            A     7029 	LD		HL,(02707h)
0000158B D8                  A     7030 	RET		C
                             A     7031 
0000158C 2A 05 27            A     7032 	LD		HL,(02705h)
0000158F 19                  A     7033 	ADD		HL,DE
00001590 C9                  A     7034 	RET
                             A     7035 
                             A     7036 ; ---
                             A     7037 
00001591 2A 01 27            A     7038 L1592:  LD		HL,(02701h)
00001594 19                  A     7039 	ADD		HL,DE
00001595 ED 5B 0D 27         A     7040 	LD		DE,(0270Dh)
00001599 A7                  A     7041 	AND		A
0000159A ED 52               A     7042 	SBC		HL,DE
0000159C C9                  A     7043 	RET
                             A     7044 
                             A     7045 ; ---
                             A     7046 
0000159D 1B                  A     7047 L159E:  DEC		DE
0000159E 1A                  A     7048 	LD		A,(DE)
0000159F 17                  A     7049 	RLA
000015A0 D0                  A     7050 	RET		NC
                             A     7051 
000015A1 1B                  A     7052 L15A2:  DEC		DE
000015A2 1B                  A     7053 	DEC		DE
000015A3 1A                  A     7054 	LD		A,(DE)
000015A4 6F                  A     7055 	LD		L,A						; low byte
000015A5 26 00               A     7056 	LD		H,000h					; make high byte zero
000015A7 3C                  A     7057 	INC		A						; test offset for 0FFh.
000015A8 20 06               A     7058 	JR		NZ,L15B1				; forward if not.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  148


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7059 
000015AA 0A                  A     7060 	LD		A,(BC)
000015AB 6F                  A     7061 	LD		L,A
000015AC 03                  A     7062 	INC		BC
000015AD 0A                  A     7063 	LD		A,(BC)
000015AE 67                  A     7064 	LD		H,A
000015AF 03                  A     7065 	INC		BC
                             A     7066 
000015B0 09                  A     7067 L15B1:  ADD		HL,BC
                             A     7068 
000015B1 44                  A     7069 	LD		B,H
000015B2 4D                  A     7070 	LD		C,L
000015B3 C9                  A     7071 	RET
                             A     7072 
                             A     7073 ; ---
                             A     7074 ;
                             A     7075 ; ---
                             A     7076 
                             A     7077 
                             A     7078 L15B5:  DEFW	L15B7
000015B4 B6 15               A+    7078 	DW P1
                             A     7079 
                             A     7080 ; ---
                             A     7081 
000015B6 DF                  A     7082 L15B7:  RST		18H						; pop word DE
                             A     7083 
000015B7 EB                  A     7084 	EX		DE,HL
                             A     7085 
000015B8 CD E6 15            A     7086 	CALL	L15E7					; WORDSTART1
                             A     7087 
000015BB EB                  A     7088 	EX		DE,HL
                             A     7089 
000015BC D7                  A     7090 	RST		10H						; push word DE
000015BD FD E9               A     7091 	JP		(IY)					; to 'next'.
                             A     7092 
                             A     7093 ; ---
                             A     7094 ;
                             A     7095 ; ---
                             A     7096 
000015BF E5                  A     7097 L15C0:  PUSH	HL
000015C0 5E                  A     7098 	LD		E,(HL)
000015C1 23                  A     7099 	INC		HL
000015C2 56                  A     7100 	LD		D,(HL)
                             A     7101 
000015C3 CD FA 15            A     7102 L15C4:  CALL	L15FB					; routine INDEXER
                             A     7103 
                             A     7104 ; -------------------------------------------------------
                             A     7105 
                             A     7106 	DEFW	L1108
000015C6 07 11               A+    7106 	DW P1
                             A     7107 L15C9:  DEFB	00Bh						; to L15D4 - find parameter field
000015C8 0B                  A+    7107 	DB P1
                             A     7108 
                             A     7109 	DEFW	L1085
000015C9 84 10               A+    7109 	DW P1
                             A     7110 L15CC:  DEFB	008h						; to L15D4 - find parameter field
000015CB 08                  A+    7110 	DB P1
                             A     7111 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  149


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7112 	DEFW	00000h					; zero end_marker.
000015CC 00 00               A+    7112 	DW P1
                             A     7113 
                             A     7114 ; -------------------------------------------------------
                             A     7115 
000015CE 01 00 00            A     7116 L15CF:  LD		BC,00000h				; zero indicates no parameter field.
000015D1 18 07               A     7117 	JR		L15DB					; forward to consider total length.
                             A     7118 
                             A     7119 ; -------------------------------------------------------
                             A     7120 
000015D3 E1                  A     7121 L15D4:  POP		HL						; retrieve the code field address
000015D4 E5                  A     7122 	PUSH	HL						; save it again
                             A     7123 
000015D5 23                  A     7124 	INC		HL						; step past the
000015D6 23                  A     7125 	INC		HL						; address word
000015D7 4E                  A     7126 	LD		C,(HL)					; and get following address
000015D8 23                  A     7127 	INC		HL						; which if in RAM could be the
000015D9 46                  A     7128 	LD		B,(HL)					; parameter field to				BC.
                             A     7129 
                             A     7130 ; ->
                             A     7131 
000015DA E1                  A     7132 L15DB:  POP		HL						; retrieve the code field address
000015DB E5                  A     7133 	PUSH	HL						; and save it again
                             A     7134 
000015DC 2B                  A     7135 	DEC		HL						; the name length field
000015DD 2B                  A     7136 	DEC		HL						; link field high order byte
000015DE 2B                  A     7137 	DEC		HL						; link field low order byte
000015DF 2B                  A     7138 	DEC		HL						; possible length field high
000015E0 56                  A     7139 	LD		D,(HL)					; save in D
000015E1 2B                  A     7140 	DEC		HL						; possible length field low
000015E2 5E                  A     7141 	LD		E,(HL)					; save in E
000015E3 19                  A     7142 	ADD		HL,DE					; add this length
000015E4 EB                  A     7143 	EX		DE,HL					; and save result in				DE.
                             A     7144 
000015E5 E1                  A     7145 	POP		HL						; retrieve code field address
                             A     7146 
                             A     7147 ; ->
                             A     7148 ; indexes the header information of a FORTH word
                             A     7149 
000015E6 2B                  A     7150 L15E7:  DEC		HL						; point to name length field
                             A     7151 
                             A     7152 ; =>
000015E7 7C                  A     7153 L15E8:  LD		A,H						; fetch high order byte of the
                             A     7154 					; header address.
000015E8 FE 3C               A     7155 	CP		03Ch						; compare to RAM location
000015EA 7E                  A     7156 	LD		A,(HL)					; fetch length byte.
000015EB CB B7               A     7157 	RES		6,A						; reset the immediate mode bit
000015ED 38 02               A     7158 	JR		C,L15F2					; forward if definition is in ROM.
                             A     7159 
000015EF C6 02               A     7160 	ADD		A,002h					; else add extra for 'length field'
                             A     7161 
000015F1 2B                  A     7162 L15F2:  DEC		HL						; step past the
000015F2 2B                  A     7163 	DEC		HL						; link to previous word.
                             A     7164 
000015F3 2B                  A     7165 L15F4:  DEC		HL						; now address last letter on name.
000015F4 3D                  A     7166 	DEC		A						; decrement the length
000015F5 20 FC               A     7167 	JR		NZ,L15F4				; loop back until at first letter  HL.
                             A     7168 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  150


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000015F7 C9                  A     7169 	RET								; return.
                             A     7170 
                             A     7171 ; -------
                             A     7172 ; INDEXER
                             A     7173 ; -------
                             A     7174 
                             A     7175 ; indexerloop
                             A     7176 
000015F8 23                  A     7177 L15F9:  INC		HL						; step past the
000015F9 E5                  A     7178 	PUSH	HL						; offset byte.
                             A     7179 
                             A     7180 ; -> Call Entry point
                             A     7181 
000015FA E1                  A     7182 L15FB:  POP		HL						; drop return address - points to byte
                             A     7183 					; after the call.
000015FB 7E                  A     7184 	LD		A,(HL)					; read low-order byte
000015FC 23                  A     7185 	INC		HL						; increment address once
000015FD E5                  A     7186 	PUSH	HL						; push return address
                             A     7187 
000015FE 66                  A     7188 	LD		H,(HL)					; read high-order byte.
000015FF 6F                  A     7189 	LD		L,A						; now HL holds the read word
00001600 B4                  A     7190 	OR		H						; test for two zeros.
00001601 C8                  A     7191 	RET		Z						; two zeros - return
                             A     7192 					; (ret addr is second NOP)
                             A     7193 
00001602 ED 52               A     7194 	SBC		HL,DE					; compare to value passed in DE
                             A     7195 
00001604 E1                  A     7196 	POP		HL						; now increment the
00001605 23                  A     7197 	INC		HL						; return address on machine stack.
                             A     7198 
00001606 20 F0               A     7199 	JR		NZ,L15F9				; loop back if read word is not
                             A     7200 					; equal to DE
                             A     7201 
00001608 D5                  A     7202 	PUSH	DE						; else preserve DE
                             A     7203 
00001609 16 00               A     7204 	LD		D,000h					; a 1 byte relative jump.
0000160B 5E                  A     7205 	LD		E,(HL)					; read one-byte offset.
0000160C 19                  A     7206 	ADD		HL,DE					; add to read address.
                             A     7207 
0000160D D1                  A     7208 	POP		DE						; restore DE
                             A     7209 
0000160E E9                  A     7210 	JP		(HL)					; >>>
                             A     7211 
                             A     7212 ; ---
                             A     7213 
                             A     7214 L1610:  DEFW	L0EC3					; 'code field' - docolon
0000160F C2 0E               A+    7214 	DW P1
                             A     7215 
                             A     7216 	DEFW	L0E1F					; 1-
00001611 1E 0E               A+    7216 	DW P1
                             A     7217 	DEFW	L0E29					; 2-
00001613 28 0E               A+    7217 	DW P1
                             A     7218 	DEFW	L08B3					; @
00001615 B2 08               A+    7218 	DW P1
                             A     7219 	DEFW	L0480					; current
00001617 80 04               A+    7219 	DW P1
                             A     7220 	DEFW	L08B3					; @
00001619 B2 08               A+    7220 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  151


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7221 	DEFW	L08C1					; !
0000161B C0 08               A+    7221 	DW P1
                             A     7222 	DEFW	L04B6					; exit
0000161D B6 04               A+    7222 	DW P1
                             A     7223 
                             A     7224 ; ---------------------------------
                             A     7225 ; THE 'FIND WORD IN RAM' SUBROUTINE
                             A     7226 ; ---------------------------------
                             A     7227 ; This subroutine is used by FORGET, EDIT and LIST.
                             A     7228 ; First use the standard FORTH word find to get address of word (in pad).
                             A     7229 ; If word does not exist then returned value will be zero.
                             A     7230 ; The lowest word in RAM is the FORTH word at L3C51 so a check is made
                             A     7231 ; against this address.
                             A     7232 
0000161F CD B9 04            A     7233 L1620:  CALL	L04B9					; forth
                             A     7234 	DEFW	L063D					; find
00001622 3D 06               A+    7234 	DW P1
                             A     7235 
                             A     7236 L1625:  DEFW	L1A0E					; end-forth.
00001624 0D 1A               A+    7236 	DW P1
                             A     7237 
00001626 DF                  A     7238 	RST		18H						; pop word DE
                             A     7239 
00001627 21 AF C3            A     7240 	LD		HL,0C3AFh				; i.e 00000h - RAMSTART+051h
                             A     7241 
0000162A 19                  A     7242 	ADD		HL,DE					; add to test value.
0000162B D8                  A     7243 	RET		C						; carry signals that word exists in RAM.
                             A     7244 					; return the address in DE.
                             A     7245 
                             A     7246 ; else generate an error code.
                             A     7247 
0000162C E7                  A     7248 	RST		20H						; Error 13
                             A     7249 	DEFB	00Dh						; Error word not found or is in ROM.
0000162D 0D                  A+    7249 	DB P1
                             A     7250 
                             A     7251 ; -----------------
                             A     7252 ; THE 'FORGET' WORD
                             A     7253 ; -----------------
                             A     7254 ; FORGET name.
                             A     7255 ; Erases the word 'name' and all subsequently defined names from the dictionary.
                             A     7256 
                             A     7257 L162F:  DEFM	"FORGE"					; 'name field'
0000162E 46 4F 52 47 45      A+    7257 	DB P1
                             A     7258 	DEFB	'T'+080h
00001633 D4                  A+    7258 	DB P1
                             A     7259 
                             A     7260 	DEFW	L13FC					; 'link field'
00001634 FB 13               A+    7260 	DW P1
                             A     7261 
                             A     7262 L1637:  DEFB	006h						; 'name length field'
00001636 06                  A+    7262 	DB P1
                             A     7263 
                             A     7264 L1638:  DEFW	L163A					; 'code field'
00001637 39 16               A+    7264 	DW P1
                             A     7265 
                             A     7266 ; ---
                             A     7267 
00001639 2A 31 00            A     7268 L163A:  LD		HL,(CURRENT)				; CURRENT
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  152


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000163C ED 5B 33 00         A     7269 	LD		DE,(CONTEXT)				; CONTEXT
00001640 A7                  A     7270 	AND		A
00001641 ED 52               A     7271 	SBC		HL,DE
                             A     7272 
00001643 C2 D9 14            A     7273 	JP		NZ,L14DA				;
                             A     7274 
00001646 CD 1F 16            A     7275 	CALL	L1620					; findramword
                             A     7276 
00001649 21 FB FF            A     7277 	LD		HL,0FFFBh
0000164C 19                  A     7278 	ADD		HL,DE
0000164D 22 39 00            A     7279 	LD		(DICT),HL				; SPARE
00001650 DD CB 3E D6         A     7280 	SET		2,(IX+03Eh)				; FLAGS
                             A     7281 
00001654 E7                  A     7282 	RST		20H						; Invoke error routine.
                             A     7283 	DEFB	0FFh						; No error
00001655 FF                  A+    7283 	DB P1
                             A     7284 
                             A     7285 ; ---------------
                             A     7286 ; THE 'EDIT' WORD
                             A     7287 ; ---------------
                             A     7288 ; EDIT name
                             A     7289 ; Lists word 'name' at bottom of the screen to be edited. Lists 18 lines at
                             A     7290 ; a time, then waits for editing until ENTER is pressed.
                             A     7291 ; A new version of the word is entered at the end of the dictionary.
                             A     7292 ; While editing, cursor up and cursor down are needed to move the cursor
                             A     7293 ; from one line to another. DELETE LINE deletes one line.
                             A     7294 
                             A     7295 L1657:  DEFM	"EDI"					; 'name field'
00001656 45 44 49            A+    7295 	DB P1
                             A     7296 	DEFB	'T'+080h
00001659 D4                  A+    7296 	DB P1
                             A     7297 
                             A     7298 	DEFW	L1637					; 'link field'
0000165A 36 16               A+    7298 	DW P1
                             A     7299 
                             A     7300 L165D:  DEFB	004h						; 'name length field'
0000165C 04                  A+    7300 	DB P1
                             A     7301 
                             A     7302 L165E:  DEFW	L1660					; 'code field'
0000165D 5F 16               A+    7302 	DW P1
                             A     7303 
                             A     7304 ; ---
                             A     7305 
0000165F CD 1F 16            A     7306 L1660:  CALL	L1620					; findramword
                             A     7307 
00001662 DD CB 3E DE         A     7308 	SET		3,(IX+03Eh)				; update FLAGS output -> input buffer
00001666 18 0C               A     7309 	JR		L1675					; forward to list routine the difference
                             A     7310 					; being that the listing will go to the
                             A     7311 					; lower screen.
                             A     7312 
                             A     7313 ; ---------------
                             A     7314 ; THE 'LIST' WORD
                             A     7315 ; ---------------
                             A     7316 ; LIST name
                             A     7317 ; (  --  )
                             A     7318 ; Lists word 'name' on the screen. It must have been defined by :, DEFINER,
                             A     7319 ; or COMPILER. Lists about 18 lines at a time and waits for key depression
                             A     7320 ; (shifted space breaks).
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  153


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7321 
                             A     7322 L1669:  DEFM	"LIS"					; 'name field'
00001668 4C 49 53            A+    7322 	DB P1
                             A     7323 	DEFB	'T'+080h
0000166B D4                  A+    7323 	DB P1
                             A     7324 
                             A     7325 	DEFW	L165D					; 'link field'
0000166C 5C 16               A+    7325 	DW P1
                             A     7326 
                             A     7327 L166F:  DEFB	004h						; 'name length field'
0000166E 04                  A+    7327 	DB P1
                             A     7328 
                             A     7329 L1670:  DEFW	L1672					; 'code field'
0000166F 71 16               A+    7329 	DW P1
                             A     7330 
                             A     7331 ; ---
                             A     7332 
00001671 CD 1F 16            A     7333 L1672:  CALL	L1620					; findramword
                             A     7334 
                             A     7335 ; edit path joins here but carriage returns are printed as zeros.
                             A     7336 
00001674 3E 0D               A     7337 L1675:  LD		A,00Dh					; prepare a carriage return.
00001676 CF                  A     7338 	RST		08H						; print_ch
                             A     7339 
00001677 DD CB 3E 5E         A     7340 	BIT		3,(IX+03Eh)				; test FLAGS output->input buffer?
                             A     7341 
0000167B D5                  A     7342 	PUSH	DE
                             A     7343 
0000167C C4 D8 02            A     7344 	CALL	NZ,L02D8				; call if so to initialize buffer
                             A     7345 
0000167F C1                  A     7346 	POP		BC						; LD DE,(BC)
                             A     7347 
00001680 0A                  A     7348 	LD		A,(BC)
00001681 5F                  A     7349 	LD		E,A
00001682 03                  A     7350 	INC		BC
00001683 0A                  A     7351 	LD		A,(BC)
00001684 57                  A     7352 	LD		D,A
00001685 0B                  A     7353 	DEC		BC
                             A     7354 
00001686 CD FA 15            A     7355 	CALL	L15FB					; routine INDEXER
                             A     7356 
                             A     7357 ; -------------------------------------------------------
                             A     7358 
                             A     7359 L168A:  DEFW	L0EC3					; DE value
00001689 C2 0E               A+    7359 	DW P1
                             A     7360 L168C:  DEFB	00Bh						; offset to L1697
0000168B 0B                  A+    7360 	DB P1
                             A     7361 
                             A     7362 L168D:  DEFW	L1108					; DE value
0000168C 07 11               A+    7362 	DW P1
                             A     7363 L168F:  DEFB	00Dh						; offset to L169C
0000168E 0D                  A+    7363 	DB P1
                             A     7364 
                             A     7365 L1690:  DEFW	L1085					; DE value
0000168F 84 10               A+    7365 	DW P1
                             A     7366 L1692:  DEFB	01Fh						; offset to L16B1
00001691 1F                  A+    7366 	DB P1
                             A     7367 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  154


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7368 	DEFW	00000h					; zero end-marker
00001692 00 00               A+    7368 	DW P1
                             A     7369 
                             A     7370 ; -------------------------------------------------------
                             A     7371 
00001694 E7                  A     7372 L1695:  RST		20H						; Error 14
                             A     7373 	DEFB	00Eh						; Word unlistable.
00001695 0E                  A+    7373 	DB P1
                             A     7374 
                             A     7375 ; Only words defined by ':', 'DEFINER' or 'COMPILER' are listable.
                             A     7376 
                             A     7377 ; -------------------------------------------------------
                             A     7378 
                             A     7379 ; ':'
00001696 21 02 00            A     7380 L1697:  LD		HL,00002h
00001699 18 18               A     7381 	JR		L16B4					;
                             A     7382 ; ---
                             A     7383 
0000169B D5                  A     7384 L169C:  PUSH	DE
0000169C 21 02 00            A     7385 	LD		HL,00002h
0000169F 09                  A     7386 	ADD		HL,BC
000016A0 7E                  A     7387 	LD		A,(HL)
000016A1 23                  A     7388 	INC		HL
000016A2 66                  A     7389 	LD		H,(HL)
000016A3 6F                  A     7390 	LD		L,A
000016A4 2B                  A     7391 	DEC		HL
000016A5 2B                  A     7392 	DEC		HL
000016A6 2B                  A     7393 	DEC		HL
                             A     7394 
000016A7 6E                  A     7395 	LD		L,(HL)
000016A8 7D                  A     7396 	LD		A,L
000016A9 07                  A     7397 	RLCA
000016AA 9F                  A     7398 	SBC		A,A
000016AB 67                  A     7399 	LD		H,A
                             A     7400 
000016AC CD 0D 18            A     7401 	CALL	L180E					; pr_int_hl?
                             A     7402 
000016AF D1                  A     7403 	POP		DE
                             A     7404 
000016B0 21 04 00            A     7405 L16B1:  LD		HL,00004h
                             A     7406 
                             A     7407 
000016B3 09                  A     7408 L16B4:  ADD		HL,BC
000016B4 E5                  A     7409 	PUSH	HL
000016B5 C5                  A     7410 	PUSH	BC
                             A     7411 
000016B6 CD E3 17            A     7412 	CALL	L17E4					;
                             A     7413 
000016B9 D1                  A     7414 	POP		DE
000016BA C1                  A     7415 	POP		BC
                             A     7416 
000016BB CD E3 17            A     7417 	CALL	L17E4					;
                             A     7418 
000016BE DD 36 14 01         A     7419 	LD		(IX+014h),001h			; LISTWSx
                             A     7420 
000016C2 DD 36 16 10         A     7421 L16C3:  LD		(IX+016h),010h			; LISTWSx
                             A     7422 
000016C6 CD 07 17            A     7423 L16C7:  CALL	L1708					; index_table
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  155


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7424 
000016C9 38 06               A     7425 	JR		C,L16D2					;
                             A     7426 
000016CB DD 35 16            A     7427 	DEC		(IX+016h)				; LISTWSx
000016CE F2 C6 16            A     7428 	JP		P,L16C7					;
                             A     7429 
000016D1 DD CB 3E 5E         A     7430 L16D2:  BIT		3,(IX+03Eh)				; FLAGS
000016D5 20 10               A     7431 	JR		NZ,L16E8				; branch forward  =->
                             A     7432 
000016D7 38 28               A     7433 	JR		C,L1702					;
                             A     7434 
000016D9 21 26 00            A     7435 	LD		HL,KEYCOD				; KEYCOD
000016DC 36 00               A     7436 	LD		(HL),000h				;
                             A     7437 
000016DE 7E                  A     7438 L16DF:  LD		A,(HL)					;
000016DF A7                  A     7439 	AND		A						;
000016E0 28 FC               A     7440 	JR		Z,L16DF					; loop back while zero
                             A     7441 
000016E2 CD E4 04            A     7442 	CALL	L04E4					; check break
                             A     7443 
000016E5 18 DB               A     7444 	JR		L16C3					; loop back
                             A     7445 
                             A     7446 ; =->
                             A     7447 
000016E7 F5                  A     7448 L16E8:  PUSH	AF
000016E8 DD CB 3E 9E         A     7449 	RES		3,(IX+03Eh)				; FLAGS
000016EC C5                  A     7450 	PUSH	BC
                             A     7451 
000016ED CD B9 04            A     7452 	CALL	L04B9					; forth
                             A     7453 
                             A     7454 	DEFW	L0578					; retype		- allow user to retype
000016F0 78 05               A+    7454 	DW P1
                             A     7455 	DEFW	L0506					; line			- interpret buffer
000016F2 06 05               A+    7455 	DW P1
                             A     7456 	DEFW	L1A0E					; end-forth.
000016F4 0D 1A               A+    7456 	DW P1
                             A     7457 
                             A     7458 
000016F6 DD CB 3E DE         A     7459 	SET		3,(IX+03Eh)				; FLAGS
                             A     7460 
000016FA CD D8 02            A     7461 	CALL	L02D8					;
                             A     7462 
000016FD C1                  A     7463 	POP		BC
000016FE F1                  A     7464 	POP		AF
000016FF 30 C1               A     7465 	JR		NC,L16C3				;
                             A     7466 
00001701 DD CB 3E 9E         A     7467 L1702:  RES		3,(IX+03Eh)				; FLAGS
00001705 FD E9               A     7468 	JP		(IY)					; to 'next'.
                             A     7469 
                             A     7470 ; -------------------------------------------------------
                             A     7471 
                             A     7472 ; called once
                             A     7473 
00001707 3A 14 00            A     7474 L1708:  LD		A,(RAMSTART+014h)				; LISTWS2
0000170A 32 15 00            A     7475 	LD		(RAMSTART+015h),A				; LISTWS3
                             A     7476 
0000170D DD 36 13 05         A     7477 	LD		(IX+013h),005h			; LISTWS
                             A     7478 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  156


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001711 0A                  A     7479 L1712:  LD		A,(BC)
00001712 5F                  A     7480 	LD		E,A
00001713 03                  A     7481 	INC		BC
00001714 0A                  A     7482 	LD		A,(BC)
00001715 57                  A     7483 	LD		D,A
00001716 03                  A     7484 	INC		BC
                             A     7485 
00001717 CD FA 15            A     7486 L1718:  CALL	L15FB					; routine INDEXER
                             A     7487 
                             A     7488 ; -------------------------------------------------------
                             A     7489 
                             A     7490 L171B:  DEFW	L1283					;
0000171A 82 12               A+    7490 	DW P1
                             A     7491 L171D:  DEFB	040h						; offset to L175D
0000171C 40                  A+    7491 	DB P1
                             A     7492 
                             A     7493 L171E:  DEFW	L1271					;
0000171D 70 12               A+    7493 	DW P1
                             A     7494 L1720:  DEFB	044h						; offset to L1764
0000171F 44                  A+    7494 	DB P1
                             A     7495 
                             A     7496 L1721:  DEFW	L12A4					;
00001720 A3 12               A+    7496 	DW P1
                             A     7497 L1723:  DEFB	048h						; offset to L176B
00001722 48                  A+    7497 	DB P1
                             A     7498 
                             A     7499 L1724:  DEFW	L129F					;
00001723 9E 12               A+    7499 	DW P1
                             A     7500 L1726:  DEFB	037h						; offset to L175D
00001725 37                  A+    7500 	DB P1
                             A     7501 
                             A     7502 L1727:  DEFW	L128D					;
00001726 8C 12               A+    7502 	DW P1
                             A     7503 L1729:  DEFB	042h						; offset to L176B
00001728 42                  A+    7503 	DB P1
                             A     7504 
                             A     7505 L172A:  DEFW	L1288					;
00001729 87 12               A+    7505 	DW P1
                             A     7506 L172C:  DEFB	038h						; offset to L1764
0000172B 38                  A+    7506 	DB P1
                             A     7507 
                             A     7508 L172D:  DEFW	L1276					;
0000172C 75 12               A+    7508 	DW P1
                             A     7509 L172F:  DEFB	03Ch						; offset to L176B
0000172E 3C                  A+    7509 	DB P1
                             A     7510 
                             A     7511 L1730:  DEFW	L1323					;
0000172F 22 13               A+    7511 	DW P1
                             A     7512 L1732:  DEFB	02Bh						; offset to L175D
00001731 2B                  A+    7512 	DB P1
                             A     7513 
                             A     7514 L1733:  DEFW	L1332					;
00001732 31 13               A+    7514 	DW P1
                             A     7515 L1735:  DEFB	036h						; offset to L176B
00001734 36                  A+    7515 	DB P1
                             A     7516 
                             A     7517 L1736:  DEFW	L133C					;
00001735 3B 13               A+    7517 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  157


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7518 L1738:  DEFB	033h						; offset to L176B
00001737 33                  A+    7518 	DB P1
                             A     7519 
                             A     7520 L1739:  DEFW	L10E8					;
00001738 E7 10               A+    7520 	DW P1
                             A     7521 L173B:  DEFB	029h						; offset to L1764
0000173A 29                  A+    7521 	DB P1
                             A     7522 
                             A     7523 L173C:  DEFW	L1140					;
0000173B 3F 11               A+    7523 	DW P1
                             A     7524 L173E:  DEFB	026h						; offset to L1764
0000173D 26                  A+    7524 	DB P1
                             A     7525 
                             A     7526 L173F:  DEFW	L1011					;
0000173E 10 10               A+    7526 	DW P1
                             A     7527 L1741:  DEFB	03Bh						; offset to L177C
00001740 3B                  A+    7527 	DB P1
                             A     7528 
                             A     7529 L1742:  DEFW	L1064					;
00001741 63 10               A+    7529 	DW P1
                             A     7530 L1744:  DEFB	047h						; offset to L178B
00001743 47                  A+    7530 	DB P1
                             A     7531 
                             A     7532 L1745:  DEFW	L104B					;
00001744 4A 10               A+    7532 	DW P1
                             A     7533 L1747:  DEFB	051h						; offset to L1798
00001746 51                  A+    7533 	DB P1
                             A     7534 
                             A     7535 L1748:  DEFW	L1379					;
00001747 78 13               A+    7535 	DW P1
                             A     7536 L174A:  DEFB	062h						; offset to L17AC
00001749 62                  A+    7536 	DB P1
                             A     7537 
                             A     7538 L174B:  DEFW	L1396					;
0000174A 95 13               A+    7538 	DW P1
                             A     7539 L174D:  DEFB	063h						; offset to L17B0
0000174C 63                  A+    7539 	DB P1
                             A     7540 
                             A     7541 L174E:  DEFW	L04B6					;
0000174D B6 04               A+    7541 	DW P1
                             A     7542 L1750:  DEFB	054h						; offset to L17A4
0000174F 54                  A+    7542 	DB P1
                             A     7543 
                             A     7544 L1751:  DEFW	00000h					; zero end-marker
00001750 00 00               A+    7544 	DW P1
                             A     7545 
                             A     7546 ; -------------------------------------------------------
                             A     7547 
                             A     7548 ; default action
                             A     7549 
00001752 CD E0 17            A     7550 L1753:  CALL	L17E1					;
                             A     7551 
00001755 DD 35 13            A     7552 L1756:  DEC		(IX+013h)				; LISTWS
00001758 20 B7               A     7553 	JR		NZ,L1712				;
0000175A A7                  A     7554 	AND		A
0000175B C9                  A     7555 	RET
                             A     7556 
                             A     7557 ; ---
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  158


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7558 
0000175C 2A 14 00            A     7559 L175D:  LD		HL,(RAMSTART+014h)				; LISTWS2
0000175F 65                  A     7560 	LD		H,L
00001760 2C                  A     7561 	INC		L
00001761 18 0C               A     7562 	JR		L1770					;
                             A     7563 
                             A     7564 ; ---
                             A     7565 
00001763 2A 14 00            A     7566 L1764:  LD		HL,(RAMSTART+014h)				; LISTWS2
00001766 65                  A     7567 	LD		H,L
00001767 25                  A     7568 	DEC		H
00001768 18 05               A     7569 	JR		L1770					;
                             A     7570 
                             A     7571 ; ---
                             A     7572 
0000176A 2A 14 00            A     7573 L176B:  LD		HL,(RAMSTART+014h)				; LISTWS2
0000176D 2D                  A     7574 	DEC		L
0000176E 65                  A     7575 	LD		H,L
                             A     7576 
0000176F 22 14 00            A     7577 L1770:  LD		(RAMSTART+014h),HL				; LISTWS2
00001772 DD 36 13 01         A     7578 	LD		(IX+013h),001h			; LISTWS
00001776 DD 35 16            A     7579 	DEC		(IX+016h)				; LISTWSx
00001779 18 D7               A     7580 	JR		L1753					;
                             A     7581 
                             A     7582 ; ---
                             A     7583 
0000177B CD D9 17            A     7584 L177C:  CALL	L17DA					;
                             A     7585 
0000177E D7                  A     7586 	RST		10H						; push word DE
0000177F 11 B3 09            A     7587 	LD		DE,009B3h				; '.' addr
                             A     7588 
00001782 CD C0 17            A     7589 L1783:  CALL	L17C1					; routine INDENT
00001785 CD 14 18            A     7590 	CALL	L1815					; pr2
                             A     7591 
00001788 18 CB               A     7592 	JR		L1756					;
                             A     7593 
                             A     7594 ; ---
                             A     7595 
0000178A CD D9 17            A     7596 L178B:  CALL	L17DA					;
0000178D D7                  A     7597 	RST		10H						; push word DE
0000178E CD D9 17            A     7598 	CALL	L17DA					;
00001791 D7                  A     7599 	RST		10H						; push word DE
00001792 11 AF 0A            A     7600 	LD		DE,00AAFh				; 'F.' addr
00001795 18 EB               A     7601 	JR		L1783					;
                             A     7602 
                             A     7603 ; ---
                             A     7604 
00001797 0A                  A     7605 L1798:  LD		A,(BC)
00001798 F5                  A     7606 	PUSH	AF
                             A     7607 
00001799 CD E0 17            A     7608 	CALL	L17E1					;
                             A     7609 
0000179C F1                  A     7610 	POP		AF
0000179D CF                  A     7611 	RST		08H						; print_ch
                             A     7612 
0000179E 3E 20               A     7613 	LD		A,020h					; a space character
000017A0 CF                  A     7614 	RST		08H						; print_ch
                             A     7615 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  159


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000017A1 18 B2               A     7616 	JR		L1756					;
                             A     7617 
                             A     7618 ; ---
                             A     7619 
000017A3 CD 07 18            A     7620 L17A4:  CALL	L1808					; pr_inline
                             A     7621 
                             A     7622 	DEFB	00Dh						; newline
000017A6 0D                  A+    7622 	DB P1
                             A     7623 	DEFB	';'						; ;
000017A7 3B                  A+    7623 	DB P1
                             A     7624 	DEFB	08Dh						; inverted newline
000017A8 8D                  A+    7624 	DB P1
                             A     7625 
000017A9 37                  A     7626 	SCF								;
000017AA C9                  A     7627 	RET								;
                             A     7628 
                             A     7629 ; ---
                             A     7630 
000017AB 3E 29               A     7631 L17AC:  LD		A,029h					; character ')' - end of comment.
000017AD 18 02               A     7632 	JR		L17B2					;
                             A     7633 
000017AF 3E 22               A     7634 L17B0:  LD		A,022h					; character '"' - quote
                             A     7635 
000017B1 F5                  A     7636 L17B2:  PUSH	AF
000017B2 C5                  A     7637 	PUSH	BC
000017B3 CD E0 17            A     7638 	CALL	L17E1					;
000017B6 D1                  A     7639 	POP		DE
000017B7 CD 78 09            A     7640 	CALL	L0979					; pr_string1
000017BA 42                  A     7641 	LD		B,D
000017BB 4B                  A     7642 	LD		C,E
000017BC F1                  A     7643 	POP		AF
                             A     7644 
000017BD CF                  A     7645 	RST		08H						; print_ch
                             A     7646 
000017BE A7                  A     7647 	AND		A
000017BF C9                  A     7648 	RET
                             A     7649 
                             A     7650 ; -------------------------------------------------------
                             A     7651 
000017C0 3A 15 00            A     7652 L17C1:  LD		A,(RAMSTART+015h)				; LISTWS3
000017C3 A7                  A     7653 	AND		A
000017C4 F8                  A     7654 	RET		M
                             A     7655 
000017C5 C5                  A     7656 	PUSH	BC						; preserve BC
000017C6 47                  A     7657 	LD		B,A						; transfer count to B
                             A     7658 
000017C7 3E 0D               A     7659 	LD		A,00Dh					; carriage return.
000017C9 CF                  A     7660 	RST		08H						; print_ch
                             A     7661 
000017CA 04                  A     7662 	INC		B						; test indentation.
000017CB 05                  A     7663 	DEC		B						;
000017CC 28 05               A     7664 	JR		Z,L17D4					;
                             A     7665 
000017CE 3E 20               A     7666 L17CF:  LD		A,020h					; a space character
000017D0 CF                  A     7667 	RST		08H						; print_ch
                             A     7668 
000017D1 10 FB               A     7669 	DJNZ	L17CF					;
                             A     7670 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  160


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000017D3 DD 36 15 FF         A     7671 L17D4:  LD		(IX+015h),0FFh			; LISTWS3
                             A     7672 
000017D7 C1                  A     7673 	POP		BC						; restore BC
000017D8 C9                  A     7674 	RET								; return.
                             A     7675 
                             A     7676 ; ---
                             A     7677 
000017D9 0A                  A     7678 L17DA:  LD		A,(BC)
000017DA 5F                  A     7679 	LD		E,A
000017DB 03                  A     7680 	INC		BC
000017DC 0A                  A     7681 	LD		A,(BC)
000017DD 57                  A     7682 	LD		D,A
000017DE 03                  A     7683 L17DF:  INC		BC
000017DF C9                  A     7684 	RET
                             A     7685 
                             A     7686 ; ---
                             A     7687 
000017E0 CD C0 17            A     7688 L17E1:  CALL	L17C1					; routine INDENT
                             A     7689 
000017E3 EB                  A     7690 L17E4:  EX		DE,HL
000017E4 2B                  A     7691 	DEC		HL
000017E5 7E                  A     7692 	LD		A,(HL)
000017E6 CB 7F               A     7693 	BIT		7,A
000017E8 20 05               A     7694 	JR		NZ,L17F0				;
                             A     7695 
000017EA CD E7 15            A     7696 	CALL	L15E8					; routine WORDSTART
                             A     7697 
000017ED 18 0B               A     7698 	JR		L17FB					;
                             A     7699 
                             A     7700 ; ---
                             A     7701 
000017EF EB                  A     7702 L17F0:  EX		DE,HL
                             A     7703 
000017F0 CD A1 15            A     7704 	CALL	L15A2					;
                             A     7705 
000017F3 13                  A     7706 	INC		DE
000017F4 1A                  A     7707 	LD		A,(DE)
000017F5 6F                  A     7708 	LD		L,A
000017F6 13                  A     7709 	INC		DE
000017F7 1A                  A     7710 	LD		A,(DE)
000017F8 67                  A     7711 	LD		H,A
000017F9 19                  A     7712 	ADD		HL,DE
                             A     7713 
                             A     7714 ; pr_string_sp
                             A     7715 
000017FA 7E                  A     7716 L17FB:  LD		A,(HL)
000017FB E6 7F               A     7717 	AND		07Fh
000017FD CF                  A     7718 	RST		08H						; print_ch
000017FE CB 7E               A     7719 	BIT		7,(HL)
00001800 23                  A     7720 	INC		HL
00001801 28 F7               A     7721 	JR		Z,L17FB					;
                             A     7722 
00001803 3E 20               A     7723 	LD		A,020h
00001805 CF                  A     7724 	RST		08H						; print_ch
00001806 C9                  A     7725 	RET
                             A     7726 
                             A     7727 ; ---------------------------------------
                             A     7728 ; THE 'INLINE PRINT STRING SPACE' ROUTINE
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  161


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7729 ; ---------------------------------------
                             A     7730 ;
                             A     7731 
00001807 E3                  A     7732 L1808:  EX		(SP),HL
00001808 CD FA 17            A     7733 	CALL	L17FB					; pr_string_sp
0000180B E3                  A     7734 	EX		(SP),HL
0000180C C9                  A     7735 	RET
                             A     7736 
                             A     7737 ; ---------------------------
                             A     7738 ; THE 'PRINT INTEGER' ROUTINE
                             A     7739 ; ---------------------------
                             A     7740 ; in HL
                             A     7741 
                             A     7742 ; -> called twice
0000180D 11 B3 09            A     7743 L180E:  LD		DE,009B3h				; '.' addr
00001810 D5                  A     7744 	PUSH	DE						; but save it as we need DE?
                             A     7745 
00001811 EB                  A     7746 	EX		DE,HL					; transfer HL to DE.
00001812 D7                  A     7747 	RST		10H						; push word DE, was HL, on Data Stack.
00001813 D1                  A     7748 	POP		DE						; restore L09B3 again
                             A     7749 
                             A     7750 ; -> called twice.
00001814 C5                  A     7751 L1815:  PUSH	BC						; preserve BC.
                             A     7752 
00001815 CD BF 04            A     7753 	CALL	L04BF					; executes '.' word
                             A     7754 
                             A     7755 ; the '.' exits so expects another word here
                             A     7756 
                             A     7757 
                             A     7758 L1819:  DEFW	L181B
00001818 1A 18               A+    7758 	DW P1
                             A     7759 
                             A     7760 L181B:  DEFW	L181D
0000181A 1C 18               A+    7760 	DW P1
                             A     7761 
0000181C C1                  A     7762 L181D:  POP		BC						;
0000181D C1                  A     7763 	POP		BC						; restore BC.
                             A     7764 
0000181E C9                  A     7765 	RET								; return.
                             A     7766 
                             A     7767 ; ---------------------------------
                             A     7768 ; THE 'CASSETTE INTERFACE' ROUTINES
                             A     7769 ; ---------------------------------
                             A     7770 
                             A     7771 ; ---
                             A     7772 ; tape???
                             A     7773 ; ---
                             A     7774 
0000181F FD E5               A     7775 L1820:  PUSH	IY
                             A     7776 
00001821 E5                  A     7777 	PUSH	HL
00001822 FD E1               A     7778 	POP		IY
                             A     7779 
00001824 21 91 18            A     7780 	LD		HL,L1892
00001827 E5                  A     7781 	PUSH	HL
                             A     7782 
00001828 21 00 E0            A     7783 	LD		HL,0E000h
0000182B CB 79               A     7784 	BIT		7,C
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  162


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000182D 28 02               A     7785 	JR		Z,L1832					;
0000182F 26 FC               A     7786 	LD		H,0FCh
00001831 13                  A     7787 L1832:  INC		DE
00001832 FD 2B               A     7788 	DEC		IY
00001834 F3                  A     7789 	DI
00001835 AF                  A     7790 	XOR		A
                             A     7791 
00001836 06 97               A     7792 L1837:  LD		B,097h
                             A     7793 
00001838 10 FE               A     7794 L1839:  DJNZ	L1839					;
0000183A D3 FE               A     7795 	OUT		(0FEh),A
0000183C EE 08               A     7796 	XOR		008h
0000183E 2C                  A     7797 	INC		L
0000183F 20 01               A     7798 	JR		NZ,L1843				;
00001841 24                  A     7799 	INC		H
00001842 20 F2               A     7800 L1843:  JR		NZ,L1837				;
00001844 06 2B               A     7801 	LD		B,02Bh
00001846 10 FE               A     7802 L1847:  DJNZ	L1847					;
00001848 D3 FE               A     7803 	OUT		(0FEh),A
0000184A 69                  A     7804 	LD		L,C
0000184B 01 08 3B            A     7805 	LD		BC,03B08h
0000184E 10 FE               A     7806 L184F:  DJNZ	L184F					;
00001850 79                  A     7807 	LD		A,C
00001851 D3 FE               A     7808 	OUT		(0FEh),A
00001853 06 38               A     7809 	LD		B,038h
00001855 C3 89 18            A     7810 	JP		L188A					;
                             A     7811 
00001858 79                  A     7812 L1859:  LD		A,C
00001859 CB 78               A     7813 	BIT		7,B
                             A     7814 
0000185B 10 FE               A     7815 L185C:  DJNZ	L185C					;
                             A     7816 
0000185D 30 04               A     7817 	JR		NC,L1864				;
                             A     7818 
0000185F 06 3D               A     7819 	LD		B,03Dh
00001861 10 FE               A     7820 L1862:  DJNZ	L1862					;
                             A     7821 
00001863 D3 FE               A     7822 L1864:  OUT		(0FEh),A
00001865 06 3A               A     7823 	LD		B,03Ah
00001867 C2 58 18            A     7824 	JP		NZ,L1859				;
0000186A 05                  A     7825 	DEC		B
0000186B AF                  A     7826 	XOR		A
0000186C CB 15               A     7827 L186D:  RL		L
0000186E C2 5B 18            A     7828 	JP		NZ,L185C				;
00001871 1B                  A     7829 	DEC		DE
00001872 FD 23               A     7830 	INC		IY
00001874 06 2E               A     7831 	LD		B,02Eh
                             A     7832 
00001876 3E 7F               A     7833 	LD		A,07Fh
00001878 DB FE               A     7834 	IN		A,(0FEh)
0000187A 1F                  A     7835 	RRA
0000187B D0                  A     7836 	RET		NC
                             A     7837 
0000187C 7A                  A     7838 	LD		A,D
0000187D FE FF               A     7839 	CP		0FFh
0000187F D0                  A     7840 	RET		NC
                             A     7841 
00001880 B3                  A     7842 	OR		E
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  163


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001881 28 0B               A     7843 	JR		Z,L188F					;
                             A     7844 
00001883 FD 6E 00            A     7845 	LD		L,(IY+000h)
00001886 7C                  A     7846 L1887:  LD		A,H
00001887 AD                  A     7847 	XOR		L
00001888 67                  A     7848 	LD		H,A
00001889 AF                  A     7849 L188A:  XOR		A
0000188A 37                  A     7850 	SCF
0000188B C3 6C 18            A     7851 	JP		L186D					; JUMP back
                             A     7852 
                             A     7853 ; ---
                             A     7854 
0000188E 6C                  A     7855 L188F:  LD		L,H
0000188F 18 F5               A     7856 	JR		L1887					;
                             A     7857 
00001891 FD E1               A     7858 L1892:  POP		IY						; restore the original IY value so that
                             A     7859 					; words can be used gain.
                             A     7860 
00001893 08                  A     7861 	EX		AF,AF'					;;
00001894 06 3B               A     7862 	LD		B,03Bh					;
                             A     7863 
00001896 10 FE               A     7864 L1897:  DJNZ	L1897					; self-loop for delay.
                             A     7865 
00001898 AF                  A     7866 	XOR		A
00001899 D3 FE               A     7867 	OUT		(0FEh),A
                             A     7868 
0000189B 3E 7F               A     7869 	LD		A,07Fh					; read the port 07FFEh
0000189D DB FE               A     7870 	IN		A,(0FEh)					; keyrows SPACE to V.
0000189F 1F                  A     7871 	RRA
000018A0 FB                  A     7872 	EI								; Enable Interrupts.
                             A     7873 
000018A1 D2 F0 04            A     7874 	JP		NC,L04F0				; jump if SPACE pressed to Error 3
                             A     7875 					; 'BREAK pressed'.
                             A     7876 
000018A4 08                  A     7877 	EX		AF,AF'					;;
000018A5 C9                  A     7878 	RET								; return.
                             A     7879 
                             A     7880 ; ---
                             A     7881 ; READ BYTES FROM TAPE
                             A     7882 ; ---
                             A     7883 
000018A6 F3                  A     7884 L18A7:  DI
000018A7 FD E5               A     7885 	PUSH	IY
000018A9 E5                  A     7886 	PUSH	HL
000018AA FD E1               A     7887 	POP		IY
000018AC 21 91 18            A     7888 	LD		HL,L1892
000018AF E5                  A     7889 	PUSH	HL
000018B0 61                  A     7890 	LD		H,C
000018B1 08                  A     7891 	EX		AF,AF'					; save carry
000018B2 AF                  A     7892 	XOR		A
000018B3 4F                  A     7893 	LD		C,A
                             A     7894 
000018B4 C0                  A     7895 L18B5:  RET		NZ
                             A     7896 
000018B5 2E 00               A     7897 L18B6:  LD		L,000h
000018B7 06 B8               A     7898 L18B8:  LD		B,0B8h
                             A     7899 
000018B9 CD 10 19            A     7900 	CALL	L1911					;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  164


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     7901 
000018BC 30 F6               A     7902 	JR		NC,L18B5				;
                             A     7903 
000018BE 3E DF               A     7904 	LD		A,0DFh
000018C0 B8                  A     7905 	CP		B
000018C1 30 F2               A     7906 	JR		NC,L18B6				;
                             A     7907 
000018C3 2C                  A     7908 	INC		L
000018C4 20 F1               A     7909 	JR		NZ,L18B8				;
                             A     7910 
000018C6 06 CF               A     7911 L18C7:  LD		B,0CFh
                             A     7912 
000018C8 CD 14 19            A     7913 	CALL	L1915					;
                             A     7914 
000018CB 30 E7               A     7915 	JR		NC,L18B5				;
                             A     7916 
000018CD 78                  A     7917 	LD		A,B
000018CE FE D8               A     7918 	CP		0D8h
000018D0 30 F4               A     7919 	JR		NC,L18C7				;
                             A     7920 
000018D2 CD 14 19            A     7921 	CALL	L1915					;
000018D5 D0                  A     7922 	RET		NC
                             A     7923 
000018D6 CD FB 18            A     7924 	CALL	L18FC					;
000018D9 D0                  A     7925 	RET		NC
                             A     7926 
000018DA 3F                  A     7927 	CCF
000018DB C0                  A     7928 	RET		NZ
                             A     7929 
000018DC 18 11               A     7930 	JR		L18F0					;
                             A     7931 
                             A     7932 ; ---
                             A     7933 
000018DE 08                  A     7934 L18DF:  EX		AF,AF'
000018DF 30 05               A     7935 	JR		NC,L18E7				;
000018E1 FD 75 00            A     7936 	LD		(IY+000h),L
000018E4 18 05               A     7937 	JR		L18EC					;
                             A     7938 
                             A     7939 ; ---
                             A     7940 
000018E6 FD 7E 00            A     7941 L18E7:  LD		A,(IY+000h)
000018E9 AD                  A     7942 	XOR		L
000018EA C0                  A     7943 	RET		NZ
                             A     7944 
000018EB FD 23               A     7945 L18EC:  INC		IY
000018ED 1B                  A     7946 	DEC		DE
000018EE 08                  A     7947 	EX		AF,AF'
                             A     7948 
000018EF CD FB 18            A     7949 L18F0:  CALL	L18FC					;
                             A     7950 
000018F2 D0                  A     7951 	RET		NC
                             A     7952 
000018F3 7A                  A     7953 	LD		A,D
000018F4 B3                  A     7954 	OR		E
000018F5 20 E7               A     7955 	JR		NZ,L18DF				;
                             A     7956 
000018F7 7C                  A     7957 	LD		A,H
000018F8 FE 01               A     7958 	CP		001h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  165


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000018FA C9                  A     7959 L18FB:  RET
                             A     7960 
                             A     7961 ; ---
                             A     7962 
000018FB 2E 01               A     7963 L18FC:  LD		L,001h
000018FD 06 C7               A     7964 L18FE:  LD		B,0C7h
                             A     7965 
000018FF CD 10 19            A     7966 	CALL	L1911					;
                             A     7967 
00001902 D0                  A     7968 	RET		NC
                             A     7969 
00001903 3E E2               A     7970 	LD		A,0E2h
00001905 B8                  A     7971 	CP		B
00001906 CB 15               A     7972 	RL		L
00001908 D2 FD 18            A     7973 	JP		NC,L18FE				;
                             A     7974 
0000190B 7C                  A     7975 	LD		A,H
0000190C AD                  A     7976 	XOR		L
0000190D 67                  A     7977 	LD		H,A
0000190E 37                  A     7978 	SCF
0000190F C9                  A     7979 	RET
                             A     7980 
                             A     7981 ; ---
                             A     7982 
00001910 CD 14 19            A     7983 L1911:  CALL	L1915					;
00001913 D0                  A     7984 	RET		NC
                             A     7985 
00001914 3E 14               A     7986 L1915:  LD		A,014h
00001916 3D                  A     7987 L1917:  DEC		A
                             A     7988 
00001917 20 FD               A     7989 	JR		NZ,L1917				;
                             A     7990 
00001919 A7                  A     7991 	AND		A
                             A     7992 
0000191A 04                  A     7993 L191B:  INC		B
0000191B C8                  A     7994 	RET		Z
                             A     7995 
0000191C 3E 7F               A     7996 	LD		A,07Fh
0000191E DB FE               A     7997 	IN		A,(0FEh)
00001920 1F                  A     7998 	RRA
00001921 D0                  A     7999 	RET		NC
                             A     8000 
00001922 A9                  A     8001 	XOR		C
00001923 E6 10               A     8002 	AND		010h
00001925 28 F3               A     8003 	JR		Z,L191B					;
                             A     8004 
00001927 79                  A     8005 	LD		A,C
00001928 2F                  A     8006 	CPL
00001929 4F                  A     8007 	LD		C,A
0000192A 37                  A     8008 	SCF
0000192B C9                  A     8009 	RET
                             A     8010 
                             A     8011 ; ---------------
                             A     8012 ; THE 'SAVE' WORD
                             A     8013 ; ---------------
                             A     8014 ; SAVE name.
                             A     8015 ; Saves entire dictionary in RAM on a dictionary type cassette file with the
                             A     8016 ; given name. Makes a noise on the internal loudspeaker.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  166


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8017 
                             A     8018 L192D:  DEFM	"SAV"					; 'name field'
0000192C 53 41 56            A+    8018 	DB P1
                             A     8019 	DEFB	'E'+080h
0000192F C5                  A+    8019 	DB P1
                             A     8020 
                             A     8021 	DEFW	L166F					; 'link field'
00001930 6E 16               A+    8021 	DW P1
                             A     8022 
                             A     8023 L1933:  DEFB	004h						; 'name length field'
00001932 04                  A+    8023 	DB P1
                             A     8024 
                             A     8025 L1934:  DEFW	L0EC3					; 'code field' - docolon
00001933 C2 0E               A+    8025 	DW P1
                             A     8026 
                             A     8027 ; ---
                             A     8028 
                             A     8029 	DEFW	L1A10					; word to pad
00001935 0F 1A               A+    8029 	DW P1
                             A     8030 	DEFW	L1A4F					;  prep some sort of header?
00001937 4E 1A               A+    8030 	DW P1
                             A     8031 	DEFW	L04B6					; exit
00001939 B6 04               A+    8031 	DW P1
                             A     8032 
                             A     8033 ; ----------------
                             A     8034 ; THE 'BSAVE' WORD
                             A     8035 ; ----------------
                             A     8036 ; BSAVE name
                             A     8037 ; (m, n -- )
                             A     8038 ; Save n bytes to bytes type cassette file 'name' starting at
                             A     8039 ; address m.
                             A     8040 ;
                             A     8041 
                             A     8042 L193C:  DEFM	"BSAV"					; 'name field'
0000193B 42 53 41 56         A+    8042 	DB P1
                             A     8043 	DEFB	'E'+080h
0000193F C5                  A+    8043 	DB P1
                             A     8044 
                             A     8045 	DEFW	L1933					; 'link field'
00001940 32 19               A+    8045 	DW P1
                             A     8046 
                             A     8047 L1943:  DEFB	005h						; 'name length field'
00001942 05                  A+    8047 	DB P1
                             A     8048 
                             A     8049 L1944:  DEFW	L0EC3					; 'code field' - docolon
00001943 C2 0E               A+    8049 	DW P1
                             A     8050 
                             A     8051 ; ---
                             A     8052 
                             A     8053 L1946:  DEFW	L1A3D					; prep_header
00001945 3C 1A               A+    8053 	DW P1
                             A     8054 	DEFW	L1A4F					; prep some sort of header?
00001947 4E 1A               A+    8054 	DW P1
                             A     8055 	DEFW	L04B6					; exit
00001949 B6 04               A+    8055 	DW P1
                             A     8056 
                             A     8057 
                             A     8058 ; ----------------
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  167


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8059 ; THE 'BLOAD' WORD
                             A     8060 ; ----------------
                             A     8061 ; BLOAD name
                             A     8062 ; (m, n -- )
                             A     8063 ; Load at most n bytes of bytes type cassette file 'name' starting at
                             A     8064 ; address m. ERROR 10 if the file has more than m bytes.
                             A     8065 ;
                             A     8066 L194C:  DEFM	"BLOA"					; 'name field'
0000194B 42 4C 4F 41         A+    8066 	DB P1
                             A     8067 	DEFB	'D'+080h
0000194F C4                  A+    8067 	DB P1
                             A     8068 
                             A     8069 	DEFW	L1943					; 'link field'
00001950 42 19               A+    8069 	DW P1
                             A     8070 
                             A     8071 L1953:  DEFB	005h						; 'name length field'
00001952 05                  A+    8071 	DB P1
                             A     8072 
                             A     8073 L1954:  DEFW	L0EC3					; 'code field' - docolon
00001953 C2 0E               A+    8073 	DW P1
                             A     8074 
                             A     8075 ; ---
                             A     8076 
                             A     8077 	DEFW	L1A3D					; prep_header
00001955 3C 1A               A+    8077 	DW P1
                             A     8078 	DEFW	L1A74					; ld-bytes??
00001957 73 1A               A+    8078 	DW P1
                             A     8079 	DEFW	L1AB8					; tapeFF
00001959 B7 1A               A+    8079 	DW P1
                             A     8080 	DEFW	L04B6					; exit
0000195B B6 04               A+    8080 	DW P1
                             A     8081 
                             A     8082 ; -----------------
                             A     8083 ; THE 'VERIFY' WORD
                             A     8084 ; -----------------
                             A     8085 ; VERIFY name
                             A     8086 ; (  --  )
                             A     8087 ; Verifies dictionary on tape against dictionary in RAM.
                             A     8088 
                             A     8089 L195E:  DEFM	"VERIF"					; 'name field'
0000195D 56 45 52 49 46      A+    8089 	DB P1
                             A     8090 	DEFB	'Y'+080h
00001962 D9                  A+    8090 	DB P1
                             A     8091 
                             A     8092 	DEFW	L1953					; 'link field'
00001963 52 19               A+    8092 	DW P1
                             A     8093 
                             A     8094 L1966:  DEFB	006h						; 'name length field'
00001965 06                  A+    8094 	DB P1
                             A     8095 
                             A     8096 L1967:  DEFW	L0EC3					; 'code field' - docolon
00001966 C2 0E               A+    8096 	DW P1
                             A     8097 
                             A     8098 ; ---
                             A     8099 
                             A     8100 L1969:  DEFW	L1A10					; word to pad
00001968 0F 1A               A+    8100 	DW P1
                             A     8101 	DEFW	L1271					; branch
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  168


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
0000196A 70 12               A+    8101 	DW P1
                             A     8102 L196D:  DEFW	0000Fh					; 15 bytes forward to L197D
0000196C 0F 00               A+    8102 	DW P1
                             A     8103 
                             A     8104 
                             A     8105 ; ------------------
                             A     8106 ; THE 'BVERIFY' WORD
                             A     8107 ; ------------------
                             A     8108 ; BVERIFY name
                             A     8109 ; (m, n -- )
                             A     8110 ; Verify at most n bytes of bytes type cassette file 'name' against
                             A     8111 ; RAM starting at address m. ERROR 10 if the file has more than m bytes.
                             A     8112 ; For BLOAD and BVERIFY, if m = 0, then starts at the address the bytes
                             A     8113 ; were saved from. If n = 0, then doesn't care about the length.
                             A     8114 ;
                             A     8115 
                             A     8116 L196F:  DEFM	"BVERIF"				; 'name field'
0000196E 42 56 45 52 49 46   A+    8116 	DB P1
                             A     8117 	DEFB	'Y'+080h
00001974 D9                  A+    8117 	DB P1
                             A     8118 
                             A     8119 	DEFW	L1966					; 'link field'
00001975 65 19               A+    8119 	DW P1
                             A     8120 
                             A     8121 L1978:  DEFB	007h						; 'name length field'
00001977 07                  A+    8121 	DB P1
                             A     8122 
                             A     8123 L1979:  DEFW	L0EC3					; 'code field' - docolon
00001978 C2 0E               A+    8123 	DW P1
                             A     8124 
                             A     8125 ; ---
                             A     8126 
                             A     8127 L197B:  DEFW	L1A3D					; prep_header
0000197A 3C 1A               A+    8127 	DW P1
                             A     8128 
                             A     8129 ; ->
                             A     8130 
                             A     8131 L197D:  DEFW	L1A74					; ld_bytes
0000197C 73 1A               A+    8131 	DW P1
                             A     8132 	DEFW	L1ABE					; tape00
0000197E BD 1A               A+    8132 	DW P1
                             A     8133 	DEFW	L04B6					; exit
00001980 B6 04               A+    8133 	DW P1
                             A     8134 
                             A     8135 ; ---------------
                             A     8136 ; THE 'LOAD' WORD
                             A     8137 ; ---------------
                             A     8138 ; LOAD name
                             A     8139 ; (  --  )
                             A     8140 ; Searches for a dictionary cassette file 'name' and loads it in, adding it
                             A     8141 ; to end of old dictionary. Writes to the screen all files found on tape.
                             A     8142 ; For best results turn the tone control on the tape recorder right down
                             A     8143 ; (as bass as possible) and the volume control to about three-quarters
                             A     8144 ; maximum.
                             A     8145 
                             A     8146 L1983:  DEFM	"LOA"					; 'name field'
00001982 4C 4F 41            A+    8146 	DB P1
                             A     8147 	DEFB	'D'+080h
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  169


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001985 C4                  A+    8147 	DB P1
                             A     8148 
                             A     8149 	DEFW	L1978					; 'link field'
00001986 77 19               A+    8149 	DW P1
                             A     8150 
                             A     8151 L1989:  DEFB	004h						; 'name length field'
00001988 04                  A+    8151 	DB P1
                             A     8152 
                             A     8153 L198A:  DEFW	L0EC3					; 'code field' - docolon
00001989 C2 0E               A+    8153 	DW P1
                             A     8154 
                             A     8155 ; ---
                             A     8156 
                             A     8157 L198C:  DEFW	L1A10					; word to pad
0000198B 0F 1A               A+    8157 	DW P1
                             A     8158 
                             A     8159 	DEFW	L1A0E					; end-forth.
0000198D 0D 1A               A+    8159 	DW P1
                             A     8160 
0000198F 2A 37 00            A     8161 	LD		HL,(STKBOT)				; STKBOT
00001992 22 0E 23            A     8162 	LD		(0230Eh),HL
00001995 EB                  A     8163 	EX		DE,HL
00001996 21 CC FF            A     8164 	LD		HL,0FFCCh
00001999 39                  A     8165 	ADD		HL,SP
0000199A A7                  A     8166 	AND		A
0000199B ED 52               A     8167 	SBC		HL,DE
0000199D 22 0C 23            A     8168 	LD		(0230Ch),HL
                             A     8169 
000019A0 CD B9 04            A     8170 	CALL	L04B9					; forth
                             A     8171 
                             A     8172 L19A4:  DEFW	L1A74					; ld_bytes
000019A3 73 1A               A+    8172 	DW P1
                             A     8173 	DEFW	L1AB8					; tapeFF
000019A5 B7 1A               A+    8173 	DW P1
                             A     8174 	DEFW	L1A0E					; end-forth.
000019A7 0D 1A               A+    8174 	DW P1
                             A     8175 
000019A9 ED 4B 37 00         A     8176 	LD		BC,(STKBOT)				; STKBOT
000019AD 21 50 00            A     8177 	LD		HL,RAMSTART+050h
000019B0 22 01 27            A     8178 	LD		(02701h),HL
000019B3 23                  A     8179 	INC		HL
000019B4 22 09 27            A     8180 	LD		(02709h),HL
000019B7 2A 25 23            A     8181 	LD		HL,(02325h)
000019BA 09                  A     8182 	ADD		HL,BC
000019BB 22 37 00            A     8183 	LD		(STKBOT),HL				; STKBOT
000019BE 21 AF C3            A     8184 	LD		HL,0C3AFh
000019C1 09                  A     8185 	ADD		HL,BC
000019C2 22 0B 27            A     8186 	LD		(0270Bh),HL
000019C5 ED 5B 29 23         A     8187 	LD		DE,(02329h)
000019C9 19                  A     8188 	ADD		HL,DE
000019CA ED 5B 4C 00         A     8189 	LD		DE,(RAMSTART+04Ch)
000019CE 22 4C 00            A     8190 	LD		(RAMSTART+04Ch),HL
000019D1 C5                  A     8191 	PUSH	BC
000019D2 D5                  A     8192 	PUSH	DE
                             A     8193 
                             A     8194 
000019D3 ED 73 0D 27         A     8195 L19D4:  LD		(0270Dh),SP
000019D7 CD 03 15            A     8196 	CALL	L1504					;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  170


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
000019DA C1                  A     8197 	POP		BC
000019DB E1                  A     8198 	POP		HL
000019DC CB 7E               A     8199 L19DD:  BIT		7,(HL)
000019DE 23                  A     8200 	INC		HL
000019DF 28 FB               A     8201 	JR		Z,L19DD					;
000019E1 23                  A     8202 	INC		HL
000019E2 23                  A     8203 	INC		HL
000019E3 71                  A     8204 	LD		(HL),C
000019E4 23                  A     8205 	INC		HL
000019E5 70                  A     8206 	LD		(HL),B
000019E6 2A 37 00            A     8207 	LD		HL,(STKBOT)				; STKBOT
000019E9 01 0C 00            A     8208 	LD		BC,0000Ch				; allow twelve bytes for underflow.
000019EC 09                  A     8209 	ADD		HL,BC
000019ED 22 3B 00            A     8210 	LD		(SPARE),HL				; SPARE
000019F0 FD E9               A     8211 	JP		(IY)					; to 'next'.
                             A     8212 
                             A     8213 ; ---
                             A     8214 
                             A     8215 L19F3:  DEFW	L0EC3					; 'code field' - docolon
000019F2 C2 0E               A+    8215 	DW P1
                             A     8216 	DEFW	L104B					; stk_data
000019F4 4A 10               A+    8216 	DW P1
                             A     8217 	DEFB	020h						; a space delimiter
000019F6 20                  A+    8217 	DB P1
                             A     8218 	DEFW	L05AB					; word			(to pad)
000019F7 AB 05               A+    8218 	DW P1
                             A     8219 	DEFW	L1A0E					; end-forth.
000019F9 0D 1A               A+    8219 	DW P1
                             A     8220 
                             A     8221 ; ---
                             A     8222 
000019FB CD 2D 0F            A     8223 L19FC:  CALL	L0F2E					; blank stack
                             A     8224 
000019FE DF                  A     8225 L19FF:  RST		18H						; pop word DE
                             A     8226 
000019FF 3E 20               A     8227 	LD		A,020h					;
00001A01 12                  A     8228 	LD		(DE),A					;
00001A02 11 0C 27            A     8229 	LD		DE,0270Ch				;
00001A05 21 FF 27            A     8230 	LD		HL,027FFh				;
                             A     8231 
00001A08 CD FA 07            A     8232 	CALL	L07FA					; routine SPACE_FILL
                             A     8233 
00001A0B FD E9               A     8234 	JP		(IY)					; to 'next'.
                             A     8235 
                             A     8236 ; ---
                             A     8237 
                             A     8238 
                             A     8239 L1A0E:  DEFW	L18FB					; location of RET instruction.
00001A0D FA 18               A+    8239 	DW P1
                             A     8240 
                             A     8241 ; ---
                             A     8242 
                             A     8243 L1A10:  DEFW	L0EC3					; 'code field' - docolon
00001A0F C2 0E               A+    8243 	DW P1
                             A     8244 	DEFW	L19F3					; word to pad
00001A11 F2 19               A+    8244 	DW P1
                             A     8245 	DEFW	L1A0E					; end-forth.
00001A13 0D 1A               A+    8245 	DW P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  171


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8246 
00001A15 AF                  A     8247 	XOR		A						;
00001A16 32 01 23            A     8248 	LD		(02301h),A				;
00001A19 21 51 00            A     8249 	LD		HL,RAMSTART+051h				;
00001A1C 22 0E 23            A     8250 	LD		(0230Eh),HL				;
00001A1F EB                  A     8251 	EX		DE,HL					;
00001A20 2A 37 00            A     8252 	LD		HL,(STKBOT)				; STKBOT
00001A23 A7                  A     8253 	AND		A						;
00001A24 ED 52               A     8254 	SBC		HL,DE
00001A26 22 0C 23            A     8255 	LD		(0230Ch),HL
00001A29 2A 4C 00            A     8256 	LD		HL,(RAMSTART+04Ch)
00001A2C 22 10 23            A     8257 	LD		(02310h),HL
00001A2F 21 31 00            A     8258 	LD		HL,CURRENT				; CURRENT
00001A32 11 12 23            A     8259 	LD		DE,02312h
00001A35 01 08 00            A     8260 	LD		BC,00008h				;
                             A     8261 
00001A38 ED B0               A     8262 	LDIR							;
                             A     8263 
00001A3A FD E9               A     8264 	JP		(IY)					; to 'next'.
                             A     8265 
                             A     8266 ; ---
                             A     8267 
                             A     8268 
                             A     8269 L1A3D:  DEFW	L0EC3					; 'code field' - docolon
00001A3C C2 0E               A+    8269 	DW P1
                             A     8270 	DEFW	L19F3					; word to pad
00001A3E F2 19               A+    8270 	DW P1
                             A     8271 	DEFW	L1011					; stack next word
00001A40 10 10               A+    8271 	DW P1
                             A     8272 	DEFW	0230Ch					; header location
00001A42 0C 23               A+    8272 	DW P1
                             A     8273 	DEFW	L08C1					; !		store int at address
00001A44 C0 08               A+    8273 	DW P1
                             A     8274 	DEFW	L1011					; stack next word
00001A46 10 10               A+    8274 	DW P1
                             A     8275 	DEFW	0230Eh					; header location
00001A48 0E 23               A+    8275 	DW P1
                             A     8276 	DEFW	L08C1					; !		store int at address
00001A4A C0 08               A+    8276 	DW P1
                             A     8277 	DEFW	L04B6					; exit
00001A4C B6 04               A+    8277 	DW P1
                             A     8278 
                             A     8279 ; ---
                             A     8280 
                             A     8281 L1A4F:  DEFW	L1A51
00001A4E 50 1A               A+    8281 	DW P1
                             A     8282 
00001A50 3A 02 23            A     8283 L1A51:  LD		A,(02302h)				; length of word in pad
00001A53 A7                  A     8284 	AND		A
00001A54 28 5F               A     8285 	JR		Z,L1AB6					; forward if null.
                             A     8286 
00001A56 2A 0C 23            A     8287 	LD		HL,(0230Ch)
00001A59 7C                  A     8288 	LD		A,H
00001A5A B5                  A     8289 	OR		L
00001A5B 28 58               A     8290 	JR		Z,L1AB6					;
                             A     8291 
00001A5D E5                  A     8292 	PUSH	HL
00001A5E 11 19 00            A     8293 	LD		DE,00019h				;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  172


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001A61 21 01 23            A     8294 	LD		HL,02301h				; pad using ROM priority
00001A64 4A                  A     8295 	LD		C,D						;
                             A     8296 
00001A65 CD 1F 18            A     8297 	CALL	L1820					;
                             A     8298 
00001A68 D1                  A     8299 	POP		DE
00001A69 2A 0E 23            A     8300 	LD		HL,(0230Eh)				;
00001A6C 0E FF               A     8301 	LD		C,0FFh
                             A     8302 
00001A6E CD 1F 18            A     8303 	CALL	L1820					;
                             A     8304 
00001A71 FD E9               A     8305 	JP		(IY)					; to 'next'.
                             A     8306 
                             A     8307 ; ---
                             A     8308 ; ld_bytes
                             A     8309 ; ---
                             A     8310 
                             A     8311 L1A74:  DEFW	L1A76
00001A73 75 1A               A+    8311 	DW P1
                             A     8312 
00001A75 11 19 00            A     8313 L1A76:  LD		DE,00019h
00001A78 21 1A 23            A     8314 	LD		HL,0231Ah
00001A7B 4A                  A     8315 	LD		C,D
                             A     8316 
00001A7C 37                  A     8317 	SCF
                             A     8318 
00001A7D CD A6 18            A     8319 	CALL	L18A7					;
                             A     8320 
00001A80 30 F3               A     8321 	JR		NC,L1A76				; loop back until read
                             A     8322 
00001A82 11 1A 23            A     8323 	LD		DE,0231Ah
00001A85 1A                  A     8324 	LD		A,(DE)
00001A86 A7                  A     8325 	AND		A
00001A87 20 0B               A     8326 	JR		NZ,L1A95				;
                             A     8327 
00001A89 CD 07 18            A     8328 	CALL	L1808					; pr_inline
                             A     8329 
                             A     8330 ; ---
                             A     8331 
                             A     8332 L1A8D:  DEFB	00Dh						; newline
00001A8C 0D                  A+    8332 	DB P1
                             A     8333 	DEFM	"Dict"
00001A8D 44 69 63 74         A+    8333 	DB P1
                             A     8334 	DEFB	':'+080h				;
00001A91 BA                  A+    8334 	DB P1
                             A     8335 
00001A92 18 0A               A     8336 L1A93:  JR		L1A9F					;
                             A     8337 
                             A     8338 ; ---
                             A     8339 
00001A94 CD 07 18            A     8340 L1A95:  CALL	L1808					; pr_inline
                             A     8341 
                             A     8342 L1A98:  DEFB	00Dh						; newline
00001A97 0D                  A+    8342 	DB P1
                             A     8343 
                             A     8344 	DEFM	"Bytes"
00001A98 42 79 74 65 73      A+    8344 	DB P1
                             A     8345 	DEFB	':'+080h				;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  173


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001A9D BA                  A+    8345 	DB P1
                             A     8346 
                             A     8347 ; ---
                             A     8348 
00001A9E 21 01 23            A     8349 L1A9F:  LD		HL,02301h
00001AA1 01 0B 0B            A     8350 	LD		BC,00B0Bh
00001AA4 18 02               A     8351 	JR		L1AA9					;
                             A     8352 
                             A     8353 ; ---
                             A     8354 
00001AA6 1A                  A     8355 L1AA7:  LD		A,(DE)
00001AA7 CF                  A     8356 	RST		08H						; print_ch
                             A     8357 
00001AA8 1A                  A     8358 L1AA9:  LD		A,(DE)
00001AA9 BE                  A     8359 	CP		(HL)
00001AAA 20 01               A     8360 	JR		NZ,L1AAE				;
00001AAC 0D                  A     8361 	DEC		C
                             A     8362 
00001AAD 23                  A     8363 L1AAE:  INC		HL
00001AAE 13                  A     8364 	INC		DE
00001AAF 10 F5               A     8365 	DJNZ	L1AA7					;
                             A     8366 
00001AB1 20 C2               A     8367 	JR		NZ,L1A76				;
00001AB3 FD E9               A     8368 	JP		(IY)					; to 'next'.
                             A     8369 
                             A     8370 ; ---
                             A     8371 
00001AB5 E7                  A     8372 L1AB6:  RST		20H						; Error 10
                             A     8373 	DEFB	00Ah						; Tape error
00001AB6 0A                  A+    8373 	DB P1
                             A     8374 
                             A     8375 ; ---
                             A     8376 ;
                             A     8377 ; ---
                             A     8378 
                             A     8379 L1AB8:  DEFW	L1ABA					; headerless 'code field'
00001AB7 B9 1A               A+    8379 	DW P1
                             A     8380 
00001AB9 06 FF               A     8381 L1ABA:  LD		B,0FFh
00001ABB 18 12               A     8382 	JR		L1AD0					; forward to +->
                             A     8383 
                             A     8384 ; ---
                             A     8385 ;
                             A     8386 ; ---
                             A     8387 
                             A     8388 L1ABE:  DEFW	L1AC0					; headerless 'code field'
00001ABD BF 1A               A+    8388 	DW P1
                             A     8389 
00001ABF 21 12 23            A     8390 L1AC0:  LD		HL,02312h
00001AC2 11 2B 23            A     8391 	LD		DE,0232Bh
00001AC5 06 08               A     8392 	LD		B,008h
                             A     8393 
00001AC7 1A                  A     8394 L1AC8:  LD		A,(DE)
00001AC8 13                  A     8395 	INC		DE
00001AC9 BE                  A     8396 	CP		(HL)
00001ACA 23                  A     8397 	INC		HL
00001ACB 20 E8               A     8398 	JR		NZ,L1AB6				; back to tape error
                             A     8399 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  174


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001ACD 10 F8               A     8400 	DJNZ	L1AC8					; back for all 8
                             A     8401 
                             A     8402 ; common code - B is 000h from above or 0FFh from previous.
                             A     8403 
00001ACF 2A 0C 23            A     8404 L1AD0:  LD		HL,(0230Ch)
00001AD2 ED 5B 25 23         A     8405 	LD		DE,(02325h)
00001AD6 7C                  A     8406 	LD		A,H
00001AD7 B5                  A     8407 	OR		L
00001AD8 28 04               A     8408 	JR		Z,L1ADF					; skip if zero
                             A     8409 
00001ADA ED 52               A     8410 	SBC		HL,DE
00001ADC 38 D7               A     8411 	JR		C,L1AB6					; back to tape error
                             A     8412 
00001ADE 2A 0E 23            A     8413 L1ADF:  LD		HL,(0230Eh)
00001AE1 7C                  A     8414 	LD		A,H
00001AE2 B5                  A     8415 	OR		L
00001AE3 20 03               A     8416 	JR		NZ,L1AE9				; skip if zero
00001AE5 2A 27 23            A     8417 	LD		HL,(02327h)
                             A     8418 
00001AE8 0E FF               A     8419 L1AE9:  LD		C,0FFh
00001AEA CB 18               A     8420 	RR		B
                             A     8421 
00001AEC CD A6 18            A     8422 	CALL	L18A7					;
                             A     8423 
00001AEF 30 C4               A     8424 	JR		NC,L1AB6				; back to report tape error
                             A     8425 
00001AF1 FD E9               A     8426 	JP		(IY)					; to 'next'.
                             A     8427 
                             A     8428 ; ==========================================================
                             A     8429 ; THE 'FLOATING POINT ARITHMETIC' ROUTINES
                             A     8430 ; ==========================================================
                             A     8431 
                             A     8432 ; ---------------------
                             A     8433 ; THE 'PREP_FP' ROUTINE
                             A     8434 ; ---------------------
                             A     8435 ; ( f1, f2 -- m1, m2 )
                             A     8436 ; -> from add/mult/div
                             A     8437 ; Entered with two floating point numbers on the stack.
                             A     8438 ; The exponents are stored in the first two bytes of FP_WS and the third byte
                             A     8439 ; is loaded with the manipulated result sign.
                             A     8440 ; the two exponent locations on the Data Stack are blanked leaving just the
                             A     8441 ; binary coded mantissas.
                             A     8442 
                             A     8443 ; Begin by clearing the first part of the workspace.
                             A     8444 
00001AF3 01 0F 00            A     8445 L1AF4:  LD		BC,RAMSTART+00Fh				; byte 15 of the 19 bytes at FP_WS
                             A     8446 
00001AF6 AF                  A     8447 	XOR		A						; clear accumulator.
                             A     8448 
00001AF7 02                  A     8449 L1AF8:  LD		(BC),A					; clear the workspace.
00001AF8 0D                  A     8450 	DEC		C						; decrement low byte of address.
00001AF9 20 FC               A     8451 	JR		NZ,L1AF8				; and back until at RAMSTART
                             A     8452 
                             A     8453 ;
                             A     8454 
00001AFB 2A 3B 00            A     8455 	LD		HL,(SPARE)				; fetch end of data stack+1 from SPARE.
00001AFE 11 FC FF            A     8456 	LD		DE,0FFFCh				; prepare  -4
                             A     8457 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  175


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001B01 2B                  A     8458 	DEC		HL						; point to last byte of stack.
00001B02 4E                  A     8459 	LD		C,(HL)					; sign/exponent of (f2) to C.
00001B03 77                  A     8460 	LD		(HL),A					; replace with zero to take overflow.
                             A     8461 
00001B04 19                  A     8462 	ADD		HL,DE					; subtract four from address
                             A     8463 
                             A     8464 ; update system variable SPARE - this could be deferred.
                             A     8465 
00001B05 23                  A     8466 	INC		HL						; point to location after (f1).
00001B06 22 3B 00            A     8467 	LD		(SPARE),HL				; update system variable SPARE
00001B09 2B                  A     8468 	DEC		HL						; point to exponent of (f1)
                             A     8469 
00001B0A 46                  A     8470 	LD		B,(HL)					; sign/exponent of (f1) to B.
00001B0B 77                  A     8471 	LD		(HL),A					; replace with zero.
                             A     8472 
                             A     8473 ; At this stage we have the sign/exponent of (f1) in B and the sign/exponent
                             A     8474 ; of (f2) in C. The next section places the sign bit of (f1) in but 7 of A
                             A     8475 ; and the sign bit of (f2) in bit 6 of A. The other bits are of no importance.
                             A     8476 
00001B0C 79                  A     8477 	LD		A,C						; transfer C to A.
00001B0D 0F                  A     8478 	RRCA							; rotate sign bit to bit 6.
00001B0E A8                  A     8479 	XOR		B						; XOR B		
00001B0F E6 7F               A     8480 	AND		07Fh						; mask off bits to restore
00001B11 A8                  A     8481 	XOR		B						; bit 6 as it was, bit 7 of B to A.
                             A     8482 
00001B12 32 02 00            A     8483 L1B13:   LD		(RAMSTART+002h),A				; FP_WS_02				see L1C2F
                             A     8484 
00001B15 CB B8               A     8485 	RES		7,B						; make both numbers
00001B17 CB B9               A     8486 	RES		7,C						; positive
                             A     8487 
00001B19 ED 43 00 00         A     8488 	LD		(RAMSTART),BC				; store the exponents at start of FP_WS
                             A     8489 
00001B1D 23                  A     8490 	INC		HL						; point to (f2) again.
00001B1E EB                  A     8491 	EX		DE,HL					; transfer f2 pointer to DE, HL now -4
00001B1F 19                  A     8492 	ADD		HL,DE					; subtract four to point HL at (f1)
00001B20 C9                  A     8493 	RET								; return.
                             A     8494 
                             A     8495 ; On exit, HL -> (f1), DE -> (f2), B = exponent of (f1), C = exponent of (f2).
                             A     8496 
                             A     8497 ; -----------------------------
                             A     8498 ; THE 'SHIFT_ADDEND' SUBROUTINE
                             A     8499 ; -----------------------------
                             A     8500 
00001B21 3E 09               A     8501 L1B22:  LD		A,009h
00001B23 B8                  A     8502 	CP		B
00001B24 30 01               A     8503 	JR		NC,L1B28				;
                             A     8504 
00001B26 47                  A     8505 	LD		B,A						; set shift counter to nine. i.e clear.
                             A     8506 
00001B27 0E 04               A     8507 L1B28:  LD		C,004h					; four bytes 
00001B29 23                  A     8508 	INC		HL
00001B2A 23                  A     8509 	INC		HL
00001B2B 23                  A     8510 	INC		HL						; point to highest byte
                             A     8511 
00001B2C AF                  A     8512 	XOR		A						; prepare to start with a blank nibble.
                             A     8513 
00001B2D ED 67               A     8514 L1B2E:  RRD								; A=0000 XXXX --> 7654->3210 =(HL)
                             A     8515 					;			\_____<-______/
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  176


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8516 
00001B2F 2B                  A     8517 	DEC		HL						; point to next lower byte on Data Stack
00001B30 0D                  A     8518 	DEC		C						; decrement the byte counter.
00001B31 20 FA               A     8519 	JR		NZ,L1B2E				; loop for all 4 bytes = 1 nibble shift
                             A     8520 
00001B33 23                  A     8521 	INC		HL						; set pointer to start of number again
00001B34 10 F1               A     8522 	DJNZ	L1B28					; decrement the shift counter and loop.
                             A     8523 
00001B36 C6 FB               A     8524 	ADD		A,0FBh					; add minus five to last nibble lost
                             A     8525 					; will set the carry flag if 5 or more.
                             A     8526 
00001B38 E5                  A     8527 	PUSH	HL						;; preserve pointer to start of addend.
                             A     8528 
00001B39 7E                  A     8529 L1B3A:  LD		A,(HL)					; fetch the pair of BCD nibbles.
                             A     8530 
00001B3A 88                  A     8531 	ADC		A,B						; increment if carry set (B = 0)
00001B3B 27                  A     8532 	DAA								; Decimal Adjust Accumulator
                             A     8533 					; (099h becomes 000h with carry set).
                             A     8534 
00001B3C 77                  A     8535 	LD		(HL),A					; put nibbles back.
00001B3D 23                  A     8536 	INC		HL						; point to next significant pair of 
                             A     8537 					; binary coded decimal digits.
00001B3E 38 F9               A     8538 	JR		C,L1B3A					; and ripple any rounding through.   
                             A     8539 
00001B40 E1                  A     8540 	POP		HL						;; retrieve the pointer to start.
00001B41 C9                  A     8541 	RET								; return.
                             A     8542 
                             A     8543 ; ---------------------------
                             A     8544 ; THE 'BCD NEGATE' SUBROUTINE
                             A     8545 ; ---------------------------
                             A     8546 ; Negates the four byte, 8 nibble, binary coded decimal on the Data Stack.
                             A     8547 ; For example -123.456 
                             A     8548 ; is prepared as 000h 012h 034h 056h
                             A     8549 ; and negated as 099h 087h 065h 034h
                             A     8550 
00001B42 C5                  A     8551 L1B43:  PUSH	BC						; preserve the two
00001B43 E5                  A     8552 	PUSH	HL						; main registers used.
                             A     8553 
00001B44 06 04               A     8554 	LD		B,004h					; set byte counter to four.
00001B46 A7                  A     8555 	AND		A						; clear carry.
                             A     8556 
00001B47 3E 00               A     8557 L1B48:  LD		A,000h					; set to zero without disturbing carry.
                             A     8558 
00001B49 9E                  A     8559 	SBC		A,(HL)					; subtract pair of digits
00001B4A 27                  A     8560 	DAA								; Decimal Adjust Accumulator
                             A     8561 					; adjusts as if from 100 setting carry
                             A     8562 
00001B4B 77                  A     8563 	LD		(HL),A					; place adjusted decimals back. 
                             A     8564 
00001B4C 23                  A     8565 	INC		HL						; next location on Data Stack.
                             A     8566 
00001B4D 10 F8               A     8567 	DJNZ	L1B48					; loop for all 4 bytes.
                             A     8568 
00001B4F E1                  A     8569 	POP		HL						; restore the
00001B50 C1                  A     8570 	POP		BC						; saved registers.
                             A     8571 
00001B51 C9                  A     8572 	RET								; return.
                             A     8573 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  177


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8574 ; ------------------------------
                             A     8575 ; THE 'BCD OPERATION' SUBROUTINE
                             A     8576 ; ------------------------------
                             A     8577 ; This versatile routine performs the binary coded decimal addition of
                             A     8578 ; two floating point values with C = 1.
                             A     8579 ; The second entry point is used in multiplication.
                             A     8580 
                             A     8581 ; ->
00001B52 0E 01               A     8582 L1B53:  LD		C,001h					; signal the operation is addition.
                             A     8583 
                             A     8584 ; -> (with c!=0)
00001B54 E5                  A     8585 L1B55:  PUSH	HL						; preserve the 
00001B55 D5                  A     8586 	PUSH	DE						; three main
00001B56 C5                  A     8587 	PUSH	BC						; registers.
                             A     8588 
00001B57 79                  A     8589 	LD		A,C						; treat C as a binary coded decimal.
00001B58 E6 0F               A     8590 	AND		00Fh						; isolate the right-hand nibble.
00001B5A 47                  A     8591 	LD		B,A						; transfer R.H. nibble to B
                             A     8592 
00001B5B A9                  A     8593 	XOR		C						; A now has L.H. nibble.
00001B5C 4F                  A     8594 	LD		C,A						; place in C.
                             A     8595 
                             A     8596 ; this next magical routine converts the two BCD digits to binary.
                             A     8597 ; imagine we started with ninety-nine so C = 1001 0000  and B = 0000 1001
                             A     8598 
00001B5D 0F                  A     8599 	RRCA							;	0100 1000
00001B5E 0F                  A     8600 	RRCA							;	0010 0100
00001B5F 81                  A     8601 	ADD		A,C						;	1011 0100
00001B60 0F                  A     8602 	RRCA							;	0101 1010
00001B61 80                  A     8603 	ADD		A,B						;	0110 0011  = 99 binary
                             A     8604 
00001B62 4F                  A     8605 	LD		C,A						;	binary multiplier in C
                             A     8606 
                             A     8607 ; note that for simple addition C is unchanged and still contains 1.
                             A     8608 
00001B63 06 04               A     8609 	LD		B,004h					; four bytes to consider
00001B65 AF                  A     8610 	XOR		A						; clear accumulator ensuring no initial
                             A     8611 					; carry is fed into the loop.
                             A     8612 
                             A     8613 ; loop
                             A     8614 
00001B66 C5                  A     8615 L1B67:  PUSH	BC						; push the counters. 
00001B67 D5                  A     8616 	PUSH	DE						; push the (f2) pointer
                             A     8617 
00001B68 E5                  A     8618 	PUSH	HL						; push the (f1) pointer.
                             A     8619 
00001B69 86                  A     8620 	ADD		A,(HL)					; add any running carry to (f1) cell.
                             A     8621 
00001B6A 27                  A     8622 	DAA								; Decimal Adjust Accumulator
                             A     8623 					; possibly setting carry.
                             A     8624 
00001B6B 6F                  A     8625 	LD		L,A						; result to L
00001B6C 1A                  A     8626 	LD		A,(DE)					; fetch (f2) cell value.
00001B6D 26 00               A     8627 	LD		H,000h					; set high bytes H and D to
00001B6F 54                  A     8628 	LD		D,H						; zero without disturbing carry
                             A     8629 
00001B70 CB 14               A     8630 	RL		H						; now pick up any carry in H.
                             A     8631 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  178


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001B72 A7                  A     8632 	AND		A						; test (f2) cell value.
00001B73 28 1B               A     8633 	JR		Z,L1B91					; skip forward to just store the carry
                             A     8634 					; result if the addend value is zero.
                             A     8635 
00001B75 5F                  A     8636 	LD		E,A						; else DE now holds cell value.
                             A     8637 
00001B76 CB 39               A     8638 L1B77:  SRL		C						; shift counter C   0->76543210->C
                             A     8639 
00001B78 30 08               A     8640 	JR		NC,L1B83				; skip addition if no carry.
                             A     8641 
                             A     8642 ; else perform HL=HL+DE in BCD.
                             A     8643 
00001B7A 7D                  A     8644 	LD		A,L						; fetch low byte of (f1) cell.
00001B7B 83                  A     8645 	ADD		A,E						; add to low byte of (f2) cell.
00001B7C 27                  A     8646 	DAA								; DAA.
00001B7D 6F                  A     8647 	LD		L,A						; result in L and carry.
                             A     8648 
00001B7E 7C                  A     8649 	LD		A,H						; fetch high byte possibly 1 from carry
00001B7F 8A                  A     8650 	ADC		A,D						; add in any carry from above (D=0)
00001B80 27                  A     8651 	DAA								; comes into play with multiplication.
00001B81 67                  A     8652 	LD		H,A						; result to H.
                             A     8653 
00001B82 0C                  A     8654 L1B83:  INC		C						; test the counter for zero.
00001B83 0D                  A     8655 	DEC		C						; (will be if addition)
00001B84 28 0A               A     8656 	JR		Z,L1B91					; forward when zero ->
                             A     8657 
                             A     8658 ; else is BCD multiplication - double the DE value.
                             A     8659 
00001B86 7B                  A     8660 	LD		A,E						;
00001B87 87                  A     8661 	ADD		A,A						;
00001B88 27                  A     8662 	DAA								;
00001B89 5F                  A     8663 	LD		E,A						;
                             A     8664 
00001B8A 7A                  A     8665 	LD		A,D						;
00001B8B 8F                  A     8666 	ADC		A,A						;
00001B8C 27                  A     8667 	DAA								;
00001B8D 57                  A     8668 	LD		D,A						;
                             A     8669 
00001B8E 18 E6               A     8670 	JR		L1B77					; back to continue multiplying by C.
                             A     8671 
                             A     8672 ; ---
                             A     8673 
                             A     8674 ; ->
00001B90 EB                  A     8675 L1B91:  EX		DE,HL					; transfer result to DE.
                             A     8676 
00001B91 E1                  A     8677 	POP		HL						; pop (f1) cell pointer
00001B92 73                  A     8678 	LD		(HL),E					; insert result.
00001B93 7A                  A     8679 	LD		A,D						; transfer any carry to A
00001B94 D1                  A     8680 	POP		DE						; pop the (f2) pointer
00001B95 C1                  A     8681 	POP		BC						; pop the counter, and initial C value.
                             A     8682 
00001B96 13                  A     8683 	INC		DE						; increment (f2) cell pointer.
00001B97 23                  A     8684 	INC		HL						; increment (f1) cell pointer.
                             A     8685 
00001B98 10 CC               A     8686 	DJNZ	L1B67					; loop back for all 4 bytes.
                             A     8687 
00001B9A C1                  A     8688 	POP		BC						; restore the
00001B9B D1                  A     8689 	POP		DE						; three main
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  179


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001B9C E1                  A     8690 	POP		HL						; registers.
                             A     8691 
00001B9D C9                  A     8692 	RET								; return.
                             A     8693 
                             A     8694 ; -------------
                             A     8695 ; THE 'F-' WORD
                             A     8696 ; -------------
                             A     8697 ; ( f1, f2 -- f1-f2 )
                             A     8698 ; Subtracts top two floating point numbers.
                             A     8699 ;
                             A     8700 ; just flip the sign and then do floating point addition.
                             A     8701 
                             A     8702 L1B9F:  DEFB	'F'						; 'name field'  
00001B9E 46                  A+    8702 	DB P1
                             A     8703 	DEFB	'-'+080h
00001B9F AD                  A+    8703 	DB P1
                             A     8704 
                             A     8705 	DEFW	L1989					; 'link field'
00001BA0 88 19               A+    8705 	DW P1
                             A     8706 
                             A     8707 L1BA3:  DEFB	002h						; 'name length field'
00001BA2 02                  A+    8707 	DB P1
                             A     8708 
                             A     8709 L1BA4:  DEFW	L0EC3					; 'code field' - docolon
00001BA3 C2 0E               A+    8709 	DW P1
                             A     8710 
                             A     8711 ; ---
                             A     8712 
                             A     8713 L1BA6:  DEFW	L1D0F					; fnegate
00001BA5 0E 1D               A+    8713 	DW P1
                             A     8714 	DEFW	L1A0E					; end-forth.
00001BA7 0D 1A               A+    8714 	DW P1
                             A     8715 
00001BA9 18 07               A     8716 	JR		L1BB3					; forward to floating point addition.
                             A     8717 
                             A     8718 ; -------------
                             A     8719 ; THE 'F+' WORD
                             A     8720 ; -------------
                             A     8721 ; ( f1, f2 -- f1+f2 )
                             A     8722 ; Adds top two floating point numbers.
                             A     8723 
                             A     8724 L1BAC:  DEFB	'F'						; 'name field'   
00001BAB 46                  A+    8724 	DB P1
                             A     8725 	DEFB	'+'+080h
00001BAC AB                  A+    8725 	DB P1
                             A     8726 
                             A     8727 	DEFW	L1BA3					; 'link field'
00001BAD A2 1B               A+    8727 	DW P1
                             A     8728 
                             A     8729 L1BB0:  DEFB	002h						; 'name length field'
00001BAF 02                  A+    8729 	DB P1
                             A     8730 
                             A     8731 L1BB1:  DEFW	L1BB3					; 'code field'
00001BB0 B2 1B               A+    8731 	DW P1
                             A     8732 
                             A     8733 ; ---
                             A     8734 
00001BB2 CD F3 1A            A     8735 L1BB3:  CALL	L1AF4					; PREP_FP
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  180


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8736 
00001BB5 79                  A     8737 	LD		A,C						; take exponent of second number (f2).
00001BB6 90                  A     8738 	SUB		B						; subtract exponent of first (f1).
00001BB7 F5                  A     8739 	PUSH	AF						; save result flags.
                             A     8740 
00001BB8 30 06               A     8741 	JR		NC,L1BC1				; forward if second number >= first.
                             A     8742 
00001BBA EB                  A     8743 	EX		DE,HL					; else swap the pointers.
00001BBB ED 44               A     8744 	NEG								; negate negative result.
00001BBD DD 70 00            A     8745 	LD		(IX+000h),B				; place B in FP_WS_0  (was C).
                             A     8746 
00001BC0 47                  A     8747 L1BC1:  LD		B,A						; put positive subtraction result in B.
                             A     8748 
00001BC1 C4 21 1B            A     8749 	CALL	NZ,L1B22				; routine SHIFT_ADDEND aligns digits if
                             A     8750 					; exponents are not equal.
                             A     8751 
00001BC4 F1                  A     8752 	POP		AF						; retrieve subtraction result flags.
00001BC5 30 01               A     8753 	JR		NC,L1BC9				; forward is second number was >= first.
                             A     8754 
00001BC7 EB                  A     8755 	EX		DE,HL					; else switch the pointers back.
                             A     8756 
00001BC8 06 02               A     8757 L1BC9:  LD		B,002h					; two floating point numbers to consider
                             A     8758 
00001BCA DD 4E 02            A     8759 	LD		C,(IX+002h)				; FP_WS_02
                             A     8760 
00001BCD CB 11               A     8761 L1BCE:  RL		C						; test sign bit first bit 7 then bit 6.
                             A     8762 
00001BCF DC 42 1B            A     8763 	CALL	C,L1B43					; routine BCD neg if carry
                             A     8764 
00001BD2 EB                  A     8765 	EX		DE,HL					; switch number pointers.
                             A     8766 
00001BD3 10 F8               A     8767 	DJNZ	L1BCE					; decrement counter and loop if second
                             A     8768 					; number still to do.
                             A     8769 
00001BD5 CD 52 1B            A     8770 	CALL	L1B53					; the BCD ADDITION routine.
                             A     8771 
                             A     8772 ; The routine preserves main registers so HL->(f1), DE->(f2) and B is zero.
                             A     8773 
00001BD8 1B                  A     8774 	DEC		DE						; point to highest byte of result which
                             A     8775 					; could be 099h if one negative number
                             A     8776 					; involved or 098h if two negatives.
                             A     8777 
00001BD9 1A                  A     8778 	LD		A,(DE)					; fetch the result sign byte.
00001BDA C6 68               A     8779 	ADD		A,068h					; add 068h causing carry if negative.
00001BDC CB 18               A     8780 	RR		B						; pick up carry in bit 7 of B, which 
                             A     8781 					; was zero so zero flag now set if none.
                             A     8782 
00001BDE DD 70 02            A     8783 	LD		(IX+002h),B				; place result sign in  FP_WS_02
                             A     8784 
00001BE1 C4 42 1B            A     8785 	CALL	NZ,L1B43				; routine BCD_NEGATE if negative result.
                             A     8786 
                             A     8787 ; if the 
                             A     8788 
00001BE4 1A                  A     8789 L1BE5:  LD		A,(DE)					;
00001BE5 A7                  A     8790 	AND		A						;
                             A     8791 
00001BE6 20 19               A     8792 	JR		NZ,L1C02				;
                             A     8793 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  181


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8794 ; else A is zero.
                             A     8795 
00001BE8 DD 35 00            A     8796 	DEC		(IX+000h)				; decrement the result exponent FP_WS_00
00001BEB DD 35 00            A     8797 	DEC		(IX+000h)				; as two nibbles will be moved at a time
                             A     8798 
00001BEE D5                  A     8799 	PUSH	DE						; save pointer to 4th byte
                             A     8800 
00001BEF 62                  A     8801 	LD		H,D						; make HL
00001BF0 6B                  A     8802 	LD		L,E						; equal to DE
00001BF1 2B                  A     8803 	DEC		HL						; minus one.
                             A     8804 
00001BF2 01 FF 03            A     8805 	LD		BC,003FFh				; counter for three bytes. The 0FFh 
                             A     8806 					; value ensures B is not affected by 
                             A     8807 					; the LDD instruction. Also A is 0.
                             A     8808 
00001BF5 B6                  A     8809 L1BF6:  OR		(HL)					; (detects if the three bytes are zero)
                             A     8810 
00001BF6 ED A8               A     8811 	LDD								; copy HL contents one location higher 
                             A     8812 					; to that addressed by DE. Also dec bc.
                             A     8813 
00001BF8 10 FB               A     8814 	DJNZ	L1BF6					; repeat for all 3 bytes
                             A     8815 
00001BFA EB                  A     8816 	EX		DE,HL					; make HL address lowest location
00001BFB 70                  A     8817 	LD		(HL),B					; and insert a zero into vacated byte.
                             A     8818 
00001BFC D1                  A     8819 	POP		DE						; restore the pointer to the 4th byte.
                             A     8820 
00001BFD 20 E5               A     8821 	JR		NZ,L1BE5				; jump back to the end test if something
                             A     8822 					; was being shifted through.
                             A     8823 
                             A     8824 ; else all four bytes are zero - i.e. the result of the addition is zero.
                             A     8825 
00001BFF FD E9               A     8826 	JP		(IY)					; to 'next'.
                             A     8827 
                             A     8828 ; ---
                             A     8829 
                             A     8830 ; The branch was to here, from the end test above, when the 4th byte had been 
                             A     8831 ; filled.
                             A     8832 ; Before joining common code, ensure that the initial block move will be
                             A     8833 ; ineffective.
                             A     8834 
00001C01 54                  A     8835 L1C02:  LD		D,H						; make DE the same as HL - the source
00001C02 5D                  A     8836 	LD		E,L						; and the destination are the same.
                             A     8837 
                             A     8838 ; -> common code from mult and above.
                             A     8839 
00001C03 D5                  A     8840 L1C04:  PUSH	DE						; save start location.
                             A     8841 
00001C04 01 04 00            A     8842 	LD		BC,00004h				; 4 bytes to consider.
00001C07 ED B0               A     8843 	LDIR							; block move sets DE to one past dest.
                             A     8844 
00001C09 E1                  A     8845 	POP		HL						; restore start of source.
                             A     8846 
00001C0A 1B                  A     8847 	DEC		DE						; DE now addresses 4th byte.
                             A     8848 
00001C0B 1A                  A     8849 L1C0C:  LD		A,(DE)					; load the 4th byte to accumulator.
00001C0C A7                  A     8850 	AND		A						; test for zero.
                             A     8851 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  182


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001C0D 28 11               A     8852 	JR		Z,L1C21					; skip forward if so.
                             A     8853 
00001C0F FE 10               A     8854 	CP		010h						; test if one or two nibbles populated
                             A     8855 					; setting carry for a single nibble.
                             A     8856 
00001C11 9F                  A     8857 	SBC		A,A						; 000h for two nibbles, 0FFh for one.
00001C12 3C                  A     8858 	INC		A						; 001h					000h
00001C13 3C                  A     8859 	INC		A						; 002h for two nibbles, 001h for one :-)
                             A     8860 
00001C14 47                  A     8861 	LD		B,A						; nibble count to B.
00001C15 DD 86 00            A     8862 	ADD		A,(IX+000h)				; add count to FP_WS_00 the result
00001C18 32 00 00            A     8863 	LD		(RAMSTART),A				; exponent and place back in FP_WS_00.
                             A     8864 
00001C1B CD 21 1B            A     8865 	CALL	L1B22					; routine 'shift_addend' moves all the 
                             A     8866 					; nibbles to the right.
                             A     8867 
00001C1E 18 EB               A     8868 	JR		L1C0C					; back to pick up byte and then to
                             A     8869 					; next routine.
                             A     8870 
                             A     8871 ; ---
                             A     8872 
                             A     8873 ; now test for a result that is too large or too small. 
                             A     8874 ; Note. these results may have arisen from multiplication or addition.
                             A     8875 
00001C20 3A 00 00            A     8876 L1C21:  LD		A,(RAMSTART)				; fetch result exponent from FP_WS_00
                             A     8877 
00001C23 3D                  A     8878 	DEC		A						; decrement?
00001C24 FE BF               A     8879 	CP		0BFh						; compare lower limit
00001C26 3C                  A     8880 	INC		A						; increment?
                             A     8881 
00001C27 30 13               A     8882 	JR		NC,L1C3D				; forward if less to ZERO_RSLT
                             A     8883 
00001C29 FE 80               A     8884 	CP		080h						; compare upper limit
00001C2B 30 0D               A     8885 	JR		NC,L1C3B				; forward to Error 8 - Overflow
                             A     8886 
00001C2D 47                  A     8887 	LD		B,A						; save unsigned exponent in B.
                             A     8888 
                             A     8889 ; now combine result sign and the exponent.
                             A     8890 ; for addition then FP_WS_02 contains either 080h or 000h and most of what 
                             A     8891 ; follows does not apply.
                             A     8892 ; for multiplication then bit 7 is sign of (f1) bit 6 is sign of (f2).
                             A     8893 
00001C2E 3A 02 00            A     8894 L1C2F:   LD		A,(RAMSTART+002h)				; FP_WS_02			see L1B13
                             A     8895 
00001C31 4F                  A     8896 	LD		C,A						; save a copy in C
00001C32 17                  A     8897 	RLA								; rotate bit 6 to 7
00001C33 A9                  A     8898 	XOR		C						; XOR bit 7 - minus * minus = a plus.
00001C34 E6 80               A     8899 	AND		080h						; only interested in bit 7.
00001C36 A8                  A     8900 	XOR		B						; combine with exponent.
00001C37 12                  A     8901 	LD		(DE),A					; and place in sign/exp on Data Stack.
                             A     8902 
00001C38 FD E9               A     8903 	JP		(IY)					; to 'next'.
                             A     8904 
                             A     8905 ; ---
                             A     8906 
00001C3A E7                  A     8907 L1C3B:  RST		20H						; Error 8.
                             A     8908 	DEFB	008h						; Overflow in floating-point arithmetic.
00001C3B 08                  A+    8908 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  183


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     8909 
                             A     8910 ; ------------------------------------
                             A     8911 ; THE 'ZERO RESULT' TERMINATING BRANCH
                             A     8912 ; ------------------------------------
                             A     8913 
00001C3C 01 00 04            A     8914 L1C3D:  LD		BC,00400h				; count 4 bytes, fill byte is zero.
                             A     8915 
00001C3F 71                  A     8916 L1C40:  LD		(HL),C					; insert a zero.
00001C40 23                  A     8917 	INC		HL						; next location.
00001C41 10 FC               A     8918 	DJNZ	L1C40					; repeat for all 4 bytes.
                             A     8919 
00001C43 FD E9               A     8920 	JP		(IY)					; to 'next'.
                             A     8921 
                             A     8922 
                             A     8923 
                             A     8924 
                             A     8925 ; -------------
                             A     8926 ; THE 'F*' WORD
                             A     8927 ; -------------
                             A     8928 ; (f1, f2 -- f1*f2)
                             A     8929 ; Multiplies top two floating point numbers and leaves result on the stack.
                             A     8930 
                             A     8931 L1C46:  DEFB	'F'						; 'name field' 
00001C45 46                  A+    8931 	DB P1
                             A     8932 	DEFB	'*'+080h
00001C46 AA                  A+    8932 	DB P1
                             A     8933 
                             A     8934 	DEFW	L1BB0					; 'link field'
00001C47 AF 1B               A+    8934 	DW P1
                             A     8935 
                             A     8936 L1C4A:  DEFB	002h						; 'name length field'
00001C49 02                  A+    8936 	DB P1
                             A     8937 
                             A     8938 L1C4B:  DEFW	L1C4D					; 'code field'
00001C4A 4C 1C               A+    8938 	DW P1
                             A     8939 
                             A     8940 ; ---
                             A     8941 
00001C4C CD F3 1A            A     8942 L1C4D:  CALL	L1AF4					; routine PREP_FP prepares the two
                             A     8943 					; numbers on the Data Stack placing the
                             A     8944 					; exponents and signs in FP_WS.
                             A     8945 
00001C4F AF                  A     8946 	XOR		A						; set accumulator to zero.
00001C50 B8                  A     8947 	CP		B						; compare to exponent of (f1).
00001C51 9F                  A     8948 	SBC		A,A						; 000h if zero or 0FFh
00001C52 A1                  A     8949 	AND		C						; combine with exponent of (f2).
                             A     8950 
00001C53 28 E7               A     8951 	JR		Z,L1C3D					; back if zero to exit via ZERO_RSLT.
                             A     8952 
00001C55 E5                  A     8953 	PUSH	HL						; save pointer to first number - result.
                             A     8954 
00001C56 01 02 00            A     8955 	LD		BC,RAMSTART+002h				; set BC to location before free 
                             A     8956 					; workspace set to zero by PREP_FP.
                             A     8957 
00001C59 C5                  A     8958 	PUSH	BC						; push onto machine stack.
                             A     8959 
00001C5A 06 03               A     8960 	LD		B,003h					; count three bytes - six nibbles.
                             A     8961 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  184


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001C5C 4E                  A     8962 L1C5D:  LD		C,(HL)					; fetch BCD pair to C
00001C5D 23                  A     8963 	INC		HL						; address more significant pair.
                             A     8964 
00001C5E E3                  A     8965 	EX		(SP),HL					; Data Stack pointer to machine stack,
                             A     8966 					; workspace pointer to HL.
00001C5F 23                  A     8967 	INC		HL						; increment workspace pointer.
                             A     8968 
00001C60 CD 54 1B            A     8969 	CALL	L1B55					; routine BCD_OP multiplies C by each
                             A     8970 					; of the 4 bytes of (f2) laying the 
                             A     8971 					; result down in workspace at HL
                             A     8972 
00001C63 E3                  A     8973 	EX		(SP),HL					; swap in multiplier pointer to HL,
                             A     8974 					; workspace pointer to machine stack.
                             A     8975 
00001C64 10 F6               A     8976 	DJNZ	L1C5D					; repeat for all three bytes.
                             A     8977 
00001C66 ED 4B 00 00         A     8978 	LD		BC,(RAMSTART)				; fetch raw exponents from FP_WS_00/01
00001C6A 78                  A     8979 	LD		A,B						; add the exponents
00001C6B 81                  A     8980 	ADD		A,C						; together.
                             A     8981 
00001C6C D6 42               A     8982 	SUB		042h						; adjust for sign
                             A     8983 
00001C6E 32 00 00            A     8984 	LD		(RAMSTART),A				; put the result back in FP_WS_00.
                             A     8985 
00001C71 E1                  A     8986 	POP		HL						; pop workspace pointer to HL.
00001C72 D1                  A     8987 	POP		DE						; pop result pointer to DE.
                             A     8988 
00001C73 18 8E               A     8989 	JR		L1C04					; back to common code to copy the 4
                             A     8990 					; bytes from the workspace to the 
                             A     8991 					; Data Stack and then set exponent
                             A     8992 					; and sign.
                             A     8993 
                             A     8994 ; -------------
                             A     8995 ; THE 'F/' WORD
                             A     8996 ; -------------
                             A     8997 ; ( f1, f2 -- f1/f2 )
                             A     8998 ; Divides two floating point numbers.
                             A     8999 
                             A     9000 L1C76:  DEFB	'F'						; 'name field'
00001C75 46                  A+    9000 	DB P1
                             A     9001 	DEFB	'/'+080h
00001C76 AF                  A+    9001 	DB P1
                             A     9002 
                             A     9003 	DEFW	L1C4A					; 'link field'
00001C77 49 1C               A+    9003 	DW P1
                             A     9004 
                             A     9005 L1C7A:  DEFB	002h						; 'name length field'
00001C79 02                  A+    9005 	DB P1
                             A     9006 
                             A     9007 L1C7B:  DEFW	L1C7D					; 'code field'
00001C7A 7C 1C               A+    9007 	DW P1
                             A     9008 
                             A     9009 ;---
                             A     9010 
00001C7C CD F3 1A            A     9011 L1C7D:  CALL	L1AF4					; routine PREP_FP prepares the two
                             A     9012 					; numbers (f1) and (f2) placing the 
                             A     9013 					; raw exponents in the first two 
                             A     9014 					; locations of workspace, the signs in
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  185


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9015 					; the next location and clearing the
                             A     9016 					; sixteen remaining locations.
                             A     9017 					; This must be the one that uses them 
                             A     9018 					; all.
                             A     9019 
00001C7F AF                  A     9020 	XOR		A						; set accumulator to zero.
00001C80 B8                  A     9021 	CP		B						; compare to exponent of dividend (f1).
00001C81 28 B9               A     9022 	JR		Z,L1C3D					; forward if zero to ZERO_RSLT.
                             A     9023 
00001C83 B9                  A     9024 	CP		C						; compare to exponent of divisor (f2).
00001C84 28 B4               A     9025 	JR		Z,L1C3B					; back if zero to Error 8 - Overflow.
                             A     9026 					; division by zero.
                             A     9027 
                             A     9028 ; HL points to first number on stack, DE to second.
                             A     9029 
00001C86 13                  A     9030 	INC		DE						;
00001C87 13                  A     9031 	INC		DE						;
00001C88 1A                  A     9032 	LD		A,(DE)					; get first two digits to A
00001C89 1B                  A     9033 	DEC		DE						;
00001C8A 1B                  A     9034 	DEC		DE						; back to first
                             A     9035 
00001C8B C6 01               A     9036 	ADD		A,001h					; add one (e.g. 99 would give 9A)
00001C8D 27                  A     9037 	DAA								; adjust  (e.g. 09Ah would be 000h carry)
00001C8E 08                  A     9038 	EX		AF,AF'					; save the flags
00001C8F EB                  A     9039 	EX		DE,HL					; HL now points to divisor 
                             A     9040 
00001C90 CD 42 1B            A     9041 	CALL	L1B43					; routine BCD negate the divisor
                             A     9042 
00001C93 EB                  A     9043 	EX		DE,HL					; point back again.
00001C94 E5                  A     9044 	PUSH	HL						; save pointer to first - the result.
                             A     9045 
00001C95 11 10 00            A     9046 	LD		DE,RAMSTART+010h				; destination FP_WS_10
00001C98 01 04 00            A     9047 	LD		BC,00004h				; four bytes
                             A     9048 
00001C9B ED B0               A     9049 	LDIR							; copy to end of FP_WS 
                             A     9050 					; (+ one byte of list_ws)
                             A     9051 
00001C9D EB                  A     9052 	EX		DE,HL					; HL points to last cell plus one.
00001C9E 2B                  A     9053 	DEC		HL						; Now points to last byte copied.
                             A     9054 
00001C9F 06 05               A     9055 	LD		B,005h					; count 5.
                             A     9056 
                             A     9057 ; loop
                             A     9058 
00001CA1 D5                  A     9059 L1CA2:  PUSH	DE						;
00001CA2 7E                  A     9060 	LD		A,(HL)					;
00001CA3 2B                  A     9061 	DEC		HL						;
00001CA4 5E                  A     9062 	LD		E,(HL)					;
                             A     9063 
00001CA5 08                  A     9064 	EX		AF,AF'					;
00001CA6 4F                  A     9065 	LD		C,A						;
00001CA7 08                  A     9066 	EX		AF,AF'					;
                             A     9067 
00001CA8 0C                  A     9068 	INC		C						;
00001CA9 0D                  A     9069 	DEC		C						;
00001CAA 20 03               A     9070 	JR		NZ,L1CB0				;
                             A     9071 
00001CAC 5F                  A     9072 	LD		E,A						;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  186


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001CAD 18 1B               A     9073 	JR		L1CCB					;
                             A     9074 
                             A     9075 ; ---
                             A     9076 
00001CAF C5                  A     9077 L1CB0:  PUSH	BC						;
00001CB0 06 02               A     9078 	LD		B,002h					;
                             A     9079 
00001CB2 16 10               A     9080 L1CB3:  LD		D,010h					;
                             A     9081 
00001CB4 CB 23               A     9082 L1CB5:  SLA		E						;
00001CB6 17                  A     9083 	RLA								;
00001CB7 CB 12               A     9084 	RL		D						;
00001CB9 30 F9               A     9085 	JR		NC,L1CB5				;
                             A     9086 
00001CBB 14                  A     9087 	INC		D						;
                             A     9088 
00001CBC 91                  A     9089 L1CBD:  SUB		C						;
00001CBD 27                  A     9090 	DAA								;
00001CBE 1C                  A     9091 	INC		E						;
00001CBF 30 FB               A     9092 	JR		NC,L1CBD				;
                             A     9093 
00001CC1 15                  A     9094 	DEC		D						;
00001CC2 20 F8               A     9095 	JR		NZ,L1CBD				;
                             A     9096 
00001CC4 81                  A     9097 	ADD		A,C						;
00001CC5 27                  A     9098 	DAA								;
00001CC6 1D                  A     9099 	DEC		E						;
00001CC7 10 E9               A     9100 	DJNZ	L1CB3					;
                             A     9101 
00001CC9 C1                  A     9102 	POP		BC						;
                             A     9103 
00001CCA 4B                  A     9104 L1CCB:  LD		C,E						;
00001CCB D1                  A     9105 	POP		DE						;
00001CCC 0C                  A     9106 	INC		C						;
00001CCD 0D                  A     9107 	DEC		C						;
00001CCE 28 17               A     9108 	JR		Z,L1CE8					;
                             A     9109 
00001CD0 E5                  A     9110 	PUSH	HL						;
00001CD1 2B                  A     9111 	DEC		HL						;
00001CD2 2B                  A     9112 	DEC		HL						;
                             A     9113 
00001CD3 CD 54 1B            A     9114 	CALL	L1B55					; bcd_op mult
                             A     9115 
00001CD6 D5                  A     9116 	PUSH	DE						;
                             A     9117 
00001CD7 11 FB FF            A     9118 	LD		DE,0FFFBh				; -4
00001CDA 19                  A     9119 	ADD		HL,DE					;
                             A     9120 
00001CDB 11 03 00            A     9121 	LD		DE,RAMSTART+003h				; FP_WS_03
00001CDE 79                  A     9122 	LD		A,C						;
00001CDF 12                  A     9123 	LD		(DE),A					;
                             A     9124 
00001CE0 CD 52 1B            A     9125 	CALL	L1B53					; bcd_op add
                             A     9126 
00001CE3 D1                  A     9127 	POP		DE						;
00001CE4 E1                  A     9128 	POP		HL						;
00001CE5 23                  A     9129 	INC		HL						;
00001CE6 04                  A     9130 	INC		B						;
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  187


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9131 
00001CE7 10 B8               A     9132 L1CE8:  DJNZ	L1CA2					;
                             A     9133 
00001CE9 2A 00 00            A     9134 	LD		HL,(RAMSTART)				; FP_WS
00001CEC 7C                  A     9135 	LD		A,H						;
00001CED 95                  A     9136 	SUB		L						;
00001CEE C6 40               A     9137 	ADD		A,040h					;
                             A     9138 
00001CF0 21 08 00            A     9139 	LD		HL,RAMSTART+008h				; FP_WS
00001CF3 47                  A     9140 	LD		B,A						;
00001CF4 3A 0B 00            A     9141 	LD		A,(RAMSTART+00Bh)				;
00001CF7 A7                  A     9142 	AND		A						;
00001CF8 20 03               A     9143 	JR		NZ,L1CFE				;
                             A     9144 
00001CFA 05                  A     9145 	DEC		B						;
00001CFB 05                  A     9146 	DEC		B						;
00001CFC 2B                  A     9147 	DEC		HL						;
                             A     9148 
00001CFD DD 70 00            A     9149 L1CFE:  LD		(IX+000h),B				;
                             A     9150 
00001D00 D1                  A     9151 	POP		DE						;
                             A     9152 
00001D01 C3 03 1C            A     9153 	JP		L1C04					; back to common code to copy the 4
                             A     9154 					; bytes from the workspace to the 
                             A     9155 					; Data Stack and then set exponent
                             A     9156 					; and sign.
                             A     9157 
                             A     9158 ; ------------------
                             A     9159 ; THE 'FNEGATE' WORD
                             A     9160 ; ------------------
                             A     9161 ; ( f -- -f )
                             A     9162 ; Floating point negation.
                             A     9163 ; Toggle the sign bit unless the number is zero (four zero bytes).
                             A     9164 
                             A     9165 L1D05:  DEFM	"FNEGAT"				; 'name field'
00001D04 46 4E 45 47 41 54   A+    9165 	DB P1
                             A     9166 	DEFB	'E'+080h
00001D0A C5                  A+    9166 	DB P1
                             A     9167 
                             A     9168 	DEFW	L1C7A					; 'link field'
00001D0B 79 1C               A+    9168 	DW P1
                             A     9169 
                             A     9170 L1D0E:  DEFB	007h						; 'name length field'
00001D0D 07                  A+    9170 	DB P1
                             A     9171 
                             A     9172 L1D0F:  DEFW	L1D11					; 'code field'
00001D0E 10 1D               A+    9172 	DW P1
                             A     9173 
                             A     9174 ; ---
                             A     9175 
00001D10 DF                  A     9176 L1D11:  RST		18H						; pop word from data stack to DE.
                             A     9177 
00001D11 7A                  A     9178 	LD		A,D						; exponent byte to A.
00001D12 A7                  A     9179 	AND		A						; test for zero.
00001D13 28 02               A     9180 	JR		Z,L1D18					; forward if so to leave undisturbed.
                             A     9181 
00001D15 EE 80               A     9182 	XOR		080h						; else toggle the sign bit
                             A     9183 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  188


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001D17 57                  A     9184 L1D18:  LD		D,A						; exponent byte to D.
00001D18 D7                  A     9185 	RST		10H						; push word DE on data stack.
                             A     9186 
00001D19 FD E9               A     9187 	JP		(IY)					; to 'next'.
                             A     9188 
                             A     9189 ; --------------
                             A     9190 ; THE 'INT' WORD
                             A     9191 ; --------------
                             A     9192 ; (f -- n)
                             A     9193 ; Converts signed floating point number to signed single length integer.
                             A     9194 ; Truncates towards zero.
                             A     9195 ; Result in range -32768 to 32767
                             A     9196 
                             A     9197 L1D1C:  DEFM	"IN"					; 'name field'
00001D1B 49 4E               A+    9197 	DB P1
                             A     9198 	DEFB	'T'+080h
00001D1D D4                  A+    9198 	DB P1
                             A     9199 
                             A     9200 	DEFW	L1D0E					; 'link field'
00001D1E 0D 1D               A+    9200 	DW P1
                             A     9201 
                             A     9202 L1D21:  DEFB	003h						; 'name length field'
00001D20 03                  A+    9202 	DB P1
                             A     9203 
                             A     9204 L1D22:  DEFW	L1D24					; 'code field'
00001D21 23 1D               A+    9204 	DW P1
                             A     9205 
                             A     9206 ; ---
                             A     9207 
                             A     9208 ;L1D24:  LD		HL,(SPARE)				; fetch value from SPARE.
00001D23 2A 3B 00            A     9209 L1D24:  LD		HL,(SPARE)				; fetch value from SPARE.
00001D26 2B                  A     9210 	DEC		HL						; now points to end of data stack.
                             A     9211 
00001D27 11 00 00            A     9212 	LD		DE,00000h				; initialize 16-bit result.
                             A     9213 
00001D2A 7E                  A     9214 L1D2B:  LD		A,(HL)					; fetch the exponent byte.
                             A     9215 
00001D2B 07                  A     9216 	RLCA							; double exponent moving sign bit to 0.
                             A     9217 
00001D2C FE 82               A     9218 	CP		082h						; compare exponent to plus 1.
00001D2E 38 14               A     9219 	JR		C,L1D45					; forward if number is smaller than 1
                             A     9220 					; to return the result DE.
                             A     9221 
                             A     9222 ; else the number is >= 1.0
                             A     9223 
00001D30 AF                  A     9224 	XOR		A						; clear accumulator.
00001D31 2B                  A     9225 	DEC		HL						; point to the first pair of BCD digits.
                             A     9226 
00001D32 CD 32 07            A     9227 	CALL	L0732					; call shift_fp
                             A     9228 
00001D35 23                  A     9229 	INC		HL						; point to exponent.
                             A     9230 
00001D36 EB                  A     9231 	EX		DE,HL					; pointer to DE, integer to HL.
                             A     9232 
                             A     9233 ; before adding in the nibble from the mantissa, multiply any previous result
                             A     9234 ; by ten.
                             A     9235 
00001D37 44                  A     9236 	LD		B,H						; make a copy of HL in BC.
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  189


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001D38 4D                  A     9237 	LD		C,L						;
                             A     9238 
00001D39 29                  A     9239 	ADD		HL,HL					; * 2
00001D3A 29                  A     9240 	ADD		HL,HL					; * 4
00001D3B 09                  A     9241 	ADD		HL,BC					; * 5
00001D3C 29                  A     9242 	ADD		HL,HL					; * 10
                             A     9243 
00001D3D 4F                  A     9244 	LD		C,A						; leftmost nibble from mantissa to C.
00001D3E 06 00               A     9245 	LD		B,000h					; prepare to add just the nibble.
00001D40 09                  A     9246 	ADD		HL,BC					; add into the result.
00001D41 EB                  A     9247 	EX		DE,HL					; switch back to DE
                             A     9248 
00001D42 18 E6               A     9249 	JR		L1D2B					; back to loop.
                             A     9250 
                             A     9251 ; ---
                             A     9252 
00001D44 2B                  A     9253 L1D45:  DEC		HL						; skip redundant components of Floating
00001D45 2B                  A     9254 	DEC		HL						; Point number addressing the
                             A     9255 					; lower two bytes on the data stack.
00001D46 72                  A     9256 	LD		(HL),D					; insert high-order byte first.
00001D47 2B                  A     9257 	DEC		HL						; point to location beneath.
00001D48 73                  A     9258 	LD		(HL),E					; insert low-order byte.
                             A     9259 
00001D49 11 93 0D            A     9260 	LD		DE,L0D94				; 'pos' addr.
                             A     9261 
00001D4C C3 BF 04            A     9262 	JP		L04BF					; exit via 'pos' routine.
                             A     9263 
                             A     9264 ; -----------------
                             A     9265 ; THE 'UFLOAT' WORD
                             A     9266 ; -----------------
                             A     9267 ; (un -- f)
                             A     9268 ; Converts unsigned single length integer to floating point.
                             A     9269 ; e.g. 65535 16 bit number converted to  32-bit float 8-bit sign/exponent
                             A     9270 ; 6-nibble BCD mantissa.	045h  6 5 5 3 5 0
                             A     9271 
                             A     9272 L1D50:  DEFM	"UFLOA"					; 'name field'
00001D4F 55 46 4C 4F 41      A+    9272 	DB P1
                             A     9273 	DEFB	'T'+080h
00001D54 D4                  A+    9273 	DB P1
                             A     9274 
                             A     9275 	DEFW	L1D21					; 'link field'
00001D55 20 1D               A+    9275 	DW P1
                             A     9276 
                             A     9277 L1D58:  DEFB	006h						; 'name length field'
00001D57 06                  A+    9277 	DB P1
                             A     9278 
                             A     9279 L1D59:  DEFW	L1D5B					; 'code field'
00001D58 5A 1D               A+    9279 	DW P1
                             A     9280 
                             A     9281 ; ---
                             A     9282 
00001D5A DF                  A     9283 L1D5B:  RST		18H						; pop word off stack to DE
00001D5B EB                  A     9284 	EX		DE,HL					; now HL
                             A     9285 
00001D5C 01 00 10            A     9286 	LD		BC,01000h				; count 16 bits, set C to zero.
00001D5F 51                  A     9287 	LD		D,C
00001D60 59                  A     9288 	LD		E,C						; initialize DE to zero.
                             A     9289 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  190


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001D61 29                  A     9290 L1D62:  ADD		HL,HL					; double
                             A     9291 
00001D62 7B                  A     9292 	LD		A,E						;
00001D63 8F                  A     9293 	ADC		A,A						; add carry to low byte
00001D64 27                  A     9294 	DAA								; adjust
00001D65 5F                  A     9295 	LD		E,A						;
                             A     9296 
00001D66 7A                  A     9297 	LD		A,D						;
00001D67 8F                  A     9298 	ADC		A,A						; add carry to high byte
00001D68 27                  A     9299 	DAA								; adjust
00001D69 57                  A     9300 	LD		D,A						;
                             A     9301 
00001D6A CB 11               A     9302 	RL		C						; pick up overflow
00001D6C 10 F3               A     9303 	DJNZ	L1D62					; loop  back for 16 bits
                             A     9304 
00001D6E D7                  A     9305 	RST		10H						; DE to Data stack.
                             A     9306 
00001D6F 16 46               A     9307 	LD		D,046h					; exponent byte   +6
00001D71 59                  A     9308 	LD		E,C						; low byte
                             A     9309 
00001D72 D7                  A     9310 	RST		10H						; higher word of float to stack.
                             A     9311 
00001D73 2B                  A     9312 	DEC		HL						; point to
00001D74 2B                  A     9313 	DEC		HL						; lower on stack
                             A     9314 
00001D75 CD 40 07            A     9315 	CALL	L0740					; normalize routine.
                             A     9316 
00001D78 FD E9               A     9317 	JP		(IY)					; to 'next'.
                             A     9318 
                             A     9319 ; -------------------
                             A     9320 ; THE 'CHARACTER SET'
                             A     9321 ; -------------------
                             A     9322 ; The 96 ASCII character bitmaps are copied to RAM during initialization and
                             A     9323 ; the 8x8 characters can afterwards be redefined by the user.
                             A     9324 ; Some ROM space is saved by supplying the blank top line of most characters
                             A     9325 ; and in case of the middle range (capitals with no descenders) the bottom
                             A     9326 ; line as well. Only the final copyright symbol is held in ROM as an 8x8
                             A     9327 ; character.
                             A     9328 
                             A     9329 
                             A     9330 ; 020h - Character: ' '			CHR0h(32)
                             A     9331 
                             A     9332 L1D7B:  DEFB	00000000B
00001D7A 00                  A+    9332 	DB P1
                             A     9333 	DEFB	00000000B
00001D7B 00                  A+    9333 	DB P1
                             A     9334 	DEFB	00000000B
00001D7C 00                  A+    9334 	DB P1
                             A     9335 	DEFB	00000000B
00001D7D 00                  A+    9335 	DB P1
                             A     9336 	DEFB	00000000B
00001D7E 00                  A+    9336 	DB P1
                             A     9337 	DEFB	00000000B
00001D7F 00                  A+    9337 	DB P1
                             A     9338 	DEFB	00000000B
00001D80 00                  A+    9338 	DB P1
                             A     9339 
                             A     9340 ; 021h - Character: '!'			CHR0h(33)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  191


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9341 
                             A     9342 	DEFB	00010000B
00001D81 10                  A+    9342 	DB P1
                             A     9343 	DEFB	00010000B
00001D82 10                  A+    9343 	DB P1
                             A     9344 	DEFB	00010000B
00001D83 10                  A+    9344 	DB P1
                             A     9345 	DEFB	00010000B
00001D84 10                  A+    9345 	DB P1
                             A     9346 	DEFB	00000000B
00001D85 00                  A+    9346 	DB P1
                             A     9347 	DEFB	00010000B
00001D86 10                  A+    9347 	DB P1
                             A     9348 	DEFB	00000000B
00001D87 00                  A+    9348 	DB P1
                             A     9349 
                             A     9350 ; 022h - Character: '"'			CHR0h(34)
                             A     9351 
                             A     9352 	DEFB	00100100B
00001D88 24                  A+    9352 	DB P1
                             A     9353 	DEFB	00100100B
00001D89 24                  A+    9353 	DB P1
                             A     9354 	DEFB	00000000B
00001D8A 00                  A+    9354 	DB P1
                             A     9355 	DEFB	00000000B
00001D8B 00                  A+    9355 	DB P1
                             A     9356 	DEFB	00000000B
00001D8C 00                  A+    9356 	DB P1
                             A     9357 	DEFB	00000000B
00001D8D 00                  A+    9357 	DB P1
                             A     9358 	DEFB	00000000B
00001D8E 00                  A+    9358 	DB P1
                             A     9359 
                             A     9360 ; 023h - Character: '#'			CHR0h(35)
                             A     9361 
                             A     9362 	DEFB	00100100B
00001D8F 24                  A+    9362 	DB P1
                             A     9363 	DEFB	01111110B
00001D90 7E                  A+    9363 	DB P1
                             A     9364 	DEFB	00100100B
00001D91 24                  A+    9364 	DB P1
                             A     9365 	DEFB	00100100B
00001D92 24                  A+    9365 	DB P1
                             A     9366 	DEFB	01111110B
00001D93 7E                  A+    9366 	DB P1
                             A     9367 	DEFB	00100100B
00001D94 24                  A+    9367 	DB P1
                             A     9368 	DEFB	00000000B
00001D95 00                  A+    9368 	DB P1
                             A     9369 
                             A     9370 ; 024h - Character: '0h'			CHR0h(36)
                             A     9371 
                             A     9372 	DEFB	00001000B
00001D96 08                  A+    9372 	DB P1
                             A     9373 	DEFB	00111110B
00001D97 3E                  A+    9373 	DB P1
                             A     9374 	DEFB	00101000B
00001D98 28                  A+    9374 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  192


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9375 	DEFB	00111110B
00001D99 3E                  A+    9375 	DB P1
                             A     9376 	DEFB	00001010B
00001D9A 0A                  A+    9376 	DB P1
                             A     9377 	DEFB	00111110B
00001D9B 3E                  A+    9377 	DB P1
                             A     9378 	DEFB	00001000B
00001D9C 08                  A+    9378 	DB P1
                             A     9379 
                             A     9380 ; 025h - Character: '%'			CHR0h(37)
                             A     9381 
                             A     9382 	DEFB	01100010B
00001D9D 62                  A+    9382 	DB P1
                             A     9383 	DEFB	01100100B
00001D9E 64                  A+    9383 	DB P1
                             A     9384 	DEFB	00001000B
00001D9F 08                  A+    9384 	DB P1
                             A     9385 	DEFB	00010000B
00001DA0 10                  A+    9385 	DB P1
                             A     9386 	DEFB	00100110B
00001DA1 26                  A+    9386 	DB P1
                             A     9387 	DEFB	01000110B
00001DA2 46                  A+    9387 	DB P1
                             A     9388 	DEFB	00000000B
00001DA3 00                  A+    9388 	DB P1
                             A     9389 
                             A     9390 ; 026h - Character: '&'			CHR0h(38)
                             A     9391 
                             A     9392 	DEFB	00010000B
00001DA4 10                  A+    9392 	DB P1
                             A     9393 	DEFB	00101000B
00001DA5 28                  A+    9393 	DB P1
                             A     9394 	DEFB	00010000B
00001DA6 10                  A+    9394 	DB P1
                             A     9395 	DEFB	00101010B
00001DA7 2A                  A+    9395 	DB P1
                             A     9396 	DEFB	01000100B
00001DA8 44                  A+    9396 	DB P1
                             A     9397 	DEFB	00111010B
00001DA9 3A                  A+    9397 	DB P1
                             A     9398 	DEFB	00000000B
00001DAA 00                  A+    9398 	DB P1
                             A     9399 
                             A     9400 ; 027h - Character: '''			CHR0h(39)
                             A     9401 
                             A     9402 	DEFB	00001000B
00001DAB 08                  A+    9402 	DB P1
                             A     9403 	DEFB	00010000B
00001DAC 10                  A+    9403 	DB P1
                             A     9404 	DEFB	00000000B
00001DAD 00                  A+    9404 	DB P1
                             A     9405 	DEFB	00000000B
00001DAE 00                  A+    9405 	DB P1
                             A     9406 	DEFB	00000000B
00001DAF 00                  A+    9406 	DB P1
                             A     9407 	DEFB	00000000B
00001DB0 00                  A+    9407 	DB P1
                             A     9408 	DEFB	00000000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  193


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001DB1 00                  A+    9408 	DB P1
                             A     9409 
                             A     9410 ; 028h - Character: '('			CHR0h(40)
                             A     9411 
                             A     9412 	DEFB	00000100B
00001DB2 04                  A+    9412 	DB P1
                             A     9413 	DEFB	00001000B
00001DB3 08                  A+    9413 	DB P1
                             A     9414 	DEFB	00001000B
00001DB4 08                  A+    9414 	DB P1
                             A     9415 	DEFB	00001000B
00001DB5 08                  A+    9415 	DB P1
                             A     9416 	DEFB	00001000B
00001DB6 08                  A+    9416 	DB P1
                             A     9417 	DEFB	00000100B
00001DB7 04                  A+    9417 	DB P1
                             A     9418 	DEFB	00000000B
00001DB8 00                  A+    9418 	DB P1
                             A     9419 
                             A     9420 ; 029h - Character: ')'			CHR0h(42)
                             A     9421 
                             A     9422 	DEFB	00100000B
00001DB9 20                  A+    9422 	DB P1
                             A     9423 	DEFB	00010000B
00001DBA 10                  A+    9423 	DB P1
                             A     9424 	DEFB	00010000B
00001DBB 10                  A+    9424 	DB P1
                             A     9425 	DEFB	00010000B
00001DBC 10                  A+    9425 	DB P1
                             A     9426 	DEFB	00010000B
00001DBD 10                  A+    9426 	DB P1
                             A     9427 	DEFB	00100000B
00001DBE 20                  A+    9427 	DB P1
                             A     9428 	DEFB	00000000B
00001DBF 00                  A+    9428 	DB P1
                             A     9429 
                             A     9430 ; 02Ah - Character: '*'			CHR0h(42)
                             A     9431 
                             A     9432 	DEFB	00000000B
00001DC0 00                  A+    9432 	DB P1
                             A     9433 	DEFB	00010100B
00001DC1 14                  A+    9433 	DB P1
                             A     9434 	DEFB	00001000B
00001DC2 08                  A+    9434 	DB P1
                             A     9435 	DEFB	00111110B
00001DC3 3E                  A+    9435 	DB P1
                             A     9436 	DEFB	00001000B
00001DC4 08                  A+    9436 	DB P1
                             A     9437 	DEFB	00010100B
00001DC5 14                  A+    9437 	DB P1
                             A     9438 	DEFB	00000000B
00001DC6 00                  A+    9438 	DB P1
                             A     9439 
                             A     9440 ; 02Bh - Character: '+'			CHR0h(43)
                             A     9441 
                             A     9442 	DEFB	00000000B
00001DC7 00                  A+    9442 	DB P1
                             A     9443 	DEFB	00001000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  194


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001DC8 08                  A+    9443 	DB P1
                             A     9444 	DEFB	00001000B
00001DC9 08                  A+    9444 	DB P1
                             A     9445 	DEFB	00111110B
00001DCA 3E                  A+    9445 	DB P1
                             A     9446 	DEFB	00001000B
00001DCB 08                  A+    9446 	DB P1
                             A     9447 	DEFB	00001000B
00001DCC 08                  A+    9447 	DB P1
                             A     9448 	DEFB	00000000B
00001DCD 00                  A+    9448 	DB P1
                             A     9449 
                             A     9450 ; 02Ch - Character: ','			CHR0h(44)
                             A     9451 
                             A     9452 	DEFB	00000000B
00001DCE 00                  A+    9452 	DB P1
                             A     9453 	DEFB	00000000B
00001DCF 00                  A+    9453 	DB P1
                             A     9454 	DEFB	00000000B
00001DD0 00                  A+    9454 	DB P1
                             A     9455 	DEFB	00000000B
00001DD1 00                  A+    9455 	DB P1
                             A     9456 	DEFB	00001000B
00001DD2 08                  A+    9456 	DB P1
                             A     9457 	DEFB	00001000B
00001DD3 08                  A+    9457 	DB P1
                             A     9458 	DEFB	00010000B
00001DD4 10                  A+    9458 	DB P1
                             A     9459 
                             A     9460 ; 02Dh - Character: '-'			CHR0h(45)
                             A     9461 
                             A     9462 	DEFB	00000000B
00001DD5 00                  A+    9462 	DB P1
                             A     9463 	DEFB	00000000B
00001DD6 00                  A+    9463 	DB P1
                             A     9464 	DEFB	00000000B
00001DD7 00                  A+    9464 	DB P1
                             A     9465 	DEFB	00111110B
00001DD8 3E                  A+    9465 	DB P1
                             A     9466 	DEFB	00000000B
00001DD9 00                  A+    9466 	DB P1
                             A     9467 	DEFB	00000000B
00001DDA 00                  A+    9467 	DB P1
                             A     9468 	DEFB	00000000B
00001DDB 00                  A+    9468 	DB P1
                             A     9469 
                             A     9470 ; 02Eh - Character: '.'			CHR0h(46)
                             A     9471 
                             A     9472 	DEFB	00000000B
00001DDC 00                  A+    9472 	DB P1
                             A     9473 	DEFB	00000000B
00001DDD 00                  A+    9473 	DB P1
                             A     9474 	DEFB	00000000B
00001DDE 00                  A+    9474 	DB P1
                             A     9475 	DEFB	00000000B
00001DDF 00                  A+    9475 	DB P1
                             A     9476 	DEFB	00011000B
00001DE0 18                  A+    9476 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  195


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9477 	DEFB	00011000B
00001DE1 18                  A+    9477 	DB P1
                             A     9478 	DEFB	00000000B
00001DE2 00                  A+    9478 	DB P1
                             A     9479 
                             A     9480 ; 02Fh - Character: '/'			CHR0h(47)
                             A     9481 
                             A     9482 	DEFB	00000000B
00001DE3 00                  A+    9482 	DB P1
                             A     9483 	DEFB	00000010B
00001DE4 02                  A+    9483 	DB P1
                             A     9484 	DEFB	00000100B
00001DE5 04                  A+    9484 	DB P1
                             A     9485 	DEFB	00001000B
00001DE6 08                  A+    9485 	DB P1
                             A     9486 	DEFB	00010000B
00001DE7 10                  A+    9486 	DB P1
                             A     9487 	DEFB	00100000B
00001DE8 20                  A+    9487 	DB P1
                             A     9488 	DEFB	00000000B
00001DE9 00                  A+    9488 	DB P1
                             A     9489 
                             A     9490 ; 030h - Character: '0'			CHR0h(48)
                             A     9491 
                             A     9492 	DEFB	00111100B
00001DEA 3C                  A+    9492 	DB P1
                             A     9493 	DEFB	01000110B
00001DEB 46                  A+    9493 	DB P1
                             A     9494 	DEFB	01001010B
00001DEC 4A                  A+    9494 	DB P1
                             A     9495 	DEFB	01010010B
00001DED 52                  A+    9495 	DB P1
                             A     9496 	DEFB	01100010B
00001DEE 62                  A+    9496 	DB P1
                             A     9497 	DEFB	00111100B
00001DEF 3C                  A+    9497 	DB P1
                             A     9498 	DEFB	00000000B
00001DF0 00                  A+    9498 	DB P1
                             A     9499 
                             A     9500 ; 031h - Character: '1'			CHR0h(49)
                             A     9501 
                             A     9502 	DEFB	00011000B
00001DF1 18                  A+    9502 	DB P1
                             A     9503 	DEFB	00101000B
00001DF2 28                  A+    9503 	DB P1
                             A     9504 	DEFB	00001000B
00001DF3 08                  A+    9504 	DB P1
                             A     9505 	DEFB	00001000B
00001DF4 08                  A+    9505 	DB P1
                             A     9506 	DEFB	00001000B
00001DF5 08                  A+    9506 	DB P1
                             A     9507 	DEFB	00111110B
00001DF6 3E                  A+    9507 	DB P1
                             A     9508 	DEFB	00000000B
00001DF7 00                  A+    9508 	DB P1
                             A     9509 
                             A     9510 ; 032h - Character: '2'			CHR0h(50)
                             A     9511 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  196


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9512 	DEFB	00111100B
00001DF8 3C                  A+    9512 	DB P1
                             A     9513 	DEFB	01000010B
00001DF9 42                  A+    9513 	DB P1
                             A     9514 	DEFB	00000010B
00001DFA 02                  A+    9514 	DB P1
                             A     9515 	DEFB	00111100B
00001DFB 3C                  A+    9515 	DB P1
                             A     9516 	DEFB	01000000B
00001DFC 40                  A+    9516 	DB P1
                             A     9517 	DEFB	01111110B
00001DFD 7E                  A+    9517 	DB P1
                             A     9518 	DEFB	00000000B
00001DFE 00                  A+    9518 	DB P1
                             A     9519 
                             A     9520 ; 033h - Character: '3'			CHR0h(51)
                             A     9521 
                             A     9522 	DEFB	00111100B
00001DFF 3C                  A+    9522 	DB P1
                             A     9523 	DEFB	01000010B
00001E00 42                  A+    9523 	DB P1
                             A     9524 	DEFB	00001100B
00001E01 0C                  A+    9524 	DB P1
                             A     9525 	DEFB	00000010B
00001E02 02                  A+    9525 	DB P1
                             A     9526 	DEFB	01000010B
00001E03 42                  A+    9526 	DB P1
                             A     9527 	DEFB	00111100B
00001E04 3C                  A+    9527 	DB P1
                             A     9528 	DEFB	00000000B
00001E05 00                  A+    9528 	DB P1
                             A     9529 
                             A     9530 ; 034h - Character: '4'			CHR0h(52)
                             A     9531 
                             A     9532 	DEFB	00001000B
00001E06 08                  A+    9532 	DB P1
                             A     9533 	DEFB	00011000B
00001E07 18                  A+    9533 	DB P1
                             A     9534 	DEFB	00101000B
00001E08 28                  A+    9534 	DB P1
                             A     9535 	DEFB	01001000B
00001E09 48                  A+    9535 	DB P1
                             A     9536 	DEFB	01111110B
00001E0A 7E                  A+    9536 	DB P1
                             A     9537 	DEFB	00001000B
00001E0B 08                  A+    9537 	DB P1
                             A     9538 	DEFB	00000000B
00001E0C 00                  A+    9538 	DB P1
                             A     9539 
                             A     9540 ; 035h - Character: '5'			CHR0h(53)
                             A     9541 
                             A     9542 	DEFB	01111110B
00001E0D 7E                  A+    9542 	DB P1
                             A     9543 	DEFB	01000000B
00001E0E 40                  A+    9543 	DB P1
                             A     9544 	DEFB	01111100B
00001E0F 7C                  A+    9544 	DB P1
                             A     9545 	DEFB	00000010B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  197


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001E10 02                  A+    9545 	DB P1
                             A     9546 	DEFB	01000010B
00001E11 42                  A+    9546 	DB P1
                             A     9547 	DEFB	00111100B
00001E12 3C                  A+    9547 	DB P1
                             A     9548 	DEFB	00000000B
00001E13 00                  A+    9548 	DB P1
                             A     9549 
                             A     9550 ; 036h - Character: '6'			CHR0h(54)
                             A     9551 
                             A     9552 	DEFB	00111100B
00001E14 3C                  A+    9552 	DB P1
                             A     9553 	DEFB	01000000B
00001E15 40                  A+    9553 	DB P1
                             A     9554 	DEFB	01111100B
00001E16 7C                  A+    9554 	DB P1
                             A     9555 	DEFB	01000010B
00001E17 42                  A+    9555 	DB P1
                             A     9556 	DEFB	01000010B
00001E18 42                  A+    9556 	DB P1
                             A     9557 	DEFB	00111100B
00001E19 3C                  A+    9557 	DB P1
                             A     9558 	DEFB	00000000B
00001E1A 00                  A+    9558 	DB P1
                             A     9559 
                             A     9560 ; 037h - Character: '7'			CHR0h(55)
                             A     9561 
                             A     9562 	DEFB	01111110B
00001E1B 7E                  A+    9562 	DB P1
                             A     9563 	DEFB	00000010B
00001E1C 02                  A+    9563 	DB P1
                             A     9564 	DEFB	00000100B
00001E1D 04                  A+    9564 	DB P1
                             A     9565 	DEFB	00001000B
00001E1E 08                  A+    9565 	DB P1
                             A     9566 	DEFB	00010000B
00001E1F 10                  A+    9566 	DB P1
                             A     9567 	DEFB	00010000B
00001E20 10                  A+    9567 	DB P1
                             A     9568 	DEFB	00000000B
00001E21 00                  A+    9568 	DB P1
                             A     9569 
                             A     9570 ; 038h - Character: '8'			CHR0h(56)
                             A     9571 
                             A     9572 	DEFB	00111100B
00001E22 3C                  A+    9572 	DB P1
                             A     9573 	DEFB	01000010B
00001E23 42                  A+    9573 	DB P1
                             A     9574 	DEFB	00111100B
00001E24 3C                  A+    9574 	DB P1
                             A     9575 	DEFB	01000010B
00001E25 42                  A+    9575 	DB P1
                             A     9576 	DEFB	01000010B
00001E26 42                  A+    9576 	DB P1
                             A     9577 	DEFB	00111100B
00001E27 3C                  A+    9577 	DB P1
                             A     9578 	DEFB	00000000B
00001E28 00                  A+    9578 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  198


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9579 
                             A     9580 ; 039h - Character: '9'			CHR0h(57)
                             A     9581 
                             A     9582 	DEFB	00111100B
00001E29 3C                  A+    9582 	DB P1
                             A     9583 	DEFB	01000010B
00001E2A 42                  A+    9583 	DB P1
                             A     9584 	DEFB	01000010B
00001E2B 42                  A+    9584 	DB P1
                             A     9585 	DEFB	00111110B
00001E2C 3E                  A+    9585 	DB P1
                             A     9586 	DEFB	00000010B
00001E2D 02                  A+    9586 	DB P1
                             A     9587 	DEFB	00111100B
00001E2E 3C                  A+    9587 	DB P1
                             A     9588 	DEFB	00000000B
00001E2F 00                  A+    9588 	DB P1
                             A     9589 
                             A     9590 ; 03Ah - Character: ':'			CHR0h(58)
                             A     9591 
                             A     9592 	DEFB	00000000B
00001E30 00                  A+    9592 	DB P1
                             A     9593 	DEFB	00000000B
00001E31 00                  A+    9593 	DB P1
                             A     9594 	DEFB	00010000B
00001E32 10                  A+    9594 	DB P1
                             A     9595 	DEFB	00000000B
00001E33 00                  A+    9595 	DB P1
                             A     9596 	DEFB	00000000B
00001E34 00                  A+    9596 	DB P1
                             A     9597 	DEFB	00010000B
00001E35 10                  A+    9597 	DB P1
                             A     9598 	DEFB	00000000B
00001E36 00                  A+    9598 	DB P1
                             A     9599 
                             A     9600 ; 03Bh - Character: ';'			CHR0h(59)
                             A     9601 
                             A     9602 	DEFB	00000000B
00001E37 00                  A+    9602 	DB P1
                             A     9603 	DEFB	00010000B
00001E38 10                  A+    9603 	DB P1
                             A     9604 	DEFB	00000000B
00001E39 00                  A+    9604 	DB P1
                             A     9605 	DEFB	00000000B
00001E3A 00                  A+    9605 	DB P1
                             A     9606 	DEFB	00010000B
00001E3B 10                  A+    9606 	DB P1
                             A     9607 	DEFB	00010000B
00001E3C 10                  A+    9607 	DB P1
                             A     9608 	DEFB	00100000B
00001E3D 20                  A+    9608 	DB P1
                             A     9609 
                             A     9610 ; 03Ch - Character: '<'			CHR0h(60)
                             A     9611 
                             A     9612 	DEFB	00000000B
00001E3E 00                  A+    9612 	DB P1
                             A     9613 	DEFB	00000100B
00001E3F 04                  A+    9613 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  199


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9614 	DEFB	00001000B
00001E40 08                  A+    9614 	DB P1
                             A     9615 	DEFB	00010000B
00001E41 10                  A+    9615 	DB P1
                             A     9616 	DEFB	00001000B
00001E42 08                  A+    9616 	DB P1
                             A     9617 	DEFB	00000100B
00001E43 04                  A+    9617 	DB P1
                             A     9618 	DEFB	00000000B
00001E44 00                  A+    9618 	DB P1
                             A     9619 
                             A     9620 ; 03Dh - Character: '='			CHR0h(61)
                             A     9621 
                             A     9622 	DEFB	00000000B
00001E45 00                  A+    9622 	DB P1
                             A     9623 	DEFB	00000000B
00001E46 00                  A+    9623 	DB P1
                             A     9624 	DEFB	00111110B
00001E47 3E                  A+    9624 	DB P1
                             A     9625 	DEFB	00000000B
00001E48 00                  A+    9625 	DB P1
                             A     9626 	DEFB	00111110B
00001E49 3E                  A+    9626 	DB P1
                             A     9627 	DEFB	00000000B
00001E4A 00                  A+    9627 	DB P1
                             A     9628 	DEFB	00000000B
00001E4B 00                  A+    9628 	DB P1
                             A     9629 
                             A     9630 ; 03Eh - Character: '>'			CHR0h(62)
                             A     9631 
                             A     9632 	DEFB	00000000B
00001E4C 00                  A+    9632 	DB P1
                             A     9633 	DEFB	00010000B
00001E4D 10                  A+    9633 	DB P1
                             A     9634 	DEFB	00001000B
00001E4E 08                  A+    9634 	DB P1
                             A     9635 	DEFB	00000100B
00001E4F 04                  A+    9635 	DB P1
                             A     9636 	DEFB	00001000B
00001E50 08                  A+    9636 	DB P1
                             A     9637 	DEFB	00010000B
00001E51 10                  A+    9637 	DB P1
                             A     9638 	DEFB	00000000B
00001E52 00                  A+    9638 	DB P1
                             A     9639 
                             A     9640 ; 03Fh - Character: '?'			CHR0h(63)
                             A     9641 
                             A     9642 	DEFB	00111100B
00001E53 3C                  A+    9642 	DB P1
                             A     9643 	DEFB	01000010B
00001E54 42                  A+    9643 	DB P1
                             A     9644 	DEFB	00000100B
00001E55 04                  A+    9644 	DB P1
                             A     9645 	DEFB	00001000B
00001E56 08                  A+    9645 	DB P1
                             A     9646 	DEFB	00000000B
00001E57 00                  A+    9646 	DB P1
                             A     9647 	DEFB	00001000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  200


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001E58 08                  A+    9647 	DB P1
                             A     9648 
                             A     9649 ; 040h - Character: '@'			CHR0h(64)
                             A     9650 
                             A     9651 	DEFB	00111100B
00001E59 3C                  A+    9651 	DB P1
                             A     9652 	DEFB	01001010B
00001E5A 4A                  A+    9652 	DB P1
                             A     9653 	DEFB	01010110B
00001E5B 56                  A+    9653 	DB P1
                             A     9654 	DEFB	01011110B
00001E5C 5E                  A+    9654 	DB P1
                             A     9655 	DEFB	01000000B
00001E5D 40                  A+    9655 	DB P1
                             A     9656 	DEFB	00111100B
00001E5E 3C                  A+    9656 	DB P1
                             A     9657 
                             A     9658 ; 041h - Character: 'A'			CHR0h(65)
                             A     9659 
                             A     9660 	DEFB	00111100B
00001E5F 3C                  A+    9660 	DB P1
                             A     9661 	DEFB	01000010B
00001E60 42                  A+    9661 	DB P1
                             A     9662 	DEFB	01000010B
00001E61 42                  A+    9662 	DB P1
                             A     9663 	DEFB	01111110B
00001E62 7E                  A+    9663 	DB P1
                             A     9664 	DEFB	01000010B
00001E63 42                  A+    9664 	DB P1
                             A     9665 	DEFB	01000010B
00001E64 42                  A+    9665 	DB P1
                             A     9666 
                             A     9667 ; 042h - Character: 'B'			CHR0h(66)
                             A     9668 
                             A     9669 	DEFB	01111100B
00001E65 7C                  A+    9669 	DB P1
                             A     9670 	DEFB	01000010B
00001E66 42                  A+    9670 	DB P1
                             A     9671 	DEFB	01111100B
00001E67 7C                  A+    9671 	DB P1
                             A     9672 	DEFB	01000010B
00001E68 42                  A+    9672 	DB P1
                             A     9673 	DEFB	01000010B
00001E69 42                  A+    9673 	DB P1
                             A     9674 	DEFB	01111100B
00001E6A 7C                  A+    9674 	DB P1
                             A     9675 
                             A     9676 ; 043h - Character: 'C'			CHR0h(67)
                             A     9677 
                             A     9678 	DEFB	00111100B
00001E6B 3C                  A+    9678 	DB P1
                             A     9679 	DEFB	01000010B
00001E6C 42                  A+    9679 	DB P1
                             A     9680 	DEFB	01000000B
00001E6D 40                  A+    9680 	DB P1
                             A     9681 	DEFB	01000000B
00001E6E 40                  A+    9681 	DB P1
                             A     9682 	DEFB	01000010B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  201


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001E6F 42                  A+    9682 	DB P1
                             A     9683 	DEFB	00111100B
00001E70 3C                  A+    9683 	DB P1
                             A     9684 
                             A     9685 ; 044h - Character: 'D'			CHR0h(68)
                             A     9686 
                             A     9687 	DEFB	01111000B
00001E71 78                  A+    9687 	DB P1
                             A     9688 	DEFB	01000100B
00001E72 44                  A+    9688 	DB P1
                             A     9689 	DEFB	01000010B
00001E73 42                  A+    9689 	DB P1
                             A     9690 	DEFB	01000010B
00001E74 42                  A+    9690 	DB P1
                             A     9691 	DEFB	01000100B
00001E75 44                  A+    9691 	DB P1
                             A     9692 	DEFB	01111000B
00001E76 78                  A+    9692 	DB P1
                             A     9693 
                             A     9694 ; 045h - Character: 'E'			CHR0h(69)
                             A     9695 
                             A     9696 	DEFB	01111110B
00001E77 7E                  A+    9696 	DB P1
                             A     9697 	DEFB	01000000B
00001E78 40                  A+    9697 	DB P1
                             A     9698 	DEFB	01111100B
00001E79 7C                  A+    9698 	DB P1
                             A     9699 	DEFB	01000000B
00001E7A 40                  A+    9699 	DB P1
                             A     9700 	DEFB	01000000B
00001E7B 40                  A+    9700 	DB P1
                             A     9701 	DEFB	01111110B
00001E7C 7E                  A+    9701 	DB P1
                             A     9702 
                             A     9703 ; 046h - Character: 'F'			CHR0h(70)
                             A     9704 
                             A     9705 	DEFB	01111110B
00001E7D 7E                  A+    9705 	DB P1
                             A     9706 	DEFB	01000000B
00001E7E 40                  A+    9706 	DB P1
                             A     9707 	DEFB	01111100B
00001E7F 7C                  A+    9707 	DB P1
                             A     9708 	DEFB	01000000B
00001E80 40                  A+    9708 	DB P1
                             A     9709 	DEFB	01000000B
00001E81 40                  A+    9709 	DB P1
                             A     9710 	DEFB	01000000B
00001E82 40                  A+    9710 	DB P1
                             A     9711 
                             A     9712 ; 047h - Character: 'G'			CHR0h(71)
                             A     9713 
                             A     9714 	DEFB	00111100B
00001E83 3C                  A+    9714 	DB P1
                             A     9715 	DEFB	01000010B
00001E84 42                  A+    9715 	DB P1
                             A     9716 	DEFB	01000000B
00001E85 40                  A+    9716 	DB P1
                             A     9717 	DEFB	01001110B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  202


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001E86 4E                  A+    9717 	DB P1
                             A     9718 	DEFB	01000010B
00001E87 42                  A+    9718 	DB P1
                             A     9719 	DEFB	00111100B
00001E88 3C                  A+    9719 	DB P1
                             A     9720 
                             A     9721 ; 048h - Character: 'H'			CHR0h(72)
                             A     9722 
                             A     9723 	DEFB	01000010B
00001E89 42                  A+    9723 	DB P1
                             A     9724 	DEFB	01000010B
00001E8A 42                  A+    9724 	DB P1
                             A     9725 	DEFB	01111110B
00001E8B 7E                  A+    9725 	DB P1
                             A     9726 	DEFB	01000010B
00001E8C 42                  A+    9726 	DB P1
                             A     9727 	DEFB	01000010B
00001E8D 42                  A+    9727 	DB P1
                             A     9728 	DEFB	01000010B
00001E8E 42                  A+    9728 	DB P1
                             A     9729 
                             A     9730 ; 049h - Character: 'I'			CHR0h(73)
                             A     9731 
                             A     9732 	DEFB	00111110B
00001E8F 3E                  A+    9732 	DB P1
                             A     9733 	DEFB	00001000B
00001E90 08                  A+    9733 	DB P1
                             A     9734 	DEFB	00001000B
00001E91 08                  A+    9734 	DB P1
                             A     9735 	DEFB	00001000B
00001E92 08                  A+    9735 	DB P1
                             A     9736 	DEFB	00001000B
00001E93 08                  A+    9736 	DB P1
                             A     9737 	DEFB	00111110B
00001E94 3E                  A+    9737 	DB P1
                             A     9738 
                             A     9739 ; 04Ah - Character: 'J'			CHR0h(74)
                             A     9740 
                             A     9741 	DEFB	00000010B
00001E95 02                  A+    9741 	DB P1
                             A     9742 	DEFB	00000010B
00001E96 02                  A+    9742 	DB P1
                             A     9743 	DEFB	00000010B
00001E97 02                  A+    9743 	DB P1
                             A     9744 	DEFB	01000010B
00001E98 42                  A+    9744 	DB P1
                             A     9745 	DEFB	01000010B
00001E99 42                  A+    9745 	DB P1
                             A     9746 	DEFB	00111100B
00001E9A 3C                  A+    9746 	DB P1
                             A     9747 
                             A     9748 ; 04Bh - Character: 'K'			CHR0h(75)
                             A     9749 
                             A     9750 	DEFB	01000100B
00001E9B 44                  A+    9750 	DB P1
                             A     9751 	DEFB	01001000B
00001E9C 48                  A+    9751 	DB P1
                             A     9752 	DEFB	01110000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  203


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001E9D 70                  A+    9752 	DB P1
                             A     9753 	DEFB	01001000B
00001E9E 48                  A+    9753 	DB P1
                             A     9754 	DEFB	01000100B
00001E9F 44                  A+    9754 	DB P1
                             A     9755 	DEFB	01000010B
00001EA0 42                  A+    9755 	DB P1
                             A     9756 
                             A     9757 ; 04Ch - Character: 'L'			CHR0h(76)
                             A     9758 
                             A     9759 	DEFB	01000000B
00001EA1 40                  A+    9759 	DB P1
                             A     9760 	DEFB	01000000B
00001EA2 40                  A+    9760 	DB P1
                             A     9761 	DEFB	01000000B
00001EA3 40                  A+    9761 	DB P1
                             A     9762 	DEFB	01000000B
00001EA4 40                  A+    9762 	DB P1
                             A     9763 	DEFB	01000000B
00001EA5 40                  A+    9763 	DB P1
                             A     9764 	DEFB	01111110B
00001EA6 7E                  A+    9764 	DB P1
                             A     9765 
                             A     9766 ; 04Dh - Character: 'M'			CHR0h(77)
                             A     9767 
                             A     9768 	DEFB	01000010B
00001EA7 42                  A+    9768 	DB P1
                             A     9769 	DEFB	01100110B
00001EA8 66                  A+    9769 	DB P1
                             A     9770 	DEFB	01011010B
00001EA9 5A                  A+    9770 	DB P1
                             A     9771 	DEFB	01000010B
00001EAA 42                  A+    9771 	DB P1
                             A     9772 	DEFB	01000010B
00001EAB 42                  A+    9772 	DB P1
                             A     9773 	DEFB	01000010B
00001EAC 42                  A+    9773 	DB P1
                             A     9774 
                             A     9775 ; 04Eh - Character: 'N'			CHR0h(78)
                             A     9776 
                             A     9777 	DEFB	01000010B
00001EAD 42                  A+    9777 	DB P1
                             A     9778 	DEFB	01100010B
00001EAE 62                  A+    9778 	DB P1
                             A     9779 	DEFB	01010010B
00001EAF 52                  A+    9779 	DB P1
                             A     9780 	DEFB	01001010B
00001EB0 4A                  A+    9780 	DB P1
                             A     9781 	DEFB	01000110B
00001EB1 46                  A+    9781 	DB P1
                             A     9782 	DEFB	01000010B
00001EB2 42                  A+    9782 	DB P1
                             A     9783 
                             A     9784 ; 04Fh - Character: 'O'			CHR0h(79)
                             A     9785 
                             A     9786 	DEFB	00111100B
00001EB3 3C                  A+    9786 	DB P1
                             A     9787 	DEFB	01000010B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  204


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001EB4 42                  A+    9787 	DB P1
                             A     9788 	DEFB	01000010B
00001EB5 42                  A+    9788 	DB P1
                             A     9789 	DEFB	01000010B
00001EB6 42                  A+    9789 	DB P1
                             A     9790 	DEFB	01000010B
00001EB7 42                  A+    9790 	DB P1
                             A     9791 	DEFB	00111100B
00001EB8 3C                  A+    9791 	DB P1
                             A     9792 
                             A     9793 ; 050h - Character: 'P'			CHR0h(80)
                             A     9794 
                             A     9795 	DEFB	01111100B
00001EB9 7C                  A+    9795 	DB P1
                             A     9796 	DEFB	01000010B
00001EBA 42                  A+    9796 	DB P1
                             A     9797 	DEFB	01000010B
00001EBB 42                  A+    9797 	DB P1
                             A     9798 	DEFB	01111100B
00001EBC 7C                  A+    9798 	DB P1
                             A     9799 	DEFB	01000000B
00001EBD 40                  A+    9799 	DB P1
                             A     9800 	DEFB	01000000B
00001EBE 40                  A+    9800 	DB P1
                             A     9801 
                             A     9802 ; 051h - Character: 'Q'			CHR0h(81)
                             A     9803 
                             A     9804 	DEFB	00111100B
00001EBF 3C                  A+    9804 	DB P1
                             A     9805 	DEFB	01000010B
00001EC0 42                  A+    9805 	DB P1
                             A     9806 	DEFB	01000010B
00001EC1 42                  A+    9806 	DB P1
                             A     9807 	DEFB	01010010B
00001EC2 52                  A+    9807 	DB P1
                             A     9808 	DEFB	01001010B
00001EC3 4A                  A+    9808 	DB P1
                             A     9809 	DEFB	00111100B
00001EC4 3C                  A+    9809 	DB P1
                             A     9810 
                             A     9811 ; 052h - Character: 'R'			CHR0h(82)
                             A     9812 
                             A     9813 	DEFB	01111100B
00001EC5 7C                  A+    9813 	DB P1
                             A     9814 	DEFB	01000010B
00001EC6 42                  A+    9814 	DB P1
                             A     9815 	DEFB	01000010B
00001EC7 42                  A+    9815 	DB P1
                             A     9816 	DEFB	01111100B
00001EC8 7C                  A+    9816 	DB P1
                             A     9817 	DEFB	01000100B
00001EC9 44                  A+    9817 	DB P1
                             A     9818 	DEFB	01000010B
00001ECA 42                  A+    9818 	DB P1
                             A     9819 
                             A     9820 ; 053h - Character: 'S'			CHR0h(83)
                             A     9821 
                             A     9822 	DEFB	00111100B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  205


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001ECB 3C                  A+    9822 	DB P1
                             A     9823 	DEFB	01000000B
00001ECC 40                  A+    9823 	DB P1
                             A     9824 	DEFB	00111100B
00001ECD 3C                  A+    9824 	DB P1
                             A     9825 	DEFB	00000010B
00001ECE 02                  A+    9825 	DB P1
                             A     9826 	DEFB	01000010B
00001ECF 42                  A+    9826 	DB P1
                             A     9827 	DEFB	00111100B
00001ED0 3C                  A+    9827 	DB P1
                             A     9828 
                             A     9829 ; 054h - Character: 'T'			CHR0h(84)
                             A     9830 
                             A     9831 	DEFB	11111110B
00001ED1 FE                  A+    9831 	DB P1
                             A     9832 	DEFB	00010000B
00001ED2 10                  A+    9832 	DB P1
                             A     9833 	DEFB	00010000B
00001ED3 10                  A+    9833 	DB P1
                             A     9834 	DEFB	00010000B
00001ED4 10                  A+    9834 	DB P1
                             A     9835 	DEFB	00010000B
00001ED5 10                  A+    9835 	DB P1
                             A     9836 	DEFB	00010000B
00001ED6 10                  A+    9836 	DB P1
                             A     9837 
                             A     9838 ; 055h - Character: 'U'			CHR0h(85)
                             A     9839 
                             A     9840 	DEFB	01000010B
00001ED7 42                  A+    9840 	DB P1
                             A     9841 	DEFB	01000010B
00001ED8 42                  A+    9841 	DB P1
                             A     9842 	DEFB	01000010B
00001ED9 42                  A+    9842 	DB P1
                             A     9843 	DEFB	01000010B
00001EDA 42                  A+    9843 	DB P1
                             A     9844 	DEFB	01000010B
00001EDB 42                  A+    9844 	DB P1
                             A     9845 	DEFB	00111110B
00001EDC 3E                  A+    9845 	DB P1
                             A     9846 
                             A     9847 ; 056h - Character: 'V'			CHR0h(86)
                             A     9848 
                             A     9849 	DEFB	01000010B
00001EDD 42                  A+    9849 	DB P1
                             A     9850 	DEFB	01000010B
00001EDE 42                  A+    9850 	DB P1
                             A     9851 	DEFB	01000010B
00001EDF 42                  A+    9851 	DB P1
                             A     9852 	DEFB	01000010B
00001EE0 42                  A+    9852 	DB P1
                             A     9853 	DEFB	00100100B
00001EE1 24                  A+    9853 	DB P1
                             A     9854 	DEFB	00011000B
00001EE2 18                  A+    9854 	DB P1
                             A     9855 
                             A     9856 ; 057h - Character: 'W'			CHR0h(87)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  206


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9857 
                             A     9858 	DEFB	01000010B
00001EE3 42                  A+    9858 	DB P1
                             A     9859 	DEFB	01000010B
00001EE4 42                  A+    9859 	DB P1
                             A     9860 	DEFB	01000010B
00001EE5 42                  A+    9860 	DB P1
                             A     9861 	DEFB	01000010B
00001EE6 42                  A+    9861 	DB P1
                             A     9862 	DEFB	01011010B
00001EE7 5A                  A+    9862 	DB P1
                             A     9863 	DEFB	00100100B
00001EE8 24                  A+    9863 	DB P1
                             A     9864 
                             A     9865 ; 058h - Character: 'X'			CHR0h(88)
                             A     9866 
                             A     9867 	DEFB	01000010B
00001EE9 42                  A+    9867 	DB P1
                             A     9868 	DEFB	00100100B
00001EEA 24                  A+    9868 	DB P1
                             A     9869 	DEFB	00011000B
00001EEB 18                  A+    9869 	DB P1
                             A     9870 	DEFB	00011000B
00001EEC 18                  A+    9870 	DB P1
                             A     9871 	DEFB	00100100B
00001EED 24                  A+    9871 	DB P1
                             A     9872 	DEFB	01000010B
00001EEE 42                  A+    9872 	DB P1
                             A     9873 
                             A     9874 ; 059h - Character: 'Y'			CHR0h(89)
                             A     9875 
                             A     9876 	DEFB	10000010B
00001EEF 82                  A+    9876 	DB P1
                             A     9877 	DEFB	01000100B
00001EF0 44                  A+    9877 	DB P1
                             A     9878 	DEFB	00101000B
00001EF1 28                  A+    9878 	DB P1
                             A     9879 	DEFB	00010000B
00001EF2 10                  A+    9879 	DB P1
                             A     9880 	DEFB	00010000B
00001EF3 10                  A+    9880 	DB P1
                             A     9881 	DEFB	00010000B
00001EF4 10                  A+    9881 	DB P1
                             A     9882 
                             A     9883 ; 05Ah - Character: 'Z'			CHR0h(90)
                             A     9884 
                             A     9885 	DEFB	01111110B
00001EF5 7E                  A+    9885 	DB P1
                             A     9886 	DEFB	00000100B
00001EF6 04                  A+    9886 	DB P1
                             A     9887 	DEFB	00001000B
00001EF7 08                  A+    9887 	DB P1
                             A     9888 	DEFB	00010000B
00001EF8 10                  A+    9888 	DB P1
                             A     9889 	DEFB	00100000B
00001EF9 20                  A+    9889 	DB P1
                             A     9890 	DEFB	01111110B
00001EFA 7E                  A+    9890 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  207


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9891 
                             A     9892 ; 05Bh - Character: '['			CHR0h(91)
                             A     9893 
                             A     9894 	DEFB	00001110B
00001EFB 0E                  A+    9894 	DB P1
                             A     9895 	DEFB	00001000B
00001EFC 08                  A+    9895 	DB P1
                             A     9896 	DEFB	00001000B
00001EFD 08                  A+    9896 	DB P1
                             A     9897 	DEFB	00001000B
00001EFE 08                  A+    9897 	DB P1
                             A     9898 	DEFB	00001000B
00001EFF 08                  A+    9898 	DB P1
                             A     9899 	DEFB	00001110B
00001F00 0E                  A+    9899 	DB P1
                             A     9900 
                             A     9901 ; 05Ch - Character: '\'			CHR0h(92)
                             A     9902 
                             A     9903 	DEFB	00000000B
00001F01 00                  A+    9903 	DB P1
                             A     9904 	DEFB	01000000B
00001F02 40                  A+    9904 	DB P1
                             A     9905 	DEFB	00100000B
00001F03 20                  A+    9905 	DB P1
                             A     9906 	DEFB	00010000B
00001F04 10                  A+    9906 	DB P1
                             A     9907 	DEFB	00001000B
00001F05 08                  A+    9907 	DB P1
                             A     9908 	DEFB	00000100B
00001F06 04                  A+    9908 	DB P1
                             A     9909 
                             A     9910 ; 05Dh - Character: ']'			CHR0h(93)
                             A     9911 
                             A     9912 	DEFB	01110000B
00001F07 70                  A+    9912 	DB P1
                             A     9913 	DEFB	00010000B
00001F08 10                  A+    9913 	DB P1
                             A     9914 	DEFB	00010000B
00001F09 10                  A+    9914 	DB P1
                             A     9915 	DEFB	00010000B
00001F0A 10                  A+    9915 	DB P1
                             A     9916 	DEFB	00010000B
00001F0B 10                  A+    9916 	DB P1
                             A     9917 	DEFB	01110000B
00001F0C 70                  A+    9917 	DB P1
                             A     9918 
                             A     9919 ; 05Eh - Character: '^'			CHR0h(94)
                             A     9920 
                             A     9921 	DEFB	00010000B
00001F0D 10                  A+    9921 	DB P1
                             A     9922 	DEFB	00111000B
00001F0E 38                  A+    9922 	DB P1
                             A     9923 	DEFB	01010100B
00001F0F 54                  A+    9923 	DB P1
                             A     9924 	DEFB	00010000B
00001F10 10                  A+    9924 	DB P1
                             A     9925 	DEFB	00010000B
00001F11 10                  A+    9925 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  208


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9926 	DEFB	00010000B
00001F12 10                  A+    9926 	DB P1
                             A     9927 
                             A     9928 ; 05Fh - Character: '_'			CHR0h(95)
                             A     9929 
                             A     9930 	DEFB	00000000B
00001F13 00                  A+    9930 	DB P1
                             A     9931 	DEFB	00000000B
00001F14 00                  A+    9931 	DB P1
                             A     9932 	DEFB	00000000B
00001F15 00                  A+    9932 	DB P1
                             A     9933 	DEFB	00000000B
00001F16 00                  A+    9933 	DB P1
                             A     9934 	DEFB	00000000B
00001F17 00                  A+    9934 	DB P1
                             A     9935 	DEFB	00000000B
00001F18 00                  A+    9935 	DB P1
                             A     9936 	DEFB	11111111B
00001F19 FF                  A+    9936 	DB P1
                             A     9937 
                             A     9938 ; 060h - Character:  ï¿½			CHR0h(96)
                             A     9939 
                             A     9940 	DEFB	00011100B
00001F1A 1C                  A+    9940 	DB P1
                             A     9941 	DEFB	00100010B
00001F1B 22                  A+    9941 	DB P1
                             A     9942 	DEFB	01111000B
00001F1C 78                  A+    9942 	DB P1
                             A     9943 	DEFB	00100000B
00001F1D 20                  A+    9943 	DB P1
                             A     9944 	DEFB	00100000B
00001F1E 20                  A+    9944 	DB P1
                             A     9945 	DEFB	01111110B
00001F1F 7E                  A+    9945 	DB P1
                             A     9946 	DEFB	00000000B
00001F20 00                  A+    9946 	DB P1
                             A     9947 
                             A     9948 ; 061h - Character: 'a'			CHR0h(97)
                             A     9949 
                             A     9950 	DEFB	00000000B
00001F21 00                  A+    9950 	DB P1
                             A     9951 	DEFB	00111000B
00001F22 38                  A+    9951 	DB P1
                             A     9952 	DEFB	00000100B
00001F23 04                  A+    9952 	DB P1
                             A     9953 	DEFB	00111100B
00001F24 3C                  A+    9953 	DB P1
                             A     9954 	DEFB	01000100B
00001F25 44                  A+    9954 	DB P1
                             A     9955 	DEFB	00111110B
00001F26 3E                  A+    9955 	DB P1
                             A     9956 	DEFB	00000000B
00001F27 00                  A+    9956 	DB P1
                             A     9957 
                             A     9958 ; 062h - Character: 'b'			CHR0h(98)
                             A     9959 
                             A     9960 	DEFB	00100000B
00001F28 20                  A+    9960 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  209


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A     9961 	DEFB	00100000B
00001F29 20                  A+    9961 	DB P1
                             A     9962 	DEFB	00111100B
00001F2A 3C                  A+    9962 	DB P1
                             A     9963 	DEFB	00100010B
00001F2B 22                  A+    9963 	DB P1
                             A     9964 	DEFB	00100010B
00001F2C 22                  A+    9964 	DB P1
                             A     9965 	DEFB	00111100B
00001F2D 3C                  A+    9965 	DB P1
                             A     9966 	DEFB	00000000B
00001F2E 00                  A+    9966 	DB P1
                             A     9967 
                             A     9968 ; 063h - Character: 'c'			CHR0h(99)
                             A     9969 
                             A     9970 	DEFB	00000000B
00001F2F 00                  A+    9970 	DB P1
                             A     9971 	DEFB	00011100B
00001F30 1C                  A+    9971 	DB P1
                             A     9972 	DEFB	00100000B
00001F31 20                  A+    9972 	DB P1
                             A     9973 	DEFB	00100000B
00001F32 20                  A+    9973 	DB P1
                             A     9974 	DEFB	00100000B
00001F33 20                  A+    9974 	DB P1
                             A     9975 	DEFB	00011100B
00001F34 1C                  A+    9975 	DB P1
                             A     9976 	DEFB	00000000B
00001F35 00                  A+    9976 	DB P1
                             A     9977 
                             A     9978 ; 064h - Character: 'd'			CHR0h(100)
                             A     9979 
                             A     9980 	DEFB	00000100B
00001F36 04                  A+    9980 	DB P1
                             A     9981 	DEFB	00000100B
00001F37 04                  A+    9981 	DB P1
                             A     9982 	DEFB	00111100B
00001F38 3C                  A+    9982 	DB P1
                             A     9983 	DEFB	01000100B
00001F39 44                  A+    9983 	DB P1
                             A     9984 	DEFB	01000100B
00001F3A 44                  A+    9984 	DB P1
                             A     9985 	DEFB	00111110B
00001F3B 3E                  A+    9985 	DB P1
                             A     9986 	DEFB	00000000B
00001F3C 00                  A+    9986 	DB P1
                             A     9987 
                             A     9988 ; 065h - Character: 'e'			CHR0h(101)
                             A     9989 
                             A     9990 	DEFB	00000000B
00001F3D 00                  A+    9990 	DB P1
                             A     9991 	DEFB	00111000B
00001F3E 38                  A+    9991 	DB P1
                             A     9992 	DEFB	01000100B
00001F3F 44                  A+    9992 	DB P1
                             A     9993 	DEFB	01111000B
00001F40 78                  A+    9993 	DB P1
                             A     9994 	DEFB	01000000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  210


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001F41 40                  A+    9994 	DB P1
                             A     9995 	DEFB	00111100B
00001F42 3C                  A+    9995 	DB P1
                             A     9996 	DEFB	00000000B
00001F43 00                  A+    9996 	DB P1
                             A     9997 
                             A     9998 ; 066h - Character: 'f'			CHR0h(102)
                             A     9999 
                             A    10000 	DEFB	00001100B
00001F44 0C                  A+   10000 	DB P1
                             A    10001 	DEFB	00010000B
00001F45 10                  A+   10001 	DB P1
                             A    10002 	DEFB	00011000B
00001F46 18                  A+   10002 	DB P1
                             A    10003 	DEFB	00010000B
00001F47 10                  A+   10003 	DB P1
                             A    10004 	DEFB	00010000B
00001F48 10                  A+   10004 	DB P1
                             A    10005 	DEFB	00010000B
00001F49 10                  A+   10005 	DB P1
                             A    10006 	DEFB	00000000B
00001F4A 00                  A+   10006 	DB P1
                             A    10007 
                             A    10008 ; 067h - Character: 'g'			CHR0h(103)
                             A    10009 
                             A    10010 	DEFB	00000000B
00001F4B 00                  A+   10010 	DB P1
                             A    10011 	DEFB	00111100B
00001F4C 3C                  A+   10011 	DB P1
                             A    10012 	DEFB	01000100B
00001F4D 44                  A+   10012 	DB P1
                             A    10013 	DEFB	01000100B
00001F4E 44                  A+   10013 	DB P1
                             A    10014 	DEFB	00111100B
00001F4F 3C                  A+   10014 	DB P1
                             A    10015 	DEFB	00000100B
00001F50 04                  A+   10015 	DB P1
                             A    10016 	DEFB	00111000B
00001F51 38                  A+   10016 	DB P1
                             A    10017 
                             A    10018 ; 068h - Character: 'h'			CHR0h(104)
                             A    10019 
                             A    10020 	DEFB	01000000B
00001F52 40                  A+   10020 	DB P1
                             A    10021 	DEFB	01000000B
00001F53 40                  A+   10021 	DB P1
                             A    10022 	DEFB	01111000B
00001F54 78                  A+   10022 	DB P1
                             A    10023 	DEFB	01000100B
00001F55 44                  A+   10023 	DB P1
                             A    10024 	DEFB	01000100B
00001F56 44                  A+   10024 	DB P1
                             A    10025 	DEFB	01000100B
00001F57 44                  A+   10025 	DB P1
                             A    10026 	DEFB	00000000B
00001F58 00                  A+   10026 	DB P1
                             A    10027 
                             A    10028 ; 069h - Character: 'i'			CHR0h(105)
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  211


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10029 
                             A    10030 	DEFB	00010000B
00001F59 10                  A+   10030 	DB P1
                             A    10031 	DEFB	00000000B
00001F5A 00                  A+   10031 	DB P1
                             A    10032 	DEFB	00110000B
00001F5B 30                  A+   10032 	DB P1
                             A    10033 	DEFB	00010000B
00001F5C 10                  A+   10033 	DB P1
                             A    10034 	DEFB	00010000B
00001F5D 10                  A+   10034 	DB P1
                             A    10035 	DEFB	00111000B
00001F5E 38                  A+   10035 	DB P1
                             A    10036 	DEFB	00000000B
00001F5F 00                  A+   10036 	DB P1
                             A    10037 
                             A    10038 ; 06Ah - Character: 'j'			CHR0h(106)
                             A    10039 
                             A    10040 	DEFB	00000100B
00001F60 04                  A+   10040 	DB P1
                             A    10041 	DEFB	00000000B
00001F61 00                  A+   10041 	DB P1
                             A    10042 	DEFB	00000100B
00001F62 04                  A+   10042 	DB P1
                             A    10043 	DEFB	00000100B
00001F63 04                  A+   10043 	DB P1
                             A    10044 	DEFB	00000100B
00001F64 04                  A+   10044 	DB P1
                             A    10045 	DEFB	00100100B
00001F65 24                  A+   10045 	DB P1
                             A    10046 	DEFB	00011000B
00001F66 18                  A+   10046 	DB P1
                             A    10047 
                             A    10048 ; 06Bh - Character: 'k'			CHR0h(107)
                             A    10049 
                             A    10050 	DEFB	00100000B
00001F67 20                  A+   10050 	DB P1
                             A    10051 	DEFB	00101000B
00001F68 28                  A+   10051 	DB P1
                             A    10052 	DEFB	00110000B
00001F69 30                  A+   10052 	DB P1
                             A    10053 	DEFB	00110000B
00001F6A 30                  A+   10053 	DB P1
                             A    10054 	DEFB	00101000B
00001F6B 28                  A+   10054 	DB P1
                             A    10055 	DEFB	00100100B
00001F6C 24                  A+   10055 	DB P1
                             A    10056 	DEFB	00000000B
00001F6D 00                  A+   10056 	DB P1
                             A    10057 
                             A    10058 ; 06Ch - Character: 'l'			CHR0h(108)
                             A    10059 
                             A    10060 	DEFB	00010000B
00001F6E 10                  A+   10060 	DB P1
                             A    10061 	DEFB	00010000B
00001F6F 10                  A+   10061 	DB P1
                             A    10062 	DEFB	00010000B
00001F70 10                  A+   10062 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  212


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10063 	DEFB	00010000B
00001F71 10                  A+   10063 	DB P1
                             A    10064 	DEFB	00010000B
00001F72 10                  A+   10064 	DB P1
                             A    10065 	DEFB	00001100B
00001F73 0C                  A+   10065 	DB P1
                             A    10066 	DEFB	00000000B
00001F74 00                  A+   10066 	DB P1
                             A    10067 
                             A    10068 ; 06Dh - Character: 'm'			CHR0h(109)
                             A    10069 
                             A    10070 	DEFB	00000000B
00001F75 00                  A+   10070 	DB P1
                             A    10071 	DEFB	01101000B
00001F76 68                  A+   10071 	DB P1
                             A    10072 	DEFB	01010100B
00001F77 54                  A+   10072 	DB P1
                             A    10073 	DEFB	01010100B
00001F78 54                  A+   10073 	DB P1
                             A    10074 	DEFB	01010100B
00001F79 54                  A+   10074 	DB P1
                             A    10075 	DEFB	01010100B
00001F7A 54                  A+   10075 	DB P1
                             A    10076 	DEFB	00000000B
00001F7B 00                  A+   10076 	DB P1
                             A    10077 
                             A    10078 ; 06Eh - Character: 'n'			CHR0h(110)
                             A    10079 
                             A    10080 	DEFB	00000000B
00001F7C 00                  A+   10080 	DB P1
                             A    10081 	DEFB	01111000B
00001F7D 78                  A+   10081 	DB P1
                             A    10082 	DEFB	01000100B
00001F7E 44                  A+   10082 	DB P1
                             A    10083 	DEFB	01000100B
00001F7F 44                  A+   10083 	DB P1
                             A    10084 	DEFB	01000100B
00001F80 44                  A+   10084 	DB P1
                             A    10085 	DEFB	01000100B
00001F81 44                  A+   10085 	DB P1
                             A    10086 	DEFB	00000000B
00001F82 00                  A+   10086 	DB P1
                             A    10087 
                             A    10088 ; 06Fh - Character: 'o'			CHR0h(111)
                             A    10089 
                             A    10090 	DEFB	00000000B
00001F83 00                  A+   10090 	DB P1
                             A    10091 	DEFB	00111000B
00001F84 38                  A+   10091 	DB P1
                             A    10092 	DEFB	01000100B
00001F85 44                  A+   10092 	DB P1
                             A    10093 	DEFB	01000100B
00001F86 44                  A+   10093 	DB P1
                             A    10094 	DEFB	01000100B
00001F87 44                  A+   10094 	DB P1
                             A    10095 	DEFB	00111000B
00001F88 38                  A+   10095 	DB P1
                             A    10096 	DEFB	00000000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  213


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001F89 00                  A+   10096 	DB P1
                             A    10097 
                             A    10098 ; 070h - Character: 'p'			CHR0h(112)
                             A    10099 
                             A    10100 	DEFB	00000000B
00001F8A 00                  A+   10100 	DB P1
                             A    10101 	DEFB	01111000B
00001F8B 78                  A+   10101 	DB P1
                             A    10102 	DEFB	01000100B
00001F8C 44                  A+   10102 	DB P1
                             A    10103 	DEFB	01000100B
00001F8D 44                  A+   10103 	DB P1
                             A    10104 	DEFB	01111000B
00001F8E 78                  A+   10104 	DB P1
                             A    10105 	DEFB	01000000B
00001F8F 40                  A+   10105 	DB P1
                             A    10106 	DEFB	01000000B
00001F90 40                  A+   10106 	DB P1
                             A    10107 
                             A    10108 ; 071h - Character: 'q'			CHR0h(113)
                             A    10109 
                             A    10110 	DEFB	00000000B
00001F91 00                  A+   10110 	DB P1
                             A    10111 	DEFB	00111100B
00001F92 3C                  A+   10111 	DB P1
                             A    10112 	DEFB	01000100B
00001F93 44                  A+   10112 	DB P1
                             A    10113 	DEFB	01000100B
00001F94 44                  A+   10113 	DB P1
                             A    10114 	DEFB	00111100B
00001F95 3C                  A+   10114 	DB P1
                             A    10115 	DEFB	00000100B
00001F96 04                  A+   10115 	DB P1
                             A    10116 	DEFB	00000110B
00001F97 06                  A+   10116 	DB P1
                             A    10117 
                             A    10118 ; 072h - Character: 'r'			CHR0h(114)
                             A    10119 
                             A    10120 	DEFB	00000000B
00001F98 00                  A+   10120 	DB P1
                             A    10121 	DEFB	00011100B
00001F99 1C                  A+   10121 	DB P1
                             A    10122 	DEFB	00100000B
00001F9A 20                  A+   10122 	DB P1
                             A    10123 	DEFB	00100000B
00001F9B 20                  A+   10123 	DB P1
                             A    10124 	DEFB	00100000B
00001F9C 20                  A+   10124 	DB P1
                             A    10125 	DEFB	00100000B
00001F9D 20                  A+   10125 	DB P1
                             A    10126 	DEFB	00000000B
00001F9E 00                  A+   10126 	DB P1
                             A    10127 
                             A    10128 ; 073h - Character: 's'			CHR0h(115)
                             A    10129 
                             A    10130 	DEFB	00000000B
00001F9F 00                  A+   10130 	DB P1
                             A    10131 	DEFB	00111000B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  214


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001FA0 38                  A+   10131 	DB P1
                             A    10132 	DEFB	01000000B
00001FA1 40                  A+   10132 	DB P1
                             A    10133 	DEFB	00111000B
00001FA2 38                  A+   10133 	DB P1
                             A    10134 	DEFB	00000100B
00001FA3 04                  A+   10134 	DB P1
                             A    10135 	DEFB	01111000B
00001FA4 78                  A+   10135 	DB P1
                             A    10136 	DEFB	00000000B
00001FA5 00                  A+   10136 	DB P1
                             A    10137 
                             A    10138 ; 074h - Character: 't'			CHR0h(116)
                             A    10139 
                             A    10140 	DEFB	00010000B
00001FA6 10                  A+   10140 	DB P1
                             A    10141 	DEFB	00111000B
00001FA7 38                  A+   10141 	DB P1
                             A    10142 	DEFB	00010000B
00001FA8 10                  A+   10142 	DB P1
                             A    10143 	DEFB	00010000B
00001FA9 10                  A+   10143 	DB P1
                             A    10144 	DEFB	00010000B
00001FAA 10                  A+   10144 	DB P1
                             A    10145 	DEFB	00001100B
00001FAB 0C                  A+   10145 	DB P1
                             A    10146 	DEFB	00000000B
00001FAC 00                  A+   10146 	DB P1
                             A    10147 
                             A    10148 ; 075h - Character: 'u'			CHR0h(117)
                             A    10149 
                             A    10150 	DEFB	00000000B
00001FAD 00                  A+   10150 	DB P1
                             A    10151 	DEFB	01000100B
00001FAE 44                  A+   10151 	DB P1
                             A    10152 	DEFB	01000100B
00001FAF 44                  A+   10152 	DB P1
                             A    10153 	DEFB	01000100B
00001FB0 44                  A+   10153 	DB P1
                             A    10154 	DEFB	01000100B
00001FB1 44                  A+   10154 	DB P1
                             A    10155 	DEFB	00111100B
00001FB2 3C                  A+   10155 	DB P1
                             A    10156 	DEFB	00000000B
00001FB3 00                  A+   10156 	DB P1
                             A    10157 
                             A    10158 ; 076h - Character: 'v'			CHR0h(118)
                             A    10159 
                             A    10160 	DEFB	00000000B
00001FB4 00                  A+   10160 	DB P1
                             A    10161 	DEFB	01000100B
00001FB5 44                  A+   10161 	DB P1
                             A    10162 	DEFB	01000100B
00001FB6 44                  A+   10162 	DB P1
                             A    10163 	DEFB	00101000B
00001FB7 28                  A+   10163 	DB P1
                             A    10164 	DEFB	00101000B
00001FB8 28                  A+   10164 	DB P1
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  215


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10165 	DEFB	00010000B
00001FB9 10                  A+   10165 	DB P1
                             A    10166 	DEFB	00000000B
00001FBA 00                  A+   10166 	DB P1
                             A    10167 
                             A    10168 ; 077h - Character: 'w'			CHR0h(119)
                             A    10169 
                             A    10170 	DEFB	00000000B
00001FBB 00                  A+   10170 	DB P1
                             A    10171 	DEFB	01000100B
00001FBC 44                  A+   10171 	DB P1
                             A    10172 	DEFB	01010100B
00001FBD 54                  A+   10172 	DB P1
                             A    10173 	DEFB	01010100B
00001FBE 54                  A+   10173 	DB P1
                             A    10174 	DEFB	01010100B
00001FBF 54                  A+   10174 	DB P1
                             A    10175 	DEFB	00101000B
00001FC0 28                  A+   10175 	DB P1
                             A    10176 	DEFB	00000000B
00001FC1 00                  A+   10176 	DB P1
                             A    10177 
                             A    10178 ; 078h - Character: 'x'			CHR0h(120)
                             A    10179 
                             A    10180 	DEFB	00000000B
00001FC2 00                  A+   10180 	DB P1
                             A    10181 	DEFB	01000100B
00001FC3 44                  A+   10181 	DB P1
                             A    10182 	DEFB	00101000B
00001FC4 28                  A+   10182 	DB P1
                             A    10183 	DEFB	00010000B
00001FC5 10                  A+   10183 	DB P1
                             A    10184 	DEFB	00101000B
00001FC6 28                  A+   10184 	DB P1
                             A    10185 	DEFB	01000100B
00001FC7 44                  A+   10185 	DB P1
                             A    10186 	DEFB	00000000B
00001FC8 00                  A+   10186 	DB P1
                             A    10187 
                             A    10188 ; 079h - Character: 'y'			CHR0h(121)
                             A    10189 
                             A    10190 	DEFB	00000000B
00001FC9 00                  A+   10190 	DB P1
                             A    10191 	DEFB	01000100B
00001FCA 44                  A+   10191 	DB P1
                             A    10192 	DEFB	01000100B
00001FCB 44                  A+   10192 	DB P1
                             A    10193 	DEFB	01000100B
00001FCC 44                  A+   10193 	DB P1
                             A    10194 	DEFB	00111100B
00001FCD 3C                  A+   10194 	DB P1
                             A    10195 	DEFB	00000100B
00001FCE 04                  A+   10195 	DB P1
                             A    10196 	DEFB	00111000B
00001FCF 38                  A+   10196 	DB P1
                             A    10197 
                             A    10198 ; 07Ah - Character: 'z'			CHR0h(122)
                             A    10199 
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  216


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10200 	DEFB	00000000B
00001FD0 00                  A+   10200 	DB P1
                             A    10201 	DEFB	01111100B
00001FD1 7C                  A+   10201 	DB P1
                             A    10202 	DEFB	00001000B
00001FD2 08                  A+   10202 	DB P1
                             A    10203 	DEFB	00010000B
00001FD3 10                  A+   10203 	DB P1
                             A    10204 	DEFB	00100000B
00001FD4 20                  A+   10204 	DB P1
                             A    10205 	DEFB	01111100B
00001FD5 7C                  A+   10205 	DB P1
                             A    10206 	DEFB	00000000B
00001FD6 00                  A+   10206 	DB P1
                             A    10207 
                             A    10208 ; 07Bh - Character: '{'			CHR0h(123)
                             A    10209 
                             A    10210 	DEFB	00001110B
00001FD7 0E                  A+   10210 	DB P1
                             A    10211 	DEFB	00001000B
00001FD8 08                  A+   10211 	DB P1
                             A    10212 	DEFB	00110000B
00001FD9 30                  A+   10212 	DB P1
                             A    10213 	DEFB	00110000B
00001FDA 30                  A+   10213 	DB P1
                             A    10214 	DEFB	00001000B
00001FDB 08                  A+   10214 	DB P1
                             A    10215 	DEFB	00001110B
00001FDC 0E                  A+   10215 	DB P1
                             A    10216 	DEFB	00000000B
00001FDD 00                  A+   10216 	DB P1
                             A    10217 
                             A    10218 ; 07Ch - Character: '|'			CHR0h(124)
                             A    10219 
                             A    10220 	DEFB	00001000B
00001FDE 08                  A+   10220 	DB P1
                             A    10221 	DEFB	00001000B
00001FDF 08                  A+   10221 	DB P1
                             A    10222 	DEFB	00001000B
00001FE0 08                  A+   10222 	DB P1
                             A    10223 	DEFB	00001000B
00001FE1 08                  A+   10223 	DB P1
                             A    10224 	DEFB	00001000B
00001FE2 08                  A+   10224 	DB P1
                             A    10225 	DEFB	00001000B
00001FE3 08                  A+   10225 	DB P1
                             A    10226 	DEFB	00000000B
00001FE4 00                  A+   10226 	DB P1
                             A    10227 
                             A    10228 ; 07Dh - Character: '}'			CHR0h(125)
                             A    10229 
                             A    10230 	DEFB	01110000B
00001FE5 70                  A+   10230 	DB P1
                             A    10231 	DEFB	00010000B
00001FE6 10                  A+   10231 	DB P1
                             A    10232 	DEFB	00001100B
00001FE7 0C                  A+   10232 	DB P1
                             A    10233 	DEFB	00001100B
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  217


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
00001FE8 0C                  A+   10233 	DB P1
                             A    10234 	DEFB	00010000B
00001FE9 10                  A+   10234 	DB P1
                             A    10235 	DEFB	01110000B
00001FEA 70                  A+   10235 	DB P1
                             A    10236 	DEFB	00000000B
00001FEB 00                  A+   10236 	DB P1
                             A    10237 
                             A    10238 ; 07Eh - Character: '~'			CHR0h(126)
                             A    10239 
                             A    10240 	DEFB	00110010B
00001FEC 32                  A+   10240 	DB P1
                             A    10241 	DEFB	01001100B
00001FED 4C                  A+   10241 	DB P1
                             A    10242 	DEFB	00000000B
00001FEE 00                  A+   10242 	DB P1
                             A    10243 	DEFB	00000000B
00001FEF 00                  A+   10243 	DB P1
                             A    10244 	DEFB	00000000B
00001FF0 00                  A+   10244 	DB P1
                             A    10245 	DEFB	00000000B
00001FF1 00                  A+   10245 	DB P1
                             A    10246 	DEFB	00000000B
00001FF2 00                  A+   10246 	DB P1
                             A    10247 
                             A    10248 ; 07Fh - Character:  ï¿½			CHR0h(127)
                             A    10249 
                             A    10250 	DEFB	00111100B
00001FF3 3C                  A+   10250 	DB P1
                             A    10251 	DEFB	01000010B
00001FF4 42                  A+   10251 	DB P1
                             A    10252 	DEFB	10011001B
00001FF5 99                  A+   10252 	DB P1
                             A    10253 	DEFB	10100001B
00001FF6 A1                  A+   10253 	DB P1
                             A    10254 	DEFB	10100001B
00001FF7 A1                  A+   10254 	DB P1
                             A    10255 	DEFB	10011001B
00001FF8 99                  A+   10255 	DB P1
                             A    10256 	DEFB	01000010B
00001FF9 42                  A+   10256 	DB P1
                             A    10257 L1FFB:  DEFB	00111100B
00001FFA 3C                  A+   10257 	DB P1
                             A    10258 
                             A    10259 
                             A    10260 
                             A    10261 ; ---------------
                             A    10262 ; THE 'SPARE' ROM
                             A    10263 ; ---------------
                             A    10264 
                             A    10265 L1FFC:  DEFB	0FFh						; unused
00001FFB FF                  A+   10265 	DB P1
                             A    10266 
                             A    10267 ; ----------
                             A    10268 ; THE 'LINK'
                             A    10269 ; ----------
                             A    10270 
                             A    10271 ; The FORTH word copied to RAM links back to L1FFF
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  218


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10272 
                             A    10273 L1FFD:  DEFW	L1D58					; pointer to prev - UFLOAT
00001FFC 57 1D               A+   10273 	DW P1
                             A    10274 L1FFF:  DEFB	000h						; length of dummy word zero
00001FFE 00                  A+   10274 	DB P1
                             A    10275 
                             A    10276 ; gap for vide ram
                             A    10277 
                             A    10278 	org RAMSTART
                             A    10279 
00000000                     A    10280 RAMSTART:
                             A    10281 
                             A    10282 ; -----------
                             A    10283 ;
                             A    10284 ; -----------
                             A    10285 ; ----------------------
                             A    10286 ; THE 'SYSTEM VARIABLES'
                             A    10287 ; ----------------------
                             A    10288 ; "Here is a list of system variables. We have given them all names, but that
                             A    10289 ; is just for ease of reference. The Ace will not recognize these names,
                             A    10290 ; except for a few, like 'BASE', that are FORTH words. I've written these
                             A    10291 ; FORTH words in bold type in the usual way."
                             A    10292 ;
                             A    10293 ;
                             A    10294 ; FP_WS			RAMSTART+000h (15360)   19 bytes used as work space for floating point
                             A    10295 ;								arithmetic.
00000000                     A    10296 FP_WS: DS 19
                             A    10297 ;
                             A    10298 ; LISTWS		RAMSTART+013h (15379)   5 bytes used as workspace by 'LIST' and 'EDIT'.
                             A    10299 ;
00000013                     A    10300 LISTWS: DS	5
                             A    10301 ;
                             A    10302 ; RAMTOP		RAMSTART+018h (15384)   2 bytes - the first address past the last
                             A    10303 ;								address in RAM.
                             A    10304 ;
00000018                     A    10305 RAMTOP:	DS	2
                             A    10306 ;
                             A    10307 ; HLD			RAMSTART+01Ah (15386)   2 bytes. The address of the latest character
                             A    10308 ;								held in the pad by formatted output.
                             A    10309 ;								('#', 'HOLD' and so on).
0000001A                     A    10310 HLD:	DS	2
                             A    10311 ;
                             A    10312 ; SCRPOS		RAMSTART+01Ch (15388)   2 bytes. The address of the place in video RAM
                             A    10313 ;								where the next character is to be printed
                             A    10314 ;								(i.e. the 'print position').
0000001C                     A    10315 SCRPOS:	DS	2
                             A    10316 ;
                             A    10317 ; INSCRN		RAMSTART+01Eh (15390)   2 bytes. The address of the start of the
                             A    10318 ;								current 'logical line' in the input buffer.
0000001E                     A    10319 INSCRN:	DS	2
                             A    10320 ;
                             A    10321 ; CURSOR		RAMSTART+020h (15392)   2 bytes. The address of the cursor in the
                             A    10322 ;								input buffer.
00000020                     A    10323 CURSOR:	DS	2
                             A    10324 ;
                             A    10325 ; ENDSUF		RAMSTART+022h (15394)   2 bytes. The address of the end of the current
                             A    10326 ;								logical line in the input buffer.
00000022                     A    10327 ENDSUF:	DS	2
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  219


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10328 ;
                             A    10329 ; L_HALF		RAMSTART+024h (15396)   2 bytes. The address of the start of the the
                             A    10330 ;								input buffer. The input buffer itself is stored
                             A    10331 ;								in the video RAM, where you see it.
00000024                     A    10332 L_HALF:	DS	2
                             A    10333 ; KEYCOD		RAMSTART+026h (15398)   1 byte. The ASCII code of the last key pressed.
00000026                     A    10334 KEYCOD:	DS	1
                             A    10335 ;
                             A    10336 ; KEYCNT		RAMSTART+027h (15399)   1 byte. Used by the routine that reads the
                             A    10337 ;								keyboard.
00000027                     A    10338 KEYCNT:	DS	1
                             A    10339 ; STATIN		RAMSTART+028h (15400)   1 byte. Used by the routine that reads the
                             A    10340 ;								keyboard.
00000028                     A    10341 STATIN:	DS	1
                             A    10342 ;
                             A    10343 ; EXWRCH		RAMSTART+029h (15401)   2 bytes. This is normally 0 but it can be
                             A    10344 ;								changed to allow printing to be sent to some
                             A    10345 ;								device other than the screen.
00000029                     A    10346 EXWRCH:	DS	2
                             A    10347 ; FRAMES		RAMSTART+02Bh (15403)   4 bytes. These four bytes form a double length
                             A    10348 ;								integer that counts the time since the Ace was
                             A    10349 ;								switched on in 50ths of a second.
0000002B                     A    10350 FRAMES:	DS	4
                             A    10351 ; XCOORD		RAMSTART+02Fh (15407)   1 byte. The x-coordinate last used by 'PLOT'.
0000002F                     A    10352 XCOORD:	DS	1
                             A    10353 ;
                             A    10354 ; YCOORD		RAMSTART+030h (15408)   1 byte. The y-coordinate last used by 'PLOT'.
00000030                     A    10355 YCOORD:	DS	1
                             A    10356 ;
                             A    10357 ; CURRENT		RAMSTART+031h (15409)   2 bytes. The parameter field address for the
                             A    10358 ;								vocabulary word of the current vocabulary.
00000031                     A    10359 CURRENT:	DS	2
                             A    10360 ;
                             A    10361 ; CONTEXT		RAMSTART+033h (15411)   2 bytes. The parameter field address for the
                             A    10362 ;								vocabulary word of the context vocabulary.
00000033                     A    10363 CONTEXT:	DS	2
                             A    10364 ;
                             A    10365 ; VOCLNK		RAMSTART+035h (15413)   2 bytes. The address of the fourth byte in the
                             A    10366 ;								parameter field - the vocabulary linkage - of
                             A    10367 ;								the vocabulary word of the most recently
                             A    10368 ;								defined vocabulary.
00000035                     A    10369 VOCLNK:	DS	2
                             A    10370 ;
                             A    10371 ; STKBOT		RAMSTART+037h (15415)   2 bytes. The address of the next byte into
                             A    10372 ;								which anything will be enclosed in the
                             A    10373 ;								dictionary, i.e. one byte past the present end
                             A    10374 ;								of the dictionary.
                             A    10375 ;								'HERE' is equivalent to 15415 @.
00000037                     A    10376 STKBOT:	DS	2
                             A    10377 
                             A    10378 ; DICT			RAMSTART+039h (15417)   2 bytes. The address of the length field in the
                             A    10379 ;								newest word in the dictionary. If that length
                             A    10380 ;								field is correctly filled in then DICT may
                             A    10381 ;								be 0.
00000039                     A    10382 DICT:	DS	2
                             A    10383 ; SPARE			RAMSTART+03Bh (15419)   2 bytes. The address of the first byte past the
                             A    10384 ;								top of the stack.
0000003B                     A    10385 SPARE:	DS	2
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  220


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10386 ;
                             A    10387 ; ERR_NO		RAMSTART+03Dh (15421)   1 byte. This is usually 255, meaning "no error".
                             A    10388 ;								If 'ABORT' is used, and ERR_NO is between 0 and
                             A    10389 ;								127, then "ERROR" will be printed out, followed
                             A    10390 ;								by the error number ERR_NO.
0000003D                     A    10391 ERR_NO:	DS	1
                             A    10392 ;
                             A    10393 ; FLAGS			RAMSTART+03Eh (15422)   1 byte. Shows the state of various parts of the
                             A    10394 ;								system, each bit showing whether something
                             A    10395 ;								particular is happening or not. Some of these
                             A    10396 ;								may be useful.
                             A    10397 ;
                             A    10398 ;								Bit 2, when 1, shows that there is an incomplete
                             A    10399 ;								definition at the end of the dictionary.
                             A    10400 ;
                             A    10401 ;								Bit 3, when 1, shows that output is to fed into
                             A    10402 ;								the input buffer.
                             A    10403 ;
                             A    10404 ;								Bit 4, when 1, shows that the Ace is in
                             A    10405 ;								invisible mode.
                             A    10406 ;
                             A    10407 ;								Bit 6, when 1, shows that the Ace is in compile
                             A    10408 ;								mode.
0000003E                     A    10409 FLAGS:	DS	1
                             A    10410 ;
                             A    10411 ; BASE			RAMSTART+03Fh (15423)   1 byte. The system number base.
0000003F                     A    10412 BASE:	DS	1
                             A    10413 
                             A    10414 ;;Deuce Vars
                             A    10415 	PUBLIC SIOANEXTIN,SIOANEXTOUT,SIOATXBUFF
                             A    10416 
00000040                     A    10417 	SIOANEXTIN:		DS	1
00000041                     A    10418 	SIOANEXTOUT:	DS	1
00000042                     A    10419 	SIOATXBUFF:		DS	SERIALTXBUFFLEN
                             A    10420 ;
                             A    10421 ;
                             A    10422 ;
                             A    10423 ; -----------------------------------------------------------------------------
                             A    10424 ;									---------
                             A    10425 ;									-------------------------------------------
                             A    10426 ; ------------						--------------------------------------------
                             A    10427 ; ACE KEYBOARD					---------
                             A    10428 ; ------------					---------
                             A    10429 ;
                             A    10430 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10431 ;|   ! | |   @ | |   # | |   0h | |   % | |   & | |   ' | |   ( | |   ) | |   _ |
                             A    10432 ;| 1 []| | 2 []| | 3 []| | 4 []| | 5 []| | 6 []| | 7 []| | 8   | | 9   | | 0 []|
                             A    10433 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10434 ; DELETE   CAPS			INV	<=		^		v		=>  GRAPHIC  DELETE
                             A    10435 ;  LINE	LOCK			VIDEO
                             A    10436 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10437 ;|		| |		| |		| |   < | |   > | |   [ | |   ] | |   ï¿½ | |   ; | |   " |
                             A    10438 ;| Q   | | W   | | E   | | R   | | T   | | Y   | | U   | | I   | | O   | | P   |
                             A    10439 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10440 ;
                             A    10441 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10442 ;|   ~ | |   | | |   \ | |   { | |   } | |   ^ | |   - | |   + | |   = | |		|
                             A    10443 ;| A   | | S   | | D   | | F   | | G   | | H   | | J   | | K   | | L   | |ENTER|
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  221


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm

Location Object              Type  Line Source
                             A    10444 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10445 ;
                             A    10446 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10447 ;|		| |   : | |   ï¿½ | |   ? | |   / | |   * | |   , | |   . | | SYM | |		|
                             A    10448 ;|SHIFT| | Z   | | X   | | C   | | V   | | B   | | N   | | M   | |SHIFT| |SPACE|
                             A    10449 ;+-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
                             A    10450 ;
                             A    10451 ;
                             A    10452 ;						[] mosaic graphic			ï¿½  currency symbol
                             A    10453 ;
                             A    10454 ; -----------------------------------------------------------------------------
Zilog Macro Assembler.  Version K2.14    05-May-120    00:29:12    Page:  222


c:\users\john bradley\dropbox\ace-2019\newrom\ace3nokb.asm


    0 Warnings
    0 Errors
