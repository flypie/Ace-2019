Zilog Macro Assembler.  Version K2.14    27-Jan-120    21:37:00    Page:    1


c:\users\john bradley\dropbox\ace-2019\newrom\pio.asm

Location Object              Type  Line Source
                             A        1 	INCLUDE "iodefs.inc"
                   000000FC  B        1 KIOBASE	equ	0FCh
                             B        2 
                   00000000  B        3 PIOIOBASE	equ	00B
                   00000001  B        4 CTCIOBASE	equ	01B
                   00000002  B        5 SIOIOBASE	equ	10B
                   00000003  B        6 PIAIOBASE	equ	11B
                   00000003  B        7 KIOIOBASE	equ	11B
                             B        8 
                   00000000  B        9 PIOPORTADATA	equ	00b
                   00000001  B       10 PIOPORTACMD		equ	01b
                   00000000  B       11 PIOPORTBDATA	equ	00b
                   00000001  B       12 PIOPORTBCMD		equ	01b
                             B       13 
                   00000000  B       14 CTCCHANNEL0		equ	00b
                   00000001  B       15 CTCCHANNEL1		equ	01b
                   00000002  B       16 CTCCHANNEL2		equ	10b
                   00000003  B       17 CTCCHANNEL3		equ	11b
                             B       18 
                   00000000  B       19 SIOPORTADATA	equ	00b
                   00000001  B       20 SIOPORTACMD		equ	01b
                   00000000  B       21 SIOPORTBDATA	equ	00b
                   00000001  B       22 SIOPORTBCMD		equ	01b
                             B       23 
                   00000000  B       24 PIAPORTCDATA	equ	00b
                   00000001  B       25 PIAPORTCCMD		equ	01b
                             B       26 
                   00000002  B       27 KIOCOMMANDA		equ	10b
                   00000003  B       28 KIOCOMMANDB		equ	11b
                             B       29 
                             B       30 MAKEPORT	MACRO	Name,Base,Device,Register
                             B       31 Name equ Base|(Device<<8)|(Register<<10)
                             B       32 	endmac 
                             B       33 
                             B       34 
                             B       35 	MAKEPORT PIOADATA,KIOBASE,PIOIOBASE,PIOPORTADATA
                   000000FC  B+      35 Name equ Base|(Device<<8)|(Register<<10)
                             B       36 	MAKEPORT PIOACMD,KIOBASE,PIOIOBASE,PIOPORTACMD
                   000004FC  B+      36 Name equ Base|(Device<<8)|(Register<<10)
                             B       37 	MAKEPORT PIOBDATA,KIOBASE,PIOIOBASE,PIOPORTBDATA
                   000000FC  B+      37 Name equ Base|(Device<<8)|(Register<<10)
                             B       38 	MAKEPORT PIOBCMD,KIOBASE,PIOIOBASE,PIOPORTBCMD
                   000004FC  B+      38 Name equ Base|(Device<<8)|(Register<<10)
                             B       39 
                             B       40 	MAKEPORT CTCCH0,KIOBASE,CTCIOBASE,CTCCHANNEL0
                   000001FC  B+      40 Name equ Base|(Device<<8)|(Register<<10)
                             B       41 	MAKEPORT CTCCH1,KIOBASE,CTCIOBASE,CTCCHANNEL1
                   000005FC  B+      41 Name equ Base|(Device<<8)|(Register<<10)
                             B       42 	MAKEPORT CTCCH2,KIOBASE,CTCIOBASE,CTCCHANNEL2
                   000009FC  B+      42 Name equ Base|(Device<<8)|(Register<<10)
                             B       43 	MAKEPORT CTCCH3,KIOBASE,CTCIOBASE,CTCCHANNEL3
                   00000DFC  B+      43 Name equ Base|(Device<<8)|(Register<<10)
                             B       44 
                             B       45 	MAKEPORT SIOADATA,KIOBASE,SIOIOBASE,SIOPORTADATA
                   000002FC  B+      45 Name equ Base|(Device<<8)|(Register<<10)
                             B       46 	MAKEPORT SIOACMD,KIOBASE,SIOIOBASE,SIOPORTACMD
                   000006FC  B+      46 Name equ Base|(Device<<8)|(Register<<10)
                             B       47 	MAKEPORT SIOBDATA,KIOBASE,SIOIOBASE,SIOPORTBDATA
Zilog Macro Assembler.  Version K2.14    27-Jan-120    21:37:00    Page:    2


iodefs.inc

Location Object              Type  Line Source
                   000002FC  B+      47 Name equ Base|(Device<<8)|(Register<<10)
                             B       48 	MAKEPORT SIOBCMD,KIOBASE,SIOIOBASE,SIOPORTBCMD
                   000006FC  B+      48 Name equ Base|(Device<<8)|(Register<<10)
                             B       49 
                             B       50 	MAKEPORT PIOCDATA,KIOBASE,PIAIOBASE,PIAPORTCDATA
                   000003FC  B+      50 Name equ Base|(Device<<8)|(Register<<10)
                             B       51 	MAKEPORT PIOCCMD,KIOBASE,PIAIOBASE,PIAPORTCCMD
                   000007FC  B+      51 Name equ Base|(Device<<8)|(Register<<10)
                             B       52 
                             B       53 	MAKEPORT KIOCMDA,KIOBASE,KIOIOBASE,KIOCOMMANDA
                   00000BFC  B+      53 Name equ Base|(Device<<8)|(Register<<10)
                             B       54 	MAKEPORT KIOCMDB,KIOBASE,KIOIOBASE,KIOCOMMANDB
                   00000FFC  B+      54 Name equ Base|(Device<<8)|(Register<<10)
                             B       55 
                             B       56 	
                   000000F0  B       57 WDTMT	equ	0F0h
                   000000F1  B       58 WDTCR	equ	0F1h
                             B       59 
                   000000F4  B       60 IPR		equ	0F4h
                             B       61 
                   000000EE  B       62 SCRP	equ	0EEh
                   000000EF  B       63 SCDP	equ	0EFh
                             B       64 
                   00000020  B       65 SERIALTXBUFFLEN	equ	020h	;must be power of 2
                             B       66 
                             B       67 DEFB MACRO P1
                             B       68 	DB P1
                             B       69 	MACEND
                             B       70 
                             B       71 DEFW MACRO P1
                             B       72 	DW P1
                             B       73 	MACEND
                             B       74 
                             B       75 DEFM MACRO P1
                             B       76 	DB P1
                             B       77 	MACEND
                             B       78 
                             B       79 
                             A        2 	.DEFINE DEUCEROM
                             A        3 	.SECTION DEUCEROM
                             A        4 
                             A        5 	PUBLIC PIOAINT,PIOBINT,PIACINT,INIT_PIO
                             A        6 
00000000                     A        7 INIT_PIO:
00000000 3E 00               A        8 	ld	A,0  | (0<<1) ;use int 0
00000002 01 FC 04            A        9 	ld	BC,PIOACMD
00000005 ED 79               A       10 	out	(BC),A
00000007 3E 0F               A       11 	ld A,1111b  | (0<<6) ;Mode 0
00000009 01 FC 04            A       12 	ld	BC,PIOACMD
0000000C ED 79               A       13 	out	(BC),A
                             A       14 
0000000E 3E 02               A       15 	ld	A,0  | (1<<1)
00000010 01 FC 04            A       16 	ld	BC,PIOBCMD
00000013 ED 79               A       17 	out	(BC),A
00000015 3E 0F               A       18 	ld	A,1111b  | (0<<6) ;Mode 0
00000017 01 FC 04            A       19 	ld	BC,PIOBCMD
0000001A ED 79               A       20 	out	(BC),A
                             A       21 
Zilog Macro Assembler.  Version K2.14    27-Jan-120    21:37:00    Page:    3


c:\users\john bradley\dropbox\ace-2019\newrom\pio.asm

Location Object              Type  Line Source
0000001C C9                  A       22 	ret
                             A       23 
                             A       24 
0000001D                     A       25 PIOAINT:
                             A       26 ;	...	interrupt	routine
0000001D F3                  A       27 	di
0000001E F5                  A       28 	push	af
0000001F F1                  A       29 	pop	af
00000020 FB                  A       30 	ei
00000021 ED 4D               A       31 	RETI
                             A       32 
00000023                     A       33 PIOBINT:
                             A       34 ;	...	interrupt	routine
00000023 F3                  A       35 	di
00000024 F5                  A       36 	push	af
00000025 F1                  A       37 	pop	af
00000026 FB                  A       38 	ei
00000027 ED 4D               A       39 	RETI
                             A       40 
00000029                     A       41 PIACINT:
                             A       42 ;	...	interrupt	routine
00000029 F3                  A       43 	di
0000002A F5                  A       44 	push af
0000002B F1                  A       45 	pop af
0000002C FB                  A       46 	ei
0000002D ED 4D               A       47 	RETI	
                             A       48 
                             A       49 
Zilog Macro Assembler.  Version K2.14    27-Jan-120    21:37:00    Page:    4


c:\users\john bradley\dropbox\ace-2019\newrom\pio.asm


    0 Warnings
    0 Errors
